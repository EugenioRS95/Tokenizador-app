var jH=Object.create;var hh=Object.defineProperty;var BH=Object.getOwnPropertyDescriptor;var LH=Object.getOwnPropertyNames;var kH=Object.getPrototypeOf,FH=Object.prototype.hasOwnProperty;var _=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),UH=(e,t)=>{for(var r in t)hh(e,r,{get:t[r],enumerable:!0})},$T=(e,t,r,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let i of LH(t))!FH.call(e,i)&&i!==r&&hh(e,i,{get:()=>t[i],enumerable:!(n=BH(t,i))||n.enumerable});return e};var li=(e,t,r)=>(r=e!=null?jH(kH(e)):{},$T(t||!e||!e.__esModule?hh(r,"default",{value:e,enumerable:!0}):r,e)),VH=e=>$T(hh({},"__esModule",{value:!0}),e);var PT=_((cCe,WH)=>{WH.exports={_args:[["dotenv@16.0.3","D:\\FaztWeb\\TokenizadorApp"]],_from:"dotenv@16.0.3",_id:"dotenv@16.0.3",_inBundle:!1,_integrity:"sha512-7GO6HghkA5fYG9TYnNxi14/7K9f5occMlp3zXAuSxn7CKCxt9xbNWG7yF8hTCSUchlfWSe3uLmlPfigevRItzQ==",_location:"/dotenv",_phantomChildren:{},_requested:{type:"version",registry:!0,raw:"dotenv@16.0.3",name:"dotenv",escapedName:"dotenv",rawSpec:"16.0.3",saveSpec:null,fetchSpec:"16.0.3"},_requiredBy:["/"],_resolved:"https://registry.npmjs.org/dotenv/-/dotenv-16.0.3.tgz",_spec:"16.0.3",_where:"D:\\FaztWeb\\TokenizadorApp",bugs:{url:"https://github.com/motdotla/dotenv/issues"},description:"Loads environment variables from .env file",devDependencies:{"@types/node":"^17.0.9",decache:"^4.6.1",dtslint:"^3.7.0",sinon:"^12.0.1",standard:"^16.0.4","standard-markdown":"^7.1.0","standard-version":"^9.3.2",tap:"^15.1.6",tar:"^6.1.11",typescript:"^4.5.4"},engines:{node:">=12"},exports:{".":{require:"./lib/main.js",types:"./lib/main.d.ts",default:"./lib/main.js"},"./config":"./config.js","./config.js":"./config.js","./lib/env-options":"./lib/env-options.js","./lib/env-options.js":"./lib/env-options.js","./lib/cli-options":"./lib/cli-options.js","./lib/cli-options.js":"./lib/cli-options.js","./package.json":"./package.json"},homepage:"https://github.com/motdotla/dotenv#readme",keywords:["dotenv","env",".env","environment","variables","config","settings"],license:"BSD-2-Clause",main:"lib/main.js",name:"dotenv",repository:{type:"git",url:"git://github.com/motdotla/dotenv.git"},scripts:{"dts-check":"tsc --project tests/types/tsconfig.json",lint:"standard","lint-readme":"standard-markdown",prerelease:"npm test",pretest:"npm run lint && npm run dts-check",release:"standard-version",test:"tap tests/*.js --100 -Rspec"},types:"lib/main.d.ts",version:"16.0.3"}});var Kg=_((lCe,ph)=>{var zH=require("fs"),IT=require("path"),HH=require("os"),KH=PT(),GH=KH.version,QH=/(?:^|^)\s*(?:export\s+)?([\w.-]+)(?:\s*=\s*?|:\s+?)(\s*'(?:\\'|[^'])*'|\s*"(?:\\"|[^"])*"|\s*`(?:\\`|[^`])*`|[^#\r\n]+)?\s*(?:#.*)?(?:$|$)/mg;function YH(e){let t={},r=e.toString();r=r.replace(/\r\n?/mg,`
`);let n;for(;(n=QH.exec(r))!=null;){let i=n[1],s=n[2]||"";s=s.trim();let o=s[0];s=s.replace(/^(['"`])([\s\S]*)\1$/mg,"$2"),o==='"'&&(s=s.replace(/\\n/g,`
`),s=s.replace(/\\r/g,"\r")),t[i]=s}return t}function Hg(e){console.log(`[dotenv@${GH}][DEBUG] ${e}`)}function JH(e){return e[0]==="~"?IT.join(HH.homedir(),e.slice(1)):e}function XH(e){let t=IT.resolve(process.cwd(),".env"),r="utf8",n=Boolean(e&&e.debug),i=Boolean(e&&e.override);e&&(e.path!=null&&(t=JH(e.path)),e.encoding!=null&&(r=e.encoding));try{let s=dh.parse(zH.readFileSync(t,{encoding:r}));return Object.keys(s).forEach(function(o){Object.prototype.hasOwnProperty.call(process.env,o)?(i===!0&&(process.env[o]=s[o]),n&&Hg(i===!0?`"${o}" is already defined in \`process.env\` and WAS overwritten`:`"${o}" is already defined in \`process.env\` and was NOT overwritten`)):process.env[o]=s[o]}),{parsed:s}}catch(s){return n&&Hg(`Failed to load ${t} ${s.message}`),{error:s}}}var dh={config:XH,parse:YH};ph.exports.config=dh.config;ph.exports.parse=dh.parse;ph.exports=dh});var xn=_((fCe,Gg)=>{"use strict";var RT=null;Gg.exports.get=function(){return RT};Gg.exports.set=function(e){RT=e}});var mh=_((hCe,Tc)=>{"use strict";typeof global.Map<"u"?(Tc.exports=global.Map,Tc.exports.Map=global.Map):(hn=function(e){this._keys=[],this._values={};for(var t=0;t<e.length;t++)if(e[t]!=null){var r=e[t],n=r[0],i=r[1];this._keys.push(n),this._values[n]={v:i,i:this._keys.length-1}}},hn.prototype.clear=function(){this._keys=[],this._values={}},hn.prototype.delete=function(e){var t=this._values[e];return t==null?!1:(delete this._values[e],this._keys.splice(t.i,1),!0)},hn.prototype.entries=function(){var e=this,t=0;return{next:function(){var r=e._keys[t++];return{value:r!==void 0?[r,e._values[r].v]:void 0,done:r===void 0}}}},hn.prototype.forEach=function(e,t){t=t||this;for(var r=0;r<this._keys.length;r++){var n=this._keys[r];e.call(t,this._values[n].v,n,t)}},hn.prototype.get=function(e){return this._values[e]?this._values[e].v:void 0},hn.prototype.has=function(e){return this._values[e]!=null},hn.prototype.keys=function(){var e=this,t=0;return{next:function(){var r=e._keys[t++];return{value:r!==void 0?r:void 0,done:r===void 0}}}},hn.prototype.set=function(e,t){return this._values[e]?(this._values[e].v=t,this):(this._keys.push(e),this._values[e]={v:t,i:this._keys.length-1},this)},hn.prototype.values=function(){var e=this,t=0;return{next:function(){var r=e._keys[t++];return{value:r!==void 0?e._values[r].v:void 0,done:r===void 0}}}},Object.defineProperty(hn.prototype,"size",{enumerable:!0,get:function(){return this._keys.length}}),Tc.exports=hn,Tc.exports.Map=hn);var hn});var Ao=_((dCe,Qg)=>{function B(e,t){if(!(this instanceof B))return new B(e,t);this._bsontype="Long",this.low_=e|0,this.high_=t|0}B.prototype.toInt=function(){return this.low_};B.prototype.toNumber=function(){return this.high_*B.TWO_PWR_32_DBL_+this.getLowBitsUnsigned()};B.prototype.toBigInt=function(){return BigInt(this.toString())};B.prototype.toJSON=function(){return this.toString()};B.prototype.toString=function(e){var t=e||10;if(t<2||36<t)throw Error("radix out of range: "+t);if(this.isZero())return"0";if(this.isNegative())if(this.equals(B.MIN_VALUE)){var r=B.fromNumber(t),n=this.div(r),i=n.multiply(r).subtract(this);return n.toString(t)+i.toInt().toString(t)}else return"-"+this.negate().toString(t);var s=B.fromNumber(Math.pow(t,6));i=this;for(var o="";!i.isZero();){var a=i.div(s),u=i.subtract(a.multiply(s)).toInt(),c=u.toString(t);if(i=a,i.isZero())return c+o;for(;c.length<6;)c="0"+c;o=""+c+o}};B.prototype.getHighBits=function(){return this.high_};B.prototype.getLowBits=function(){return this.low_};B.prototype.getLowBitsUnsigned=function(){return this.low_>=0?this.low_:B.TWO_PWR_32_DBL_+this.low_};B.prototype.getNumBitsAbs=function(){if(this.isNegative())return this.equals(B.MIN_VALUE)?64:this.negate().getNumBitsAbs();for(var e=this.high_!==0?this.high_:this.low_,t=31;t>0&&(e&1<<t)===0;t--);return this.high_!==0?t+33:t+1};B.prototype.isZero=function(){return this.high_===0&&this.low_===0};B.prototype.isNegative=function(){return this.high_<0};B.prototype.isOdd=function(){return(this.low_&1)===1};B.prototype.equals=function(e){return this.high_===e.high_&&this.low_===e.low_};B.prototype.notEquals=function(e){return this.high_!==e.high_||this.low_!==e.low_};B.prototype.lessThan=function(e){return this.compare(e)<0};B.prototype.lessThanOrEqual=function(e){return this.compare(e)<=0};B.prototype.greaterThan=function(e){return this.compare(e)>0};B.prototype.greaterThanOrEqual=function(e){return this.compare(e)>=0};B.prototype.compare=function(e){if(this.equals(e))return 0;var t=this.isNegative(),r=e.isNegative();return t&&!r?-1:!t&&r?1:this.subtract(e).isNegative()?-1:1};B.prototype.negate=function(){return this.equals(B.MIN_VALUE)?B.MIN_VALUE:this.not().add(B.ONE)};B.prototype.add=function(e){var t=this.high_>>>16,r=this.high_&65535,n=this.low_>>>16,i=this.low_&65535,s=e.high_>>>16,o=e.high_&65535,a=e.low_>>>16,u=e.low_&65535,c=0,f=0,h=0,d=0;return d+=i+u,h+=d>>>16,d&=65535,h+=n+a,f+=h>>>16,h&=65535,f+=r+o,c+=f>>>16,f&=65535,c+=t+s,c&=65535,B.fromBits(h<<16|d,c<<16|f)};B.prototype.subtract=function(e){return this.add(e.negate())};B.prototype.multiply=function(e){if(this.isZero())return B.ZERO;if(e.isZero())return B.ZERO;if(this.equals(B.MIN_VALUE))return e.isOdd()?B.MIN_VALUE:B.ZERO;if(e.equals(B.MIN_VALUE))return this.isOdd()?B.MIN_VALUE:B.ZERO;if(this.isNegative())return e.isNegative()?this.negate().multiply(e.negate()):this.negate().multiply(e).negate();if(e.isNegative())return this.multiply(e.negate()).negate();if(this.lessThan(B.TWO_PWR_24_)&&e.lessThan(B.TWO_PWR_24_))return B.fromNumber(this.toNumber()*e.toNumber());var t=this.high_>>>16,r=this.high_&65535,n=this.low_>>>16,i=this.low_&65535,s=e.high_>>>16,o=e.high_&65535,a=e.low_>>>16,u=e.low_&65535,c=0,f=0,h=0,d=0;return d+=i*u,h+=d>>>16,d&=65535,h+=n*u,f+=h>>>16,h&=65535,h+=i*a,f+=h>>>16,h&=65535,f+=r*u,c+=f>>>16,f&=65535,f+=n*a,c+=f>>>16,f&=65535,f+=i*o,c+=f>>>16,f&=65535,c+=t*u+r*a+n*o+i*s,c&=65535,B.fromBits(h<<16|d,c<<16|f)};B.prototype.div=function(e){if(e.isZero())throw Error("division by zero");if(this.isZero())return B.ZERO;if(this.equals(B.MIN_VALUE)){if(e.equals(B.ONE)||e.equals(B.NEG_ONE))return B.MIN_VALUE;if(e.equals(B.MIN_VALUE))return B.ONE;var t=this.shiftRight(1),r=t.div(e).shiftLeft(1);if(r.equals(B.ZERO))return e.isNegative()?B.ONE:B.NEG_ONE;var n=this.subtract(e.multiply(r)),i=r.add(n.div(e));return i}else if(e.equals(B.MIN_VALUE))return B.ZERO;if(this.isNegative())return e.isNegative()?this.negate().div(e.negate()):this.negate().div(e).negate();if(e.isNegative())return this.div(e.negate()).negate();var s=B.ZERO;for(n=this;n.greaterThanOrEqual(e);){r=Math.max(1,Math.floor(n.toNumber()/e.toNumber()));for(var o=Math.ceil(Math.log(r)/Math.LN2),a=o<=48?1:Math.pow(2,o-48),u=B.fromNumber(r),c=u.multiply(e);c.isNegative()||c.greaterThan(n);)r-=a,u=B.fromNumber(r),c=u.multiply(e);u.isZero()&&(u=B.ONE),s=s.add(u),n=n.subtract(c)}return s};B.prototype.modulo=function(e){return this.subtract(this.div(e).multiply(e))};B.prototype.not=function(){return B.fromBits(~this.low_,~this.high_)};B.prototype.and=function(e){return B.fromBits(this.low_&e.low_,this.high_&e.high_)};B.prototype.or=function(e){return B.fromBits(this.low_|e.low_,this.high_|e.high_)};B.prototype.xor=function(e){return B.fromBits(this.low_^e.low_,this.high_^e.high_)};B.prototype.shiftLeft=function(e){if(e&=63,e===0)return this;var t=this.low_;if(e<32){var r=this.high_;return B.fromBits(t<<e,r<<e|t>>>32-e)}else return B.fromBits(0,t<<e-32)};B.prototype.shiftRight=function(e){if(e&=63,e===0)return this;var t=this.high_;if(e<32){var r=this.low_;return B.fromBits(r>>>e|t<<32-e,t>>e)}else return B.fromBits(t>>e-32,t>=0?0:-1)};B.prototype.shiftRightUnsigned=function(e){if(e&=63,e===0)return this;var t=this.high_;if(e<32){var r=this.low_;return B.fromBits(r>>>e|t<<32-e,t>>>e)}else return e===32?B.fromBits(t,0):B.fromBits(t>>>e-32,0)};B.fromInt=function(e){if(-128<=e&&e<128){var t=B.INT_CACHE_[e];if(t)return t}var r=new B(e|0,e<0?-1:0);return-128<=e&&e<128&&(B.INT_CACHE_[e]=r),r};B.fromNumber=function(e){return isNaN(e)||!isFinite(e)?B.ZERO:e<=-B.TWO_PWR_63_DBL_?B.MIN_VALUE:e+1>=B.TWO_PWR_63_DBL_?B.MAX_VALUE:e<0?B.fromNumber(-e).negate():new B(e%B.TWO_PWR_32_DBL_|0,e/B.TWO_PWR_32_DBL_|0)};B.fromBigInt=function(e){return B.fromString(e.toString(10),10)};B.fromBits=function(e,t){return new B(e,t)};B.fromString=function(e,t){if(e.length===0)throw Error("number format error: empty string");var r=t||10;if(r<2||36<r)throw Error("radix out of range: "+r);if(e.charAt(0)==="-")return B.fromString(e.substring(1),r).negate();if(e.indexOf("-")>=0)throw Error('number format error: interior "-" character: '+e);for(var n=B.fromNumber(Math.pow(r,8)),i=B.ZERO,s=0;s<e.length;s+=8){var o=Math.min(8,e.length-s),a=parseInt(e.substring(s,s+o),r);if(o<8){var u=B.fromNumber(Math.pow(r,o));i=i.multiply(u).add(B.fromNumber(a))}else i=i.multiply(n),i=i.add(B.fromNumber(a))}return i};B.INT_CACHE_={};B.TWO_PWR_16_DBL_=1<<16;B.TWO_PWR_24_DBL_=1<<24;B.TWO_PWR_32_DBL_=B.TWO_PWR_16_DBL_*B.TWO_PWR_16_DBL_;B.TWO_PWR_31_DBL_=B.TWO_PWR_32_DBL_/2;B.TWO_PWR_48_DBL_=B.TWO_PWR_32_DBL_*B.TWO_PWR_16_DBL_;B.TWO_PWR_64_DBL_=B.TWO_PWR_32_DBL_*B.TWO_PWR_32_DBL_;B.TWO_PWR_63_DBL_=B.TWO_PWR_64_DBL_/2;B.ZERO=B.fromInt(0);B.ONE=B.fromInt(1);B.NEG_ONE=B.fromInt(-1);B.MAX_VALUE=B.fromBits(-1,2147483647);B.MIN_VALUE=B.fromBits(0,-2147483648);B.TWO_PWR_24_=B.fromInt(1<<24);Qg.exports=B;Qg.exports.Long=B});var Ac=_((pCe,Yg)=>{function Ba(e){if(!(this instanceof Ba))return new Ba(e);this._bsontype="Double",this.value=e}Ba.prototype.valueOf=function(){return this.value};Ba.prototype.toJSON=function(){return this.value};Yg.exports=Ba;Yg.exports.Double=Ba});var xc=_((mCe,Jg)=>{function L(e,t){if(!(this instanceof L))return new L(e,t);this._bsontype="Timestamp",this.low_=e|0,this.high_=t|0}L.prototype.toInt=function(){return this.low_};L.prototype.toNumber=function(){return this.high_*L.TWO_PWR_32_DBL_+this.getLowBitsUnsigned()};L.prototype.toJSON=function(){return this.toString()};L.prototype.toString=function(e){var t=e||10;if(t<2||36<t)throw Error("radix out of range: "+t);if(this.isZero())return"0";if(this.isNegative())if(this.equals(L.MIN_VALUE)){var r=L.fromNumber(t),n=this.div(r),i=n.multiply(r).subtract(this);return n.toString(t)+i.toInt().toString(t)}else return"-"+this.negate().toString(t);var s=L.fromNumber(Math.pow(t,6));i=this;for(var o="";!i.isZero();){var a=i.div(s),u=i.subtract(a.multiply(s)).toInt(),c=u.toString(t);if(i=a,i.isZero())return c+o;for(;c.length<6;)c="0"+c;o=""+c+o}};L.prototype.getHighBits=function(){return this.high_};L.prototype.getLowBits=function(){return this.low_};L.prototype.getLowBitsUnsigned=function(){return this.low_>=0?this.low_:L.TWO_PWR_32_DBL_+this.low_};L.prototype.getNumBitsAbs=function(){if(this.isNegative())return this.equals(L.MIN_VALUE)?64:this.negate().getNumBitsAbs();for(var e=this.high_!==0?this.high_:this.low_,t=31;t>0&&(e&1<<t)===0;t--);return this.high_!==0?t+33:t+1};L.prototype.isZero=function(){return this.high_===0&&this.low_===0};L.prototype.isNegative=function(){return this.high_<0};L.prototype.isOdd=function(){return(this.low_&1)===1};L.prototype.equals=function(e){return this.high_===e.high_&&this.low_===e.low_};L.prototype.notEquals=function(e){return this.high_!==e.high_||this.low_!==e.low_};L.prototype.lessThan=function(e){return this.compare(e)<0};L.prototype.lessThanOrEqual=function(e){return this.compare(e)<=0};L.prototype.greaterThan=function(e){return this.compare(e)>0};L.prototype.greaterThanOrEqual=function(e){return this.compare(e)>=0};L.prototype.compare=function(e){if(this.equals(e))return 0;var t=this.isNegative(),r=e.isNegative();return t&&!r?-1:!t&&r?1:this.subtract(e).isNegative()?-1:1};L.prototype.negate=function(){return this.equals(L.MIN_VALUE)?L.MIN_VALUE:this.not().add(L.ONE)};L.prototype.add=function(e){var t=this.high_>>>16,r=this.high_&65535,n=this.low_>>>16,i=this.low_&65535,s=e.high_>>>16,o=e.high_&65535,a=e.low_>>>16,u=e.low_&65535,c=0,f=0,h=0,d=0;return d+=i+u,h+=d>>>16,d&=65535,h+=n+a,f+=h>>>16,h&=65535,f+=r+o,c+=f>>>16,f&=65535,c+=t+s,c&=65535,L.fromBits(h<<16|d,c<<16|f)};L.prototype.subtract=function(e){return this.add(e.negate())};L.prototype.multiply=function(e){if(this.isZero())return L.ZERO;if(e.isZero())return L.ZERO;if(this.equals(L.MIN_VALUE))return e.isOdd()?L.MIN_VALUE:L.ZERO;if(e.equals(L.MIN_VALUE))return this.isOdd()?L.MIN_VALUE:L.ZERO;if(this.isNegative())return e.isNegative()?this.negate().multiply(e.negate()):this.negate().multiply(e).negate();if(e.isNegative())return this.multiply(e.negate()).negate();if(this.lessThan(L.TWO_PWR_24_)&&e.lessThan(L.TWO_PWR_24_))return L.fromNumber(this.toNumber()*e.toNumber());var t=this.high_>>>16,r=this.high_&65535,n=this.low_>>>16,i=this.low_&65535,s=e.high_>>>16,o=e.high_&65535,a=e.low_>>>16,u=e.low_&65535,c=0,f=0,h=0,d=0;return d+=i*u,h+=d>>>16,d&=65535,h+=n*u,f+=h>>>16,h&=65535,h+=i*a,f+=h>>>16,h&=65535,f+=r*u,c+=f>>>16,f&=65535,f+=n*a,c+=f>>>16,f&=65535,f+=i*o,c+=f>>>16,f&=65535,c+=t*u+r*a+n*o+i*s,c&=65535,L.fromBits(h<<16|d,c<<16|f)};L.prototype.div=function(e){if(e.isZero())throw Error("division by zero");if(this.isZero())return L.ZERO;if(this.equals(L.MIN_VALUE)){if(e.equals(L.ONE)||e.equals(L.NEG_ONE))return L.MIN_VALUE;if(e.equals(L.MIN_VALUE))return L.ONE;var t=this.shiftRight(1),r=t.div(e).shiftLeft(1);if(r.equals(L.ZERO))return e.isNegative()?L.ONE:L.NEG_ONE;var n=this.subtract(e.multiply(r)),i=r.add(n.div(e));return i}else if(e.equals(L.MIN_VALUE))return L.ZERO;if(this.isNegative())return e.isNegative()?this.negate().div(e.negate()):this.negate().div(e).negate();if(e.isNegative())return this.div(e.negate()).negate();var s=L.ZERO;for(n=this;n.greaterThanOrEqual(e);){r=Math.max(1,Math.floor(n.toNumber()/e.toNumber()));for(var o=Math.ceil(Math.log(r)/Math.LN2),a=o<=48?1:Math.pow(2,o-48),u=L.fromNumber(r),c=u.multiply(e);c.isNegative()||c.greaterThan(n);)r-=a,u=L.fromNumber(r),c=u.multiply(e);u.isZero()&&(u=L.ONE),s=s.add(u),n=n.subtract(c)}return s};L.prototype.modulo=function(e){return this.subtract(this.div(e).multiply(e))};L.prototype.not=function(){return L.fromBits(~this.low_,~this.high_)};L.prototype.and=function(e){return L.fromBits(this.low_&e.low_,this.high_&e.high_)};L.prototype.or=function(e){return L.fromBits(this.low_|e.low_,this.high_|e.high_)};L.prototype.xor=function(e){return L.fromBits(this.low_^e.low_,this.high_^e.high_)};L.prototype.shiftLeft=function(e){if(e&=63,e===0)return this;var t=this.low_;if(e<32){var r=this.high_;return L.fromBits(t<<e,r<<e|t>>>32-e)}else return L.fromBits(0,t<<e-32)};L.prototype.shiftRight=function(e){if(e&=63,e===0)return this;var t=this.high_;if(e<32){var r=this.low_;return L.fromBits(r>>>e|t<<32-e,t>>e)}else return L.fromBits(t>>e-32,t>=0?0:-1)};L.prototype.shiftRightUnsigned=function(e){if(e&=63,e===0)return this;var t=this.high_;if(e<32){var r=this.low_;return L.fromBits(r>>>e|t<<32-e,t>>>e)}else return e===32?L.fromBits(t,0):L.fromBits(t>>>e-32,0)};L.fromInt=function(e){if(-128<=e&&e<128){var t=L.INT_CACHE_[e];if(t)return t}var r=new L(e|0,e<0?-1:0);return-128<=e&&e<128&&(L.INT_CACHE_[e]=r),r};L.fromNumber=function(e){return isNaN(e)||!isFinite(e)?L.ZERO:e<=-L.TWO_PWR_63_DBL_?L.MIN_VALUE:e+1>=L.TWO_PWR_63_DBL_?L.MAX_VALUE:e<0?L.fromNumber(-e).negate():new L(e%L.TWO_PWR_32_DBL_|0,e/L.TWO_PWR_32_DBL_|0)};L.fromBits=function(e,t){return new L(e,t)};L.fromString=function(e,t){if(e.length===0)throw Error("number format error: empty string");var r=t||10;if(r<2||36<r)throw Error("radix out of range: "+r);if(e.charAt(0)==="-")return L.fromString(e.substring(1),r).negate();if(e.indexOf("-")>=0)throw Error('number format error: interior "-" character: '+e);for(var n=L.fromNumber(Math.pow(r,8)),i=L.ZERO,s=0;s<e.length;s+=8){var o=Math.min(8,e.length-s),a=parseInt(e.substring(s,s+o),r);if(o<8){var u=L.fromNumber(Math.pow(r,o));i=i.multiply(u).add(L.fromNumber(a))}else i=i.multiply(n),i=i.add(L.fromNumber(a))}return i};L.INT_CACHE_={};L.TWO_PWR_16_DBL_=1<<16;L.TWO_PWR_24_DBL_=1<<24;L.TWO_PWR_32_DBL_=L.TWO_PWR_16_DBL_*L.TWO_PWR_16_DBL_;L.TWO_PWR_31_DBL_=L.TWO_PWR_32_DBL_/2;L.TWO_PWR_48_DBL_=L.TWO_PWR_32_DBL_*L.TWO_PWR_16_DBL_;L.TWO_PWR_64_DBL_=L.TWO_PWR_32_DBL_*L.TWO_PWR_32_DBL_;L.TWO_PWR_63_DBL_=L.TWO_PWR_64_DBL_/2;L.ZERO=L.fromInt(0);L.ONE=L.fromInt(1);L.NEG_ONE=L.fromInt(-1);L.MAX_VALUE=L.fromBits(-1,2147483647);L.MIN_VALUE=L.fromBits(0,-2147483648);L.TWO_PWR_24_=L.fromInt(1<<24);Jg.exports=L;Jg.exports.Timestamp=L});var Ms=_((yCe,jT)=>{"use strict";function ZH(e){return e.toString().replace(/function *\(/,"function (")}function DT(e,t){return new Buffer(e,t)}function e8(){return Buffer.alloc.apply(Buffer,arguments)}function t8(){return Buffer.from.apply(Buffer,arguments)}jT.exports={normalizedFunctionString:ZH,allocBuffer:typeof Buffer.alloc=="function"?e8:DT,toBuffer:typeof Buffer.from=="function"?t8:DT}});var Nc=_((gCe,_h)=>{var LT="inspect",gh=Ms(),Xg=parseInt(Math.random()*16777215,10),BT=new RegExp("^[0-9a-fA-F]{24}$");try{Buffer&&Buffer.from&&(yh=!0,LT=require("util").inspect.custom||"inspect")}catch{yh=!1}var yh,We=function e(t){if(t instanceof e)return t;if(!(this instanceof e))return new e(t);if(this._bsontype="ObjectID",t==null||typeof t=="number"){this.id=this.generate(t),e.cacheHexString&&(this.__id=this.toString("hex"));return}var r=e.isValid(t);if(!r&&t!=null)throw new Error("Argument passed in must be a single String of 12 bytes or a string of 24 hex characters");if(r&&typeof t=="string"&&t.length===24&&yh)return new e(gh.toBuffer(t,"hex"));if(r&&typeof t=="string"&&t.length===24)return e.createFromHexString(t);if(t!=null&&t.length===12)this.id=t;else{if(t!=null&&typeof t.toHexString=="function")return t;throw new Error("Argument passed in must be a single String of 12 bytes or a string of 24 hex characters")}e.cacheHexString&&(this.__id=this.toString("hex"))},kT=[];for(Jr=0;Jr<256;Jr++)kT[Jr]=(Jr<=15?"0":"")+Jr.toString(16);var Jr;We.prototype.toHexString=function(){if(We.cacheHexString&&this.__id)return this.__id;var e="";if(!this.id||!this.id.length)throw new Error("invalid ObjectId, ObjectId.id must be either a string or a Buffer, but is ["+JSON.stringify(this.id)+"]");if(this.id instanceof Mc)return e=r8(this.id),We.cacheHexString&&(this.__id=e),e;for(var t=0;t<this.id.length;t++)e+=kT[this.id.charCodeAt(t)];return We.cacheHexString&&(this.__id=e),e};We.prototype.get_inc=function(){return We.index=(We.index+1)%16777215};We.prototype.getInc=function(){return this.get_inc()};We.prototype.generate=function(e){typeof e!="number"&&(e=~~(Date.now()/1e3));var t=(typeof process>"u"||process.pid===1?Math.floor(Math.random()*1e5):process.pid)%65535,r=this.get_inc(),n=gh.allocBuffer(12);return n[3]=e&255,n[2]=e>>8&255,n[1]=e>>16&255,n[0]=e>>24&255,n[6]=Xg&255,n[5]=Xg>>8&255,n[4]=Xg>>16&255,n[8]=t&255,n[7]=t>>8&255,n[11]=r&255,n[10]=r>>8&255,n[9]=r>>16&255,n};We.prototype.toString=function(e){return this.id&&this.id.copy?this.id.toString(typeof e=="string"?e:"hex"):this.toHexString()};We.prototype[LT]=We.prototype.toString;We.prototype.toJSON=function(){return this.toHexString()};We.prototype.equals=function(t){return t instanceof We?this.toString()===t.toString():typeof t=="string"&&We.isValid(t)&&t.length===12&&this.id instanceof Mc?t===this.id.toString("binary"):typeof t=="string"&&We.isValid(t)&&t.length===24?t.toLowerCase()===this.toHexString():typeof t=="string"&&We.isValid(t)&&t.length===12?t===this.id:t!=null&&(t instanceof We||t.toHexString)?t.toHexString()===this.toHexString():!1};We.prototype.getTimestamp=function(){var e=new Date,t=this.id[3]|this.id[2]<<8|this.id[1]<<16|this.id[0]<<24;return e.setTime(Math.floor(t)*1e3),e};We.index=~~(Math.random()*16777215);We.createPk=function(){return new We};We.createFromTime=function(t){var r=gh.toBuffer([0,0,0,0,0,0,0,0,0,0,0,0]);return r[3]=t&255,r[2]=t>>8&255,r[1]=t>>16&255,r[0]=t>>24&255,new We(r)};var qc=[];Jr=0;for(;Jr<10;)qc[48+Jr]=Jr++;for(;Jr<16;)qc[65-10+Jr]=qc[97-10+Jr]=Jr++;var Mc=Buffer,r8=function(e){return e.toString("hex")};We.createFromHexString=function(t){if(typeof t>"u"||t!=null&&t.length!==24)throw new Error("Argument passed in must be a single String of 12 bytes or a string of 24 hex characters");if(yh)return new We(gh.toBuffer(t,"hex"));for(var r=new Mc(12),n=0,i=0;i<24;)r[n++]=qc[t.charCodeAt(i++)]<<4|qc[t.charCodeAt(i++)];return new We(r)};We.isValid=function(t){return t==null?!1:typeof t=="number"?!0:typeof t=="string"?t.length===12||t.length===24&&BT.test(t):t instanceof We||t instanceof Mc?!0:typeof t.toHexString=="function"&&(t.id instanceof Mc||typeof t.id=="string")?t.id.length===12||t.id.length===24&&BT.test(t.id):!1};Object.defineProperty(We.prototype,"generationTime",{enumerable:!0,get:function(){return this.id[3]|this.id[2]<<8|this.id[1]<<16|this.id[0]<<24},set:function(e){this.id[3]=e&255,this.id[2]=e>>8&255,this.id[1]=e>>16&255,this.id[0]=e>>24&255}});_h.exports=We;_h.exports.ObjectID=We;_h.exports.ObjectId=We});var $c=_((_Ce,Zg)=>{function wh(e,t){if(!(this instanceof wh))return new wh;this._bsontype="BSONRegExp",this.pattern=e||"",this.options=t||"";for(var r=0;r<this.options.length;r++)if(!(this.options[r]==="i"||this.options[r]==="m"||this.options[r]==="x"||this.options[r]==="l"||this.options[r]==="s"||this.options[r]==="u"))throw new Error("the regular expression options ["+this.options[r]+"] is not supported")}Zg.exports=wh;Zg.exports.BSONRegExp=wh});var Pc=_((wCe,e_)=>{var n8=Buffer&&require("util").inspect.custom||"inspect";function Ns(e){if(!(this instanceof Ns))return new Ns(e);this._bsontype="Symbol",this.value=e}Ns.prototype.valueOf=function(){return this.value};Ns.prototype.toString=function(){return this.value};Ns.prototype[n8]=function(){return this.value};Ns.prototype.toJSON=function(){return this.value};e_.exports=Ns;e_.exports.Symbol=Ns});var vh=_((vCe,t_)=>{var La=function(e){if(!(this instanceof La))return new La(e);this._bsontype="Int32",this.value=e};La.prototype.valueOf=function(){return this.value};La.prototype.toJSON=function(){return this.value};t_.exports=La;t_.exports.Int32=La});var Ic=_((SCe,n_)=>{var r_=function e(t,r){if(!(this instanceof e))return new e(t,r);this._bsontype="Code",this.code=t,this.scope=r};r_.prototype.toJSON=function(){return{scope:this.scope,code:this.code}};n_.exports=r_;n_.exports.Code=r_});var Dc=_((OCe,s_)=>{"use strict";var Te=Ao(),i8=/^(\+|-)?(\d+|(\d*\.\d*))?(E|e)?([-+])?(\d+)?$/,s8=/^(\+|-)?(Infinity|inf)$/i,o8=/^(\+|-)?NaN$/i,Rc=6111,Sh=-6176,i_=6176,a8=34,Oh=[124,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0].reverse(),bh=[248,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0].reverse(),Eh=[120,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0].reverse(),u8=/^([-+])?(\d+)?$/,Fi=Ms(),FT=function(e){return!isNaN(parseInt(e,10))},c8=function(e){var t=Te.fromNumber(1e9),r=Te.fromNumber(0),n=0;if(!e.parts[0]&&!e.parts[1]&&!e.parts[2]&&!e.parts[3])return{quotient:e,rem:r};for(n=0;n<=3;n++)r=r.shiftLeft(32),r=r.add(new Te(e.parts[n],0)),e.parts[n]=r.div(t).low_,r=r.modulo(t);return{quotient:e,rem:r}},l8=function(e,t){if(!e&&!t)return{high:Te.fromNumber(0),low:Te.fromNumber(0)};var r=e.shiftRightUnsigned(32),n=new Te(e.getLowBits(),0),i=t.shiftRightUnsigned(32),s=new Te(t.getLowBits(),0),o=r.multiply(i),a=r.multiply(s),u=n.multiply(i),c=n.multiply(s);return o=o.add(a.shiftRightUnsigned(32)),a=new Te(a.getLowBits(),0).add(u).add(c.shiftRightUnsigned(32)),o=o.add(a.shiftRightUnsigned(32)),c=a.shiftLeft(32).add(new Te(c.getLowBits(),0)),{high:o,low:c}},f8=function(e,t){var r=e.high_>>>0,n=t.high_>>>0;if(r<n)return!0;if(r===n){var i=e.low_>>>0,s=t.low_>>>0;if(i<s)return!0}return!1},Xr=function(e){this._bsontype="Decimal128",this.bytes=e};Xr.fromString=function(e){var t=!1,r=!1,n=!1,i=0,s=0,o=0,a=0,u=0,c=[0],f=0,h=0,d=0,p=0,m=0,y=0,g=[0,0],w=[0,0],S=0,v=0;if(e=e.trim(),e.length>=7e3)throw new Error(""+e+" not a valid Decimal128 string");var E=e.match(i8),A=e.match(s8),x=e.match(o8);if(!E&&!A&&!x||e.length===0)throw new Error(""+e+" not a valid Decimal128 string");if(E&&E[4]&&E[2]===void 0)throw new Error(""+e+" not a valid Decimal128 string");if((e[v]==="+"||e[v]==="-")&&(t=e[v++]==="-"),!FT(e[v])&&e[v]!=="."){if(e[v]==="i"||e[v]==="I")return new Xr(Fi.toBuffer(t?bh:Eh));if(e[v]==="N")return new Xr(Fi.toBuffer(Oh))}for(;FT(e[v])||e[v]===".";){if(e[v]==="."){if(r)return new Xr(Fi.toBuffer(Oh));r=!0,v=v+1;continue}f<34&&(e[v]!=="0"||n)&&(n||(u=s),n=!0,c[h++]=parseInt(e[v],10),f=f+1),n&&(o=o+1),r&&(a=a+1),s=s+1,v=v+1}if(r&&!s)throw new Error(""+e+" not a valid Decimal128 string");if(e[v]==="e"||e[v]==="E"){var z=e.substr(++v).match(u8);if(!z||!z[2])return new Xr(Fi.toBuffer(Oh));m=parseInt(z[0],10),v=v+z[0].length}if(e[v])return new Xr(Fi.toBuffer(Oh));if(d=0,!f)d=0,p=0,c[0]=0,o=1,f=1,i=0;else if(p=f-1,i=o,m!==0&&i!==1)for(;e[u+i-1]==="0";)i=i-1;for(m<=a&&a-m>1<<14?m=Sh:m=m-a;m>Rc;){if(p=p+1,p-d>a8){var k=c.join("");if(k.match(/^0+$/)){m=Rc;break}else return new Xr(Fi.toBuffer(t?bh:Eh))}m=m-1}for(;m<Sh||f<o;){if(p===0){m=Sh,i=0;break}if(f<o?o=o-1:p=p-1,m<Rc)m=m+1;else if(k=c.join(""),k.match(/^0+$/)){m=Rc;break}else return new Xr(Fi.toBuffer(t?bh:Eh))}if(p-d+1<i&&e[i]!=="0"){var P=s;r&&m===Sh&&(u=u+1,P=P+1);var Z=parseInt(e[u+p+1],10),F=0;if(Z>=5&&(F=1,Z===5)){for(F=c[p]%2===1,y=u+p+2;y<P;y++)if(parseInt(e[y],10)){F=1;break}}if(F){for(var b=p;b>=0&&++c[b]>9;b--)if(c[b]=0,b===0)if(m<Rc)m=m+1,c[b]=1;else return new Xr(Fi.toBuffer(t?bh:Eh))}}if(g=Te.fromNumber(0),w=Te.fromNumber(0),i===0)g=Te.fromNumber(0),w=Te.fromNumber(0);else if(p-d<17)for(b=d,w=Te.fromNumber(c[b++]),g=new Te(0,0);b<=p;b++)w=w.multiply(Te.fromNumber(10)),w=w.add(Te.fromNumber(c[b]));else{for(b=d,g=Te.fromNumber(c[b++]);b<=p-17;b++)g=g.multiply(Te.fromNumber(10)),g=g.add(Te.fromNumber(c[b]));for(w=Te.fromNumber(c[b++]);b<=p;b++)w=w.multiply(Te.fromNumber(10)),w=w.add(Te.fromNumber(c[b]))}var q=l8(g,Te.fromString("100000000000000000"));q.low=q.low.add(w),f8(q.low,w)&&(q.high=q.high.add(Te.fromNumber(1))),S=m+i_;var I={low:Te.fromNumber(0),high:Te.fromNumber(0)};q.high.shiftRightUnsigned(49).and(Te.fromNumber(1)).equals(Te.fromNumber)?(I.high=I.high.or(Te.fromNumber(3).shiftLeft(61)),I.high=I.high.or(Te.fromNumber(S).and(Te.fromNumber(16383).shiftLeft(47))),I.high=I.high.or(q.high.and(Te.fromNumber(0x7fffffffffff)))):(I.high=I.high.or(Te.fromNumber(S&16383).shiftLeft(49)),I.high=I.high.or(q.high.and(Te.fromNumber(562949953421311)))),I.low=q.low,t&&(I.high=I.high.or(Te.fromString("9223372036854775808")));var K=Fi.allocBuffer(16);return v=0,K[v++]=I.low.low_&255,K[v++]=I.low.low_>>8&255,K[v++]=I.low.low_>>16&255,K[v++]=I.low.low_>>24&255,K[v++]=I.low.high_&255,K[v++]=I.low.high_>>8&255,K[v++]=I.low.high_>>16&255,K[v++]=I.low.high_>>24&255,K[v++]=I.high.low_&255,K[v++]=I.high.low_>>8&255,K[v++]=I.high.low_>>16&255,K[v++]=I.high.low_>>24&255,K[v++]=I.high.high_&255,K[v++]=I.high.high_>>8&255,K[v++]=I.high.high_>>16&255,K[v++]=I.high.high_>>24&255,new Xr(K)};var h8=31,UT=16383,d8=30,p8=31;i_=6176;Xr.prototype.toString=function(){for(var e,t,r,n,i,s,o=0,a=new Array(36),u=0;u<a.length;u++)a[u]=0;var c=0,f,h,d=!1,p,m={parts:new Array(4)},y,g,w=[];c=0;var S=this.bytes;n=S[c++]|S[c++]<<8|S[c++]<<16|S[c++]<<24,r=S[c++]|S[c++]<<8|S[c++]<<16|S[c++]<<24,t=S[c++]|S[c++]<<8|S[c++]<<16|S[c++]<<24,e=S[c++]|S[c++]<<8|S[c++]<<16|S[c++]<<24,c=0;var v={low:new Te(n,r),high:new Te(t,e)};if(v.high.lessThan(Te.ZERO)&&w.push("-"),i=e>>26&h8,i>>3===3){if(i===d8)return w.join("")+"Infinity";if(i===p8)return"NaN";s=e>>15&UT,p=8+(e>>14&1)}else p=e>>14&7,s=e>>17&UT;if(f=s-i_,m.parts[0]=(e&16383)+((p&15)<<14),m.parts[1]=t,m.parts[2]=r,m.parts[3]=n,m.parts[0]===0&&m.parts[1]===0&&m.parts[2]===0&&m.parts[3]===0)d=!0;else for(g=3;g>=0;g--){var E=0,A=c8(m);if(m=A.quotient,E=A.rem.low_,!!E)for(y=8;y>=0;y--)a[g*9+y]=E%10,E=Math.floor(E/10)}if(d)o=1,a[c]=0;else for(o=36,u=0;!a[c];)u++,o=o-1,c=c+1;if(h=o-1+f,h>=34||h<=-7||f>0){for(w.push(a[c++]),o=o-1,o&&w.push("."),u=0;u<o;u++)w.push(a[c++]);w.push("E"),h>0?w.push("+"+h):w.push(h)}else if(f>=0)for(u=0;u<o;u++)w.push(a[c++]);else{var x=o+f;if(x>0)for(u=0;u<x;u++)w.push(a[c++]);else w.push("0");for(w.push(".");x++<0;)w.push("0");for(u=0;u<o-Math.max(x-1,0);u++)w.push(a[c++])}return w.join("")};Xr.prototype.toJSON=function(){return{$numberDecimal:this.toString()}};s_.exports=Xr;s_.exports.Decimal128=Xr});var jc=_((bCe,o_)=>{function Ch(){if(!(this instanceof Ch))return new Ch;this._bsontype="MinKey"}o_.exports=Ch;o_.exports.MinKey=Ch});var Bc=_((ECe,a_)=>{function Th(){if(!(this instanceof Th))return new Th;this._bsontype="MaxKey"}a_.exports=Th;a_.exports.MaxKey=Th});var kc=_((CCe,u_)=>{function Lc(e,t,r){if(!(this instanceof Lc))return new Lc(e,t,r);this._bsontype="DBRef",this.namespace=e,this.oid=t,this.db=r}Lc.prototype.toJSON=function(){return{$ref:this.namespace,$id:this.oid,$db:this.db==null?"":this.db}};u_.exports=Lc;u_.exports.DBRef=Lc});var ka=_((TCe,c_)=>{typeof global<"u"&&(rr=require("buffer").Buffer);var rr,Ah=Ms();function mt(e,t){if(!(this instanceof mt))return new mt(e,t);if(e!=null&&typeof e!="string"&&!rr.isBuffer(e)&&!(e instanceof Uint8Array)&&!Array.isArray(e))throw new Error("only String, Buffer, Uint8Array or Array accepted");if(this._bsontype="Binary",e instanceof Number?(this.sub_type=e,this.position=0):(this.sub_type=t??m8,this.position=0),e!=null&&!(e instanceof Number)){if(typeof e=="string")if(typeof rr<"u")this.buffer=Ah.toBuffer(e);else if(typeof Uint8Array<"u"||Object.prototype.toString.call(e)==="[object Array]")this.buffer=y8(e);else throw new Error("only String, Buffer, Uint8Array or Array accepted");else this.buffer=e;this.position=e.length}else typeof rr<"u"?this.buffer=Ah.allocBuffer(mt.BUFFER_SIZE):typeof Uint8Array<"u"?this.buffer=new Uint8Array(new ArrayBuffer(mt.BUFFER_SIZE)):this.buffer=new Array(mt.BUFFER_SIZE),this.position=0}mt.prototype.put=function(t){if(t.length!=null&&typeof t!="number"&&t.length!==1)throw new Error("only accepts single character String, Uint8Array or Array");if(typeof t!="number"&&t<0||t>255)throw new Error("only accepts number in a valid unsigned byte range 0-255");var r=null;if(typeof t=="string"?r=t.charCodeAt(0):t.length!=null?r=t[0]:r=t,this.buffer.length>this.position)this.buffer[this.position++]=r;else if(typeof rr<"u"&&rr.isBuffer(this.buffer)){var n=Ah.allocBuffer(mt.BUFFER_SIZE+this.buffer.length);this.buffer.copy(n,0,0,this.buffer.length),this.buffer=n,this.buffer[this.position++]=r}else{n=null,Object.prototype.toString.call(this.buffer)==="[object Uint8Array]"?n=new Uint8Array(new ArrayBuffer(mt.BUFFER_SIZE+this.buffer.length)):n=new Array(mt.BUFFER_SIZE+this.buffer.length);for(var i=0;i<this.buffer.length;i++)n[i]=this.buffer[i];this.buffer=n,this.buffer[this.position++]=r}};mt.prototype.write=function(t,r){if(r=typeof r=="number"?r:this.position,this.buffer.length<r+t.length){var n=null;if(typeof rr<"u"&&rr.isBuffer(this.buffer))n=Ah.allocBuffer(this.buffer.length+t.length),this.buffer.copy(n,0,0,this.buffer.length);else if(Object.prototype.toString.call(this.buffer)==="[object Uint8Array]"){n=new Uint8Array(new ArrayBuffer(this.buffer.length+t.length));for(var i=0;i<this.position;i++)n[i]=this.buffer[i]}this.buffer=n}if(typeof rr<"u"&&rr.isBuffer(t)&&rr.isBuffer(this.buffer))t.copy(this.buffer,r,0,t.length),this.position=r+t.length>this.position?r+t.length:this.position;else if(typeof rr<"u"&&typeof t=="string"&&rr.isBuffer(this.buffer))this.buffer.write(t,r,"binary"),this.position=r+t.length>this.position?r+t.length:this.position;else if(Object.prototype.toString.call(t)==="[object Uint8Array]"||Object.prototype.toString.call(t)==="[object Array]"&&typeof t!="string"){for(i=0;i<t.length;i++)this.buffer[r++]=t[i];this.position=r>this.position?r:this.position}else if(typeof t=="string"){for(i=0;i<t.length;i++)this.buffer[r++]=t.charCodeAt(i);this.position=r>this.position?r:this.position}};mt.prototype.read=function(t,r){if(r=r&&r>0?r:this.position,this.buffer.slice)return this.buffer.slice(t,t+r);for(var n=typeof Uint8Array<"u"?new Uint8Array(new ArrayBuffer(r)):new Array(r),i=0;i<r;i++)n[i]=this.buffer[t++];return n};mt.prototype.value=function(t){if(t=t??!1,t&&typeof rr<"u"&&rr.isBuffer(this.buffer)&&this.buffer.length===this.position)return this.buffer;if(typeof rr<"u"&&rr.isBuffer(this.buffer))return t?this.buffer.slice(0,this.position):this.buffer.toString("binary",0,this.position);if(t){if(this.buffer.slice!=null)return this.buffer.slice(0,this.position);for(var r=Object.prototype.toString.call(this.buffer)==="[object Uint8Array]"?new Uint8Array(new ArrayBuffer(this.position)):new Array(this.position),n=0;n<this.position;n++)r[n]=this.buffer[n];return r}else return g8(this.buffer,0,this.position)};mt.prototype.length=function(){return this.position};mt.prototype.toJSON=function(){return this.buffer!=null?this.buffer.toString("base64"):""};mt.prototype.toString=function(e){return this.buffer!=null?this.buffer.slice(0,this.position).toString(e):""};var m8=0,y8=function(e){for(var t=typeof Uint8Array<"u"?new Uint8Array(new ArrayBuffer(e.length)):new Array(e.length),r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t},g8=function(e,t,r){for(var n="",i=t;i<r;i++)n=n+String.fromCharCode(e[i]);return n};mt.BUFFER_SIZE=256;mt.SUBTYPE_DEFAULT=0;mt.SUBTYPE_FUNCTION=1;mt.SUBTYPE_BYTE_ARRAY=2;mt.SUBTYPE_UUID_OLD=3;mt.SUBTYPE_UUID=4;mt.SUBTYPE_MD5=5;mt.SUBTYPE_USER_DEFINED=128;c_.exports=mt;c_.exports.Binary=mt});var VT=_((exports,module)=>{"use strict";var Long=Ao().Long,Double=Ac().Double,Timestamp=xc().Timestamp,ObjectID=Nc().ObjectID,Symbol=Pc().Symbol,Code=Ic().Code,MinKey=jc().MinKey,MaxKey=Bc().MaxKey,Decimal128=Dc(),Int32=vh(),DBRef=kc().DBRef,BSONRegExp=$c().BSONRegExp,Binary=ka().Binary,utils=Ms(),deserialize=function(e,t,r){t=t??{};var n=t&&t.index?t.index:0,i=e[n]|e[n+1]<<8|e[n+2]<<16|e[n+3]<<24;if(i<5||e.length<i||i+n>e.length)throw new Error("corrupt bson message");if(e[n+i-1]!==0)throw new Error("One object, sized correctly, with a spot for an EOO, but the EOO isn't 0x00");return deserializeObject(e,n,t,r)},deserializeObject=function(e,t,r,n){var i=r.evalFunctions==null?!1:r.evalFunctions,s=r.cacheFunctions==null?!1:r.cacheFunctions,o=r.cacheFunctionsCrc32==null?!1:r.cacheFunctionsCrc32;if(!o)var a=null;var u=r.fieldsAsRaw==null?null:r.fieldsAsRaw,c=r.raw==null?!1:r.raw,f=typeof r.bsonRegExp=="boolean"?r.bsonRegExp:!1,h=r.promoteBuffers==null?!1:r.promoteBuffers,d=r.promoteLongs==null?!0:r.promoteLongs,p=r.promoteValues==null?!0:r.promoteValues,m=t;if(e.length<5)throw new Error("corrupt bson message < 5 bytes long");var y=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24;if(y<5||y>e.length)throw new Error("corrupt bson message");for(var g=n?[]:{},w=0,S=!1;!S;){var v=e[t++];if(v===0)break;for(var E=t;e[E]!==0&&E<e.length;)E++;if(E>=e.length)throw new Error("Bad BSON Document: illegal CString");var A=n?w++:e.toString("utf8",t,E);if(t=E+1,v===BSON.BSON_DATA_STRING){var x=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24;if(x<=0||x>e.length-t||e[t+x-1]!==0)throw new Error("bad string length in bson");g[A]=e.toString("utf8",t,t+x-1),t=t+x}else if(v===BSON.BSON_DATA_OID){var z=utils.allocBuffer(12);e.copy(z,0,t,t+12),g[A]=new ObjectID(z),t=t+12}else if(v===BSON.BSON_DATA_INT&&p===!1)g[A]=new Int32(e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24);else if(v===BSON.BSON_DATA_INT)g[A]=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24;else if(v===BSON.BSON_DATA_NUMBER&&p===!1)g[A]=new Double(e.readDoubleLE(t)),t=t+8;else if(v===BSON.BSON_DATA_NUMBER)g[A]=e.readDoubleLE(t),t=t+8;else if(v===BSON.BSON_DATA_DATE){var k=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24,P=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24;g[A]=new Date(new Long(k,P).toNumber())}else if(v===BSON.BSON_DATA_BOOLEAN){if(e[t]!==0&&e[t]!==1)throw new Error("illegal boolean type value");g[A]=e[t++]===1}else if(v===BSON.BSON_DATA_OBJECT){var Z=t,F=e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24;if(F<=0||F>e.length-t)throw new Error("bad embedded document length in bson");c?g[A]=e.slice(t,t+F):g[A]=deserializeObject(e,Z,r,!1),t=t+F}else if(v===BSON.BSON_DATA_ARRAY){Z=t,F=e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24;var b=r,q=t+F;if(u&&u[A]){b={};for(var I in r)b[I]=r[I];b.raw=!0}if(g[A]=deserializeObject(e,Z,b,!0),t=t+F,e[t-1]!==0)throw new Error("invalid array terminator byte");if(t!==q)throw new Error("corrupted array bson")}else if(v===BSON.BSON_DATA_UNDEFINED)g[A]=void 0;else if(v===BSON.BSON_DATA_NULL)g[A]=null;else if(v===BSON.BSON_DATA_LONG){k=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24,P=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24;var K=new Long(k,P);d&&p===!0?g[A]=K.lessThanOrEqual(JS_INT_MAX_LONG)&&K.greaterThanOrEqual(JS_INT_MIN_LONG)?K.toNumber():K:g[A]=K}else if(v===BSON.BSON_DATA_DECIMAL128){var C=utils.allocBuffer(16);e.copy(C,0,t,t+16),t=t+16;var R=new Decimal128(C);g[A]=R.toObject?R.toObject():R}else if(v===BSON.BSON_DATA_BINARY){var j=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24,H=j,ee=e[t++];if(j<0)throw new Error("Negative binary type element size found");if(j>e.length)throw new Error("Binary type size larger than document size");if(e.slice!=null){if(ee===Binary.SUBTYPE_BYTE_ARRAY){if(j=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24,j<0)throw new Error("Negative binary type element size found for subtype 0x02");if(j>H-4)throw new Error("Binary type with subtype 0x02 contains to long binary size");if(j<H-4)throw new Error("Binary type with subtype 0x02 contains to short binary size")}h&&p?g[A]=e.slice(t,t+j):g[A]=new Binary(e.slice(t,t+j),ee)}else{var X=typeof Uint8Array<"u"?new Uint8Array(new ArrayBuffer(j)):new Array(j);if(ee===Binary.SUBTYPE_BYTE_ARRAY){if(j=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24,j<0)throw new Error("Negative binary type element size found for subtype 0x02");if(j>H-4)throw new Error("Binary type with subtype 0x02 contains to long binary size");if(j<H-4)throw new Error("Binary type with subtype 0x02 contains to short binary size")}for(E=0;E<j;E++)X[E]=e[t+E];h&&p?g[A]=X:g[A]=new Binary(X,ee)}t=t+j}else if(v===BSON.BSON_DATA_REGEXP&&f===!1){for(E=t;e[E]!==0&&E<e.length;)E++;if(E>=e.length)throw new Error("Bad BSON Document: illegal CString");var Se=e.toString("utf8",t,E);for(t=E+1,E=t;e[E]!==0&&E<e.length;)E++;if(E>=e.length)throw new Error("Bad BSON Document: illegal CString");var Me=e.toString("utf8",t,E);t=E+1;var _t=new Array(Me.length);for(E=0;E<Me.length;E++)switch(Me[E]){case"m":_t[E]="m";break;case"s":_t[E]="g";break;case"i":_t[E]="i";break}g[A]=new RegExp(Se,_t.join(""))}else if(v===BSON.BSON_DATA_REGEXP&&f===!0){for(E=t;e[E]!==0&&E<e.length;)E++;if(E>=e.length)throw new Error("Bad BSON Document: illegal CString");for(Se=e.toString("utf8",t,E),t=E+1,E=t;e[E]!==0&&E<e.length;)E++;if(E>=e.length)throw new Error("Bad BSON Document: illegal CString");Me=e.toString("utf8",t,E),t=E+1,g[A]=new BSONRegExp(Se,Me)}else if(v===BSON.BSON_DATA_SYMBOL){if(x=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24,x<=0||x>e.length-t||e[t+x-1]!==0)throw new Error("bad string length in bson");g[A]=new Symbol(e.toString("utf8",t,t+x-1)),t=t+x}else if(v===BSON.BSON_DATA_TIMESTAMP)k=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24,P=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24,g[A]=new Timestamp(k,P);else if(v===BSON.BSON_DATA_MIN_KEY)g[A]=new MinKey;else if(v===BSON.BSON_DATA_MAX_KEY)g[A]=new MaxKey;else if(v===BSON.BSON_DATA_CODE){if(x=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24,x<=0||x>e.length-t||e[t+x-1]!==0)throw new Error("bad string length in bson");var Ge=e.toString("utf8",t,t+x-1);if(i)if(s){var le=o?a(Ge):Ge;g[A]=isolateEvalWithHash(functionCache,le,Ge,g)}else g[A]=isolateEval(Ge);else g[A]=new Code(Ge);t=t+x}else if(v===BSON.BSON_DATA_CODE_W_SCOPE){var ve=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24;if(ve<4+4+4+1)throw new Error("code_w_scope total size shorter minimum expected length");if(x=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24,x<=0||x>e.length-t||e[t+x-1]!==0)throw new Error("bad string length in bson");Ge=e.toString("utf8",t,t+x-1),t=t+x,Z=t,F=e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24;var et=deserializeObject(e,Z,r,!1);if(t=t+F,ve<4+4+F+x)throw new Error("code_w_scope total size is to short, truncating scope");if(ve>4+4+F+x)throw new Error("code_w_scope total size is to long, clips outer document");i?(s?(le=o?a(Ge):Ge,g[A]=isolateEvalWithHash(functionCache,le,Ge,g)):g[A]=isolateEval(Ge),g[A].scope=et):g[A]=new Code(Ge,et)}else if(v===BSON.BSON_DATA_DBPOINTER){if(x=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24,x<=0||x>e.length-t||e[t+x-1]!==0)throw new Error("bad string length in bson");var wt=e.toString("utf8",t,t+x-1);t=t+x;var dt=utils.allocBuffer(12);e.copy(dt,0,t,t+12),z=new ObjectID(dt),t=t+12;var ci=wt.split("."),Di=ci.shift(),ji=ci.join(".");g[A]=new DBRef(ji,z,Di)}else throw new Error("Detected unknown BSON type "+v.toString(16)+' for fieldname "'+A+'", are you using the latest BSON parser')}if(y!==t-m)throw n?new Error("corrupt array bson"):new Error("corrupt object bson");return g.$id!=null&&(g=new DBRef(g.$ref,g.$id,g.$db)),g},isolateEvalWithHash=function(functionCache,hash,functionString,object){var value=null;return functionCache[hash]==null&&(eval("value = "+functionString),functionCache[hash]=value),functionCache[hash].bind(object)},isolateEval=function(functionString){var value=null;return eval("value = "+functionString),value},BSON={},functionCache=BSON.functionCache={};BSON.BSON_DATA_NUMBER=1;BSON.BSON_DATA_STRING=2;BSON.BSON_DATA_OBJECT=3;BSON.BSON_DATA_ARRAY=4;BSON.BSON_DATA_BINARY=5;BSON.BSON_DATA_UNDEFINED=6;BSON.BSON_DATA_OID=7;BSON.BSON_DATA_BOOLEAN=8;BSON.BSON_DATA_DATE=9;BSON.BSON_DATA_NULL=10;BSON.BSON_DATA_REGEXP=11;BSON.BSON_DATA_DBPOINTER=12;BSON.BSON_DATA_CODE=13;BSON.BSON_DATA_SYMBOL=14;BSON.BSON_DATA_CODE_W_SCOPE=15;BSON.BSON_DATA_INT=16;BSON.BSON_DATA_TIMESTAMP=17;BSON.BSON_DATA_LONG=18;BSON.BSON_DATA_DECIMAL128=19;BSON.BSON_DATA_MIN_KEY=255;BSON.BSON_DATA_MAX_KEY=127;BSON.BSON_BINARY_SUBTYPE_DEFAULT=0;BSON.BSON_BINARY_SUBTYPE_FUNCTION=1;BSON.BSON_BINARY_SUBTYPE_BYTE_ARRAY=2;BSON.BSON_BINARY_SUBTYPE_UUID=3;BSON.BSON_BINARY_SUBTYPE_MD5=4;BSON.BSON_BINARY_SUBTYPE_USER_DEFINED=128;BSON.BSON_INT32_MAX=2147483647;BSON.BSON_INT32_MIN=-2147483648;BSON.BSON_INT64_MAX=Math.pow(2,63)-1;BSON.BSON_INT64_MIN=-Math.pow(2,63);BSON.JS_INT_MAX=9007199254740992;BSON.JS_INT_MIN=-9007199254740992;var JS_INT_MAX_LONG=Long.fromNumber(9007199254740992),JS_INT_MIN_LONG=Long.fromNumber(-9007199254740992);module.exports=deserialize});var WT=_(l_=>{var _8=function(e,t,r,n,i){var s,o,a=r==="big",u=i*8-n-1,c=(1<<u)-1,f=c>>1,h=-7,d=a?0:i-1,p=a?1:-1,m=e[t+d];for(d+=p,s=m&(1<<-h)-1,m>>=-h,h+=u;h>0;s=s*256+e[t+d],d+=p,h-=8);for(o=s&(1<<-h)-1,s>>=-h,h+=n;h>0;o=o*256+e[t+d],d+=p,h-=8);if(s===0)s=1-f;else{if(s===c)return o?NaN:(m?-1:1)*(1/0);o=o+Math.pow(2,n),s=s-f}return(m?-1:1)*o*Math.pow(2,s-n)},w8=function(e,t,r,n,i,s){var o,a,u,c=n==="big",f=s*8-i-1,h=(1<<f)-1,d=h>>1,p=i===23?Math.pow(2,-24)-Math.pow(2,-77):0,m=c?s-1:0,y=c?-1:1,g=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,o=h):(o=Math.floor(Math.log(t)/Math.LN2),t*(u=Math.pow(2,-o))<1&&(o--,u*=2),o+d>=1?t+=p/u:t+=p*Math.pow(2,1-d),t*u>=2&&(o++,u/=2),o+d>=h?(a=0,o=h):o+d>=1?(a=(t*u-1)*Math.pow(2,i),o=o+d):(a=t*Math.pow(2,d-1)*Math.pow(2,i),o=0));i>=8;e[r+m]=a&255,m+=y,a/=256,i-=8);for(o=o<<i|a,f+=i;f>0;e[r+m]=o&255,m+=y,o/=256,f-=8);e[r+m-y]|=g*128};l_.readIEEE754=_8;l_.writeIEEE754=w8});var QT=_((xCe,GT)=>{"use strict";var $_=WT().writeIEEE754,KT=Ao().Long,v8=mh(),zT=ka().Binary,S8=Ms().normalizedFunctionString,xh=/\x00/,HT=["$db","$ref","$id","$clusterTime"],f_=function(t){return typeof t=="object"&&Object.prototype.toString.call(t)==="[object Date]"},h_=function(t){return Object.prototype.toString.call(t)==="[object RegExp]"},d_=function(e,t,r,n,i){e[n++]=oe.BSON_DATA_STRING;var s=i?e.write(t,n,"ascii"):e.write(t,n,"utf8");n=n+s+1,e[n-1]=0;var o=e.write(r,n+4,"utf8");return e[n+3]=o+1>>24&255,e[n+2]=o+1>>16&255,e[n+1]=o+1>>8&255,e[n]=o+1&255,n=n+4+o,e[n++]=0,n},p_=function(e,t,r,n,i){if(Math.floor(r)===r&&r>=oe.JS_INT_MIN&&r<=oe.JS_INT_MAX)if(r>=oe.BSON_INT32_MIN&&r<=oe.BSON_INT32_MAX){e[n++]=oe.BSON_DATA_INT;var s=i?e.write(t,n,"ascii"):e.write(t,n,"utf8");n=n+s,e[n++]=0,e[n++]=r&255,e[n++]=r>>8&255,e[n++]=r>>16&255,e[n++]=r>>24&255}else if(r>=oe.JS_INT_MIN&&r<=oe.JS_INT_MAX)e[n++]=oe.BSON_DATA_NUMBER,s=i?e.write(t,n,"ascii"):e.write(t,n,"utf8"),n=n+s,e[n++]=0,$_(e,r,n,"little",52,8),n=n+8;else{e[n++]=oe.BSON_DATA_LONG,s=i?e.write(t,n,"ascii"):e.write(t,n,"utf8"),n=n+s,e[n++]=0;var o=KT.fromNumber(r),a=o.getLowBits(),u=o.getHighBits();e[n++]=a&255,e[n++]=a>>8&255,e[n++]=a>>16&255,e[n++]=a>>24&255,e[n++]=u&255,e[n++]=u>>8&255,e[n++]=u>>16&255,e[n++]=u>>24&255}else e[n++]=oe.BSON_DATA_NUMBER,s=i?e.write(t,n,"ascii"):e.write(t,n,"utf8"),n=n+s,e[n++]=0,$_(e,r,n,"little",52,8),n=n+8;return n},Fc=function(e,t,r,n,i){e[n++]=oe.BSON_DATA_NULL;var s=i?e.write(t,n,"ascii"):e.write(t,n,"utf8");return n=n+s,e[n++]=0,n},m_=function(e,t,r,n,i){e[n++]=oe.BSON_DATA_BOOLEAN;var s=i?e.write(t,n,"ascii"):e.write(t,n,"utf8");return n=n+s,e[n++]=0,e[n++]=r?1:0,n},y_=function(e,t,r,n,i){e[n++]=oe.BSON_DATA_DATE;var s=i?e.write(t,n,"ascii"):e.write(t,n,"utf8");n=n+s,e[n++]=0;var o=KT.fromNumber(r.getTime()),a=o.getLowBits(),u=o.getHighBits();return e[n++]=a&255,e[n++]=a>>8&255,e[n++]=a>>16&255,e[n++]=a>>24&255,e[n++]=u&255,e[n++]=u>>8&255,e[n++]=u>>16&255,e[n++]=u>>24&255,n},g_=function(e,t,r,n,i){e[n++]=oe.BSON_DATA_REGEXP;var s=i?e.write(t,n,"ascii"):e.write(t,n,"utf8");if(n=n+s,e[n++]=0,r.source&&r.source.match(xh)!=null)throw Error("value "+r.source+" must not contain null bytes");return n=n+e.write(r.source,n,"utf8"),e[n++]=0,r.global&&(e[n++]=115),r.ignoreCase&&(e[n++]=105),r.multiline&&(e[n++]=109),e[n++]=0,n},__=function(e,t,r,n,i){e[n++]=oe.BSON_DATA_REGEXP;var s=i?e.write(t,n,"ascii"):e.write(t,n,"utf8");if(n=n+s,e[n++]=0,r.pattern.match(xh)!=null)throw Error("pattern "+r.pattern+" must not contain null bytes");return n=n+e.write(r.pattern,n,"utf8"),e[n++]=0,n=n+e.write(r.options.split("").sort().join(""),n,"utf8"),e[n++]=0,n},w_=function(e,t,r,n,i){r===null?e[n++]=oe.BSON_DATA_NULL:r._bsontype==="MinKey"?e[n++]=oe.BSON_DATA_MIN_KEY:e[n++]=oe.BSON_DATA_MAX_KEY;var s=i?e.write(t,n,"ascii"):e.write(t,n,"utf8");return n=n+s,e[n++]=0,n},v_=function(e,t,r,n,i){e[n++]=oe.BSON_DATA_OID;var s=i?e.write(t,n,"ascii"):e.write(t,n,"utf8");if(n=n+s,e[n++]=0,typeof r.id=="string")e.write(r.id,n,"binary");else if(r.id&&r.id.copy)r.id.copy(e,n,0,12);else throw new Error("object ["+JSON.stringify(r)+"] is not a valid ObjectId");return n+12},S_=function(e,t,r,n,i){e[n++]=oe.BSON_DATA_BINARY;var s=i?e.write(t,n,"ascii"):e.write(t,n,"utf8");n=n+s,e[n++]=0;var o=r.length;return e[n++]=o&255,e[n++]=o>>8&255,e[n++]=o>>16&255,e[n++]=o>>24&255,e[n++]=oe.BSON_BINARY_SUBTYPE_DEFAULT,r.copy(e,n,0,o),n=n+o,n},O_=function(e,t,r,n,i,s,o,a,u,c){for(var f=0;f<c.length;f++)if(c[f]===r)throw new Error("cyclic dependency detected");c.push(r),e[n++]=Array.isArray(r)?oe.BSON_DATA_ARRAY:oe.BSON_DATA_OBJECT;var h=u?e.write(t,n,"ascii"):e.write(t,n,"utf8");n=n+h,e[n++]=0;var d=Uc(e,r,i,n,s+1,o,a,c);return c.pop(),d},b_=function(e,t,r,n,i){e[n++]=oe.BSON_DATA_DECIMAL128;var s=i?e.write(t,n,"ascii"):e.write(t,n,"utf8");return n=n+s,e[n++]=0,r.bytes.copy(e,n,0,16),n+16},E_=function(e,t,r,n,i){e[n++]=r._bsontype==="Long"?oe.BSON_DATA_LONG:oe.BSON_DATA_TIMESTAMP;var s=i?e.write(t,n,"ascii"):e.write(t,n,"utf8");n=n+s,e[n++]=0;var o=r.getLowBits(),a=r.getHighBits();return e[n++]=o&255,e[n++]=o>>8&255,e[n++]=o>>16&255,e[n++]=o>>24&255,e[n++]=a&255,e[n++]=a>>8&255,e[n++]=a>>16&255,e[n++]=a>>24&255,n},C_=function(e,t,r,n,i){e[n++]=oe.BSON_DATA_INT;var s=i?e.write(t,n,"ascii"):e.write(t,n,"utf8");return n=n+s,e[n++]=0,e[n++]=r&255,e[n++]=r>>8&255,e[n++]=r>>16&255,e[n++]=r>>24&255,n},T_=function(e,t,r,n,i){e[n++]=oe.BSON_DATA_NUMBER;var s=i?e.write(t,n,"ascii"):e.write(t,n,"utf8");return n=n+s,e[n++]=0,$_(e,r,n,"little",52,8),n=n+8,n},A_=function(e,t,r,n,i,s,o){e[n++]=oe.BSON_DATA_CODE;var a=o?e.write(t,n,"ascii"):e.write(t,n,"utf8");n=n+a,e[n++]=0;var u=S8(r),c=e.write(u,n+4,"utf8")+1;return e[n]=c&255,e[n+1]=c>>8&255,e[n+2]=c>>16&255,e[n+3]=c>>24&255,n=n+4+c-1,e[n++]=0,n},x_=function(e,t,r,n,i,s,o,a,u){if(r.scope&&typeof r.scope=="object"){e[n++]=oe.BSON_DATA_CODE_W_SCOPE;var c=u?e.write(t,n,"ascii"):e.write(t,n,"utf8");n=n+c,e[n++]=0;var f=n,h=typeof r.code=="string"?r.code:r.code.toString();n=n+4;var d=e.write(h,n+4,"utf8")+1;e[n]=d&255,e[n+1]=d>>8&255,e[n+2]=d>>16&255,e[n+3]=d>>24&255,e[n+4+d-1]=0,n=n+d+4;var p=Uc(e,r.scope,i,n,s+1,o,a);n=p-1;var m=p-f;e[f++]=m&255,e[f++]=m>>8&255,e[f++]=m>>16&255,e[f++]=m>>24&255,e[n++]=0}else{e[n++]=oe.BSON_DATA_CODE,c=u?e.write(t,n,"ascii"):e.write(t,n,"utf8"),n=n+c,e[n++]=0,h=r.code.toString();var y=e.write(h,n+4,"utf8")+1;e[n]=y&255,e[n+1]=y>>8&255,e[n+2]=y>>16&255,e[n+3]=y>>24&255,n=n+4+y-1,e[n++]=0}return n},q_=function(e,t,r,n,i){e[n++]=oe.BSON_DATA_BINARY;var s=i?e.write(t,n,"ascii"):e.write(t,n,"utf8");n=n+s,e[n++]=0;var o=r.value(!0),a=r.position;return r.sub_type===zT.SUBTYPE_BYTE_ARRAY&&(a=a+4),e[n++]=a&255,e[n++]=a>>8&255,e[n++]=a>>16&255,e[n++]=a>>24&255,e[n++]=r.sub_type,r.sub_type===zT.SUBTYPE_BYTE_ARRAY&&(a=a-4,e[n++]=a&255,e[n++]=a>>8&255,e[n++]=a>>16&255,e[n++]=a>>24&255),o.copy(e,n,0,r.position),n=n+r.position,n},M_=function(e,t,r,n,i){e[n++]=oe.BSON_DATA_SYMBOL;var s=i?e.write(t,n,"ascii"):e.write(t,n,"utf8");n=n+s,e[n++]=0;var o=e.write(r.value,n+4,"utf8")+1;return e[n]=o&255,e[n+1]=o>>8&255,e[n+2]=o>>16&255,e[n+3]=o>>24&255,n=n+4+o-1,e[n++]=0,n},N_=function(e,t,r,n,i,s,o){e[n++]=oe.BSON_DATA_OBJECT;var a=o?e.write(t,n,"ascii"):e.write(t,n,"utf8");n=n+a,e[n++]=0;var u=n,c;r.db!=null?c=Uc(e,{$ref:r.namespace,$id:r.oid,$db:r.db},!1,n,i+1,s):c=Uc(e,{$ref:r.namespace,$id:r.oid},!1,n,i+1,s);var f=c-u;return e[u++]=f&255,e[u++]=f>>8&255,e[u++]=f>>16&255,e[u++]=f>>24&255,c},Uc=function(t,r,n,i,s,o,a,u){i=i||0,u=u||[],u.push(r);var c=i+4;if(Array.isArray(r))for(var f=0;f<r.length;f++){var h=""+f,d=r[f];if(d&&d.toBSON){if(typeof d.toBSON!="function")throw new Error("toBSON is not a function");d=d.toBSON()}var p=typeof d;if(p==="string")c=d_(t,h,d,c,!0);else if(p==="number")c=p_(t,h,d,c,!0);else{if(p==="bigint")throw new TypeError("Unsupported type BigInt, please use Decimal128");if(p==="boolean")c=m_(t,h,d,c,!0);else if(d instanceof Date||f_(d))c=y_(t,h,d,c,!0);else if(d===void 0)c=Fc(t,h,d,c,!0);else if(d===null)c=Fc(t,h,d,c,!0);else if(d._bsontype==="ObjectID"||d._bsontype==="ObjectId")c=v_(t,h,d,c,!0);else if(Buffer.isBuffer(d))c=S_(t,h,d,c,!0);else if(d instanceof RegExp||h_(d))c=g_(t,h,d,c,!0);else if(p==="object"&&d._bsontype==null)c=O_(t,h,d,c,n,s,o,a,!0,u);else if(p==="object"&&d._bsontype==="Decimal128")c=b_(t,h,d,c,!0);else if(d._bsontype==="Long"||d._bsontype==="Timestamp")c=E_(t,h,d,c,!0);else if(d._bsontype==="Double")c=T_(t,h,d,c,!0);else if(typeof d=="function"&&o)c=A_(t,h,d,c,n,s,o,!0);else if(d._bsontype==="Code")c=x_(t,h,d,c,n,s,o,a,!0);else if(d._bsontype==="Binary")c=q_(t,h,d,c,!0);else if(d._bsontype==="Symbol")c=M_(t,h,d,c,!0);else if(d._bsontype==="DBRef")c=N_(t,h,d,c,s,o,!0);else if(d._bsontype==="BSONRegExp")c=__(t,h,d,c,!0);else if(d._bsontype==="Int32")c=C_(t,h,d,c,!0);else if(d._bsontype==="MinKey"||d._bsontype==="MaxKey")c=w_(t,h,d,c,!0);else if(typeof d._bsontype<"u")throw new TypeError("Unrecognized or invalid _bsontype: "+d._bsontype)}}else if(r instanceof v8)for(var m=r.entries(),y=!1;!y;){var g=m.next();if(y=g.done,!y){if(h=g.value[0],d=g.value[1],p=typeof d,typeof h=="string"&&HT.indexOf(h)===-1){if(h.match(xh)!=null)throw Error("key "+h+" must not contain null bytes");if(n){if(h[0]==="$")throw Error("key "+h+" must not start with '$'");if(~h.indexOf("."))throw Error("key "+h+" must not contain '.'")}}if(p==="string")c=d_(t,h,d,c);else if(p==="number")c=p_(t,h,d,c);else{if(p==="bigint")throw new TypeError("Unsupported type BigInt, please use Decimal128");if(p==="boolean")c=m_(t,h,d,c);else if(d instanceof Date||f_(d))c=y_(t,h,d,c);else if(d===null||d===void 0&&a===!1)c=Fc(t,h,d,c);else if(d._bsontype==="ObjectID"||d._bsontype==="ObjectId")c=v_(t,h,d,c);else if(Buffer.isBuffer(d))c=S_(t,h,d,c);else if(d instanceof RegExp||h_(d))c=g_(t,h,d,c);else if(p==="object"&&d._bsontype==null)c=O_(t,h,d,c,n,s,o,a,!1,u);else if(p==="object"&&d._bsontype==="Decimal128")c=b_(t,h,d,c);else if(d._bsontype==="Long"||d._bsontype==="Timestamp")c=E_(t,h,d,c);else if(d._bsontype==="Double")c=T_(t,h,d,c);else if(d._bsontype==="Code")c=x_(t,h,d,c,n,s,o,a);else if(typeof d=="function"&&o)c=A_(t,h,d,c,n,s,o);else if(d._bsontype==="Binary")c=q_(t,h,d,c);else if(d._bsontype==="Symbol")c=M_(t,h,d,c);else if(d._bsontype==="DBRef")c=N_(t,h,d,c,s,o);else if(d._bsontype==="BSONRegExp")c=__(t,h,d,c);else if(d._bsontype==="Int32")c=C_(t,h,d,c);else if(d._bsontype==="MinKey"||d._bsontype==="MaxKey")c=w_(t,h,d,c);else if(typeof d._bsontype<"u")throw new TypeError("Unrecognized or invalid _bsontype: "+d._bsontype)}}}else{if(r.toBSON){if(typeof r.toBSON!="function")throw new Error("toBSON is not a function");if(r=r.toBSON(),r!=null&&typeof r!="object")throw new Error("toBSON function did not return an object")}for(h in r){if(d=r[h],d&&d.toBSON){if(typeof d.toBSON!="function")throw new Error("toBSON is not a function");d=d.toBSON()}if(p=typeof d,typeof h=="string"&&HT.indexOf(h)===-1){if(h.match(xh)!=null)throw Error("key "+h+" must not contain null bytes");if(n){if(h[0]==="$")throw Error("key "+h+" must not start with '$'");if(~h.indexOf("."))throw Error("key "+h+" must not contain '.'")}}if(p==="string")c=d_(t,h,d,c);else if(p==="number")c=p_(t,h,d,c);else{if(p==="bigint")throw new TypeError("Unsupported type BigInt, please use Decimal128");if(p==="boolean")c=m_(t,h,d,c);else if(d instanceof Date||f_(d))c=y_(t,h,d,c);else if(d===void 0)a===!1&&(c=Fc(t,h,d,c));else if(d===null)c=Fc(t,h,d,c);else if(d._bsontype==="ObjectID"||d._bsontype==="ObjectId")c=v_(t,h,d,c);else if(Buffer.isBuffer(d))c=S_(t,h,d,c);else if(d instanceof RegExp||h_(d))c=g_(t,h,d,c);else if(p==="object"&&d._bsontype==null)c=O_(t,h,d,c,n,s,o,a,!1,u);else if(p==="object"&&d._bsontype==="Decimal128")c=b_(t,h,d,c);else if(d._bsontype==="Long"||d._bsontype==="Timestamp")c=E_(t,h,d,c);else if(d._bsontype==="Double")c=T_(t,h,d,c);else if(d._bsontype==="Code")c=x_(t,h,d,c,n,s,o,a);else if(typeof d=="function"&&o)c=A_(t,h,d,c,n,s,o);else if(d._bsontype==="Binary")c=q_(t,h,d,c);else if(d._bsontype==="Symbol")c=M_(t,h,d,c);else if(d._bsontype==="DBRef")c=N_(t,h,d,c,s,o);else if(d._bsontype==="BSONRegExp")c=__(t,h,d,c);else if(d._bsontype==="Int32")c=C_(t,h,d,c);else if(d._bsontype==="MinKey"||d._bsontype==="MaxKey")c=w_(t,h,d,c);else if(typeof d._bsontype<"u")throw new TypeError("Unrecognized or invalid _bsontype: "+d._bsontype)}}}u.pop(),t[c++]=0;var w=c-i;return t[i++]=w&255,t[i++]=w>>8&255,t[i++]=w>>16&255,t[i++]=w>>24&255,c},oe={};oe.BSON_DATA_NUMBER=1;oe.BSON_DATA_STRING=2;oe.BSON_DATA_OBJECT=3;oe.BSON_DATA_ARRAY=4;oe.BSON_DATA_BINARY=5;oe.BSON_DATA_UNDEFINED=6;oe.BSON_DATA_OID=7;oe.BSON_DATA_BOOLEAN=8;oe.BSON_DATA_DATE=9;oe.BSON_DATA_NULL=10;oe.BSON_DATA_REGEXP=11;oe.BSON_DATA_CODE=13;oe.BSON_DATA_SYMBOL=14;oe.BSON_DATA_CODE_W_SCOPE=15;oe.BSON_DATA_INT=16;oe.BSON_DATA_TIMESTAMP=17;oe.BSON_DATA_LONG=18;oe.BSON_DATA_DECIMAL128=19;oe.BSON_DATA_MIN_KEY=255;oe.BSON_DATA_MAX_KEY=127;oe.BSON_BINARY_SUBTYPE_DEFAULT=0;oe.BSON_BINARY_SUBTYPE_FUNCTION=1;oe.BSON_BINARY_SUBTYPE_BYTE_ARRAY=2;oe.BSON_BINARY_SUBTYPE_UUID=3;oe.BSON_BINARY_SUBTYPE_MD5=4;oe.BSON_BINARY_SUBTYPE_USER_DEFINED=128;oe.BSON_INT32_MAX=2147483647;oe.BSON_INT32_MIN=-2147483648;oe.BSON_INT64_MAX=Math.pow(2,63)-1;oe.BSON_INT64_MIN=-Math.pow(2,63);oe.JS_INT_MAX=9007199254740992;oe.JS_INT_MIN=-9007199254740992;GT.exports=Uc});var eA=_((qCe,ZT)=>{"use strict";var O8=Ao().Long,b8=Ac().Double,E8=xc().Timestamp,C8=Nc().ObjectID,T8=Pc().Symbol,A8=$c().BSONRegExp,x8=Ic().Code,q8=Dc(),M8=jc().MinKey,N8=Bc().MaxKey,$8=kc().DBRef,YT=ka().Binary,JT=Ms().normalizedFunctionString,P8=function(t){return typeof t=="object"&&Object.prototype.toString.call(t)==="[object Date]"},Vc=function(t,r,n){var i=5;if(Array.isArray(t))for(var s=0;s<t.length;s++)i+=XT(s.toString(),t[s],r,!0,n);else{t.toBSON&&(t=t.toBSON());for(var o in t)i+=XT(o,t[o],r,!1,n)}return i};function XT(e,t,r,n,i){switch(t&&t.toBSON&&(t=t.toBSON()),typeof t){case"string":return 1+Buffer.byteLength(e,"utf8")+1+4+Buffer.byteLength(t,"utf8")+1;case"number":return Math.floor(t)===t&&t>=$s.JS_INT_MIN&&t<=$s.JS_INT_MAX&&t>=$s.BSON_INT32_MIN&&t<=$s.BSON_INT32_MAX?(e!=null?Buffer.byteLength(e,"utf8")+1:0)+(4+1):(e!=null?Buffer.byteLength(e,"utf8")+1:0)+(8+1);case"undefined":return n||!i?(e!=null?Buffer.byteLength(e,"utf8")+1:0)+1:0;case"boolean":return(e!=null?Buffer.byteLength(e,"utf8")+1:0)+(1+1);case"object":if(t==null||t instanceof M8||t instanceof N8||t._bsontype==="MinKey"||t._bsontype==="MaxKey")return(e!=null?Buffer.byteLength(e,"utf8")+1:0)+1;if(t instanceof C8||t._bsontype==="ObjectID"||t._bsontype==="ObjectId")return(e!=null?Buffer.byteLength(e,"utf8")+1:0)+(12+1);if(t instanceof Date||P8(t))return(e!=null?Buffer.byteLength(e,"utf8")+1:0)+(8+1);if(typeof Buffer<"u"&&Buffer.isBuffer(t))return(e!=null?Buffer.byteLength(e,"utf8")+1:0)+(1+4+1)+t.length;if(t instanceof O8||t instanceof b8||t instanceof E8||t._bsontype==="Long"||t._bsontype==="Double"||t._bsontype==="Timestamp")return(e!=null?Buffer.byteLength(e,"utf8")+1:0)+(8+1);if(t instanceof q8||t._bsontype==="Decimal128")return(e!=null?Buffer.byteLength(e,"utf8")+1:0)+(16+1);if(t instanceof x8||t._bsontype==="Code")return t.scope!=null&&Object.keys(t.scope).length>0?(e!=null?Buffer.byteLength(e,"utf8")+1:0)+1+4+4+Buffer.byteLength(t.code.toString(),"utf8")+1+Vc(t.scope,r,i):(e!=null?Buffer.byteLength(e,"utf8")+1:0)+1+4+Buffer.byteLength(t.code.toString(),"utf8")+1;if(t instanceof YT||t._bsontype==="Binary")return t.sub_type===YT.SUBTYPE_BYTE_ARRAY?(e!=null?Buffer.byteLength(e,"utf8")+1:0)+(t.position+1+4+1+4):(e!=null?Buffer.byteLength(e,"utf8")+1:0)+(t.position+1+4+1);if(t instanceof T8||t._bsontype==="Symbol")return(e!=null?Buffer.byteLength(e,"utf8")+1:0)+Buffer.byteLength(t.value,"utf8")+4+1+1;if(t instanceof $8||t._bsontype==="DBRef"){var s={$ref:t.namespace,$id:t.oid};return t.db!=null&&(s.$db=t.db),(e!=null?Buffer.byteLength(e,"utf8")+1:0)+1+Vc(s,r,i)}else return t instanceof RegExp||Object.prototype.toString.call(t)==="[object RegExp]"?(e!=null?Buffer.byteLength(e,"utf8")+1:0)+1+Buffer.byteLength(t.source,"utf8")+1+(t.global?1:0)+(t.ignoreCase?1:0)+(t.multiline?1:0)+1:t instanceof A8||t._bsontype==="BSONRegExp"?(e!=null?Buffer.byteLength(e,"utf8")+1:0)+1+Buffer.byteLength(t.pattern,"utf8")+1+Buffer.byteLength(t.options,"utf8")+1:(e!=null?Buffer.byteLength(e,"utf8")+1:0)+Vc(t,r,i)+1;case"function":if(t instanceof RegExp||Object.prototype.toString.call(t)==="[object RegExp]"||String.call(t)==="[object RegExp]")return(e!=null?Buffer.byteLength(e,"utf8")+1:0)+1+Buffer.byteLength(t.source,"utf8")+1+(t.global?1:0)+(t.ignoreCase?1:0)+(t.multiline?1:0)+1;if(r&&t.scope!=null&&Object.keys(t.scope).length>0)return(e!=null?Buffer.byteLength(e,"utf8")+1:0)+1+4+4+Buffer.byteLength(JT(t),"utf8")+1+Vc(t.scope,r,i);if(r)return(e!=null?Buffer.byteLength(e,"utf8")+1:0)+1+4+Buffer.byteLength(JT(t),"utf8")+1}return 0}var $s={};$s.BSON_INT32_MAX=2147483647;$s.BSON_INT32_MIN=-2147483648;$s.JS_INT_MAX=9007199254740992;$s.JS_INT_MIN=-9007199254740992;ZT.exports=Vc});var nA=_((MCe,nr)=>{"use strict";var I8=mh(),R8=Ao(),D8=Ac(),j8=xc(),B8=Nc(),L8=$c(),k8=Pc(),F8=vh(),U8=Ic(),V8=Dc(),W8=jc(),z8=Bc(),H8=kc(),K8=ka(),G8=VT(),tA=QT(),Q8=eA(),P_=Ms(),rA=1024*1024*17,qh=P_.allocBuffer(rA),Ie=function(){};Ie.prototype.serialize=function(t,r){r=r||{};var n=typeof r.checkKeys=="boolean"?r.checkKeys:!1,i=typeof r.serializeFunctions=="boolean"?r.serializeFunctions:!1,s=typeof r.ignoreUndefined=="boolean"?r.ignoreUndefined:!0,o=typeof r.minInternalBufferSize=="number"?r.minInternalBufferSize:rA;qh.length<o&&(qh=P_.allocBuffer(o));var a=tA(qh,t,n,0,0,i,s,[]),u=P_.allocBuffer(a);return qh.copy(u,0,0,u.length),u};Ie.prototype.serializeWithBufferAndIndex=function(e,t,r){r=r||{};var n=typeof r.checkKeys=="boolean"?r.checkKeys:!1,i=typeof r.serializeFunctions=="boolean"?r.serializeFunctions:!1,s=typeof r.ignoreUndefined=="boolean"?r.ignoreUndefined:!0,o=typeof r.index=="number"?r.index:0,a=tA(t,e,n,o||0,0,i,s);return a-1};Ie.prototype.deserialize=function(e,t){return G8(e,t)};Ie.prototype.calculateObjectSize=function(e,t){t=t||{};var r=typeof t.serializeFunctions=="boolean"?t.serializeFunctions:!1,n=typeof t.ignoreUndefined=="boolean"?t.ignoreUndefined:!0;return Q8(e,r,n)};Ie.prototype.deserializeStream=function(e,t,r,n,i,s){s=s??{};for(var o=t,a=0;a<r;a++){var u=e[o]|e[o+1]<<8|e[o+2]<<16|e[o+3]<<24;s.index=o,n[i+a]=this.deserialize(e,s),o=o+u}return o};Ie.BSON_INT32_MAX=2147483647;Ie.BSON_INT32_MIN=-2147483648;Ie.BSON_INT64_MAX=Math.pow(2,63)-1;Ie.BSON_INT64_MIN=-Math.pow(2,63);Ie.JS_INT_MAX=9007199254740992;Ie.JS_INT_MIN=-9007199254740992;Ie.BSON_DATA_NUMBER=1;Ie.BSON_DATA_STRING=2;Ie.BSON_DATA_OBJECT=3;Ie.BSON_DATA_ARRAY=4;Ie.BSON_DATA_BINARY=5;Ie.BSON_DATA_OID=7;Ie.BSON_DATA_BOOLEAN=8;Ie.BSON_DATA_DATE=9;Ie.BSON_DATA_NULL=10;Ie.BSON_DATA_REGEXP=11;Ie.BSON_DATA_CODE=13;Ie.BSON_DATA_SYMBOL=14;Ie.BSON_DATA_CODE_W_SCOPE=15;Ie.BSON_DATA_INT=16;Ie.BSON_DATA_TIMESTAMP=17;Ie.BSON_DATA_LONG=18;Ie.BSON_DATA_MIN_KEY=255;Ie.BSON_DATA_MAX_KEY=127;Ie.BSON_BINARY_SUBTYPE_DEFAULT=0;Ie.BSON_BINARY_SUBTYPE_FUNCTION=1;Ie.BSON_BINARY_SUBTYPE_BYTE_ARRAY=2;Ie.BSON_BINARY_SUBTYPE_UUID=3;Ie.BSON_BINARY_SUBTYPE_MD5=4;Ie.BSON_BINARY_SUBTYPE_USER_DEFINED=128;nr.exports=Ie;nr.exports.Code=U8;nr.exports.Map=I8;nr.exports.Symbol=k8;nr.exports.BSON=Ie;nr.exports.DBRef=H8;nr.exports.Binary=K8;nr.exports.ObjectID=B8;nr.exports.Long=R8;nr.exports.Timestamp=j8;nr.exports.Double=D8;nr.exports.Int32=F8;nr.exports.MinKey=W8;nr.exports.MaxKey=z8;nr.exports.BSONRegExp=L8;nr.exports.Decimal128=V8});var I_=_((NCe,sA)=>{var At=nA(),Y8=ka(),J8=Ic(),X8=kc(),Z8=Dc(),e5=Ac(),t5=vh(),r5=Ao(),n5=mh(),i5=Bc(),s5=jc(),iA=Nc(),o5=$c(),a5=Pc(),u5=xc();At.BSON_INT32_MAX=2147483647;At.BSON_INT32_MIN=-2147483648;At.BSON_INT64_MAX=Math.pow(2,63)-1;At.BSON_INT64_MIN=-Math.pow(2,63);At.JS_INT_MAX=9007199254740992;At.JS_INT_MIN=-9007199254740992;At.Binary=Y8;At.Code=J8;At.DBRef=X8;At.Decimal128=Z8;At.Double=e5;At.Int32=t5;At.Long=r5;At.Map=n5;At.MaxKey=i5;At.MinKey=s5;At.ObjectId=iA;At.ObjectID=iA;At.BSONRegExp=o5;At.Symbol=a5;At.Timestamp=u5;sA.exports=At});var oA=_((exports,module)=>{"use strict";var Module=require("module"),xrequire=eval("require"),createRequireFromPath=Module.createRequire||Module.createRequireFromPath||((e,t)=>{let r=new Module(e);r.filename=e,r.paths=Module._nodeModulePaths(t);function n(o){return xrequire(i(o))}function i(o,a){return Module._resolveFilename(o,r,!1,a)}n.resolve=i;function s(o){return Module._resolveLookupPaths(o,r,!0)}return i.paths=s,n.main=process.mainModule,n.extensions=Module._extensions,n.cache=Module._cache,n});module.exports=createRequireFromPath});var uA=_(($Ce,aA)=>{"use strict";var R_=require("path"),c5=require("fs"),l5=oA(),f5=new Map;function Fa(e,t){let r=(n,i)=>{let s=Fa.cache&&Fa.cache.get(n);if(!s){let o;try{o=c5.statSync(n)}catch(a){throw new Error(`require-at: stat '${n}' failed: ${a.message}`)}if(!o||!o.isDirectory()){if(i)throw new Error(`require-at: not a directory: '${e}'`);return r(R_.dirname(n),!0)}s=l5(R_.join(n,"._require-at_"),n),Fa.cache&&Fa.cache.set(n,s)}return t?s(t):s};return r(R_.resolve(e),!1)}Fa.cache=f5;aA.exports=Fa});var cA=_((exports,module)=>{"use strict";var __assign=exports&&exports.__assign||function(){return __assign=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++){t=arguments[r];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e},__assign.apply(this,arguments)},__importDefault=exports&&exports.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});exports.optionalRequireCwd=exports.optionalRequire=exports.makeOptionalRequire=exports.tryResolve=exports.tryRequire=exports.setDefaultLog=void 0;var assert_1=__importDefault(require("assert")),require_at_1=__importDefault(uA()),xrequire=eval("require"),pnpDependencyNameRegExp=/^(?![a-zA-Z]:[\\/]|\\\\|\.{0,2}(?:\/|$))((?:node:)?(?:@[^/]+\/)?[^/]+)\/*(.*|)$/;function getPnpDependencyName(e){var t=e.match(pnpDependencyNameRegExp);return t?t[1]:null}function findModuleNotFound(e,t){var r=e.message.split(`
`)[0];if(!r)return!1;if(r.includes("'"+t+"'"))return!0;var n=getPnpDependencyName(t);return n?r.includes(" "+n+" ")||r.includes(" "+n+". ")||r.includes(" "+n+", "):!1}function defaultLog(e,t){console.log("Just FYI: "+e+'; Path "'+t+'"')}var __defaultLog=defaultLog;function setDefaultLog(e){__defaultLog=e}exports.setDefaultLog=setDefaultLog;function _getOptions(e,t,r){if(t===void 0&&(t=xrequire),typeof e=="object"){var n=__assign({require:t,log:r},e);return(0,assert_1.default)(!(n.hasOwnProperty("notFound")&&n.hasOwnProperty("default")),"optionalRequire: options set with both `notFound` and `default`"),n}else return{require:t,log:r,message:e}}function _optionalRequire(e,t){try{return t.resolve?t.require.resolve(e):t.require(e)}catch(i){if(i.code!=="MODULE_NOT_FOUND"||!findModuleNotFound(i,e)){if(typeof t.fail=="function")return t.fail(i);throw i}if(t.message){var r=t.message===!0?"":t.message+" - ",n=t.resolve?"resolved":"found";t.log(r+"optional module not "+n,e)}return typeof t.notFound=="function"?t.notFound(i):t.default}}function tryRequire(e,t,r){var n=_getOptions(r,e,__defaultLog);return n.resolve=!1,_optionalRequire(t,n)}exports.tryRequire=tryRequire;function tryResolve(e,t,r){var n=_getOptions(r,e,__defaultLog);return n.resolve=!0,_optionalRequire(t,n)}exports.tryResolve=tryResolve;function makeOptionalRequire(e,t){var r=function(n,i){var s=_getOptions(i,e,r.log);return _optionalRequire(n,s)};return r.resolve=function(n,i){var s=_getOptions(i,e,r.log);return s.resolve=!0,_optionalRequire(n,s)},r.log=t||__defaultLog,r}exports.makeOptionalRequire=makeOptionalRequire;exports.optionalRequire=makeOptionalRequire(xrequire);exports.optionalRequireCwd=makeOptionalRequire((0,require_at_1.default)(process.cwd()))});var Mh=_((PCe,Gn)=>{"use strict";var Kn=cA();Gn.exports=function(){return Kn.makeOptionalRequire.apply(Kn,arguments)};Gn.exports.tryRequire=Kn.tryRequire;Gn.exports.tryResolve=Kn.tryResolve;Gn.exports.try=Kn.tryRequire;Gn.exports.resolve=Kn.tryResolve;Gn.exports.makeOptionalRequire=Kn.makeOptionalRequire;Gn.exports.optionalRequire=Kn.optionalRequire;Gn.exports.optionalRequireCwd=Kn.optionalRequireCwd;Gn.exports.optionalRequireTop=Kn.optionalRequireTop;var lA;Object.defineProperty(Gn.exports,"log",{set(e){lA=e,Kn.setDefaultLog(e)},get(){return lA}})});var fA=_((ICe,h5)=>{h5.exports={_args:[["mongodb@3.7.3","D:\\FaztWeb\\TokenizadorApp"]],_from:"mongodb@3.7.3",_id:"mongodb@3.7.3",_inBundle:!1,_integrity:"sha512-Psm+g3/wHXhjBEktkxXsFMZvd3nemI0r3IPsE0bU+4//PnvNWKkzhZcEsbPcYiWqe8XqXJJEg4Tgtr7Raw67Yw==",_location:"/mongodb",_phantomChildren:{"core-util-is":"1.0.3",inherits:"2.0.4",isarray:"1.0.0","process-nextick-args":"2.0.1","require-at":"1.0.6","safe-buffer":"5.1.2",string_decoder:"1.1.1","util-deprecate":"1.0.2"},_requested:{type:"version",registry:!0,raw:"mongodb@3.7.3",name:"mongodb",escapedName:"mongodb",rawSpec:"3.7.3",saveSpec:null,fetchSpec:"3.7.3"},_requiredBy:["/mongoose"],_resolved:"https://registry.npmjs.org/mongodb/-/mongodb-3.7.3.tgz",_spec:"3.7.3",_where:"D:\\FaztWeb\\TokenizadorApp",author:{name:"The MongoDB NodeJS Team",email:"dbx-node@mongodb.com"},bugs:{url:"https://jira.mongodb.org/projects/NODE/issues/"},dependencies:{bl:"^2.2.1",bson:"^1.1.4",denque:"^1.4.1","optional-require":"^1.1.8","safe-buffer":"^5.1.2",saslprep:"^1.0.0"},description:"The official MongoDB driver for Node.js",devDependencies:{"@types/chai":"^4.2.16","@types/mocha":"^8.2.2","@types/node":"^14.14.37","array-includes":"^3.1.3",chai:"^4.1.1","chai-subset":"^1.6.0",chalk:"^2.4.2",co:"4.6.0",eslint:"^7.10.0","eslint-config-prettier":"^6.11.0","eslint-plugin-es":"^3.0.1","eslint-plugin-prettier":"^3.1.3",jsdoc:"^3.5.5","lodash.camelcase":"^4.3.0",mocha:"5.2.0","mocha-sinon":"^2.1.0","mongodb-extjson":"^2.1.1","mongodb-mock-server":"^1.0.1",nyc:"^15.1.0","object.entries":"^1.1.3",prettier:"^1.19.1",semver:"^5.5.0",sinon:"^4.3.0","sinon-chai":"^3.2.0",snappy:"^6.3.4","spec-xunit-file":"0.0.1-3","standard-version":"^9.2.0",tslib:"^2.2.0",typescript:"^4.2.4","util.promisify":"^1.0.1","worker-farm":"^1.5.0",wtfnode:"^0.8.0",yargs:"^14.2.0"},engines:{node:">=4"},files:["index.js","lib"],homepage:"https://github.com/mongodb/node-mongodb-native",keywords:["mongodb","driver","official"],license:"Apache-2.0",main:"index.js",name:"mongodb",optionalDependencies:{saslprep:"^1.0.0"},peerDependenciesMeta:{kerberos:{optional:!0},"mongodb-client-encryption":{optional:!0},"mongodb-extjson":{optional:!0},snappy:{optional:!0},"bson-ext":{optional:!0},aws4:{optional:!0}},repository:{type:"git",url:"git+ssh://git@github.com/mongodb/node-mongodb-native.git"},scripts:{"build:evergreen":"node .evergreen/generate_evergreen_tasks.js","build:unified":"tsc -p test/functional/unified-spec-runner/tsconfig.unified.json","check:atlas":"mocha --opts '{}' ./test/manual/atlas_connectivity.test.js","check:bench":"node test/benchmarks/driverBench/","check:coverage":"nyc npm run check:test","check:kerberos":"mocha --opts '{}' -t 60000 test/manual/kerberos.test.js","check:ldap":"mocha --opts '{}' test/manual/ldap.test.js","check:lint":"eslint -v && eslint lib test","check:test":"mocha --recursive test/functional test/unit","check:tls":"mocha --opts '{}' test/manual/tls_support.test.js",format:"npm run check:lint -- --fix",release:"standard-version -i HISTORY.md",test:"npm run check:lint && mocha --recursive test/functional test/unit"},version:"3.7.3"}});var he=_((RCe,pA)=>{"use strict";var D_=require("os"),d5=require("crypto"),hA=Mh()(require),p5=()=>{let e=d5.randomBytes(16);return e[6]=e[6]&15|64,e[8]=e[8]&63|128,e};function m5(e,t,r){r.forEach(n=>e.on(n,i=>t.emit(n,i)))}function y5(){let e;try{e=hA("kerberos")}catch(t){throw t.code==="MODULE_NOT_FOUND"?new Error("The `kerberos` module was not found. Please install it and try again."):t}return e}var Ua=function(){throw new Error("The `mongodb-extjson` module was not found. Please install it and try again.")};function g5(){let e=hA("mongodb-extjson");return e||(e={parse:Ua,deserialize:Ua,serialize:Ua,stringify:Ua,setBSONModule:Ua,BSON:Ua}),e}function dA(e){if(e){if(e.ismaster)return e.ismaster.maxWireVersion;if(typeof e.lastIsMaster=="function"){let t=e.lastIsMaster();if(t)return t.maxWireVersion}if(e.description)return e.description.maxWireVersion}return 0}function _5(e,t){return t&&t.collation&&dA(e)<5}function w5(e){return e&&typeof e.then=="function"}function v5(e,t,r){e=e||[];let n=0,i=0;for(n=0;n<e.length;++n)i++,t(e[n],s);if(i===0){r();return}function s(o){if(i--,o){r(o);return}n===e.length&&i<=0&&r()}}function S5(e,t,r){e=e||[];let n=0,i=e.length;if(i===0){r();return}function s(o){if(n++,i--,o){r(o);return}if(n===e.length&&i<=0){r();return}t(e[n],s)}t(e[n],s)}function O5(e){return e.description!=null}function b5(e,t){return!Array.isArray(e)||!Array.isArray(t)?!1:e.length===t.length&&e.every((r,n)=>r===t[n])}function E5(e,t){let r=Object.keys(e),n=Object.keys(t);return r.length===n.length&&r.every(i=>t[i]===e[i])}function C5(e,t){return e===t?!0:!(e==null&&t!=null||e!=null&&t==null||e.constructor.name!==t.constructor.name||e.message!==t.message)}function T5(e){return function(r,n){let i=e[r.s.state];if(i&&i.indexOf(n)<0)throw new TypeError(`illegal state transition from [${r.s.state}] => [${n}], allowed: [${i}]`);r.emit("stateChanged",r.s.state,n),r.s.state=n}}function A5(e){e=e||{};let t={driver:{name:"nodejs",version:fA().version},os:{type:D_.type(),name:process.platform,architecture:process.arch,version:D_.release()},platform:`'Node.js ${process.version}, ${D_.endianness} (${e.useUnifiedTopology?"unified":"legacy"})`};if(e.driverInfo&&(e.driverInfo.name&&(t.driver.name=`${t.driver.name}|${e.driverInfo.name}`),e.driverInfo.version&&(t.version=`${t.driver.version}|${e.driverInfo.version}`),e.driverInfo.platform&&(t.platform=`${t.platform}|${e.driverInfo.platform}`)),e.appname){let r=Buffer.from(e.appname);t.application={name:r.length>128?r.slice(0,128).toString("utf8"):e.appname}}return t}var x5=()=>{};pA.exports={uuidV4:p5,relayEvents:m5,collationNotSupported:_5,retrieveEJSON:g5,retrieveKerberos:y5,maxWireVersion:dA,isPromiseLike:w5,eachAsync:v5,eachAsyncSeries:S5,isUnifiedTopology:O5,arrayStrictEqual:b5,tagsStrictEqual:E5,errorStrictEqual:C5,makeStateMachine:T5,makeClientMetadata:A5,noop:x5}});var xo=_((DCe,mA)=>{"use strict";var q5=Object.freeze({HostUnreachable:6,HostNotFound:7,NetworkTimeout:89,ShutdownInProgress:91,PrimarySteppedDown:189,ExceededTimeLimit:262,SocketException:9001,NotMaster:10107,InterruptedAtShutdown:11600,InterruptedDueToReplStateChange:11602,NotMasterNoSlaveOk:13435,NotMasterOrSecondary:13436,StaleShardVersion:63,StaleEpoch:150,StaleConfig:13388,RetryChangeStream:234,FailedToSatisfyReadPreference:133,CursorNotFound:43,LegacyNotPrimary:10058,WriteConcernFailed:64,NamespaceNotFound:26,IllegalOperation:20,MaxTimeMSExpired:50,UnknownReplWriteConcern:79,UnsatisfiableWriteConcern:100,DuplicateKey:11e3,CannotCreateIndex:67,IndexOptionsConflict:85,IndexKeySpecsConflict:86,InvalidIndexSpecificationOption:197});mA.exports=Object.freeze({MONGODB_ERROR_CODES:q5})});var se=_((jCe,_A)=>{"use strict";var ze=xo().MONGODB_ERROR_CODES,Ui=Symbol("errorLabels"),Vi=class extends Error{constructor(t){if(t instanceof Error)super(t.message),this.stack=t.stack;else{if(typeof t=="string")super(t);else{super(t.message||t.errmsg||t.$err||"n/a"),t.errorLabels&&(this[Ui]=new Set(t.errorLabels));for(var r in t)r==="errorLabels"||r==="errmsg"||(this[r]=t[r])}Error.captureStackTrace(this,this.constructor)}this.name="MongoError"}get errmsg(){return this.message}static create(t){return new Vi(t)}hasErrorLabel(t){return this[Ui]==null?!1:this[Ui].has(t)}addErrorLabel(t){this[Ui]==null&&(this[Ui]=new Set),this[Ui].add(t)}get errorLabels(){return this[Ui]?Array.from(this[Ui]):[]}},yA=Symbol("beforeHandshake");function M5(e){return e[yA]===!0}var Wc=class extends Vi{constructor(t,r){super(t),this.name="MongoNetworkError",r&&typeof r.beforeHandshake=="boolean"&&(this[yA]=r.beforeHandshake)}},B_=class extends Wc{constructor(t,r){super(t,r),this.name="MongoNetworkTimeoutError"}},Nh=class extends Vi{constructor(t){super(t),this.name="MongoParseError"}},$h=class extends Vi{constructor(t,r){r&&r.error?super(r.error.message||r.error):super(t),this.name="MongoTimeoutError",r&&(this.reason=r)}},L_=class extends $h{constructor(t,r){super(t,r),this.name="MongoServerSelectionError"}};function N5(e){let t=Object.assign({},e);return t.ok===0&&(t.ok=1,delete t.errmsg,delete t.code,delete t.codeName),t}var Ph=class extends Vi{constructor(t,r){super(t),this.name="MongoWriteConcernError",r&&Array.isArray(r.errorLabels)&&(this[Ui]=new Set(r.errorLabels)),r!=null&&(this.result=N5(r))}},$5=new Set([ze.HostUnreachable,ze.HostNotFound,ze.NetworkTimeout,ze.ShutdownInProgress,ze.PrimarySteppedDown,ze.SocketException,ze.NotMaster,ze.InterruptedAtShutdown,ze.InterruptedDueToReplStateChange,ze.NotMasterNoSlaveOk,ze.NotMasterOrSecondary]),j_=new Set([ze.InterruptedAtShutdown,ze.InterruptedDueToReplStateChange,ze.NotMaster,ze.NotMasterNoSlaveOk,ze.NotMasterOrSecondary,ze.PrimarySteppedDown,ze.ShutdownInProgress,ze.HostNotFound,ze.HostUnreachable,ze.NetworkTimeout,ze.SocketException,ze.ExceededTimeLimit]);function P5(e){return e instanceof Ph?j_.has(e.code)||j_.has(e.result.code):j_.has(e.code)}function I5(e){return $5.has(e.code)||e instanceof Wc||e.message.match(/not master/)||e.message.match(/node is recovering/)}var R5=new Set([ze.ShutdownInProgress,ze.PrimarySteppedDown,ze.InterruptedAtShutdown,ze.InterruptedDueToReplStateChange,ze.NotMasterOrSecondary]),D5=new Set([ze.NotMaster,ze.NotMasterNoSlaveOk,ze.LegacyNotPrimary]),j5=new Set([ze.InterruptedAtShutdown,ze.ShutdownInProgress]);function gA(e){return typeof e.code=="number"?R5.has(e.code):/not master or secondary/.test(e.message)||/node is recovering/.test(e.message)}function B5(e){return typeof e.code=="number"?D5.has(e.code):gA(e)?!1:/not master/.test(e.message)}function L5(e){return e.code&&j5.has(e.code)}function k5(e){return e instanceof Nh||e==null?!0:gA(e)||B5(e)}_A.exports={MongoError:Vi,MongoNetworkError:Wc,MongoNetworkTimeoutError:B_,MongoParseError:Nh,MongoTimeoutError:$h,MongoServerSelectionError:L_,MongoWriteConcernError:Ph,isRetryableError:I5,isSDAMUnrecoverableError:k5,isNodeShuttingDownError:L5,isRetryableWriteError:P5,isNetworkErrorBeforeHandshake:M5}});var Wi=_((BCe,wA)=>{"use strict";var F5=new Set(["w","wtimeout","j","journal","fsync"]),k_,qo=class{constructor(t,r,n,i){t!=null&&(this.w=t),r!=null&&(this.wtimeout=r),n!=null&&(this.j=n),i!=null&&(this.fsync=i)}static fromOptions(t){if(!(t==null||t.writeConcern==null&&t.w==null&&t.wtimeout==null&&t.j==null&&t.journal==null&&t.fsync==null))return t.writeConcern?typeof t.writeConcern=="string"?new qo(t.writeConcern):Object.keys(t.writeConcern).some(r=>F5.has(r))?new qo(t.writeConcern.w,t.writeConcern.wtimeout,t.writeConcern.j||t.writeConcern.journal,t.writeConcern.fsync):void 0:(k_||(k_=N()),k_.emitWarningOnce("Top-level use of w, wtimeout, j, and fsync is deprecated. Use writeConcern instead."),new qo(t.w,t.wtimeout,t.j||t.journal,t.fsync))}};wA.exports=qo});var F_=_(vA=>{"use strict";function U5(){let e=this;return{next:function(){return Promise.resolve().then(()=>e.next()).then(t=>t?{value:t,done:!1}:e.close().then(()=>({value:t,done:!0})))}}}vA.asyncIterator=U5});var N=_((Rh,AA)=>{"use strict";var Ps=se().MongoError,V5=Wi(),W5=function(e){var t={};for(var r in e)t[r]=e[r];return t},z5=function(e,t,r){Object.defineProperty(e,t,{enumerable:!0,get:function(){return r}})},H5=Rh.formatSortValue=function(e){var t=(""+e).toLowerCase();switch(t){case"ascending":case"asc":case"1":return 1;case"descending":case"desc":case"-1":return-1;default:throw new Error("Illegal sort clause, must be of the form [['field1', '(ascending|descending)'], ['field2', '(ascending|descending)']]")}},K5=Rh.formattedOrderClause=function(e){var t=new Map;if(e==null)return null;if(Array.isArray(e)){if(e.length===0)return null;for(var r=0;r<e.length;r++)e[r].constructor===String?t.set(`${e[r]}`,1):t.set(`${e[r][0]}`,H5(e[r][1]))}else if(e!=null&&typeof e=="object")if(e instanceof Map)t=e;else{var n=Object.keys(e);for(var i of n)t.set(i,e[i])}else if(typeof e=="string")t.set(`${e}`,1);else throw new Error("Illegal sort clause, must be of the form [['field1', '(ascending|descending)'], ['field2', '(ascending|descending)']]");return t},G5=function(t){if(typeof t!="string")throw new Ps("collection name must be a String");if(!t||t.indexOf("..")!==-1)throw new Ps("collection names cannot be empty");if(t.indexOf("$")!==-1&&t.match(/((^\$cmd)|(oplog\.\$main))/)==null)throw new Ps("collection names must not contain '$'");if(t.match(/^\.|\.$/)!=null)throw new Ps("collection names must not start or end with '.'");if(t.indexOf("\0")!==-1)throw new Ps("collection names cannot contain a null character")},Q5=function(e,t,r,n){try{if(e==null)return;if(e)return n?e(t,r,n):e(t,r)}catch(i){return process.nextTick(function(){throw i}),!1}return!0},Y5=function(e){if(e instanceof Error)return e;for(var t=e.err||e.errmsg||e.errMessage||e,r=Ps.create({message:t,driver:!0}),n=typeof e=="object"?Object.keys(e):[],i=0;i<n.length;i++)try{r[n[i]]=e[n[i]]}catch{}return r},J5=function(t){var r=null;if(typeof t=="string")r=t;else if(Array.isArray(t))r={},t.forEach(function(i){r[i]=1});else if(t!=null&&typeof t=="object"){r={};for(var n in t)r[n]=t[n]}return r},X5=function(e){var t={},r=[],n;return typeof e=="string"?(r.push(e+"_"+1),t[e]=1):Array.isArray(e)?e.forEach(function(i){typeof i=="string"?(r.push(i+"_"+1),t[i]=1):Array.isArray(i)?(r.push(i[0]+"_"+(i[1]||1)),t[i[0]]=i[1]||1):Ih(i)&&(n=Object.keys(i),n.forEach(function(s){r.push(s+"_"+i[s]),t[s]=i[s]}))}):Ih(e)&&(n=Object.keys(e),n.forEach(function(i){r.push(i+"_"+e[i]),t[i]=e[i]})),{name:r.join("_"),keys:n,fieldHash:t}},Ih=Rh.isObject=function(e){return Object.prototype.toString.call(e)==="[object Object]"},Z5=function(e,t){var r={};return e.forEach(function(n){r[n]=t[n]}),r},eK=function(e,t,r){for(var n in t)r.indexOf(n)===-1&&(e[n]=t[n]);return e},tK=function(e,t){for(var r in t)e[r]=t[r];return e},rK=function(e,t){var r={sslCA:"ca",sslCRL:"crl",sslValidate:"rejectUnauthorized",sslKey:"key",sslCert:"cert",sslPass:"passphrase",socketTimeoutMS:"socketTimeout",connectTimeoutMS:"connectionTimeout",replicaSet:"setName",rs_name:"setName",secondaryAcceptableLatencyMS:"acceptableLatency",connectWithNoPrimary:"secondaryOnlyConnectionAllowed",acceptableLatencyMS:"localThresholdMS"};for(var n in t)r[n]?e[r[n]]=t[n]:e[n]=t[n];return e},nK=function(e,t){var r={};for(var n in e)t.indexOf(n)!==-1&&(r[n]=e[n]);return r},SA=["w","j","wtimeout","fsync","writeConcern"];function iK(e,t){let r=!1;for(let n of SA)if(n in e){r=!0;break}if(!r)for(let n of SA)t[n]&&("writeConcern"in e||(e.writeConcern={}),e.writeConcern[n]=t[n]);return e}var sK=(e,t,r,n)=>{if(e==null)throw new TypeError("This method requires a valid topology instance");if(!Array.isArray(r))throw new TypeError("This method requires an array of arguments to apply");n=n||{};let i=e.s.promiseLibrary,s=r[r.length-1],o,a,u;if(!n.skipSessions&&e.hasSessionSupport()){if(a=r[r.length-2],a==null||a.session==null){u=Symbol(),o=e.startSession({owner:u});let f=r.length-2;r[f]=Object.assign({},r[f],{session:o})}else if(a.session&&a.session.hasEnded)throw new Ps("Use of expired sessions is not permitted")}let c=(f,h)=>function(p,m){if(o&&o.owner===u&&!n.returnsCursor)o.endSession(()=>{if(delete a.session,p)return h(p);f(m)});else{if(p)return h(p);f(m)}};if(typeof s=="function"){s=r.pop();let f=c(h=>s(null,h),h=>s(h,null));r.push(f);try{return t.apply(null,r)}catch(h){throw f(h),h}}if(r[r.length-1]!=null)throw new TypeError("final argument to `executeLegacyOperation` must be a callback");return new i(function(f,h){let d=c(f,h);r[r.length-1]=d;try{return t.apply(null,r)}catch(p){d(p)}})};function oK(e,t){return t&&t.s.options.retryWrites&&(e.retryWrites=!0),e}function aK(e,t,r){r=r||{};let n=t.db,i=t.collection;if(r.session&&r.session.inTransaction())return e.writeConcern&&delete e.writeConcern,e;let s=V5.fromOptions(r);return s?Object.assign(e,{writeConcern:s}):i&&i.writeConcern?Object.assign(e,{writeConcern:Object.assign({},i.writeConcern)}):n&&n.writeConcern?Object.assign(e,{writeConcern:Object.assign({},n.writeConcern)}):e}function uK(e){return e&&typeof e.then=="function"}function cK(e,t,r){let n=t.s&&t.s.topology||t.topology;if(!n)throw new TypeError('parameter "target" is missing a topology');let i=n.capabilities();if(r.collation&&typeof r.collation=="object")if(i&&i.commandsTakeCollation)e.collation=r.collation;else throw new Ps("Current topology does not support collation")}function lK(e,t,r){if(r&&r.session&&r.session.inTransaction())return;let n=Object.assign({},e.readConcern||{});t.s.readConcern&&Object.assign(n,t.s.readConcern),Object.keys(n).length>0&&Object.assign(e,{readConcern:n})}function fK(e,t){return e.explain?e:{explain:e,verbosity:t.verbosity}}var bA=+process.version.split(".")[0].substring(1),hK=e=>bA<=6?process.emitWarning(e,"DeprecationWarning",Va):process.emitWarning(e,{type:"DeprecationWarning",code:Va}),dK=e=>console.error(e),EA=process.emitWarning?hK:dK;function pK(e,t){return`${e} option [${t}] is deprecated and will be removed in a later version.`}function mK(e,t){if(process.noDeprecation===!0)return t;let r=e.msgHandler?e.msgHandler:pK,n=new Set;function i(){let s=arguments[e.optionsIndex];return!Ih(s)||Object.keys(s).length===0?t.apply(this,arguments):(e.deprecatedOptions.forEach(o=>{if(Object.prototype.hasOwnProperty.call(s,o)&&!n.has(o)){n.add(o);let a=r(e.name,o);if(EA(a),this&&this.getLogger){let u=this.getLogger();u&&u.warn(a)}}}),t.apply(this,arguments))}return Object.setPrototypeOf(i,t),t.prototype&&(i.prototype=t.prototype),i}var U_={};try{F_(),U_.ASYNC_ITERATOR=!0}catch{U_.ASYNC_ITERATOR=!1}var Wa=class{constructor(t,r){this.db=t,this.collection=r}toString(){return this.collection?`${this.db}.${this.collection}`:this.db}withCollection(t){return new Wa(this.db,t)}static fromString(t){if(!t)throw new Error(`Cannot parse namespace from "${t}"`);let r=t.indexOf(".");return new Wa(t.substring(0,r),t.substring(r+1))}};function*yK(e){let t=e||0;for(;;){let r=t;t+=1,yield r}}function gK(e,t,r){let n=e&&e.s&&e.s.promiseLibrary||Promise,i;return typeof t!="function"&&(i=new n((s,o)=>{t=(a,u)=>{if(a)return o(a);s(u)}})),r(function(s,o){if(s!=null){try{t(s)}catch(a){return process.nextTick(()=>{throw a})}return}t(s,o)}),i}function W_(){let e=process.hrtime();return Math.floor(e[0]*1e3+e[1]/1e6)}function _K(e){if(typeof e!="number")throw TypeError("numeric value required to calculate duration");let t=W_()-e;return t<0?0:t}function wK(e,t){let r,n,i,s=!1;t=t||{};let o=t.interval||1e3,a=t.minInterval||500,u=typeof t.immediate=="boolean"?t.immediate:!1,c=typeof t.clock=="function"?t.clock:W_;function f(){let m=c(),y=m-i,g=m-n,w=o-g;i=m,!(y<a)&&(w>a&&d(a),w<0&&p())}function h(){s=!0,r&&(clearTimeout(r),r=null),n=0,i=0}function d(m){s||(clearTimeout(r),r=setTimeout(p,m||o))}function p(){i=0,n=c(),e(m=>{if(m)throw m;d(o)})}return u?p():(n=c(),d()),{wake:f,stop:h}}function CA(e){return Array.isArray(e)?e.reduce((t,r)=>t||CA(r),null):Object.keys(typeof e.toBSON!="function"?e:e.toBSON()).map(t=>t[0]).indexOf("$")>=0}var Va="MONGODB DRIVER";function TA(e){return process.emitWarning?bA<=6?process.emitWarning(e,void 0,Va):process.emitWarning(e,{code:Va}):console.error(`[${Va}] Warning:`,e)}var OA=new Set;function vK(e){if(!OA.has(e))return OA.add(e),TA(e)}function SK(e,t){e=Array.isArray(e)?new Set(e):e,t=Array.isArray(t)?new Set(t):t;for(let r of t)if(!e.has(r))return!1;return!0}function OK(e,t){let r=Object.prototype.toString,n=Object.prototype.hasOwnProperty,i=o=>r.call(o)==="[object Object]";if(!i(e))return!1;let s=e.constructor;if(s&&s.prototype&&(!i(s.prototype)||!n.call(s.prototype,"isPrototypeOf")))return!1;if(t){let o=Object.keys(e);return SK(o,t)}return!0}function V_(e){if(e==null)return e;if(Array.isArray(e))return e.map(r=>V_(r));if(OK(e)){let r={};for(let n in e)r[n]=V_(e[n]);return r}let t=e.constructor;if(t)switch(t.name.toLowerCase()){case"date":return new t(Number(e));case"map":return new Map(e);case"set":return new Set(e);case"buffer":return Buffer.from(e)}return e}function bK(e){let t=e.version.split(".").map(r=>Number.parseInt(r,10));return{major:t[0],minor:t[1],patch:t[2]}}AA.exports={filterOptions:nK,mergeOptions:tK,translateOptions:rK,shallowClone:W5,getSingleProperty:z5,checkCollectionName:G5,toError:Y5,formattedOrderClause:K5,parseIndexOptions:X5,normalizeHintField:J5,handleCallback:Q5,decorateCommand:eK,isObject:Ih,debugOptions:Z5,MAX_JS_INT:Number.MAX_SAFE_INTEGER+1,conditionallyMergeWriteConcern:iK,executeLegacyOperation:sK,applyRetryableWrites:oK,applyWriteConcern:aK,isPromiseLike:uK,decorateWithCollation:cK,decorateWithReadConcern:lK,decorateWithExplain:fK,deprecateOptions:mK,SUPPORTS:U_,MongoDBNamespace:Wa,emitDeprecationWarning:EA,makeCounter:yK,maybePromise:gK,now:W_,calculateDurationInMs:_K,makeInterruptableAsyncInterval:wK,hasAtomicOperators:CA,MONGODB_WARNING_CODE:Va,emitWarning:TA,emitWarningOnce:vK,deepCopy:V_,parsePackageVersion:bK}});var Yt=_((kCe,MA)=>{"use strict";var xA=N().parsePackageVersion,EK=se().MongoError,jh=Mh()(require);function CK(e,t){let r={};return e.forEach(function(n){r[n]=t[n]}),r}function TK(){let e=I_();e.native=!1;let t=jh("bson-ext"),r=xA(jh("bson-ext/package.json")||{version:"0.0.0"});if(t){if(r.major>=4)throw new EK("bson-ext version 4 and above does not work with the 3.x version of the mongodb driver");return t.native=!0,t}return e}function Dh(){throw new Error("Attempted to use Snappy compression, but Snappy is not installed. Install or disable Snappy compression and try again.")}var qA=Symbol("kPkgVersion");function AK(){let e=jh("snappy");if(!e)return{compress:Dh,uncompress:Dh,compressSync:Dh,uncompressSync:Dh};let t=jh("snappy/package.json")||{version:"0.0.0"},r=xA(t);if(e[qA]=r,r.major>=7){let n=e.compress,i=e.uncompress;e.compress=(s,o)=>{n(s).then(a=>o(void 0,a)).catch(a=>o(a))},e.uncompress=(s,o)=>{i(s).then(a=>o(void 0,a)).catch(a=>o(a))}}return e}MA.exports={PKG_VERSION:qA,debugOptions:CK,retrieveBSON:TK,retrieveSnappy:AK}});var ir=_((FCe,NA)=>{"use strict";var xK=N().emitWarningOnce,be=function(e,t,r){if(!be.isValid(e))throw new TypeError(`Invalid read preference mode ${e}`);if(t&&!Array.isArray(t)){xK("ReadPreference tags must be an array, this will change in the next major version");let n=typeof t.maxStalenessSeconds<"u",i=typeof t.hedge<"u";n||i?(r=t,t=void 0):t=[t]}if(this.mode=e,this.tags=t,this.hedge=r&&r.hedge,r=r||{},r.maxStalenessSeconds!=null){if(r.maxStalenessSeconds<=0)throw new TypeError("maxStalenessSeconds must be a positive integer");this.maxStalenessSeconds=r.maxStalenessSeconds,this.minWireVersion=5}if(this.mode===be.PRIMARY){if(this.tags&&Array.isArray(this.tags)&&this.tags.length>0)throw new TypeError("Primary read preference cannot be combined with tags");if(this.maxStalenessSeconds)throw new TypeError("Primary read preference cannot be combined with maxStalenessSeconds");if(this.hedge)throw new TypeError("Primary read preference cannot be combined with hedge")}};Object.defineProperty(be.prototype,"preference",{enumerable:!0,get:function(){return this.mode}});be.PRIMARY="primary";be.PRIMARY_PREFERRED="primaryPreferred";be.SECONDARY="secondary";be.SECONDARY_PREFERRED="secondaryPreferred";be.NEAREST="nearest";var qK=[be.PRIMARY,be.PRIMARY_PREFERRED,be.SECONDARY,be.SECONDARY_PREFERRED,be.NEAREST,null];be.fromOptions=function(e){if(!e)return null;let t=e.readPreference;if(!t)return null;let r=e.readPreferenceTags,n=e.maxStalenessSeconds;if(typeof t=="string")return new be(t,r);if(!(t instanceof be)&&typeof t=="object"){let i=t.mode||t.preference;if(i&&typeof i=="string")return new be(i,t.tags,{maxStalenessSeconds:t.maxStalenessSeconds||n,hedge:t.hedge})}return t};be.resolve=function(e,t){t=t||{};let r=t.session,n=e&&e.readPreference,i;return t.readPreference?i=be.fromOptions(t):r&&r.inTransaction()&&r.transaction.options.readPreference?i=r.transaction.options.readPreference:n!=null?i=n:i=be.primary,typeof i=="string"?new be(i):i};be.translate=function(e){if(e.readPreference==null)return e;let t=e.readPreference;if(typeof t=="string")e.readPreference=new be(t);else if(t&&!(t instanceof be)&&typeof t=="object"){let r=t.mode||t.preference;r&&typeof r=="string"&&(e.readPreference=new be(r,t.tags,{maxStalenessSeconds:t.maxStalenessSeconds}))}else if(!(t instanceof be))throw new TypeError("Invalid read preference: "+t);return e};be.isValid=function(e){return qK.indexOf(e)!==-1};be.prototype.isValid=function(e){return be.isValid(typeof e=="string"?e:this.mode)};var MK=["primaryPreferred","secondary","secondaryPreferred","nearest"];be.prototype.slaveOk=function(){return MK.indexOf(this.mode)!==-1};be.prototype.equals=function(e){return e.mode===this.mode};be.prototype.toJSON=function(){let e={mode:this.mode};return Array.isArray(this.tags)&&(e.tags=this.tags),this.maxStalenessSeconds&&(e.maxStalenessSeconds=this.maxStalenessSeconds),this.hedge&&(e.hedge=this.hedge),e};be.primary=new be("primary");be.primaryPreferred=new be("primaryPreferred");be.secondary=new be("secondary");be.secondaryPreferred=new be("secondaryPreferred");be.nearest=new be("nearest");NA.exports=be});var mr=_((UCe,PA)=>{"use strict";var NK="closing",$K="closed",PK="connecting",IK="connected",$A={Single:"Single",ReplicaSetNoPrimary:"ReplicaSetNoPrimary",ReplicaSetWithPrimary:"ReplicaSetWithPrimary",Sharded:"Sharded",Unknown:"Unknown"},RK={Standalone:"Standalone",Mongos:"Mongos",PossiblePrimary:"PossiblePrimary",RSPrimary:"RSPrimary",RSSecondary:"RSSecondary",RSArbiter:"RSArbiter",RSOther:"RSOther",RSGhost:"RSGhost",Unknown:"Unknown"};function DK(e){let t=e.s.description||e.s.serverDescription;return t.topologyType===$A.Single?t.servers[0].type:t.type}var jK={useUnifiedTopology:!0,localThresholdMS:15,serverSelectionTimeoutMS:3e4,heartbeatFrequencyMS:1e4,minHeartbeatFrequencyMS:500};function BK(e){e.forEach(clearTimeout),e.clear()}function LK(e,t){return clearTimeout(e),t.delete(e)}PA.exports={STATE_CLOSING:NK,STATE_CLOSED:$K,STATE_CONNECTING:PK,STATE_CONNECTED:IK,TOPOLOGY_DEFAULTS:jK,TopologyType:$A,ServerType:RK,serverType:DK,drainTimerQueue:BK,clearAndRemoveTimerFrom:LK}});var Mo=_((VCe,DA)=>{"use strict";var kK=he().arrayStrictEqual,FK=he().tagsStrictEqual,UK=he().errorStrictEqual,sr=mr().ServerType,VK=N().now,WK=new Set([sr.RSPrimary,sr.Standalone,sr.Mongos]),zK=new Set([sr.RSPrimary,sr.RSSecondary,sr.Mongos,sr.Standalone]),HK=["minWireVersion","maxWireVersion","maxBsonObjectSize","maxMessageSizeBytes","maxWriteBatchSize","compression","me","hosts","passives","arbiters","tags","setName","setVersion","electionId","primary","logicalSessionTimeoutMinutes","saslSupportedMechs","__nodejs_mock_server__","$clusterTime"],z_=class{constructor(t,r,n){n=n||{},r=Object.assign({minWireVersion:0,maxWireVersion:0,hosts:[],passives:[],arbiters:[],tags:[]},r),r.isWritablePrimary!=null&&(r.ismaster=r.isWritablePrimary),this.address=t,this.error=n.error,this.roundTripTime=n.roundTripTime||-1,this.lastUpdateTime=VK(),this.lastWriteDate=r.lastWrite?r.lastWrite.lastWriteDate:null,this.opTime=r.lastWrite?r.lastWrite.opTime:null,this.type=IA(r),this.topologyVersion=n.topologyVersion||r.topologyVersion,HK.forEach(i=>{typeof r[i]<"u"&&(this[i]=r[i])}),this.me&&(this.me=this.me.toLowerCase()),this.hosts=this.hosts.map(i=>i.toLowerCase()),this.passives=this.passives.map(i=>i.toLowerCase()),this.arbiters=this.arbiters.map(i=>i.toLowerCase())}get allHosts(){return this.hosts.concat(this.arbiters).concat(this.passives)}get isReadable(){return this.type===sr.RSSecondary||this.isWritable}get isDataBearing(){return zK.has(this.type)}get isWritable(){return WK.has(this.type)}get host(){let t=`:${this.port}`.length;return this.address.slice(0,-t)}get port(){let t=this.address.split(":").pop();return t&&Number.parseInt(t,10)}equals(t){let r=this.topologyVersion===t.topologyVersion||RA(this.topologyVersion,t.topologyVersion)===0;return t!=null&&UK(this.error,t.error)&&this.type===t.type&&this.minWireVersion===t.minWireVersion&&this.me===t.me&&kK(this.hosts,t.hosts)&&FK(this.tags,t.tags)&&this.setName===t.setName&&this.setVersion===t.setVersion&&(this.electionId?t.electionId&&this.electionId.equals(t.electionId):this.electionId===t.electionId)&&this.primary===t.primary&&this.logicalSessionTimeoutMinutes===t.logicalSessionTimeoutMinutes&&r}};function IA(e){return!e||!e.ok?sr.Unknown:e.isreplicaset?sr.RSGhost:e.msg&&e.msg==="isdbgrid"?sr.Mongos:e.setName?e.hidden?sr.RSOther:e.ismaster?sr.RSPrimary:e.secondary?sr.RSSecondary:e.arbiterOnly?sr.RSArbiter:sr.RSOther:sr.Standalone}function RA(e,t){return e==null||t==null?-1:e.processId.equals(t.processId)?e.counter===t.counter?0:e.counter<t.counter?-1:1:-1}DA.exports={ServerDescription:z_,parseServerType:IA,compareTopologyVersion:RA}});var H_=_((WCe,jA)=>{"use strict";var KK="2.6",GK="5.0";jA.exports={MIN_SUPPORTED_SERVER_VERSION:KK,MAX_SUPPORTED_SERVER_VERSION:GK,MIN_SUPPORTED_WIRE_VERSION:2,MAX_SUPPORTED_WIRE_VERSION:13}});var K_=_((zCe,FA)=>{"use strict";var St=mr().ServerType,za=Mo().ServerDescription,Bh=H_(),Pr=mr().TopologyType,QK=Bh.MIN_SUPPORTED_SERVER_VERSION,YK=Bh.MAX_SUPPORTED_SERVER_VERSION,BA=Bh.MIN_SUPPORTED_WIRE_VERSION,LA=Bh.MAX_SUPPORTED_WIRE_VERSION,No=class{constructor(t,r,n,i,s,o,a){a=a||{},this.type=t||Pr.Unknown,this.setName=n||null,this.maxSetVersion=i||null,this.maxElectionId=s||null,this.servers=r||new Map,this.stale=!1,this.compatible=!0,this.compatibilityError=null,this.logicalSessionTimeoutMinutes=null,this.heartbeatFrequencyMS=a.heartbeatFrequencyMS||0,this.localThresholdMS=a.localThresholdMS||0,this.commonWireVersion=o||null,Object.defineProperty(this,"options",{value:a,enumberable:!1});for(let u of this.servers.values())if(u.type!==St.Unknown&&(u.minWireVersion>LA&&(this.compatible=!1,this.compatibilityError=`Server at ${u.address} requires wire version ${u.minWireVersion}, but this version of the driver only supports up to ${LA} (MongoDB ${YK})`),u.maxWireVersion<BA)){this.compatible=!1,this.compatibilityError=`Server at ${u.address} reports wire version ${u.maxWireVersion}, but this version of the driver requires at least ${BA} (MongoDB ${QK}).`;break}this.logicalSessionTimeoutMinutes=null;for(let u of this.servers){let c=u[1];if(c.isReadable){if(c.logicalSessionTimeoutMinutes==null){this.logicalSessionTimeoutMinutes=null;break}if(this.logicalSessionTimeoutMinutes==null){this.logicalSessionTimeoutMinutes=c.logicalSessionTimeoutMinutes;continue}this.logicalSessionTimeoutMinutes=Math.min(this.logicalSessionTimeoutMinutes,c.logicalSessionTimeoutMinutes)}}}updateFromSrvPollingEvent(t){let r=t.addresses(),n=new Map(this.servers);for(let i of this.servers)r.has(i[0])?r.delete(i[0]):n.delete(i[0]);if(n.size===this.servers.size&&r.size===0)return this;for(let i of r)n.set(i,new za(i));return new No(this.type,n,this.setName,this.maxSetVersion,this.maxElectionId,this.commonWireVersion,this.options,null)}update(t){let r=t.address,n=this.type,i=this.setName,s=this.maxSetVersion,o=this.maxElectionId,a=this.commonWireVersion;t.setName&&i&&t.setName!==i&&(t=new za(r,null));let u=t.type,c=new Map(this.servers);if(t.maxWireVersion!==0&&(a==null?a=t.maxWireVersion:a=Math.min(a,t.maxWireVersion)),c.set(r,t),n===Pr.Single)return new No(Pr.Single,c,i,s,o,a,this.options);if(n===Pr.Unknown&&(u===St.Standalone&&this.servers.size!==1?c.delete(r):n=JK(u)),n===Pr.Sharded&&[St.Mongos,St.Unknown].indexOf(u)===-1&&c.delete(r),n===Pr.ReplicaSetNoPrimary){if([St.Standalone,St.Mongos].indexOf(u)>=0&&c.delete(r),u===St.RSPrimary){let f=kA(c,i,t,s,o);n=f[0],i=f[1],s=f[2],o=f[3]}else if([St.RSSecondary,St.RSArbiter,St.RSOther].indexOf(u)>=0){let f=eG(c,i,t);n=f[0],i=f[1]}}if(n===Pr.ReplicaSetWithPrimary)if([St.Standalone,St.Mongos].indexOf(u)>=0)c.delete(r),n=Ha(c);else if(u===St.RSPrimary){let f=kA(c,i,t,s,o);n=f[0],i=f[1],s=f[2],o=f[3]}else[St.RSSecondary,St.RSArbiter,St.RSOther].indexOf(u)>=0?n=ZK(c,i,t):n=Ha(c);return new No(n,c,i,s,o,a,this.options)}get error(){let t=Array.from(this.servers.values()).filter(r=>r.error);if(t.length>0)return t[0].error}get hasKnownServers(){return Array.from(this.servers.values()).some(t=>t.type!==St.Unknown)}get hasDataBearingServers(){return Array.from(this.servers.values()).some(t=>t.isDataBearing)}hasServer(t){return this.servers.has(t)}};function JK(e){return e===St.Standalone?Pr.Single:e===St.Mongos?Pr.Sharded:e===St.RSPrimary?Pr.ReplicaSetWithPrimary:e===St.RSGhost||e===St.Unknown?Pr.Unknown:Pr.ReplicaSetNoPrimary}function XK(e,t){if(e==null)return-1;if(t==null)return 1;if(e.id instanceof Buffer&&t.id instanceof Buffer){let i=e.id,s=t.id;return i.compare(s)}let r=e.toString(),n=t.toString();return r.localeCompare(n)}function kA(e,t,r,n,i){if(t=t||r.setName,t!==r.setName)return e.delete(r.address),[Ha(e),t,n,i];let s=r.electionId?r.electionId:null;if(r.setVersion&&s){if(n&&i&&(n>r.setVersion||XK(i,s)>0))return e.set(r.address,new za(r.address)),[Ha(e),t,n,i];i=r.electionId}r.setVersion!=null&&(n==null||r.setVersion>n)&&(n=r.setVersion);for(let u of e.keys()){let c=e.get(u);if(c.type===St.RSPrimary&&c.address!==r.address){e.set(u,new za(c.address));break}}r.allHosts.forEach(u=>{e.has(u)||e.set(u,new za(u))});let o=Array.from(e.keys()),a=r.allHosts;return o.filter(u=>a.indexOf(u)===-1).forEach(u=>{e.delete(u)}),[Ha(e),t,n,i]}function ZK(e,t,r){if(t==null)throw new TypeError("setName is required");return(t!==r.setName||r.me&&r.address!==r.me)&&e.delete(r.address),Ha(e)}function eG(e,t,r){let n=Pr.ReplicaSetNoPrimary;return t=t||r.setName,t!==r.setName?(e.delete(r.address),[n,t]):(r.allHosts.forEach(i=>{e.has(i)||e.set(i,new za(i))}),r.me&&r.address!==r.me&&e.delete(r.address),[n,t])}function Ha(e){for(let t of e.keys())if(e.get(t).type===St.RSPrimary)return Pr.ReplicaSetWithPrimary;return Pr.ReplicaSetNoPrimary}FA.exports={TopologyDescription:No}});var nt=_((HCe,VA)=>{"use strict";var G_=ir(),tG=se().MongoError,UA=mr().ServerType,rG=K_().TopologyDescription,nG=16,iG=9,sG={OP_REPLY:1,OP_UPDATE:2001,OP_INSERT:2002,OP_QUERY:2004,OP_GETMORE:2005,OP_DELETE:2006,OP_KILL_CURSORS:2007,OP_COMPRESSED:2012,OP_MSG:2013},oG=function(e,t){var r=e.readPreference||new G_("primary");if(t.readPreference&&(r=t.readPreference),typeof r=="string"&&(r=new G_(r)),!(r instanceof G_))throw new tG("read preference must be a ReadPreference instance");return r},aG=function(e){return{length:e.readInt32LE(0),requestId:e.readInt32LE(4),responseTo:e.readInt32LE(8),opCode:e.readInt32LE(12)}};function uG(e,t){return Object.assign(e,{raw:typeof t.raw=="boolean"?t.raw:!1,promoteLongs:typeof t.promoteLongs=="boolean"?t.promoteLongs:!0,promoteValues:typeof t.promoteValues=="boolean"?t.promoteValues:!0,promoteBuffers:typeof t.promoteBuffers=="boolean"?t.promoteBuffers:!1,bsonRegExp:typeof t.bsonRegExp=="boolean"?t.bsonRegExp:!1,monitoring:typeof t.monitoring=="boolean"?t.monitoring:!1,fullResult:typeof t.fullResult=="boolean"?t.fullResult:!1}),typeof t.socketTimeout=="number"&&(e.socketTimeout=t.socketTimeout),t.session&&(e.session=t.session),typeof t.documentsReturnedIn=="string"&&(e.documentsReturnedIn=t.documentsReturnedIn),e}function cG(e){return e.type==="mongos"||e.description&&e.description.type===UA.Mongos?!0:e.description&&e.description instanceof rG?Array.from(e.description.servers.values()).some(r=>r.type===UA.Mongos):!1}function lG(e){return e.split(".")[0]}function fG(e){return e.split(".").slice(1).join(".")}VA.exports={getReadPreference:oG,MESSAGE_HEADER_SIZE:nG,COMPRESSION_DETAILS_SIZE:iG,opcodes:sG,parseHeader:aG,applyCommonQueryOptions:uG,isSharded:cG,databaseNamespace:lG,collectionNamespace:fG}});var zi=_((KCe,HA)=>{"use strict";var WA=Yt().retrieveSnappy(),zA=require("zlib"),Lh={snappy:1,zlib:2},hG=new Set(["ismaster","saslStart","saslContinue","getnonce","authenticate","createUser","updateUser","copydbSaslStart","copydbgetnonce","copydb"]);function dG(e,t,r){switch(e.options.agreedCompressor){case"snappy":WA.compress(t,r);break;case"zlib":var n={};e.options.zlibCompressionLevel&&(n.level=e.options.zlibCompressionLevel),zA.deflate(t,n,r);break;default:throw new Error('Attempt to compress message using unknown compressor "'+e.options.agreedCompressor+'".')}}function pG(e,t,r){if(e<0||e>Lh.length)throw new Error("Server sent message compressed using an unsupported compressor. (Received compressor ID "+e+")");switch(e){case Lh.snappy:WA.uncompress(t,r);break;case Lh.zlib:zA.inflate(t,r);break;default:r(null,t)}}HA.exports={compressorIDs:Lh,uncompressibleCommands:hG,compress:dG,decompress:pG}});var jt=_((Q_,GA)=>{var kh=require("buffer"),Hi=kh.Buffer;function KA(e,t){for(var r in e)t[r]=e[r]}Hi.from&&Hi.alloc&&Hi.allocUnsafe&&Hi.allocUnsafeSlow?GA.exports=kh:(KA(kh,Q_),Q_.Buffer=Ka);function Ka(e,t,r){return Hi(e,t,r)}KA(Hi,Ka);Ka.from=function(e,t,r){if(typeof e=="number")throw new TypeError("Argument must not be a number");return Hi(e,t,r)};Ka.alloc=function(e,t,r){if(typeof e!="number")throw new TypeError("Argument must be a number");var n=Hi(e);return t!==void 0?typeof r=="string"?n.fill(t,r):n.fill(t):n.fill(0),n};Ka.allocUnsafe=function(e){if(typeof e!="number")throw new TypeError("Argument must be a number");return Hi(e)};Ka.allocUnsafeSlow=function(e){if(typeof e!="number")throw new TypeError("Argument must be a number");return kh.SlowBuffer(e)}});var dn=_((GCe,JA)=>{"use strict";var mG=Yt().retrieveBSON,yG=mG(),gG=yG.Long,zc=jt().Buffer,Hc=0,qn=nt().opcodes,_G=2,wG=4,vG=8,SG=16,OG=32,bG=64,EG=128,CG=1,TG=2,AG=4,xG=8,Ga=function(e,t,r,n){var i=this;if(t==null)throw new Error("ns must be specified for query");if(r==null)throw new Error("query must be specified for query");if(t.indexOf("\0")!==-1)throw new Error("namespace cannot contain a null character");this.bson=e,this.ns=t,this.query=r,this.numberToSkip=n.numberToSkip||0,this.numberToReturn=n.numberToReturn||0,this.returnFieldSelector=n.returnFieldSelector||null,this.requestId=Ga.getRequestId(),this.pre32Limit=n.pre32Limit,this.serializeFunctions=typeof n.serializeFunctions=="boolean"?n.serializeFunctions:!1,this.ignoreUndefined=typeof n.ignoreUndefined=="boolean"?n.ignoreUndefined:!1,this.maxBsonSize=n.maxBsonSize||1024*1024*16,this.checkKeys=typeof n.checkKeys=="boolean"?n.checkKeys:!0,this.batchSize=i.numberToReturn,this.tailable=!1,this.slaveOk=typeof n.slaveOk=="boolean"?n.slaveOk:!1,this.oplogReplay=!1,this.noCursorTimeout=!1,this.awaitData=!1,this.exhaust=!1,this.partial=!1};Ga.prototype.incRequestId=function(){this.requestId=Hc++};Ga.nextRequestId=function(){return Hc+1};Ga.prototype.toBin=function(){var e=this,t=[],r=null,n=0;this.tailable&&(n|=_G),this.slaveOk&&(n|=wG),this.oplogReplay&&(n|=vG),this.noCursorTimeout&&(n|=SG),this.awaitData&&(n|=OG),this.exhaust&&(n|=bG),this.partial&&(n|=EG),e.batchSize!==e.numberToReturn&&(e.numberToReturn=e.batchSize);var i=zc.alloc(4*4+4+zc.byteLength(e.ns)+1+4+4);t.push(i);var s=e.bson.serialize(this.query,{checkKeys:this.checkKeys,serializeFunctions:this.serializeFunctions,ignoreUndefined:this.ignoreUndefined});t.push(s),e.returnFieldSelector&&Object.keys(e.returnFieldSelector).length>0&&(r=e.bson.serialize(this.returnFieldSelector,{checkKeys:this.checkKeys,serializeFunctions:this.serializeFunctions,ignoreUndefined:this.ignoreUndefined}),t.push(r));var o=i.length+s.length+(r?r.length:0),a=4;return i[3]=o>>24&255,i[2]=o>>16&255,i[1]=o>>8&255,i[0]=o&255,i[a+3]=this.requestId>>24&255,i[a+2]=this.requestId>>16&255,i[a+1]=this.requestId>>8&255,i[a]=this.requestId&255,a=a+4,i[a+3]=0,i[a+2]=0,i[a+1]=0,i[a]=0,a=a+4,i[a+3]=qn.OP_QUERY>>24&255,i[a+2]=qn.OP_QUERY>>16&255,i[a+1]=qn.OP_QUERY>>8&255,i[a]=qn.OP_QUERY&255,a=a+4,i[a+3]=n>>24&255,i[a+2]=n>>16&255,i[a+1]=n>>8&255,i[a]=n&255,a=a+4,a=a+i.write(this.ns,a,"utf8")+1,i[a-1]=0,i[a+3]=this.numberToSkip>>24&255,i[a+2]=this.numberToSkip>>16&255,i[a+1]=this.numberToSkip>>8&255,i[a]=this.numberToSkip&255,a=a+4,i[a+3]=this.numberToReturn>>24&255,i[a+2]=this.numberToReturn>>16&255,i[a+1]=this.numberToReturn>>8&255,i[a]=this.numberToReturn&255,a=a+4,t};Ga.getRequestId=function(){return++Hc};var QA=function(e,t,r,n){n=n||{},this.numberToReturn=n.numberToReturn||0,this.requestId=Hc++,this.bson=e,this.ns=t,this.cursorId=r};QA.prototype.toBin=function(){var e=4+zc.byteLength(this.ns)+1+4+8+16,t=0,r=zc.alloc(e);return r[t+3]=e>>24&255,r[t+2]=e>>16&255,r[t+1]=e>>8&255,r[t]=e&255,t=t+4,r[t+3]=this.requestId>>24&255,r[t+2]=this.requestId>>16&255,r[t+1]=this.requestId>>8&255,r[t]=this.requestId&255,t=t+4,r[t+3]=0,r[t+2]=0,r[t+1]=0,r[t]=0,t=t+4,r[t+3]=qn.OP_GETMORE>>24&255,r[t+2]=qn.OP_GETMORE>>16&255,r[t+1]=qn.OP_GETMORE>>8&255,r[t]=qn.OP_GETMORE&255,t=t+4,r[t+3]=0,r[t+2]=0,r[t+1]=0,r[t]=0,t=t+4,t=t+r.write(this.ns,t,"utf8")+1,r[t-1]=0,r[t+3]=this.numberToReturn>>24&255,r[t+2]=this.numberToReturn>>16&255,r[t+1]=this.numberToReturn>>8&255,r[t]=this.numberToReturn&255,t=t+4,r[t+3]=this.cursorId.getLowBits()>>24&255,r[t+2]=this.cursorId.getLowBits()>>16&255,r[t+1]=this.cursorId.getLowBits()>>8&255,r[t]=this.cursorId.getLowBits()&255,t=t+4,r[t+3]=this.cursorId.getHighBits()>>24&255,r[t+2]=this.cursorId.getHighBits()>>16&255,r[t+1]=this.cursorId.getHighBits()>>8&255,r[t]=this.cursorId.getHighBits()&255,t=t+4,r};var YA=function(e,t,r){this.ns=t,this.requestId=Hc++,this.cursorIds=r};YA.prototype.toBin=function(){var e=24+this.cursorIds.length*8,t=0,r=zc.alloc(e);r[t+3]=e>>24&255,r[t+2]=e>>16&255,r[t+1]=e>>8&255,r[t]=e&255,t=t+4,r[t+3]=this.requestId>>24&255,r[t+2]=this.requestId>>16&255,r[t+1]=this.requestId>>8&255,r[t]=this.requestId&255,t=t+4,r[t+3]=0,r[t+2]=0,r[t+1]=0,r[t]=0,t=t+4,r[t+3]=qn.OP_KILL_CURSORS>>24&255,r[t+2]=qn.OP_KILL_CURSORS>>16&255,r[t+1]=qn.OP_KILL_CURSORS>>8&255,r[t]=qn.OP_KILL_CURSORS&255,t=t+4,r[t+3]=0,r[t+2]=0,r[t+1]=0,r[t]=0,t=t+4,r[t+3]=this.cursorIds.length>>24&255,r[t+2]=this.cursorIds.length>>16&255,r[t+1]=this.cursorIds.length>>8&255,r[t]=this.cursorIds.length&255,t=t+4;for(var n=0;n<this.cursorIds.length;n++)r[t+3]=this.cursorIds[n].getLowBits()>>24&255,r[t+2]=this.cursorIds[n].getLowBits()>>16&255,r[t+1]=this.cursorIds[n].getLowBits()>>8&255,r[t]=this.cursorIds[n].getLowBits()&255,t=t+4,r[t+3]=this.cursorIds[n].getHighBits()>>24&255,r[t+2]=this.cursorIds[n].getHighBits()>>16&255,r[t+1]=this.cursorIds[n].getHighBits()>>8&255,r[t]=this.cursorIds[n].getHighBits()&255,t=t+4;return r};var Y_=function(e,t,r,n,i){i=i||{promoteLongs:!0,promoteValues:!0,promoteBuffers:!1,bsonRegExp:!1},this.parsed=!1,this.raw=t,this.data=n,this.bson=e,this.opts=i,this.length=r.length,this.requestId=r.requestId,this.responseTo=r.responseTo,this.opCode=r.opCode,this.fromCompressed=r.fromCompressed,this.responseFlags=n.readInt32LE(0),this.cursorId=new gG(n.readInt32LE(4),n.readInt32LE(8)),this.startingFrom=n.readInt32LE(12),this.numberReturned=n.readInt32LE(16),this.documents=new Array(this.numberReturned),this.cursorNotFound=(this.responseFlags&CG)!==0,this.queryFailure=(this.responseFlags&TG)!==0,this.shardConfigStale=(this.responseFlags&AG)!==0,this.awaitCapable=(this.responseFlags&xG)!==0,this.promoteLongs=typeof i.promoteLongs=="boolean"?i.promoteLongs:!0,this.promoteValues=typeof i.promoteValues=="boolean"?i.promoteValues:!0,this.promoteBuffers=typeof i.promoteBuffers=="boolean"?i.promoteBuffers:!1,this.bsonRegExp=typeof i.bsonRegExp=="boolean"?i.bsonRegExp:!1};Y_.prototype.isParsed=function(){return this.parsed};Y_.prototype.parse=function(e){if(!this.parsed){e=e||{};var t=e.raw||!1,r=e.documentsReturnedIn||null,n=typeof e.promoteLongs=="boolean"?e.promoteLongs:this.opts.promoteLongs,i=typeof e.promoteValues=="boolean"?e.promoteValues:this.opts.promoteValues,s=typeof e.promoteBuffers=="boolean"?e.promoteBuffers:this.opts.promoteBuffers,o=typeof e.bsonRegExp=="boolean"?e.bsonRegExp:this.opts.bsonRegExp,a,u;u={promoteLongs:n,promoteValues:i,promoteBuffers:s,bsonRegExp:o},this.index=20;for(var c=0;c<this.numberReturned;c++)a=this.data[this.index]|this.data[this.index+1]<<8|this.data[this.index+2]<<16|this.data[this.index+3]<<24,t?this.documents[c]=this.data.slice(this.index,this.index+a):this.documents[c]=this.bson.deserialize(this.data.slice(this.index,this.index+a),u),this.index=this.index+a;if(this.documents.length===1&&r!=null&&t){let f={};f[r]=!0,u.fieldsAsRaw=f;let h=this.bson.deserialize(this.documents[0],u);this.documents=[h]}this.parsed=!0}};JA.exports={Query:Ga,GetMore:QA,Response:Y_,KillCursor:YA}});var $o=_((QCe,rx)=>{"use strict";var XA=jt().Buffer,qG=nt().opcodes,MG=nt().databaseNamespace,NG=ir(),$G=se().MongoError,J_=0,ZA=1,ex=2,tx=1<<16,Qa=class{constructor(t,r,n,i){if(n==null)throw new Error("query must be specified for query");this.bson=t,this.ns=r,this.command=n,this.command.$db=MG(r),i.readPreference&&i.readPreference.mode!==NG.PRIMARY&&(this.command.$readPreference=i.readPreference.toJSON()),this.options=i||{},this.requestId=i.requestId?i.requestId:Qa.getRequestId(),this.serializeFunctions=typeof i.serializeFunctions=="boolean"?i.serializeFunctions:!1,this.ignoreUndefined=typeof i.ignoreUndefined=="boolean"?i.ignoreUndefined:!1,this.checkKeys=typeof i.checkKeys=="boolean"?i.checkKeys:!1,this.maxBsonSize=i.maxBsonSize||1024*1024*16,this.checksumPresent=!1,this.moreToCome=i.moreToCome||!1,this.exhaustAllowed=typeof i.exhaustAllowed=="boolean"?i.exhaustAllowed:!1}toBin(){let t=[],r=0;this.checksumPresent&&(r|=ZA),this.moreToCome&&(r|=ex),this.exhaustAllowed&&(r|=tx);let n=XA.alloc(4*4+4);t.push(n);let i=n.length,s=this.command;return i+=this.makeDocumentSegment(t,s),n.writeInt32LE(i,0),n.writeInt32LE(this.requestId,4),n.writeInt32LE(0,8),n.writeInt32LE(qG.OP_MSG,12),n.writeUInt32LE(r,16),t}makeDocumentSegment(t,r){let n=XA.alloc(1);n[0]=0;let i=this.serializeBson(r);return t.push(n),t.push(i),n.length+i.length}serializeBson(t){return this.bson.serialize(t,{checkKeys:this.checkKeys,serializeFunctions:this.serializeFunctions,ignoreUndefined:this.ignoreUndefined})}};Qa.getRequestId=function(){return J_=J_+1&2147483647,J_};var X_=class{constructor(t,r,n,i,s){s=s||{promoteLongs:!0,promoteValues:!0,promoteBuffers:!1,bsonRegExp:!1},this.parsed=!1,this.raw=r,this.data=i,this.bson=t,this.opts=s,this.length=n.length,this.requestId=n.requestId,this.responseTo=n.responseTo,this.opCode=n.opCode,this.fromCompressed=n.fromCompressed,this.responseFlags=i.readInt32LE(0),this.checksumPresent=(this.responseFlags&ZA)!==0,this.moreToCome=(this.responseFlags&ex)!==0,this.exhaustAllowed=(this.responseFlags&tx)!==0,this.promoteLongs=typeof s.promoteLongs=="boolean"?s.promoteLongs:!0,this.promoteValues=typeof s.promoteValues=="boolean"?s.promoteValues:!0,this.promoteBuffers=typeof s.promoteBuffers=="boolean"?s.promoteBuffers:!1,this.bsonRegExp=typeof s.bsonRegExp=="boolean"?s.bsonRegExp:!1,this.documents=[]}isParsed(){return this.parsed}parse(t){if(this.parsed)return;t=t||{},this.index=4;let r=t.raw||!1,n=t.documentsReturnedIn||null,i=typeof t.promoteLongs=="boolean"?t.promoteLongs:this.opts.promoteLongs,s=typeof t.promoteValues=="boolean"?t.promoteValues:this.opts.promoteValues,o=typeof t.promoteBuffers=="boolean"?t.promoteBuffers:this.opts.promoteBuffers,a=typeof t.bsonRegExp=="boolean"?t.bsonRegExp:this.opts.bsonRegExp,u={promoteLongs:i,promoteValues:s,promoteBuffers:o,bsonRegExp:a};for(;this.index<this.data.length;){let c=this.data.readUInt8(this.index++);if(c===1)throw new $G("OP_MSG Payload Type 1 detected unsupported protocol");if(c===0){let f=this.data.readUInt32LE(this.index),h=this.data.slice(this.index,this.index+f);this.documents.push(r?h:this.bson.deserialize(h,u)),this.index+=f}}if(this.documents.length===1&&n!=null&&r){let c={};c[n]=!0,u.fieldsAsRaw=c;let f=this.bson.deserialize(this.documents[0],u);this.documents=[f]}this.parsed=!0}};rx.exports={Msg:Qa,BinMsg:X_}});var Mn=_((YCe,nx)=>{"use strict";var Kc=require("util").format,PG=se().MongoError,Gc={},yr={},pn=null,Is=process.pid,Ki=null,gr=function(e,t){if(!(this instanceof gr))return new gr(e,t);t=t||{},this.className=e,t.logger?Ki=t.logger:Ki==null&&(Ki=console.log),t.loggerLevel&&(pn=t.loggerLevel||"error"),yr[this.className]==null&&(Gc[this.className]=!0)};gr.prototype.debug=function(e,t){if(this.isDebug()&&(Object.keys(yr).length>0&&yr[this.className]||Object.keys(yr).length===0&&Gc[this.className])){var r=new Date().getTime(),n=Kc("[%s-%s:%s] %s %s","DEBUG",this.className,Is,r,e),i={type:"debug",message:e,className:this.className,pid:Is,date:r};t&&(i.meta=t),Ki(n,i)}};gr.prototype.warn=function(e,t){if(this.isWarn()&&(Object.keys(yr).length>0&&yr[this.className]||Object.keys(yr).length===0&&Gc[this.className])){var r=new Date().getTime(),n=Kc("[%s-%s:%s] %s %s","WARN",this.className,Is,r,e),i={type:"warn",message:e,className:this.className,pid:Is,date:r};t&&(i.meta=t),Ki(n,i)}},gr.prototype.info=function(e,t){if(this.isInfo()&&(Object.keys(yr).length>0&&yr[this.className]||Object.keys(yr).length===0&&Gc[this.className])){var r=new Date().getTime(),n=Kc("[%s-%s:%s] %s %s","INFO",this.className,Is,r,e),i={type:"info",message:e,className:this.className,pid:Is,date:r};t&&(i.meta=t),Ki(n,i)}},gr.prototype.error=function(e,t){if(this.isError()&&(Object.keys(yr).length>0&&yr[this.className]||Object.keys(yr).length===0&&Gc[this.className])){var r=new Date().getTime(),n=Kc("[%s-%s:%s] %s %s","ERROR",this.className,Is,r,e),i={type:"error",message:e,className:this.className,pid:Is,date:r};t&&(i.meta=t),Ki(n,i)}},gr.prototype.isInfo=function(){return pn==="info"||pn==="debug"},gr.prototype.isError=function(){return pn==="error"||pn==="info"||pn==="debug"},gr.prototype.isWarn=function(){return pn==="error"||pn==="warn"||pn==="info"||pn==="debug"},gr.prototype.isDebug=function(){return pn==="debug"};gr.reset=function(){pn="error",yr={}};gr.currentLogger=function(){return Ki};gr.setCurrentLogger=function(e){if(typeof e!="function")throw new PG("current logger must be a function");Ki=e};gr.filter=function(e,t){e==="class"&&Array.isArray(t)&&(yr={},t.forEach(function(r){yr[r]=!0}))};gr.setLevel=function(e){if(e!=="info"&&e!=="error"&&e!=="debug"&&e!=="warn")throw new Error(Kc("%s is an illegal logging level",e));pn=e};nx.exports=gr});var Fh=_((JCe,ix)=>{"use strict";var Z_=function(e,t,r){this.result=e,this.connection=t,this.message=r};Z_.prototype.toJSON=function(){let e=Object.assign({},this,this.result);return delete e.message,e};Z_.prototype.toString=function(){return JSON.stringify(this.toJSON())};ix.exports=Z_});var iw=_((XCe,lx)=>{"use strict";var IG=require("events").EventEmitter,RG=require("crypto"),DG=Yt().debugOptions,jG=nt().parseHeader,BG=zi().decompress,sx=dn().Response,ox=$o().BinMsg,cx=se().MongoNetworkError,LG=se().MongoNetworkTimeoutError,rw=se().MongoError,kG=Mn(),FG=nt().opcodes.OP_COMPRESSED,ax=nt().opcodes.OP_MSG,ux=nt().MESSAGE_HEADER_SIZE,fi=jt().Buffer,UG=dn().Query,VG=Fh(),WG=0,zG=1024*1024*16*4,HG=["host","port","size","keepAlive","keepAliveInitialDelay","noDelay","connectionTimeout","socketTimeout","ssl","ca","crl","cert","rejectUnauthorized","promoteLongs","promoteValues","promoteBuffers","bsonRegExp","checkServerIdentity"],Ya,Po=!1,Uh={},nw=class extends IG{constructor(t,r){if(super(),r=r||{},!r.bson)throw new TypeError("must pass in valid bson parser");this.id=WG++,this.options=r,this.logger=kG("Connection",r),this.bson=r.bson,this.tag=r.tag,this.maxBsonMessageSize=r.maxBsonMessageSize||zG,this.helloOk=void 0,this.port=r.port||27017,this.host=r.host||"localhost",this.socketTimeout=typeof r.socketTimeout=="number"?r.socketTimeout:0,this.keepAlive=typeof r.keepAlive=="boolean"?r.keepAlive:!0,this.keepAliveInitialDelay=typeof r.keepAliveInitialDelay=="number"?r.keepAliveInitialDelay:12e4,this.connectionTimeout=typeof r.connectionTimeout=="number"?r.connectionTimeout:3e4,this.keepAliveInitialDelay>this.socketTimeout&&(this.keepAliveInitialDelay=Math.round(this.socketTimeout/2)),this.logger.isDebug()&&this.logger.debug(`creating connection ${this.id} with options [${JSON.stringify(DG(HG,r))}]`),this.responseOptions={promoteLongs:typeof r.promoteLongs=="boolean"?r.promoteLongs:!0,promoteValues:typeof r.promoteValues=="boolean"?r.promoteValues:!0,promoteBuffers:typeof r.promoteBuffers=="boolean"?r.promoteBuffers:!1,bsonRegExp:typeof r.bsonRegExp=="boolean"?r.bsonRegExp:!1},this.flushing=!1,this.queue=[],this.writeStream=null,this.destroyed=!1,this.timedOut=!1;let n=RG.createHash("sha1");n.update(this.address),this.hashedName=n.digest("hex"),this.workItems=[],this.socket=t,this.socket.once("error",GG(this)),this.socket.once("timeout",QG(this)),this.socket.once("close",YG(this)),this.socket.on("data",JG(this)),Po&&KG(this.id,this)}setSocketTimeout(t){this.socket&&this.socket.setTimeout(t)}resetSocketTimeout(){this.socket&&this.socket.setTimeout(this.socketTimeout)}static enableConnectionAccounting(t){t&&(Ya=t),Po=!0,Uh={}}static disableConnectionAccounting(){Po=!1,Ya=void 0}static connections(){return Uh}get address(){return`${this.host}:${this.port}`}unref(){if(this.socket==null){this.once("connect",()=>this.socket.unref());return}this.socket.unref()}flush(t){for(;this.workItems.length>0;){let r=this.workItems.shift();r.cb&&r.cb(t)}}destroy(t,r){if(typeof t=="function"&&(r=t,t={}),t=Object.assign({force:!1},t),Po&&Vh(this.id),this.socket==null){this.destroyed=!0;return}if(t.force||this.timedOut){this.socket.destroy(),this.destroyed=!0,typeof r=="function"&&r(null,null);return}this.socket.end(n=>{this.destroyed=!0,typeof r=="function"&&r(n,null)})}write(t){if(this.logger.isDebug())if(!Array.isArray(t))this.logger.debug(`writing buffer [ ${t.length} ] to ${this.address}`);else for(let r=0;r<t.length;r++)this.logger.debug(`writing buffer [ ${t[r].length} ] to ${this.address}`);if(this.socket.destroyed===!1){if(!Array.isArray(t))return this.socket.write(t,"binary"),!0;for(let r=0;r<t.length;r++)this.socket.write(t[r],"binary");return!0}return!1}toString(){return""+this.id}toJSON(){return{id:this.id,host:this.host,port:this.port}}isConnected(){return this.destroyed?!1:!this.socket.destroyed&&this.socket.writable}command(t,r,n,i){typeof n=="function"&&(i=n,n={});let s=this,o=typeof n.socketTimeout=="number"?n.socketTimeout:0,a=s.options.bson,u=new UG(a,t,r,{numberToSkip:0,numberToReturn:1}),c=()=>{};function f(p,m){i(p,m),i=c}function h(p){s.resetSocketTimeout(),ew.forEach(m=>s.removeListener(m,h)),s.removeListener("message",d),p==null&&(p=new rw(`runCommand failed for connection to '${s.address}'`)),s.on("error",c),f(p)}function d(p){if(p.responseTo!==u.requestId)return;s.resetSocketTimeout(),ew.forEach(y=>s.removeListener(y,h)),s.removeListener("message",d),p.parse({promoteValues:!0});let m=p.documents[0];if(m.ok===0||m.$err||m.errmsg||m.code){f(new rw(m));return}f(void 0,new VG(m,this,p))}s.setSocketTimeout(o),ew.forEach(p=>s.once(p,h)),s.on("message",d),s.write(u.toBin())}},ew=["error","close","timeout","parseError"];function Vh(e){delete Uh[e],Ya&&Ya.deleteConnection(e)}function KG(e,t){Uh[e]=t,Ya&&Ya.addConnection(e,t)}function GG(e){return function(t){Po&&Vh(e.id),e.logger.isDebug()&&e.logger.debug(`connection ${e.id} for [${e.address}] errored out with [${JSON.stringify(t)}]`),e.emit("error",new cx(t),e)}}function QG(e){return function(){Po&&Vh(e.id),e.logger.isDebug()&&e.logger.debug(`connection ${e.id} for [${e.address}] timed out`),e.timedOut=!0,e.emit("timeout",new LG(`connection ${e.id} to ${e.address} timed out`,{beforeHandshake:e.ismaster==null}),e)}}function YG(e){return function(t){Po&&Vh(e.id),e.logger.isDebug()&&e.logger.debug(`connection ${e.id} with for [${e.address}] closed`),t||e.emit("close",new cx(`connection ${e.id} to ${e.address} closed`),e)}}function tw(e,t){let r=jG(t);if(r.opCode!==FG){let s=r.opCode===ax?ox:sx;e.emit("message",new s(e.bson,t,r,t.slice(ux),e.responseOptions),e);return}r.fromCompressed=!0;let n=ux;r.opCode=t.readInt32LE(n),n+=4,r.length=t.readInt32LE(n),n+=4;let i=t[n];n++,BG(i,t.slice(n),(s,o)=>{if(s){e.emit("error",s);return}if(o.length!==r.length){e.emit("error",new rw("Decompressing a compressed message from the server failed. The message is corrupt."));return}let a=r.opCode===ax?ox:sx;e.emit("message",new a(e.bson,t,r,o,e.responseOptions),e)})}function JG(e){return function(t){for(;t.length>0;)if(e.bytesRead>0&&e.sizeOfMessage>0){let r=e.sizeOfMessage-e.bytesRead;if(r>t.length)t.copy(e.buffer,e.bytesRead),e.bytesRead=e.bytesRead+t.length,t=fi.alloc(0);else{t.copy(e.buffer,e.bytesRead,0,r),t=t.slice(r);let n=e.buffer;e.buffer=null,e.sizeOfMessage=0,e.bytesRead=0,e.stubBuffer=null,tw(e,n)}}else if(e.stubBuffer!=null&&e.stubBuffer.length>0)if(e.stubBuffer.length+t.length>4){let r=fi.alloc(e.stubBuffer.length+t.length);e.stubBuffer.copy(r,0),t.copy(r,e.stubBuffer.length),t=r,e.buffer=null,e.sizeOfMessage=0,e.bytesRead=0,e.stubBuffer=null}else{let r=fi.alloc(e.stubBuffer.length+t.length);e.stubBuffer.copy(r,0),t.copy(r,e.stubBuffer.length),t=fi.alloc(0)}else if(t.length>4){let r=t[0]|t[1]<<8|t[2]<<16|t[3]<<24;if(r<0||r>e.maxBsonMessageSize){let n={err:"socketHandler",trace:"",bin:e.buffer,parseState:{sizeOfMessage:r,bytesRead:e.bytesRead,stubBuffer:e.stubBuffer}};e.emit("parseError",n,e);return}if(r>4&&r<e.maxBsonMessageSize&&r>t.length)e.buffer=fi.alloc(r),t.copy(e.buffer,0),e.bytesRead=t.length,e.sizeOfMessage=r,e.stubBuffer=null,t=fi.alloc(0);else if(r>4&&r<e.maxBsonMessageSize&&r===t.length){let n=t;e.buffer=null,e.sizeOfMessage=0,e.bytesRead=0,e.stubBuffer=null,t=fi.alloc(0),tw(e,n)}else if(r<=4||r>e.maxBsonMessageSize){let n={err:"socketHandler",trace:null,bin:t,parseState:{sizeOfMessage:r,bytesRead:0,buffer:null,stubBuffer:null}};e.emit("parseError",n,e),e.buffer=null,e.sizeOfMessage=0,e.bytesRead=0,e.stubBuffer=null,t=fi.alloc(0)}else{let n=t.slice(0,r);e.buffer=null,e.sizeOfMessage=0,e.bytesRead=0,e.stubBuffer=null,t=t.slice(r),tw(e,n)}}else e.stubBuffer=fi.alloc(t.length),t.copy(e.stubBuffer,0),t=fi.alloc(0)}}lx.exports=nw});var Io=_((ZCe,dx)=>{"use strict";var XG=$o().Msg,ZG=dn().KillCursor,eQ=dn().GetMore,Ja=N().deepCopy,tQ=new Set(["authenticate","saslStart","saslContinue","getnonce","createUser","updateUser","copydbgetnonce","copydbsaslstart","copydb"]),rQ=new Set(["hello","ismaster","isMaster"]),fx={$query:"filter",$orderby:"sort",$hint:"hint",$comment:"comment",$maxScan:"maxScan",$max:"max",$min:"min",$returnKey:"returnKey",$showDiskLoc:"showRecordId",$maxTimeMS:"maxTimeMS",$snapshot:"snapshot"},hx={numberToSkip:"skip",numberToReturn:"batchSize",returnFieldsSelector:"projection"},nQ=["tailable","oplogReplay","noCursorTimeout","awaitData","partial","exhaust"],sw=e=>e.ns.split(".")[1],iQ=(e,t)=>tQ.has(e)||rQ.has(e)&&!!t.speculativeAuthenticate,sQ=e=>{let t;if(e instanceof eQ)t={getMore:Ja(e.cursorId),collection:sw(e),batchSize:e.numberToReturn};else if(e instanceof ZG)t={killCursors:sw(e),cursors:Ja(e.cursorIds)};else if(e instanceof XG)t=Ja(e.command);else if(e.query&&e.query.$query){let n;e.ns==="admin.$cmd"?n=Object.assign({},e.query.$query):(n={find:sw(e)},Object.keys(fx).forEach(i=>{typeof e.query[i]<"u"&&(n[fx[i]]=Ja(e.query[i]))})),Object.keys(hx).forEach(i=>{typeof e[i]<"u"&&(n[hx[i]]=Ja(e[i]))}),nQ.forEach(i=>{e[i]&&(n[i]=e[i])}),typeof e.pre32Limit<"u"&&(n.limit=e.pre32Limit),e.query.$explain?t={explain:n}:t=n}else t=Ja(e.query||e);let r=Object.keys(t)[0];return{cmd:t,name:r,shouldRedact:iQ(r,t)}};dx.exports={extractCommand:sQ}});var fw=_((eTe,yx)=>{"use strict";var oQ=dn().KillCursor,aQ=dn().GetMore,mx=N().calculateDurationInMs,cw=Io().extractCommand,px=e=>e.ns,uQ=e=>e.ns.split(".")[0],cQ=e=>e.options?`${e.options.host}:${e.options.port}`:e.address,lQ=e=>e.s&&e.queue,fQ=(e,t)=>e instanceof aQ?{ok:1,cursor:{id:t.message.cursorId,ns:px(e),nextBatch:t.message.documents}}:e instanceof oQ?{ok:1,cursorsUnknown:e.cursorIds}:e.query&&typeof e.query.$query<"u"?{ok:1,cursor:{id:t.message.cursorId,ns:px(e),firstBatch:t.message.documents}}:t&&t.result?t.result:t,lw=e=>{if(lQ(e))return{connectionId:cQ(e)};let t=e;return{address:t.address,connectionId:t.id}},ow=class{constructor(t,r){let n=cw(r),i=n.name,s=lw(t);Object.assign(this,s,{requestId:r.requestId,databaseName:uQ(r),commandName:i,command:n.shouldRedact?{}:n.cmd})}},aw=class{constructor(t,r,n,i){let s=cw(r),o=s.name,a=lw(t);Object.assign(this,a,{requestId:r.requestId,commandName:o,duration:mx(i),reply:s.shouldRedact?{}:fQ(r,n)})}},uw=class{constructor(t,r,n,i){let s=cw(r),o=s.name,a=lw(t);Object.assign(this,a,{requestId:r.requestId,commandName:o,duration:mx(i),failure:s.shouldRedact?{}:n})}};yx.exports={CommandStartedEvent:ow,CommandSucceededEvent:aw,CommandFailedEvent:uw}});var Rs=_((tTe,gx)=>{"use strict";var hw=class{constructor(t,r,n){this.connection=t,this.credentials=r,this.options=n}},dw=class{constructor(t){this.bson=t}prepare(t,r,n){n(void 0,t)}auth(t,r){r(new TypeError("`auth` method must be overridden by subclass"))}};gx.exports={AuthContext:hw,AuthProvider:dw}});var mw=_((rTe,wx)=>{"use strict";var _x=require("crypto"),hQ=Rs().AuthProvider,pw=class extends hQ{auth(t,r){let n=t.connection,i=t.credentials,s=i.username,o=i.password,a=i.source;n.command(`${a}.$cmd`,{getnonce:1},(u,c)=>{let f=null,h=null;if(u==null){f=c.result.nonce;let m=_x.createHash("md5");m.update(s+":mongo:"+o,"utf8");let y=m.digest("hex");m=_x.createHash("md5"),m.update(f+s+y,"utf8"),h=m.digest("hex")}let d={authenticate:1,user:s,nonce:f,key:h};n.command(`${a}.$cmd`,d,r)})}};wx.exports=pw});var gw=_((nTe,Sx)=>{"use strict";var dQ=Rs().AuthProvider,yw=class extends dQ{prepare(t,r,n){let i=r.credentials;Object.assign(t,{speculativeAuthenticate:vx(i)}),n(void 0,t)}auth(t,r){let n=t.connection,i=t.credentials;if(t.response.speculativeAuthenticate)return r();n.command("$external.$cmd",vx(i),r)}};function vx(e){let t={authenticate:1,mechanism:"MONGODB-X509"};return e.username&&Object.assign(t,{user:e.username}),t}Sx.exports=yw});var ww=_((iTe,Ox)=>{"use strict";var pQ=Yt().retrieveBSON,mQ=Rs().AuthProvider,yQ=pQ(),gQ=yQ.Binary,_w=class extends mQ{auth(t,r){let n=t.connection,i=t.credentials,s=i.username,o=i.password,a=new gQ(`\0${s}\0${o}`),u={saslStart:1,mechanism:"PLAIN",payload:a,autoAuthorize:1};n.command("$external.$cmd",u,r)}};Ox.exports=_w});var Ow=_((sTe,Ex)=>{"use strict";var _Q=require("dns"),wQ=Rs().AuthProvider,vQ=he().retrieveKerberos,Wh=se().MongoError,vw,Sw=class extends wQ{auth(t,r){let n=t.connection,i=t.credentials;if(i==null)return r(new Wh("credentials required"));let s=i.username;function o(a,u){return n.command("$external.$cmd",a,u)}SQ(t,(a,u)=>{if(a)return r(a);if(u==null)return r(new Wh("gssapi client missing"));u.step("",(c,f)=>{if(c)return r(c);o(OQ(f),(h,d)=>{if(h)return r(h);let p=d.result;bx(u,10,p.payload,(m,y)=>{if(m)return r(m);o(bQ(y,p.conversationId),(g,w)=>{if(g)return r(g);let S=w.result;EQ(u,s,S.payload,(v,E)=>{if(v)return r(v);o({saslContinue:1,conversationId:S.conversationId,payload:E},(A,x)=>{if(A)return r(A);r(void 0,x)})})})})})})})}};Ex.exports=Sw;function SQ(e,t){let r=e.options.host,n=e.options.port,i=e.credentials;if(!r||!n||!i)return t(new Wh(`Connection must specify: ${r?"host":""}, ${n?"port":""}, ${i?"host":"credentials"}.`));if(vw==null)try{vw=vQ()}catch(c){return t(c)}let s=i.username,o=i.password,a=i.mechanismProperties,u=a.gssapiservicename||a.gssapiServiceName||"mongodb";CQ(r,a,(c,f)=>{if(c)return t(c);let h={};o!=null&&Object.assign(h,{user:s,password:o}),vw.initializeClient(`${u}${process.platform==="win32"?"/":"@"}${f}`,h,(d,p)=>{if(d)return t(new Wh(d));t(null,p)})})}function OQ(e){return{saslStart:1,mechanism:"GSSAPI",payload:e,autoAuthorize:1}}function bQ(e,t){return{saslContinue:1,conversationId:t,payload:e}}function bx(e,t,r,n){e.step(r,(i,s)=>{if(i&&t===0)return n(i);if(i)return bx(e,t-1,r,n);n(void 0,s||"")})}function EQ(e,t,r,n){e.unwrap(r,(i,s)=>{if(i)return n(i);e.wrap(s||"",{user:t},(o,a)=>{if(o)return n(o);n(void 0,a)})})}function CQ(e,t,r){if(!(typeof t.gssapiCanonicalizeHostName=="boolean"?t.gssapiCanonicalizeHostName:!1))return r(void 0,e);_Q.resolveCname(e,(i,s)=>{if(i)return r(i);if(Array.isArray(s)&&s.length>0)return r(void 0,s[0]);r(void 0,e)})}});var Ax=_((oTe,Tx)=>{Tx.exports=Gi;function Gi(e,t){if(!(this instanceof Gi))return new Gi(e,t);this.length=0,this.updates=[],this.path=new Uint16Array(4),this.pages=new Array(32768),this.maxPages=this.pages.length,this.level=0,this.pageSize=e||1024,this.deduplicate=t?t.deduplicate:null,this.zeros=this.deduplicate?zh(this.deduplicate.length):null}Gi.prototype.updated=function(e){for(;this.deduplicate&&e.buffer[e.deduplicate]===this.deduplicate[e.deduplicate];)if(e.deduplicate++,e.deduplicate===this.deduplicate.length){e.deduplicate=0,e.buffer.equals&&e.buffer.equals(this.deduplicate)&&(e.buffer=this.deduplicate);break}e.updated||!this.updates||(e.updated=!0,this.updates.push(e))};Gi.prototype.lastUpdate=function(){if(!this.updates||!this.updates.length)return null;var e=this.updates.pop();return e.updated=!1,e};Gi.prototype._array=function(e,t){if(e>=this.maxPages){if(t)return;TQ(this,e)}qQ(e,this.path);for(var r=this.pages,n=this.level;n>0;n--){var i=this.path[n],s=r[i];if(!s){if(t)return;s=r[i]=new Array(32768)}r=s}return r};Gi.prototype.get=function(e,t){var r=this._array(e,t),n=this.path[0],i=r&&r[n];return!i&&!t&&(i=r[n]=new Cx(e,zh(this.pageSize)),e>=this.length&&(this.length=e+1)),i&&i.buffer===this.deduplicate&&this.deduplicate&&!t&&(i.buffer=xQ(i.buffer),i.deduplicate=0),i};Gi.prototype.set=function(e,t){var r=this._array(e,!1),n=this.path[0];if(e>=this.length&&(this.length=e+1),!t||this.zeros&&t.equals&&t.equals(this.zeros)){r[n]=void 0;return}this.deduplicate&&t.equals&&t.equals(this.deduplicate)&&(t=this.deduplicate);var i=r[n],s=AQ(t,this.pageSize);i?i.buffer=s:r[n]=new Cx(e,s)};Gi.prototype.toBuffer=function(){for(var e=new Array(this.length),t=zh(this.pageSize),r=0;r<e.length;)for(var n=this._array(r,!0),i=0;i<32768&&r<e.length;i++)e[r++]=n&&n[i]?n[i].buffer:t;return Buffer.concat(e)};function TQ(e,t){for(;e.maxPages<t;){var r=e.pages;e.pages=new Array(32768),e.pages[0]=r,e.level++,e.maxPages*=32768}}function AQ(e,t){if(e.length===t)return e;if(e.length>t)return e.slice(0,t);var r=zh(t);return e.copy(r),r}function zh(e){if(Buffer.alloc)return Buffer.alloc(e);var t=new Buffer(e);return t.fill(0),t}function xQ(e){var t=Buffer.allocUnsafe?Buffer.allocUnsafe(e.length):new Buffer(e.length);return e.copy(t),t}function Cx(e,t){this.offset=e*t.length,this.buffer=t,this.updated=!1,this.deduplicate=0}function qQ(e,t){e=(e-(t[0]=e&32767))/32768,e=(e-(t[1]=e&32767))/32768,t[3]=(e-(t[2]=e&32767))/32768&32767}});var qx=_((aTe,xx)=>{var MQ=Ax();xx.exports=Ds;function Ds(e){if(!(this instanceof Ds))return new Ds(e);if(e||(e={}),Buffer.isBuffer(e)&&(e={buffer:e}),this.pageOffset=e.pageOffset||0,this.pageSize=e.pageSize||1024,this.pages=e.pages||MQ(this.pageSize),this.byteLength=this.pages.length*this.pageSize,this.length=8*this.byteLength,!$Q(this.pageSize))throw new Error("The page size should be a power of two");if(this._trackUpdates=!!e.trackUpdates,this._pageMask=this.pageSize-1,e.buffer){for(var t=0;t<e.buffer.length;t+=this.pageSize)this.pages.set(t/this.pageSize,e.buffer.slice(t,t+this.pageSize));this.byteLength=e.buffer.length,this.length=8*this.byteLength}}Ds.prototype.get=function(e){var t=e&7,r=(e-t)/8;return!!(this.getByte(r)&128>>t)};Ds.prototype.getByte=function(e){var t=e&this._pageMask,r=(e-t)/this.pageSize,n=this.pages.get(r,!0);return n?n.buffer[t+this.pageOffset]:0};Ds.prototype.set=function(e,t){var r=e&7,n=(e-r)/8,i=this.getByte(n);return this.setByte(n,t?i|128>>r:i&(255^128>>r))};Ds.prototype.toBuffer=function(){for(var e=NQ(this.pages.length*this.pageSize),t=0;t<this.pages.length;t++){var r=this.pages.get(t,!0),n=t*this.pageSize;r&&r.buffer.copy(e,n,this.pageOffset,this.pageOffset+this.pageSize)}return e};Ds.prototype.setByte=function(e,t){var r=e&this._pageMask,n=(e-r)/this.pageSize,i=this.pages.get(n,!1);return r+=this.pageOffset,i.buffer[r]===t?!1:(i.buffer[r]=t,e>=this.byteLength&&(this.byteLength=e+1,this.length=this.byteLength*8),this._trackUpdates&&this.pages.updated(i),!0)};function NQ(e){if(Buffer.alloc)return Buffer.alloc(e);var t=new Buffer(e);return t.fill(0),t}function $Q(e){return!(e&e-1)}});var $x=_((uTe,Nx)=>{"use strict";var PQ=require("fs"),IQ=require("path"),RQ=qx(),Mx=PQ.readFileSync(IQ.resolve(__dirname,"../code-points.mem")),Qc=0;function Xa(){let e=Mx.readUInt32BE(Qc);Qc+=4;let t=Mx.slice(Qc,Qc+e);return Qc+=e,RQ({buffer:t})}var DQ=Xa(),jQ=Xa(),BQ=Xa(),LQ=Xa(),kQ=Xa(),FQ=Xa();Nx.exports={unassigned_code_points:DQ,commonly_mapped_to_nothing:jQ,non_ASCII_space_characters:BQ,prohibited_characters:LQ,bidirectional_r_al:kQ,bidirectional_l:FQ}});var Dx=_((cTe,Rx)=>{"use strict";var{unassigned_code_points:UQ,commonly_mapped_to_nothing:VQ,non_ASCII_space_characters:WQ,prohibited_characters:zQ,bidirectional_r_al:bw,bidirectional_l:HQ}=$x();Rx.exports=JQ;var KQ=WQ,GQ=VQ,Px=e=>e.codePointAt(0),QQ=e=>e[0],YQ=e=>e[e.length-1];function Ix(e){let t=[],r=e.length;for(let n=0;n<r;n+=1){let i=e.charCodeAt(n);if(i>=55296&&i<=56319&&r>n+1){let s=e.charCodeAt(n+1);if(s>=56320&&s<=57343){t.push((i-55296)*1024+s-56320+65536),n+=1;continue}}t.push(i)}return t}function JQ(e,t={}){if(typeof e!="string")throw new TypeError("Expected string.");if(e.length===0)return"";let r=Ix(e).map(f=>KQ.get(f)?32:f).filter(f=>!GQ.get(f)),n=String.fromCodePoint.apply(null,r).normalize("NFKC"),i=Ix(n);if(i.some(f=>zQ.get(f)))throw new Error("Prohibited character, see https://tools.ietf.org/html/rfc4013#section-2.3");if(t.allowUnassigned!==!0&&i.some(h=>UQ.get(h)))throw new Error("Unassigned code point, see https://tools.ietf.org/html/rfc4013#section-2.5");let o=i.some(f=>bw.get(f)),a=i.some(f=>HQ.get(f));if(o&&a)throw new Error("String must not contain RandALCat and LCat at the same time, see https://tools.ietf.org/html/rfc3454#section-6");let u=bw.get(Px(QQ(n))),c=bw.get(Px(YQ(n)));if(o&&!(u&&c))throw new Error("Bidirectional RandALCat character must be the first and the last character of the string, see https://tools.ietf.org/html/rfc3454#section-6");return n}});var Yc=_((lTe,Vx)=>{"use strict";var Do=require("crypto"),or=jt().Buffer,XQ=Yt().retrieveBSON,Ro=se().MongoError,ZQ=Rs().AuthProvider,eY=N().emitWarning,tY=XQ(),Ew=tY.Binary,Gh;try{Gh=Dx()}catch{}var Qh=class extends ZQ{constructor(t,r){super(t),this.cryptoMethod=r||"sha1"}prepare(t,r,n){let i=this.cryptoMethod;i==="sha256"&&Gh==null&&eY("Warning: no saslprep library specified. Passwords will not be sanitized"),Do.randomBytes(24,(s,o)=>{if(s)return n(s);Object.assign(r,{nonce:o});let a=r.credentials,u=Object.assign({},t,{speculativeAuthenticate:Object.assign(kx(i,a,o),{db:a.source})});n(void 0,u)})}auth(t,r){let n=t.response;if(n&&n.speculativeAuthenticate){Fx(this.cryptoMethod,n.speculativeAuthenticate,t,r);return}rY(this.cryptoMethod,t,r)}};function Bx(e){return e.replace("=","=3D").replace(",","=2C")}function Lx(e,t){return or.concat([or.from("n=","utf8"),or.from(e,"utf8"),or.from(",r=","utf8"),or.from(t.toString("base64"),"utf8")])}function kx(e,t,r){let n=Bx(t.username);return{saslStart:1,mechanism:e==="sha1"?"SCRAM-SHA-1":"SCRAM-SHA-256",payload:new Ew(or.concat([or.from("n,,","utf8"),Lx(n,r)])),autoAuthorize:1,options:{skipEmptyExchange:!0}}}function rY(e,t,r){let n=t.connection,i=t.credentials,s=t.nonce,o=i.source,a=kx(e,i,s);n.command(`${o}.$cmd`,a,(u,c)=>{let f=Ux(u,c);if(f)return r(f);Fx(e,c.result,t,r)})}function Fx(e,t,r,n){let i=r.connection,s=r.credentials,o=r.nonce,a=s.source,u=Bx(s.username),c=s.password,f;if(e==="sha256")f=Gh?Gh(c):c;else try{f=nY(u,c)}catch(F){return n(F)}let h=or.isBuffer(t.payload)?new Ew(t.payload):t.payload,d=jx(h.value()),p=parseInt(d.i,10);if(p&&p<4096){n(new Ro(`Server returned an invalid iteration count ${p}`),!1);return}let m=d.s,y=d.r;if(y.startsWith("nonce")){n(new Ro(`Server returned an invalid nonce: ${y}`),!1);return}let g=`c=biws,r=${y}`,w=uY(f,or.from(m,"base64"),p,e),S=Hh(e,w,"Client Key"),v=Hh(e,w,"Server Key"),E=sY(e,S),A=[Lx(u,o),h.value().toString("base64"),g].join(","),x=Hh(e,E,A),z=`p=${iY(S,x)}`,k=[g,z].join(","),P=Hh(e,v,A),Z={saslContinue:1,conversationId:t.conversationId,payload:new Ew(or.from(k))};i.command(`${a}.$cmd`,Z,(F,b)=>{let q=Ux(F,b);if(q)return n(q);let I=b.result,K=jx(I.payload.value());if(!cY(or.from(K.v,"base64"),P)){n(new Ro("Server returned an invalid signature"));return}if(!I||I.done!==!1)return n(q,I);let C={saslContinue:1,conversationId:I.conversationId,payload:or.alloc(0)};i.command(`${a}.$cmd`,C,n)})}function jx(e){let t={},r=e.split(",");for(let n=0;n<r.length;n++){let i=r[n].split("=");t[i[0]]=i[1]}return t}function nY(e,t){if(typeof e!="string")throw new Ro("username must be a string");if(typeof t!="string")throw new Ro("password must be a string");if(t.length===0)throw new Ro("password cannot be empty");let r=Do.createHash("md5");return r.update(`${e}:mongo:${t}`,"utf8"),r.digest("hex")}function iY(e,t){or.isBuffer(e)||(e=or.from(e)),or.isBuffer(t)||(t=or.from(t));let r=Math.max(e.length,t.length),n=[];for(let i=0;i<r;i+=1)n.push(e[i]^t[i]);return or.from(n).toString("base64")}function sY(e,t){return Do.createHash(e).update(t).digest()}function Hh(e,t,r){return Do.createHmac(e,t).update(r).digest()}var Kh={},Cw=0;function oY(){Kh={},Cw=0}var aY={sha256:32,sha1:20};function uY(e,t,r,n){let i=[e,t.toString("base64"),r].join("_");if(Kh[i]!==void 0)return Kh[i];let s=Do.pbkdf2Sync(e,t,r,aY[n],n);return Cw>=200&&oY(),Kh[i]=s,Cw+=1,s}function cY(e,t){if(e.length!==t.length)return!1;if(typeof Do.timingSafeEqual=="function")return Do.timingSafeEqual(e,t);let r=0;for(let n=0;n<e.length;n++)r|=e[n]^t[n];return r===0}function Ux(e,t){if(e)return e;let r=t.result;if(r.$err||r.errmsg)return new Ro(r)}var Tw=class extends Qh{constructor(t){super(t,"sha1")}},Aw=class extends Qh{constructor(t){super(t,"sha256")}};Vx.exports={ScramSHA1:Tw,ScramSHA256:Aw}});var xw=_((fTe,Wx)=>{"use strict";function lY(e){if(e){if(Array.isArray(e.saslSupportedMechs))return e.saslSupportedMechs.indexOf("SCRAM-SHA-256")>=0?"scram-sha-256":"scram-sha-1";if(e.maxWireVersion>=3)return"scram-sha-1"}return"mongocr"}var Jc=class{constructor(t){t=t||{},this.username=t.username,this.password=t.password,this.source=t.source||t.db,this.mechanism=t.mechanism||"default",this.mechanismProperties=t.mechanismProperties||{},/MONGODB-AWS/i.test(this.mechanism)&&(!this.username&&process.env.AWS_ACCESS_KEY_ID&&(this.username=process.env.AWS_ACCESS_KEY_ID),!this.password&&process.env.AWS_SECRET_ACCESS_KEY&&(this.password=process.env.AWS_SECRET_ACCESS_KEY),this.mechanismProperties.AWS_SESSION_TOKEN==null&&process.env.AWS_SESSION_TOKEN!=null&&(this.mechanismProperties.AWS_SESSION_TOKEN=process.env.AWS_SESSION_TOKEN)),Object.freeze(this.mechanismProperties),Object.freeze(this)}equals(t){return this.mechanism===t.mechanism&&this.username===t.username&&this.password===t.password&&this.source===t.source}resolveAuthMechanism(t){return/DEFAULT/i.test(this.mechanism)?new Jc({username:this.username,password:this.password,source:this.source,mechanism:lY(t),mechanismProperties:this.mechanismProperties}):this}};Wx.exports={MongoCredentials:Jc}});var Kx=_((hTe,Hx)=>{"use strict";var fY=Rs().AuthProvider,hY=xw().MongoCredentials,jo=se().MongoError,dY=require("crypto"),pY=require("http"),mY=he().maxWireVersion,yY=require("url"),Mw;try{Mw=require("aws4")}catch{}var gY=110,_Y="http://169.254.170.2",qw="http://169.254.169.254",zx="/latest/meta-data/iam/security-credentials",Nw=class extends fY{auth(t,r){let n=t.connection,i=t.credentials;if(mY(n)<9){r(new jo("MONGODB-AWS authentication requires MongoDB version 4.4 or later"));return}if(Mw==null){r(new jo("MONGODB-AWS authentication requires the `aws4` module, please install it as a dependency of your project"));return}if(i.username==null){wY(i,(h,d)=>{if(h)return r(h);t.credentials=d,this.auth(t,r)});return}let s=i.source,o=this.bson,a=i.username,u=i.password,c=i.mechanismProperties.AWS_SESSION_TOKEN,f=a&&u&&c?{accessKeyId:a,secretAccessKey:u,sessionToken:c}:a&&u?{accessKeyId:a,secretAccessKey:u}:void 0;dY.randomBytes(32,(h,d)=>{if(h){r(h);return}let p={saslStart:1,mechanism:"MONGODB-AWS",payload:o.serialize({r:d,p:gY})};n.command(`${s}.$cmd`,p,(m,y)=>{if(m)return r(m);let g=y.result,w=o.deserialize(g.payload.buffer),S=w.h,v=w.s.buffer;if(v.length!==64){r(new jo(`Invalid server nonce length ${v.length}, expected 64`));return}if(v.compare(d,0,d.length,0,d.length)!==0){r(new jo("Server nonce does not begin with client nonce"));return}if(S.length<1||S.length>255||S.indexOf("..")!==-1){r(new jo(`Server returned an invalid host: "${S}"`));return}let E="Action=GetCallerIdentity&Version=2011-06-15",A=Mw.sign({method:"POST",host:S,region:vY(w.h),service:"sts",headers:{"Content-Type":"application/x-www-form-urlencoded","Content-Length":E.length,"X-MongoDB-Server-Nonce":v.toString("base64"),"X-MongoDB-GS2-CB-Flag":"n"},path:"/",body:E},f),x=A.headers.Authorization,z=A.headers["X-Amz-Date"],k={a:x,d:z};c&&(k.t=c);let P={saslContinue:1,conversationId:1,payload:o.serialize(k)};n.command(`${s}.$cmd`,P,Z=>{if(Z)return r(Z);r()})})})}};function wY(e,t){function r(n){if(n.AccessKeyId==null||n.SecretAccessKey==null||n.Token==null){t(new jo("Could not obtain temporary MONGODB-AWS credentials"));return}t(void 0,new hY({username:n.AccessKeyId,password:n.SecretAccessKey,source:e.source,mechanism:"MONGODB-AWS",mechanismProperties:{AWS_SESSION_TOKEN:n.Token}}))}if(process.env.AWS_CONTAINER_CREDENTIALS_RELATIVE_URI){Yh(`${_Y}${process.env.AWS_CONTAINER_CREDENTIALS_RELATIVE_URI}`,void 0,(n,i)=>{if(n)return t(n);r(i)});return}Yh(`${qw}/latest/api/token`,{method:"PUT",json:!1,headers:{"X-aws-ec2-metadata-token-ttl-seconds":30}},(n,i)=>{if(n)return t(n);Yh(`${qw}/${zx}`,{json:!1,headers:{"X-aws-ec2-metadata-token":i}},(s,o)=>{if(s)return t(s);Yh(`${qw}/${zx}/${o}`,{headers:{"X-aws-ec2-metadata-token":i}},(a,u)=>{if(a)return t(a);r(u)})})})}function vY(e){let t=e.split(".");return t.length===1||t[1]==="amazonaws"?"us-east-1":t[1]}function Yh(e,t,r){t=Object.assign({method:"GET",timeout:1e4,json:!0},yY.parse(e),t);let n=pY.request(t,i=>{i.setEncoding("utf8");let s="";i.on("data",o=>s+=o),i.on("end",()=>{if(t.json===!1){r(void 0,s);return}try{let o=JSON.parse(s);r(void 0,o)}catch{r(new jo(`Invalid JSON response: "${s}"`))}})});n.on("error",i=>r(i)),n.end()}Hx.exports=Nw});var $w=_((dTe,Gx)=>{"use strict";var SY=mw(),OY=gw(),bY=ww(),EY=Ow(),CY=Yc().ScramSHA1,TY=Yc().ScramSHA256,AY=Kx();function xY(e){return{"mongodb-aws":new AY(e),mongocr:new SY(e),x509:new OY(e),plain:new bY(e),gssapi:new EY(e),"scram-sha-1":new CY(e),"scram-sha-256":new TY(e)}}Gx.exports={defaultAuthProviders:xY}});var Zh=_((pTe,eq)=>{"use strict";var Jx=require("net"),qY=require("tls"),Xx=iw(),Xc=se().MongoError,Jh=se().MongoNetworkError,MY=se().MongoNetworkTimeoutError,NY=$w().defaultAuthProviders,$Y=Rs().AuthContext,Xh=H_(),PY=he().makeClientMetadata,Qx=Xh.MAX_SUPPORTED_WIRE_VERSION,IY=Xh.MAX_SUPPORTED_SERVER_VERSION,Yx=Xh.MIN_SUPPORTED_WIRE_VERSION,RY=Xh.MIN_SUPPORTED_SERVER_VERSION,Za;function DY(e,t,r){typeof t=="function"&&(r=t,t=void 0);let n=e&&e.connectionType?e.connectionType:Xx;Za==null&&(Za=NY(e.bson));let i=e.family!==void 0?e.family:0;VY(i,e,t,(s,o)=>{if(s){r(s,o);return}LY(new n(o,e),e,r)})}function jY(e){return!(e instanceof Xx)}function BY(e,t){let r=e&&typeof e.maxWireVersion=="number"&&e.maxWireVersion>=Yx,n=e&&typeof e.minWireVersion=="number"&&e.minWireVersion<=Qx;if(r){if(n)return null;let s=`Server at ${t.host}:${t.port} reports minimum wire version ${e.minWireVersion}, but this version of the Node.js Driver requires at most ${Qx} (MongoDB ${IY})`;return new Xc(s)}let i=`Server at ${t.host}:${t.port} reports maximum wire version ${e.maxWireVersion||0}, but this version of the Node.js Driver requires at least ${Yx} (MongoDB ${RY})`;return new Xc(i)}function LY(e,t,r){let n=function(o,a){o&&e&&e.destroy(),r(o,a)},i=t.credentials;if(i&&!i.mechanism.match(/DEFAULT/i)&&!Za[i.mechanism]){n(new Xc(`authMechanism '${i.mechanism}' not supported`));return}let s=new $Y(e,i,t);kY(s,(o,a)=>{if(o)return n(o);let u=Object.assign({},t);(t.connectTimeoutMS||t.connectionTimeout)&&(u.socketTimeout=t.connectTimeoutMS||t.connectionTimeout),a.helloOk=!!t.useUnifiedTopology;let c=new Date().getTime();e.command("admin.$cmd",a,u,(f,h)=>{if(f){n(f);return}let d=h.result;if(d.ok===0){n(new Xc(d));return}"isWritablePrimary"in d&&(d.ismaster=d.isWritablePrimary),t.useUnifiedTopology&&d.helloOk&&(e.helloOk=!0);let p=BY(d,t);if(p){n(p);return}if(!jY(e)&&d.compression){let m=a.compression.filter(y=>d.compression.indexOf(y)!==-1);m.length&&(e.agreedCompressor=m[0]),t.compression&&t.compression.zlibCompressionLevel&&(e.zlibCompressionLevel=t.compression.zlibCompressionLevel)}if(e.ismaster=d,e.lastIsMasterMS=new Date().getTime()-c,!d.arbiterOnly&&i){Object.assign(s,{response:d});let m=i.resolveAuthMechanism(d);Za[m.mechanism].auth(s,g=>{if(g)return n(g);n(void 0,e)});return}n(void 0,e)})})}function kY(e,t){let r=e.options,n=e.connection.serverApi,i=r.compression&&r.compression.compressors?r.compression.compressors:[],s={[n?"hello":"ismaster"]:!0,client:r.metadata||PY(r),compression:i},o=e.credentials;if(o){if(o.mechanism.match(/DEFAULT/i)&&o.username){Object.assign(s,{saslSupportedMechs:`${o.source}.${o.username}`}),Za["scram-sha-256"].prepare(s,e,t);return}let a=Za[o.mechanism];if(a==null)return t(new Xc(`No AuthProvider for ${o.mechanism} defined.`));a.prepare(s,e,t);return}t(void 0,s)}var FY=["pfx","key","passphrase","cert","ca","ciphers","NPNProtocols","ALPNProtocols","servername","ecdhCurve","secureProtocol","secureContext","session","minDHSize","crl","rejectUnauthorized"];function Zx(e,t){let r=typeof t.host=="string"?t.host:"localhost";return r.indexOf("/")!==-1?{path:r}:{family:e,host:r,port:typeof t.port=="number"?t.port:27017,rejectUnauthorized:!1}}function UY(e,t){let r=Zx(e,t);for(let n in t)t[n]!=null&&FY.indexOf(n)!==-1&&(r[n]=t[n]);return t.checkServerIdentity===!1?r.checkServerIdentity=function(){}:typeof t.checkServerIdentity=="function"&&(r.checkServerIdentity=t.checkServerIdentity),r.servername==null&&!Jx.isIP(r.host)&&(r.servername=r.host),r}var Pw=new Set(["error","close","timeout","parseError"]);function VY(e,t,r,n){let i=typeof t.ssl=="boolean"?t.ssl:!1,s=typeof t.keepAlive=="boolean"?t.keepAlive:!0,o=typeof t.keepAliveInitialDelay=="number"?t.keepAliveInitialDelay:12e4,a=typeof t.noDelay=="boolean"?t.noDelay:!0,u=typeof t.connectionTimeout=="number"?t.connectionTimeout:typeof t.connectTimeoutMS=="number"?t.connectTimeoutMS:3e4,c=typeof t.socketTimeoutMS=="number"?t.socketTimeoutMS:typeof t.socketTimeout=="number"?t.socketTimeout:0,f=typeof t.rejectUnauthorized=="boolean"?t.rejectUnauthorized:!0;o>c&&(o=Math.round(c/2));let h,d=function(w,S){w&&h&&h.destroy(),n(w,S)};try{i?(h=qY.connect(UY(e,t)),typeof h.disableRenegotiation=="function"&&h.disableRenegotiation()):h=Jx.createConnection(Zx(e,t))}catch(w){return d(w)}h.setKeepAlive(s,o),h.setTimeout(u),h.setNoDelay(a);let p=i?"secureConnect":"connect",m;function y(w){return S=>{Pw.forEach(v=>h.removeAllListeners(v)),m&&r.removeListener("cancel",m),h.removeListener(p,g),d(WY(w,S))}}function g(){if(Pw.forEach(w=>h.removeAllListeners(w)),m&&r.removeListener("cancel",m),h.authorizationError&&f)return d(h.authorizationError);h.setTimeout(c),d(null,h)}Pw.forEach(w=>h.once(w,y(w))),r&&(m=y("cancel"),r.once("cancel",m)),h.once(p,g)}function WY(e,t){switch(e){case"error":return new Jh(t);case"timeout":return new MY("connection timed out");case"close":return new Jh("connection closed");case"cancel":return new Jh("connection establishment was cancelled");default:return new Jh("unknown network error")}}eq.exports=DY});var Lo=_((mTe,tq)=>{"use strict";var Bo=class{constructor(t){t!=null&&(this.level=t)}static fromOptions(t){if(t!=null){if(t.readConcern)return t.readConcern instanceof Bo?t.readConcern:new Bo(t.readConcern.level);if(t.level)return new Bo(t.level)}}static get MAJORITY(){return"majority"}static get AVAILABLE(){return"available"}static get LINEARIZABLE(){return"linearizable"}static get SNAPSHOT(){return"snapshot"}};tq.exports=Bo});var eu=_((yTe,iq)=>{"use strict";var rq=se().MongoError,zY=ir(),HY=Lo(),KY=Wi(),js,nq;(()=>{let e="NO_TRANSACTION",t="STARTING_TRANSACTION",r="TRANSACTION_IN_PROGRESS",n="TRANSACTION_COMMITTED",i="TRANSACTION_COMMITTED_EMPTY",s="TRANSACTION_ABORTED";js={NO_TRANSACTION:e,STARTING_TRANSACTION:t,TRANSACTION_IN_PROGRESS:r,TRANSACTION_COMMITTED:n,TRANSACTION_COMMITTED_EMPTY:i,TRANSACTION_ABORTED:s},nq={[e]:[e,t],[t]:[r,n,i,s],[r]:[r,n,s],[n]:[n,i,t,e],[s]:[t,e],[i]:[i,e]}})();var Iw=class{constructor(t){t=t||{},this.state=js.NO_TRANSACTION,this.options={};let r=KY.fromOptions(t);if(r){if(r.w<=0)throw new rq("Transactions do not support unacknowledged write concern");this.options.writeConcern=r}t.readConcern&&(this.options.readConcern=HY.fromOptions(t)),t.readPreference&&(this.options.readPreference=zY.fromOptions(t)),t.maxCommitTimeMS&&(this.options.maxTimeMS=t.maxCommitTimeMS),this._pinnedServer=void 0,this._recoveryToken=void 0}get server(){return this._pinnedServer}get recoveryToken(){return this._recoveryToken}get isPinned(){return!!this.server}get isActive(){return[js.STARTING_TRANSACTION,js.TRANSACTION_IN_PROGRESS].indexOf(this.state)!==-1}transition(t){let r=nq[this.state];if(r&&r.indexOf(t)!==-1){this.state=t,(this.state===js.NO_TRANSACTION||this.state===js.STARTING_TRANSACTION||this.state===js.TRANSACTION_ABORTED)&&this.unpinServer();return}throw new rq(`Attempted illegal state transition from [${this.state}] to [${t}]`)}pinServer(t){this.isActive&&(this._pinnedServer=t)}unpinServer(){this._pinnedServer=void 0}};function GY(e){return!!(e.commitTransaction||e.abortTransaction)}iq.exports={TxnState:js,Transaction:Iw,isTransactionCommand:GY}});var xt=_((gTe,fq)=>{"use strict";var QY=xo().MONGODB_ERROR_CODES,YY=ir(),ed=mr().TopologyType,oq=se().MongoError,JY=se().isRetryableWriteError,XY=he().maxWireVersion,ZY=se().MongoNetworkError,e7=QY.IllegalOperation;function Rw(e,t,r){e.listeners(t).length>0&&e.emit(t,r)}function t7(e){return!e.compression||!e.compression.compressors?[]:(e.compression.compressors.forEach(function(t){if(t!=="snappy"&&t!=="zlib")throw new Error("compressors must be at least one of snappy or zlib")}),e.compression.compressors)}function r7(e){return JSON.parse(JSON.stringify(e))}var n7=function(e){return e.s.serverDescription||(e.s.serverDescription={address:e.name,arbiters:[],hosts:[],passives:[],type:"Unknown"}),e.s.serverDescription},aq=function(e,t){e.listeners("serverDescriptionChanged").length>0&&(e.emit("serverDescriptionChanged",{topologyId:e.s.topologyId!==-1?e.s.topologyId:e.id,address:e.name,previousDescription:n7(e),newDescription:t}),e.s.serverDescription=t)},i7=function(e){return e.s.topologyDescription||(e.s.topologyDescription={topologyType:"Unknown",servers:[{address:e.name,arbiters:[],hosts:[],passives:[],type:"Unknown"}]}),e.s.topologyDescription},s7=function(e,t){e.listeners("topologyDescriptionChanged").length>0&&(e.emit("topologyDescriptionChanged",{topologyId:e.s.topologyId!==-1?e.s.topologyId:e.id,address:e.name,previousDescription:i7(e),newDescription:t}),e.s.serverDescription=t)},o7=function(e,t,r){var n=td(e,t),i=td(e,r);return i!==n},td=function(e,t){return t||(t=e.ismaster),t?t.ismaster&&t.msg==="isdbgrid"?"Mongos":t.ismaster&&!t.hosts?"Standalone":t.ismaster?"RSPrimary":t.secondary?"RSSecondary":t.arbiterOnly?"RSArbiter":"Unknown":"Unknown"},uq=function(e){return function(t){if(e.s.state!=="destroyed"){var r=new Date().getTime();Rw(e,"serverHeartbeatStarted",{connectionId:e.name}),e.command("admin.$cmd",{ismaster:!0},{monitoring:!0},function(n,i){if(n)Rw(e,"serverHeartbeatFailed",{durationMS:s,failure:n,connectionId:e.name});else{e.emit("ismaster",i,e);var s=new Date().getTime()-r;Rw(e,"serverHeartbeatSucceeded",{durationMS:s,reply:i.result,connectionId:e.name}),o7(e,e.s.ismaster,i.result)&&aq(e,{address:e.name,arbiters:[],hosts:[],passives:[],type:e.s.inTopology?td(e):"Standalone"}),e.s.ismaster=i.result,e.s.isMasterLatencyMS=s}if(typeof t=="function")return t(n,i);e.s.inquireServerStateTimeout=setTimeout(uq(e),e.s.haInterval)})}}},a7=function(e){var t={};for(var r in e)t[r]=e[r];return t};function u7(e,t){var r=!1;this.start=function(){return this.isRunning()||(r=setInterval(e,t)),this},this.stop=function(){return clearInterval(r),r=!1,this},this.isRunning=function(){return r!==!1}}function c7(e,t){var r=!1,n=()=>{r&&(clearTimeout(r),r=!1,e())};this.start=function(){return this.isRunning()||(r=setTimeout(n,t)),this},this.stop=function(){return clearTimeout(r),r=!1,this},this.isRunning=function(){return r!==!1}}function l7(e,t){var r={servers:[]};e||(e={servers:[]});for(var n=0;n<e.servers.length;n++){for(var i=!1,s=0;s<t.servers.length;s++)if(t.servers[s].address.toLowerCase()===e.servers[n].address.toLowerCase()){i=!0;break}i||r.servers.push({address:e.servers[n].address,from:e.servers[n].type,to:"Unknown"})}for(s=0;s<t.servers.length;s++){for(i=!1,n=0;n<e.servers.length;n++)if(e.servers[n].address.toLowerCase()===t.servers[s].address.toLowerCase()){i=!0;break}i||r.servers.push({address:t.servers[s].address,from:"Unknown",to:t.servers[s].type})}for(n=0;n<e.servers.length;n++){var o=e.servers[n];for(s=0;s<t.servers.length;s++){var a=t.servers[s];o.address.toLowerCase()===a.address.toLowerCase()&&o.type!==a.type&&r.servers.push({address:o.address,from:o.type,to:a.type})}}return r}function f7(e,t){(e.clusterTime==null||t.clusterTime.greaterThan(e.clusterTime.clusterTime))&&(e.clusterTime=t)}var h7={endSessions:function(e,t){Array.isArray(e)||(e=[e]),this.command("admin.$cmd",{endSessions:e},{readPreference:YY.primaryPreferred},()=>{typeof t=="function"&&t()})}};function cq(e){return e.description?e.description.type:e.type==="mongos"?ed.Sharded:e.type==="replset"?ed.ReplicaSetWithPrimary:ed.Single}var d7=6,lq=function(e){return!(e.lastIsMaster().maxWireVersion<d7||!e.logicalSessionTimeoutMinutes||cq(e)===ed.Single)},sq="This MongoDB deployment does not support retryable writes. Please add retryWrites=false to your connection string.";function p7(e){return e.code!==e7||!e.errmsg.includes("Transaction numbers")?e:new oq({message:sq,errmsg:sq,originalError:e})}function m7(e,t){return e instanceof oq?(lq(t)&&(e instanceof ZY||XY(t)<9&&JY(e))&&e.addErrorLabel("RetryableWriteError"),e.hasErrorLabel("RetryableWriteError")):!1}fq.exports={SessionMixins:h7,resolveClusterTime:f7,inquireServerState:uq,getTopologyType:td,emitServerDescriptionChanged:aq,emitTopologyDescriptionChanged:s7,cloneOptions:a7,createCompressionInfo:t7,clone:r7,diff:l7,Interval:u7,Timeout:c7,isRetryableWritesSupported:lq,getMMAPError:p7,topologyType:cq,legacyIsRetryableWriteError:m7}});var Bs=_((_Te,Eq)=>{"use strict";var y7=Yt().retrieveBSON,g7=require("events"),gq=y7(),hq=gq.Binary,_7=he().uuidV4,Qn=se().MongoError,dq=se().isRetryableError,w7=se().MongoNetworkError,v7=se().MongoWriteConcernError,pq=eu().Transaction,qt=eu().TxnState,S7=he().isPromiseLike,O7=ir(),Dw=N().maybePromise,b7=eu().isTransactionCommand,E7=xt().resolveClusterTime,C7=nt().isSharded,T7=he().maxWireVersion,jw=N().now,_q=N().calculateDurationInMs,A7=8;function wq(e,t){if(e.serverSession==null){let r=new Qn("Cannot use a session that has ended");if(typeof t=="function")return t(r,null),!1;throw r}return!0}var Zc=Symbol("serverSession"),el=class extends g7{constructor(t,r,n,i){if(super(),t==null)throw new Error("ClientSession requires a topology");if(r==null||!(r instanceof nd))throw new Error("ClientSession requires a ServerSessionPool");n=n||{},i=i||{},this.topology=t,this.sessionPool=r,this.hasEnded=!1,this.clientOptions=i,this[Zc]=void 0,this.supports={causalConsistency:typeof n.causalConsistency<"u"?n.causalConsistency:!0},this.clusterTime=n.initialClusterTime,this.operationTime=null,this.explicit=!!n.explicit,this.owner=n.owner,this.defaultTransactionOptions=Object.assign({},n.defaultTransactionOptions),this.transaction=new pq}get id(){return this.serverSession.id}get serverSession(){return this[Zc]==null&&(this[Zc]=this.sessionPool.acquire()),this[Zc]}endSession(t,r){typeof t=="function"&&(r=t,t={}),t=t||{};let n=this;return Dw(this,r,i=>{if(n.hasEnded)return i();function s(){n.sessionPool.release(n.serverSession),n[Zc]=void 0,n.hasEnded=!0,n.emit("ended",n),i()}if(n.serverSession&&n.inTransaction()){n.abortTransaction(o=>{if(o)return i(o);s()});return}s()})}advanceOperationTime(t){if(this.operationTime==null){this.operationTime=t;return}t.greaterThan(this.operationTime)&&(this.operationTime=t)}equals(t){return t instanceof el?this.id.id.buffer.equals(t.id.id.buffer):!1}incrementTransactionNumber(){this.serverSession.txnNumber++}inTransaction(){return this.transaction.isActive}startTransaction(t){if(wq(this),this.inTransaction())throw new Qn("Transaction already in progress");let r=T7(this.topology);if(C7(this.topology)&&r!=null&&r<A7)throw new Qn("Transactions are not supported on sharded clusters in MongoDB < 4.2.");this.incrementTransactionNumber(),this.transaction=new pq(Object.assign({},this.clientOptions,t||this.defaultTransactionOptions)),this.transaction.transition(qt.STARTING_TRANSACTION)}commitTransaction(t){return Dw(this,t,r=>yq(this,"commitTransaction",r))}abortTransaction(t){return Dw(this,t,r=>yq(this,"abortTransaction",r))}toBSON(){throw new Error("ClientSession cannot be serialized to BSON.")}withTransaction(t,r){let n=jw();return Bw(this,n,t,r)}},vq=12e4,x7=100,q7=79,mq=50,M7=new Set(["CannotSatisfyWriteConcern","UnknownReplWriteConcern","UnsatisfiableWriteConcern"]);function Sq(e,t){return _q(e)<t}function N7(e){return id(e)||!M7.has(e.codeName)&&e.code!==x7&&e.code!==q7}function id(e){return e==null?!1:e.code===mq||e.writeConcernError&&e.writeConcernError.code===mq}function Oq(e,t,r,n){return e.commitTransaction().catch(i=>{if(i instanceof Qn&&Sq(t,vq)&&!id(i)){if(i.hasErrorLabel("UnknownTransactionCommitResult"))return Oq(e,t,r,n);if(i.hasErrorLabel("TransientTransactionError"))return Bw(e,t,r,n)}throw i})}var $7=new Set([qt.NO_TRANSACTION,qt.TRANSACTION_COMMITTED,qt.TRANSACTION_ABORTED]);function P7(e){return $7.has(e.transaction.state)}function Bw(e,t,r,n){e.startTransaction(n);let i;try{i=r(e)}catch(s){i=Promise.reject(s)}if(!S7(i))throw e.abortTransaction(),new TypeError("Function provided to `withTransaction` must return a Promise");return i.then(()=>{if(!P7(e))return Oq(e,t,r,n)}).catch(s=>{function o(a){if(a instanceof Qn&&a.hasErrorLabel("TransientTransactionError")&&Sq(t,vq))return Bw(e,t,r,n);throw id(a)&&a.addErrorLabel("UnknownTransactionCommitResult"),a}return e.transaction.isActive?e.abortTransaction().then(()=>o(s)):o(s)})}function yq(e,t,r){if(!wq(e,r))return;let n=e.transaction.state;if(n===qt.NO_TRANSACTION){r(new Qn("No transaction started"));return}if(t==="commitTransaction"){if(n===qt.STARTING_TRANSACTION||n===qt.TRANSACTION_COMMITTED_EMPTY){e.transaction.transition(qt.TRANSACTION_COMMITTED_EMPTY),r(null,null);return}if(n===qt.TRANSACTION_ABORTED){r(new Qn("Cannot call commitTransaction after calling abortTransaction"));return}}else{if(n===qt.STARTING_TRANSACTION){e.transaction.transition(qt.TRANSACTION_ABORTED),r(null,null);return}if(n===qt.TRANSACTION_ABORTED){r(new Qn("Cannot call abortTransaction twice"));return}if(n===qt.TRANSACTION_COMMITTED||n===qt.TRANSACTION_COMMITTED_EMPTY){r(new Qn("Cannot call abortTransaction after calling commitTransaction"));return}}let i={[t]:1},s;e.transaction.options.writeConcern?s=Object.assign({},e.transaction.options.writeConcern):e.clientOptions&&e.clientOptions.w&&(s={w:e.clientOptions.w}),n===qt.TRANSACTION_COMMITTED&&(s=Object.assign({wtimeout:1e4},s,{w:"majority"})),s&&Object.assign(i,{writeConcern:s}),t==="commitTransaction"&&e.transaction.options.maxTimeMS&&Object.assign(i,{maxTimeMS:e.transaction.options.maxTimeMS});function o(u,c){t==="commitTransaction"?(e.transaction.transition(qt.TRANSACTION_COMMITTED),u&&(u instanceof w7||u instanceof v7||dq(u)||id(u)?N7(u)&&(u.addErrorLabel("UnknownTransactionCommitResult"),e.transaction.unpinServer()):u.hasErrorLabel("TransientTransactionError")&&e.transaction.unpinServer())):e.transaction.transition(qt.TRANSACTION_ABORTED),r(u,c)}function a(u){return t==="commitTransaction"?u:null}e.transaction.recoveryToken&&I7(e)&&(i.recoveryToken=e.transaction.recoveryToken),e.topology.command("admin.$cmd",i,{session:e},(u,c)=>{if(u&&dq(u))return i.commitTransaction&&(e.transaction.unpinServer(),i.writeConcern=Object.assign({wtimeout:1e4},i.writeConcern,{w:"majority"})),e.topology.command("admin.$cmd",i,{session:e},(f,h)=>o(a(f),h));o(a(u),c)})}function I7(e){return!!e.topology.s.options.useRecoveryToken}var rd=class{constructor(){this.id={id:new hq(_7(),hq.SUBTYPE_UUID)},this.lastUse=jw(),this.txnNumber=0,this.isDirty=!1}hasTimedOut(t){return Math.round(_q(this.lastUse)%864e5%36e5/6e4)>t-1}},nd=class{constructor(t){if(t==null)throw new Error("ServerSessionPool requires a topology");this.topology=t,this.sessions=[]}endAllPooledSessions(t){if(this.sessions.length){this.topology.endSessions(this.sessions.map(r=>r.id),()=>{this.sessions=[],typeof t=="function"&&t()});return}typeof t=="function"&&t()}acquire(){let t=this.topology.logicalSessionTimeoutMinutes;for(;this.sessions.length;){let r=this.sessions.shift();if(!r.hasTimedOut(t))return r}return new rd}release(t){let r=this.topology.logicalSessionTimeoutMinutes;for(;this.sessions.length&&this.sessions[this.sessions.length-1].hasTimedOut(r);)this.sessions.pop();if(!t.hasTimedOut(r)){if(t.isDirty)return;this.sessions.unshift(t)}}};function bq(e,t){return!!(e.aggregate||e.count||e.distinct||e.find||e.parallelCollectionScan||e.geoNear||e.geoSearch||e.mapReduce&&t&&t.out&&(t.out.inline===1||t.out==="inline"))}function R7(e,t,r){if(e.hasEnded)return new Qn("Cannot use a session that has ended");if(r&&r.writeConcern&&r.writeConcern.w===0)return;let n=e.serverSession;n.lastUse=jw(),t.lsid=n.id;let i=e.inTransaction()||b7(t),s=r.willRetryWrite,o=bq(t,r);if(n.txnNumber&&(s||i)&&(t.txnNumber=gq.Long.fromNumber(n.txnNumber)),!i){e.transaction.state!==qt.NO_TRANSACTION&&e.transaction.transition(qt.NO_TRANSACTION),e.supports.causalConsistency&&e.operationTime&&o&&(t.readConcern=t.readConcern||{},Object.assign(t.readConcern,{afterClusterTime:e.operationTime}));return}if(r.readPreference&&!r.readPreference.equals(O7.primary))return new Qn(`Read preference in a transaction must be primary, not: ${r.readPreference.mode}`);if(t.autocommit=!1,e.transaction.state===qt.STARTING_TRANSACTION){e.transaction.transition(qt.TRANSACTION_IN_PROGRESS),t.startTransaction=!0;let a=e.transaction.options.readConcern||e.clientOptions.readConcern;a&&(t.readConcern=a),e.supports.causalConsistency&&e.operationTime&&(t.readConcern=t.readConcern||{},Object.assign(t.readConcern,{afterClusterTime:e.operationTime}))}}function D7(e,t){t.$clusterTime&&E7(e,t.$clusterTime),t.operationTime&&e&&e.supports.causalConsistency&&e.advanceOperationTime(t.operationTime),t.recoveryToken&&e&&e.inTransaction()&&(e.transaction._recoveryToken=t.recoveryToken)}Eq.exports={ClientSession:el,ServerSession:rd,ServerSessionPool:nd,TxnState:qt,applySession:R7,updateSessionFromResponse:D7,commandSupportsReadConcern:bq}});var Rq=_((wTe,Iq)=>{"use strict";var j7=require("util").inherits,Fw=require("events").EventEmitter,Nn=se().MongoError,B7=se().MongoTimeoutError,L7=se().MongoWriteConcernError,k7=Mn(),F7=require("util").format,U7=$o().Msg,V7=Fh(),Lw=nt().MESSAGE_HEADER_SIZE,Cq=nt().COMPRESSION_DETAILS_SIZE,W7=nt().opcodes,z7=zi().compress,H7=zi().compressorIDs,K7=zi().uncompressibleCommands,sd=fw(),kw=jt().Buffer,G7=Zh(),Q7=Bs().updateSessionFromResponse,xq=he().eachAsync,Y7=he().makeStateMachine,J7=N().now,ks="disconnected",tu="connecting",tl="connected",Ls="draining",mn="destroying",Ir="destroyed",ru=Y7({[ks]:[tu,Ls,ks],[tu]:[tu,tl,Ls,ks],[tl]:[tl,ks,Ls],[Ls]:[Ls,mn,Ir],[mn]:[mn,Ir],[Ir]:[Ir]}),qq=new Set(["error","close","timeout","parseError","connect","message"]),X7=0,Bt=function(e,t){if(Fw.call(this),this.topology=e,this.s={state:ks,cancellationToken:new Fw},this.s.cancellationToken.setMaxListeners(1/0),this.options=Object.assign({host:"localhost",port:27017,size:5,minSize:0,connectionTimeout:3e4,socketTimeout:0,keepAlive:!0,keepAliveInitialDelay:12e4,noDelay:!0,ssl:!1,checkServerIdentity:!0,ca:null,crl:null,cert:null,key:null,passphrase:null,rejectUnauthorized:!1,promoteLongs:!0,promoteValues:!0,promoteBuffers:!1,bsonRegExp:!1,reconnect:!0,reconnectInterval:1e3,reconnectTries:30,domainsEnabled:!1,legacyCompatMode:!0},t),this.id=X7++,this.retriesLeft=this.options.reconnectTries,this.reconnectId=null,this.reconnectError=null,!t.bson||t.bson&&(typeof t.bson.serialize!="function"||typeof t.bson.deserialize!="function"))throw new Error("must pass in valid bson parser");this.logger=k7("Pool",t),this.availableConnections=[],this.inUseConnections=[],this.connectingConnections=0,this.executing=!1,this.queue=[],this.numberOfConsecutiveTimeouts=0,this.connectionIndex=0;let r=this;this._messageHandler=Z7(this),this._connectionCloseHandler=function(n){od(r,"close",n,this)},this._connectionErrorHandler=function(n){od(r,"error",n,this)},this._connectionTimeoutHandler=function(n){od(r,"timeout",n,this)},this._connectionParseErrorHandler=function(n){od(r,"parseError",n,this)}};j7(Bt,Fw);Object.defineProperty(Bt.prototype,"size",{enumerable:!0,get:function(){return this.options.size}});Object.defineProperty(Bt.prototype,"minSize",{enumerable:!0,get:function(){return this.options.minSize}});Object.defineProperty(Bt.prototype,"connectionTimeout",{enumerable:!0,get:function(){return this.options.connectionTimeout}});Object.defineProperty(Bt.prototype,"socketTimeout",{enumerable:!0,get:function(){return this.options.socketTimeout}});Object.defineProperty(Bt.prototype,"state",{enumerable:!0,get:function(){return this.s.state}});function Mq(e){e.inUseConnections=[],e.availableConnections=[],e.connectingConnections=0,e.executing=!1,e.numberOfConsecutiveTimeouts=0,e.connectionIndex=0,e.retriesLeft=e.options.reconnectTries,e.reconnectId=null}function od(e,t,r,n){if(n){if(n._connectionFailHandled)return;n._connectionFailHandled=!0,n.destroy(),Uw(e,n),n.flush(r)}if(t==="timeout"&&(e.numberOfConsecutiveTimeouts=e.numberOfConsecutiveTimeouts+1,e.numberOfConsecutiveTimeouts>e.options.reconnectTries))return e.numberOfConsecutiveTimeouts=0,e.destroy(!0),e.emit("close",e);e.socketCount()===0&&(e.state!==Ir&&e.state!==mn&&e.state!==Ls&&e.options.reconnect&&ru(e,ks),t=t==="error"?"close":t,e.emit(t,r)),!e.reconnectId&&e.options.reconnect&&(e.reconnectError=r,e.reconnectId=setTimeout(Nq(e),e.options.reconnectInterval)),Pq(e)<e.minSize&&Fs(e)}function Nq(e,t){return function(){if(e.emit("attemptReconnect",e),e.state===Ir||e.state===mn){typeof t=="function"&&t(new Nn("Cannot create connection when pool is destroyed"));return}if(e.retriesLeft=e.retriesLeft-1,e.retriesLeft<=0){e.destroy();let r=new B7(`failed to reconnect after ${e.options.reconnectTries} attempts with interval ${e.options.reconnectInterval} ms`,e.reconnectError);e.emit("reconnectFailed",r),typeof t=="function"&&t(r);return}e.reconnectId=null,Fs(e,(r,n)=>{r==null&&(e.reconnectId=null,e.retriesLeft=e.options.reconnectTries,e.emit("reconnect",e)),typeof t=="function"&&t(r,n)})}}function $q(e,t,r){var n=t.indexOf(e);n!==-1&&(t.splice(n,1),r.push(e))}function Z7(e){return function(t,r){for(var n=null,i=0;i<r.workItems.length;i++)r.workItems[i].requestId===t.responseTo&&(n=r.workItems[i],r.workItems.splice(i,1));n&&n.monitoring&&$q(r,e.inUseConnections,e.availableConnections),e.numberOfConsecutiveTimeouts=0,n&&n.socketTimeout&&r.resetSocketTimeout(),e.logger.isDebug()&&e.logger.debug(F7("message [ %s ] received from %s:%s",t.raw.length,e.options.host,e.options.port));function s(o,a,u,c){if(!o.options.domainsEnabled)return process.nextTick(function(){return a(u,c)});a(u,c)}if(e.executing||process.nextTick(function(){nu(e)()}),n&&!n.immediateRelease){try{t.parse(n)}catch(o){return s(e,n.cb,new Nn(o))}if(t.documents[0]){let o=t.documents[0],a=n.session;a&&Q7(a,o),e.topology&&o.$clusterTime&&(e.topology.clusterTime=o.$clusterTime)}if(n.command&&t.documents[0]){let o=t.documents[0];if(o.writeConcernError){let a=new L7(o.writeConcernError,o);return s(e,n.cb,a)}if(o.ok===0||o.$err||o.errmsg||o.code)return s(e,n.cb,new Nn(o))}t.hashedName=r.hashedName,s(e,n.cb,null,new V7(n.fullResult?t:t.documents[0],r,t))}}}Bt.prototype.socketCount=function(){return this.availableConnections.length+this.inUseConnections.length};function Pq(e){return e.availableConnections.length+e.inUseConnections.length+e.connectingConnections}Bt.prototype.allConnections=function(){return this.availableConnections.concat(this.inUseConnections)};Bt.prototype.get=function(){return this.allConnections()[0]};Bt.prototype.isConnected=function(){if(this.state===Ir||this.state===mn)return!1;for(var e=this.availableConnections.concat(this.inUseConnections),t=0;t<e.length;t++)if(e[t].isConnected())return!0;return!1};Bt.prototype.isDestroyed=function(){return this.state===Ir||this.state===mn};Bt.prototype.isDisconnected=function(){return this.state===ks};Bt.prototype.connect=function(e){if(this.state!==ks)throw new Nn("connection in unlawful state "+this.state);ru(this,tu),Fs(this,(t,r)=>{if(t){if(typeof e=="function"){this.destroy(),e(t);return}this.state===tu&&this.emit("error",t),this.destroy();return}if(ru(this,tl),this.minSize)for(let n=0;n<this.minSize;n++)Fs(this);typeof e=="function"?e(null,r):this.emit("connect",this,r)})};Bt.prototype.auth=function(e,t){typeof t=="function"&&t(null,null)};Bt.prototype.logout=function(e,t){typeof t=="function"&&t(null,null)};Bt.prototype.unref=function(){var e=this.availableConnections.concat(this.inUseConnections);e.forEach(function(t){t.unref()})};function Tq(e,t,r,n){ru(e,mn),e.s.cancellationToken.emit("cancel"),xq(t,(i,s)=>{for(let o of qq)i.removeAllListeners(o);i.on("error",()=>{}),i.destroy(r,s)},i=>{if(i){typeof n=="function"&&n(i,null);return}Mq(e),e.queue=[],ru(e,Ir),typeof n=="function"&&n(null,null)})}Bt.prototype.destroy=function(e,t){var r=this;if(typeof e=="function"&&(t=e,e=!1),this.state===Ir||r.state===mn){typeof t=="function"&&t(null,null);return}if(ru(this,Ls),e){for(var n=r.availableConnections.concat(r.inUseConnections);r.queue.length>0;){var i=r.queue.shift();typeof i.cb=="function"&&i.cb(new Nn("Pool was force destroyed"))}return Tq(r,n,{force:!0},t)}this.reconnectId&&clearTimeout(this.reconnectId);function s(){if(r.state===Ir||r.state===mn){typeof t=="function"&&t();return}if(ad(r.queue),r.queue.length===0){for(var o=r.availableConnections.concat(r.inUseConnections),a=0;a<o.length;a++)if(o[a].workItems.length>0)return setTimeout(s,1);Tq(r,o,{force:!1},t)}else nu(r)(),setTimeout(s,1)}s()};Bt.prototype.reset=function(e){if(this.s.state!==tl){typeof e=="function"&&e(new Nn("pool is not connected, reset aborted"));return}this.s.cancellationToken.emit("cancel");let t=this.availableConnections.concat(this.inUseConnections);xq(t,(r,n)=>{for(let i of qq)r.removeAllListeners(i);r.destroy({force:!0},n)},r=>{if(r&&typeof e=="function"){e(r,null);return}Mq(this),Fs(this,()=>{typeof e=="function"&&e(null,null)})})};function e9(e,t,r){let n=t.toBin();if(!!!e.options.agreedCompressor||!t9(t))return r(null,n);let s=kw.concat(n),o=s.slice(Lw),a=s.readInt32LE(12);z7(e,o,function(u,c){if(u)return r(u,null);let f=kw.alloc(Lw);f.writeInt32LE(Lw+Cq+c.length,0),f.writeInt32LE(t.requestId,4),f.writeInt32LE(0,8),f.writeInt32LE(W7.OP_COMPRESSED,12);let h=kw.alloc(Cq);return h.writeInt32LE(a,0),h.writeInt32LE(o.length,4),h.writeUInt8(H7[e.options.agreedCompressor],8),r(null,[f,h,c])})}Bt.prototype.write=function(e,t,r){var n=this;if(typeof t=="function"&&(r=t),t=t||{},typeof r!="function"&&!t.noResponse)throw new Nn("write method must provide a callback");if(this.state===Ir||this.state===mn){r(new Nn("pool destroyed"));return}if(this.state===Ls){r(new Nn("pool is draining, new operations prohibited"));return}if(this.options.domainsEnabled&&process.domain&&typeof r=="function"){var i=r;r=process.domain.bind(function(){for(var o=new Array(arguments.length),a=0;a<arguments.length;a++)o[a]=arguments[a];process.nextTick(function(){i.apply(null,o)})})}var s={cb:r,raw:!1,promoteLongs:!0,promoteValues:!0,promoteBuffers:!1,bsonRegExp:!1,fullResult:!1};s.promoteLongs=typeof t.promoteLongs=="boolean"?t.promoteLongs:!0,s.promoteValues=typeof t.promoteValues=="boolean"?t.promoteValues:!0,s.promoteBuffers=typeof t.promoteBuffers=="boolean"?t.promoteBuffers:!1,s.bsonRegExp=typeof t.bsonRegExp=="boolean"?t.bsonRegExp:!1,s.raw=typeof t.raw=="boolean"?t.raw:!1,s.immediateRelease=typeof t.immediateRelease=="boolean"?t.immediateRelease:!1,s.documentsReturnedIn=t.documentsReturnedIn,s.command=typeof t.command=="boolean"?t.command:!1,s.fullResult=typeof t.fullResult=="boolean"?t.fullResult:!1,s.noResponse=typeof t.noResponse=="boolean"?t.noResponse:!1,s.session=t.session||null,s.socketTimeout=t.socketTimeout,s.monitoring=t.monitoring,s.requestId=e.requestId,n.options.monitorCommands&&(this.emit("commandStarted",new sd.CommandStartedEvent(this,e)),s.started=J7(),s.cb=(o,a)=>{o?n.emit("commandFailed",new sd.CommandFailedEvent(this,e,o,s.started)):a&&a.result&&(a.result.ok===0||a.result.$err)?n.emit("commandFailed",new sd.CommandFailedEvent(this,e,a.result,s.started)):n.emit("commandSucceeded",new sd.CommandSucceededEvent(this,e,a,s.started)),typeof r=="function"&&r(o,a)}),e9(n,e,(o,a)=>{if(o)throw o;s.buffer=a,t.monitoring?n.queue.unshift(s):n.queue.push(s),n.executing||process.nextTick(function(){nu(n)()})})};function t9(e){let t=e instanceof U7?e.command:e.query,r=Object.keys(t)[0];return!K7.has(r)}function Aq(e,t){for(var r=0;r<t.length;r++)if(t[r]===e)return t.splice(r,1),!0}function Uw(e,t){Aq(t,e.availableConnections)||Aq(t,e.inUseConnections)}function Fs(e,t){if(e.state===Ir||e.state===mn){typeof t=="function"&&t(new Nn("Cannot create connection when pool is destroyed"));return}e.connectingConnections++,G7(e.options,e.s.cancellationToken,(r,n)=>{if(e.connectingConnections--,r){if(e.logger.isDebug()&&e.logger.debug(`connection attempt failed with error [${JSON.stringify(r)}]`),!e.reconnectId&&e.options.reconnect){if(e.state===tu&&e.options.legacyCompatMode){t(r);return}e.reconnectError=r,e.reconnectId=setTimeout(Nq(e,t),e.options.reconnectInterval);return}typeof t=="function"&&t(r);return}if(e.state===Ir||e.state===mn){typeof t=="function"&&t(new Nn("Pool was destroyed after connection creation")),n.destroy();return}n.on("error",e._connectionErrorHandler),n.on("close",e._connectionCloseHandler),n.on("timeout",e._connectionTimeoutHandler),n.on("parseError",e._connectionParseErrorHandler),n.on("message",e._messageHandler),e.availableConnections.push(n),typeof t=="function"&&t(null,n),nu(e)()})}function ad(e){for(var t=0;t<e.length;t++)if(e[t].monitoring){var r=e[t];e.splice(t,1),r.cb(new Nn({message:"no connection available for monitoring",driver:!0}))}}function nu(e){return function(){if(e.state!==Ir&&!e.executing){if(e.executing=!0,e.connectingConnections>0){e.executing=!1;return}for(;;){let o=Pq(e);if(e.availableConnections.length===0){ad(e.queue),o<e.options.size&&e.queue.length>0&&Fs(e);break}if(e.queue.length===0)break;var t=null;let a=e.availableConnections.filter(u=>u.workItems.length===0);if(a.length===0?t=e.availableConnections[e.connectionIndex++%e.availableConnections.length]:t=a[e.connectionIndex++%a.length],!t.isConnected()){Uw(e,t),ad(e.queue);break}var r=e.queue.shift();if(r.monitoring){var n=!1;for(let u=0;u<e.availableConnections.length;u++)if(e.availableConnections[u].isConnected()&&e.availableConnections[u].workItems.length===0){n=!0,t=e.availableConnections[u];break}if(!n){e.queue.unshift(r),o<e.options.size&&e.queue.length>0&&Fs(e),setTimeout(()=>nu(e)(),10);break}}if(o<e.options.size&&t.workItems.length>0){e.queue.unshift(r),Fs(e);break}var i=r.buffer;r.monitoring&&$q(t,e.availableConnections,e.inUseConnections),r.noResponse||t.workItems.push(r),!r.immediateRelease&&typeof r.socketTimeout=="number"&&t.setSocketTimeout(r.socketTimeout);var s=!0;if(Array.isArray(i))for(let u=0;u<i.length;u++)s=t.write(i[u]);else s=t.write(i);if(r.noResponse&&typeof r.cb=="function"&&r.cb(null,null),s===!1){e.queue.unshift(r),Uw(e,t),ad(e.queue);break}}e.executing=!1}}}Bt._execute=nu;Iq.exports=Bt});var iu=_((vTe,Bq)=>{"use strict";var r9=dn().Query,n9=$o().Msg,Vw=se().MongoError,i9=nt().getReadPreference,s9=nt().isSharded,o9=nt().databaseNamespace,a9=eu().isTransactionCommand,u9=Bs().applySession,c9=se().MongoNetworkError,Dq=he().maxWireVersion;function l9(e){return Dq(e)&&e.autoEncrypter}function f9(e,t,r,n,i){if(typeof n=="function"&&(i=n,n={}),n=n||{},r==null)return i(new Vw(`command ${JSON.stringify(r)} does not return a cursor`));if(!l9(e)){jq(e,t,r,n,i);return}let s=Dq(e);if(typeof s!="number"||s<8){i(new Vw("Auto-encryption requires a minimum MongoDB version of 4.2"));return}p9(e,t,r,n,i)}function jq(e,t,r,n,i){let s=e.s.bson,o=e.s.pool,a=i9(r,n),u=d9(e),c=n.session,f=e.clusterTime,h=f,d=Object.assign({},r),p=n.serverApi;if(p&&(d.apiVersion=p.version||p,p.strict!=null&&(d.apiStrict=p.strict),p.deprecationErrors!=null&&(d.apiDeprecationErrors=p.deprecationErrors)),h9(e)&&c){let v=c.clusterTime;f&&f.clusterTime&&v&&v.clusterTime&&v.clusterTime.greaterThan(f.clusterTime)&&(h=v),!c.transaction.isActive&&c.transaction.isPinned&&!d.startTransaction&&!d.commitTransaction&&c.transaction.unpinServer();let E=u9(c,d,n);if(E)return i(E)}h&&(d.$clusterTime=h),s9(e)&&!u&&a&&a.mode!=="primary"&&(d={$query:d,$readPreference:a.toJSON()});let m=Object.assign({command:!0,numberToSkip:0,numberToReturn:-1,checkKeys:!1},n);m.slaveOk=a.slaveOk();let y=`${o9(t)}.$cmd`,g=u?new n9(s,y,d,m):new r9(s,y,d,m),S=c&&(c.inTransaction()||a9(d))?function(v){return v&&v instanceof c9&&!v.hasErrorLabel("TransientTransactionError")&&v.addErrorLabel("TransientTransactionError"),!r.commitTransaction&&v&&v instanceof Vw&&v.hasErrorLabel("TransientTransactionError")&&c.transaction.unpinServer(),i.apply(null,arguments)}:i;try{o.write(g,m,S)}catch(v){S(v)}}function h9(e){return e==null?!1:e.description?e.description.maxWireVersion>=6:e.ismaster==null?!1:e.ismaster.maxWireVersion>=6}function d9(e){let t=e.ismaster?e.ismaster:e.description;return t==null?!1:t.maxWireVersion>=6&&t.__nodejs_mock_server__==null}function p9(e,t,r,n,i){let s=e.autoEncrypter;function o(a,u){if(a||u==null){i(a,u);return}s.decrypt(u.result,n,(c,f)=>{if(c){i(c,null);return}u.result=f,u.message.documents=[f],i(null,u)})}s.encrypt(t,r,n,(a,u)=>{if(a){i(a,null);return}jq(e,t,u,n,o)})}Bq.exports=f9});var nl=_((STe,Lq)=>{"use strict";var m9=se().MongoError,rl=class{constructor(t){typeof t=="boolean"?this.verbosity=t?"allPlansExecution":"queryPlanner":this.verbosity=t}static fromOptions(t){if(t==null||t.explain===void 0)return;let r=t.explain;if(typeof r=="boolean"||typeof r=="string")return new rl(t.explain);throw new m9("explain must be a string or a boolean")}};Lq.exports={Explain:rl}});var Fq=_((OTe,kq)=>{"use strict";var y9=se().MongoError,g9=nt().collectionNamespace,_9=iu(),w9=N().decorateWithExplain,v9=nl().Explain;function S9(e,t,r,n,i,s,o){if(i.length===0)throw new y9(`${t} must contain at least one document`);typeof s=="function"&&(o=s,s={}),s=s||{};let a=typeof s.ordered=="boolean"?s.ordered:!0,u=s.writeConcern,c={};if(c[t]=g9(n),c[r]=i,c.ordered=a,u&&Object.keys(u).length>0&&(c.writeConcern=u),s.collation)for(let d=0;d<c[r].length;d++)c[r][d].collation||(c[r][d].collation=s.collation);s.bypassDocumentValidation===!0&&(c.bypassDocumentValidation=s.bypassDocumentValidation);let f=v9.fromOptions(s);f&&(c=w9(c,f));let h=Object.assign({checkKeys:t==="insert",numberToReturn:1},s);_9(e,n,c,h,o)}kq.exports=S9});var Vq=_((bTe,Uq)=>{"use strict";var O9=dn().KillCursor,b9=se().MongoError,E9=se().MongoNetworkError,C9=nt().collectionNamespace,T9=he().maxWireVersion,A9=he().emitWarning,x9=iu();function q9(e,t,r,n,i){typeof n=="function"&&(i=n,n={}),i=typeof i=="function"?i:()=>{};let s=r.cursorId;if(T9(e)<4){let u=e.s.bson,c=e.s.pool,f=new O9(u,t,[s]),h={immediateRelease:!0,noResponse:!0};if(typeof r.session=="object"&&(h.session=r.session),c&&c.isConnected())try{c.write(f,h,i)}catch(d){typeof i=="function"?i(d,null):A9(d)}return}let o={killCursors:C9(t),cursors:[s]},a=n||{};typeof r.session=="object"&&(a.session=r.session),x9(e,t,o,a,(u,c)=>{if(u)return i(u);let f=c.message;if(f.cursorNotFound)return i(new E9("cursor killed or timed out"),null);if(!Array.isArray(f.documents)||f.documents.length===0)return i(new b9(`invalid killCursors result returned for cursor id ${s}`));i(null,f.documents[0])})}Uq.exports=q9});var zq=_((ETe,Wq)=>{"use strict";var M9=dn().GetMore,N9=Yt().retrieveBSON,$9=se().MongoError,P9=se().MongoNetworkError,I9=N9(),ud=I9.Long,R9=nt().collectionNamespace,D9=he().maxWireVersion,j9=nt().applyCommonQueryOptions,B9=iu();function L9(e,t,r,n,i,s){i=i||{};let o=D9(e);function a(h,d){if(h)return s(h);let p=d.message;if(p.cursorNotFound)return s(new P9("cursor killed or timed out"),null);if(o<4){let y=typeof p.cursorId=="number"?ud.fromNumber(p.cursorId):p.cursorId;r.documents=p.documents,r.cursorId=y,s(null,null,p.connection);return}if(p.documents[0].ok===0)return s(new $9(p.documents[0]));let m=typeof p.documents[0].cursor.id=="number"?ud.fromNumber(p.documents[0].cursor.id):p.documents[0].cursor.id;r.documents=p.documents[0].cursor.nextBatch,r.cursorId=m,s(null,p.documents[0],p.connection)}if(o<4){let h=e.s.bson,d=new M9(h,t,r.cursorId,{numberToReturn:n}),p=j9({},r);e.s.pool.write(d,p,a);return}let c={getMore:r.cursorId instanceof ud?r.cursorId:ud.fromNumber(r.cursorId),collection:R9(t),batchSize:Math.abs(n)};r.cmd.tailable&&typeof r.cmd.maxAwaitTimeMS=="number"&&(c.maxTimeMS=r.cmd.maxAwaitTimeMS);let f=Object.assign({returnFieldSelector:null,documentsReturnedIn:"nextBatch"},i);r.session&&(f.session=r.session),B9(e,t,c,f,a)}Wq.exports=L9});var Qq=_((CTe,Gq)=>{"use strict";var k9=dn().Query,Hq=se().MongoError,Kq=nt().getReadPreference,F9=nt().collectionNamespace,U9=nt().isSharded,V9=he().maxWireVersion,W9=nt().applyCommonQueryOptions,z9=iu(),H9=N().decorateWithExplain,K9=nl().Explain;function G9(e,t,r,n,i,s){if(i=i||{},n.cursorId!=null)return s();if(r==null)return s(new Hq(`command ${JSON.stringify(r)} does not return a cursor`));if(V9(e)<4){let c=Y9(e,t,r,n,i),f=W9({},n);typeof c.documentsReturnedIn=="string"&&(f.documentsReturnedIn=c.documentsReturnedIn),e.s.pool.write(c,f,s);return}let o=Kq(r,i),a=Q9(e,t,r,n,i);try{let c=K9.fromOptions(i);c&&(a=H9(a,c))}catch(c){return s(c)}r.virtual=!1;let u=Object.assign({documentsReturnedIn:"firstBatch",numberToReturn:1,slaveOk:o.slaveOk()},i);r.readPreference&&(u.readPreference=o),n.session&&(u.session=n.session),z9(e,t,a,u,s)}function Q9(e,t,r,n){n.batchSize=r.batchSize||n.batchSize;let i={find:F9(t)};r.query&&(r.query.$query?i.filter=r.query.$query:i.filter=r.query);let s=r.sort;if(Array.isArray(s)){let o={};if(s.length>0&&!Array.isArray(s[0])){let a=s[1];a==="asc"?a=1:a==="desc"&&(a=-1),o[s[0]]=a}else for(let a=0;a<s.length;a++){let u=s[a][1];u==="asc"?u=1:u==="desc"&&(u=-1),o[s[a][0]]=u}s=o}return typeof r.allowDiskUse=="boolean"&&(i.allowDiskUse=r.allowDiskUse),r.sort&&(i.sort=s),r.fields&&(i.projection=r.fields),r.hint&&(i.hint=r.hint),r.skip&&(i.skip=r.skip),r.limit&&(i.limit=r.limit),r.limit<0&&(i.limit=Math.abs(r.limit),i.singleBatch=!0),typeof r.batchSize=="number"&&(r.batchSize<0&&(r.limit!==0&&Math.abs(r.batchSize)<Math.abs(r.limit)&&(i.limit=Math.abs(r.batchSize)),i.singleBatch=!0),i.batchSize=Math.abs(r.batchSize)),r.comment&&(i.comment=r.comment),r.maxScan&&(i.maxScan=r.maxScan),r.maxTimeMS&&(i.maxTimeMS=r.maxTimeMS),r.min&&(i.min=r.min),r.max&&(i.max=r.max),typeof r.returnKey=="boolean"&&(i.returnKey=r.returnKey),typeof r.showDiskLoc=="boolean"&&(i.showRecordId=r.showDiskLoc),r.snapshot&&(i.snapshot=r.snapshot),r.tailable&&(i.tailable=r.tailable),r.oplogReplay&&(i.oplogReplay=r.oplogReplay),r.noCursorTimeout&&(i.noCursorTimeout=r.noCursorTimeout),r.awaitData&&(i.awaitData=r.awaitData),r.awaitdata&&(i.awaitData=r.awaitdata),r.partial&&(i.partial=r.partial),r.collation&&(i.collation=r.collation),r.readConcern&&(i.readConcern=r.readConcern),i}function Y9(e,t,r,n,i){i=i||{};let s=e.s.bson,o=Kq(r,i);n.batchSize=r.batchSize||n.batchSize;let a=0;n.limit<0||n.limit!==0&&n.limit<n.batchSize||n.limit>0&&n.batchSize===0?a=n.limit:a=n.batchSize;let u=n.skip||0,c={};if(U9(e)&&o&&(c.$readPreference=o.toJSON()),r.sort&&(c.$orderby=r.sort),r.hint&&(c.$hint=r.hint),r.snapshot&&(c.$snapshot=r.snapshot),typeof r.returnKey<"u"&&(c.$returnKey=r.returnKey),r.maxScan&&(c.$maxScan=r.maxScan),r.min&&(c.$min=r.min),r.max&&(c.$max=r.max),typeof r.showDiskLoc<"u"&&(c.$showDiskLoc=r.showDiskLoc),r.comment&&(c.$comment=r.comment),r.maxTimeMS&&(c.$maxTimeMS=r.maxTimeMS),i.explain!==void 0&&(a=-Math.abs(r.limit||0),c.$explain=!0),c.$query=r.query,r.readConcern&&r.readConcern.level!=="local")throw new Hq(`server find command does not support a readConcern level of ${r.readConcern.level}`);r.readConcern&&(r=Object.assign({},r),delete r.readConcern);let f=typeof i.serializeFunctions=="boolean"?i.serializeFunctions:!1,h=typeof i.ignoreUndefined=="boolean"?i.ignoreUndefined:!1,d=new k9(s,t,c,{numberToSkip:u,numberToReturn:a,pre32Limit:typeof r.limit<"u"?r.limit:void 0,checkKeys:!1,returnFieldSelector:r.fields,serializeFunctions:f,ignoreUndefined:h});return typeof r.tailable=="boolean"&&(d.tailable=r.tailable),typeof r.oplogReplay=="boolean"&&(d.oplogReplay=r.oplogReplay),typeof r.noCursorTimeout=="boolean"&&(d.noCursorTimeout=r.noCursorTimeout),typeof r.awaitData=="boolean"&&(d.awaitData=r.awaitData),typeof r.partial=="boolean"&&(d.partial=r.partial),d.slaveOk=o.slaveOk(),d}Gq.exports=G9});var zw=_((TTe,Yq)=>{"use strict";var Ww=Fq();Yq.exports={insert:function(t,r,n,i,s){Ww(t,"insert","documents",r,n,i,s)},update:function(t,r,n,i,s){Ww(t,"update","updates",r,n,i,s)},remove:function(t,r,n,i,s){Ww(t,"delete","deletes",r,n,i,s)},killCursors:Vq(),getMore:zq(),query:Qq(),command:iu()}});var ne=_((ATe,Xq)=>{"use strict";var J9=nl().Explain,X9=se().MongoError,Jq={READ_OPERATION:Symbol("READ_OPERATION"),WRITE_OPERATION:Symbol("WRITE_OPERATION"),RETRYABLE:Symbol("RETRYABLE"),EXECUTE_WITH_SELECTION:Symbol("EXECUTE_WITH_SELECTION"),NO_INHERIT_OPTIONS:Symbol("NO_INHERIT_OPTIONS"),EXPLAINABLE:Symbol("EXPLAINABLE")},Hw=class{constructor(t){if(this.options=Object.assign({},t),this.hasAspect(Jq.EXPLAINABLE))this.explain=J9.fromOptions(t);else if(this.options.explain!==void 0)throw new X9("explain is not supported on this command")}hasAspect(t){return this.constructor.aspects==null?!1:this.constructor.aspects.has(t)}set session(t){Object.assign(this.options,{session:t})}get session(){return this.options.session}clearSession(){delete this.options.session}get canRetryRead(){return!0}execute(){throw new TypeError("`execute` must be implemented for OperationBase subclasses")}};function Z9(e,t){return!Array.isArray(t)&&!(t instanceof Set)&&(t=[t]),t=new Set(t),Object.defineProperty(e,"aspects",{value:t,writable:!1}),t}Xq.exports={Aspect:Jq,defineAspects:Z9,OperationBase:Hw}});var su=_((xTe,rM)=>{"use strict";var eJ=N().maybePromise,Kw=se().MongoError,eM=ne().Aspect,tJ=ne().OperationBase,Gw=ir(),rJ=se().isRetryableError,nJ=he().maxWireVersion,iJ=he().isUnifiedTopology;function tM(e,t,r){if(e==null)throw new TypeError("This method requires a valid topology instance");if(!(t instanceof tJ))throw new TypeError("This method requires a valid operation instance");return eJ(e,r,n=>{if(iJ(e)&&e.shouldCheckForSessionSupport())return oJ(e,t,n);let i,s;if(e.hasSessionSupport()){if(t.session==null)s=Symbol(),i=e.startSession({owner:s}),t.session=i;else if(t.session.hasEnded)return n(new Kw("Use of expired sessions is not permitted"))}else if(t.session)return n(new Kw("Current topology does not support sessions"));function o(a,u){i&&i.owner===s&&(i.endSession(),t.session===i&&t.clearSession()),n(a,u)}try{t.hasAspect(eM.EXECUTE_WITH_SELECTION)?sJ(e,t,o):t.execute(o)}catch(a){i&&i.owner===s&&(i.endSession(),t.session===i&&t.clearSession()),n(a)}})}function Zq(e){return nJ(e)>=6}function sJ(e,t,r){let n=t.readPreference||Gw.primary,i=t.session&&t.session.inTransaction();if(i&&!n.equals(Gw.primary)){r(new Kw(`Read preference in a transaction must be primary, not: ${n.mode}`));return}let s={readPreference:n,session:t.session};function o(a,u){if(a==null)return r(null,u);if(!rJ(a))return r(a);e.selectServer(s,(c,f)=>{if(c||!Zq(f)){r(c,null);return}t.execute(f,r)})}e.selectServer(s,(a,u)=>{if(a){r(a,null);return}let c=e.s.options.retryReads!==!1&&t.session&&!i&&Zq(u)&&t.canRetryRead;if(t.hasAspect(eM.RETRYABLE)&&c){t.execute(u,o);return}t.execute(u,r)})}function oJ(e,t,r){e.selectServer(Gw.primaryPreferred,n=>{if(n)return r(n);tM(e,t,r)})}rM.exports=tM});var $n=_((qTe,oM)=>{"use strict";var aJ=Mn(),uJ=Yt().retrieveBSON,Qi=se().MongoError,nM=se().MongoNetworkError,cJ=he().collationNotSupported,lJ=ir(),fJ=he().isUnifiedTopology,hJ=su(),dJ=require("stream").Readable,pJ=N().SUPPORTS,mJ=N().MongoDBNamespace,yJ=N().mergeOptions,gJ=ne().OperationBase,_J=uJ(),hi=_J.Long,iM={INIT:0,OPEN:1,CLOSED:2,GET_MORE:3};function ko(e,t,r){try{e(t,r)}catch(n){process.nextTick(function(){throw n})}}var ld=class extends dJ{constructor(t,r,n,i){super({objectMode:!0}),i=i||{},r instanceof gJ&&(this.operation=r,r=this.operation.ns.toString(),i=this.operation.options,n=this.operation.cmd?this.operation.cmd:{}),this.pool=null,this.server=null,this.disconnectHandler=i.disconnectHandler,this.bson=t.s.bson,this.ns=r,this.namespace=mJ.fromString(r),this.cmd=n,this.options=i,this.topology=t,this.cursorState={cursorId:null,cmd:n,documents:i.documents||[],cursorIndex:0,dead:!1,killed:!1,init:!1,notified:!1,limit:i.limit||n.limit||0,skip:i.skip||n.skip||0,batchSize:i.batchSize||n.batchSize||1e3,currentLimit:0,transforms:i.transforms,raw:i.raw||n&&n.raw},typeof i.session=="object"&&(this.cursorState.session=i.session);let s=t.s.options;typeof s.promoteLongs=="boolean"?this.cursorState.promoteLongs=s.promoteLongs:typeof i.promoteLongs=="boolean"&&(this.cursorState.promoteLongs=i.promoteLongs),typeof s.promoteValues=="boolean"?this.cursorState.promoteValues=s.promoteValues:typeof i.promoteValues=="boolean"&&(this.cursorState.promoteValues=i.promoteValues),typeof s.promoteBuffers=="boolean"?this.cursorState.promoteBuffers=s.promoteBuffers:typeof i.promoteBuffers=="boolean"&&(this.cursorState.promoteBuffers=i.promoteBuffers),typeof s.bsonRegExp=="boolean"?this.cursorState.bsonRegExp=s.bsonRegExp:typeof i.bsonRegExp=="boolean"&&(this.cursorState.bsonRegExp=i.bsonRegExp),s.reconnect&&(this.cursorState.reconnect=s.reconnect),this.logger=aJ("Cursor",s),typeof n=="number"?(this.cursorState.cursorId=hi.fromNumber(n),this.cursorState.lastCursorId=this.cursorState.cursorId):n instanceof hi&&(this.cursorState.cursorId=n,this.cursorState.lastCursorId=n),this.operation&&(this.operation.cursorState=this.cursorState)}setCursorBatchSize(t){this.cursorState.batchSize=t}cursorBatchSize(){return this.cursorState.batchSize}setCursorLimit(t){this.cursorState.limit=t}cursorLimit(){return this.cursorState.limit}setCursorSkip(t){this.cursorState.skip=t}cursorSkip(){return this.cursorState.skip}_next(t){cd(this,t)}clone(){let t=yJ({},this.options);return delete t.session,this.topology.cursor(this.ns,this.cmd,t)}isDead(){return this.cursorState.dead===!0}isKilled(){return this.cursorState.killed===!0}isNotified(){return this.cursorState.notified===!0}bufferedCount(){return this.cursorState.documents.length-this.cursorState.cursorIndex}readBufferedDocuments(t){let r=this.cursorState.documents.length-this.cursorState.cursorIndex,n=t<r?t:r,i=this.cursorState.documents.slice(this.cursorState.cursorIndex,this.cursorState.cursorIndex+n);if(this.cursorState.transforms&&typeof this.cursorState.transforms.doc=="function")for(let s=0;s<i.length;s++)i[s]=this.cursorState.transforms.doc(i[s]);return this.cursorState.limit>0&&this.cursorState.currentLimit+i.length>this.cursorState.limit&&(i=i.slice(0,this.cursorState.limit-this.cursorState.currentLimit),this.kill()),this.cursorState.currentLimit=this.cursorState.currentLimit+i.length,this.cursorState.cursorIndex=this.cursorState.cursorIndex+i.length,i}kill(t){if(this.cursorState.dead=!0,this.cursorState.killed=!0,this.cursorState.documents=[],this.cursorState.cursorId==null||this.cursorState.cursorId.isZero()||this.cursorState.init===!1){t&&t(null,null);return}this.server.killCursors(this.ns,this.cursorState,t)}rewind(){this.cursorState.init&&(this.cursorState.dead||this.kill(),this.cursorState.currentLimit=0,this.cursorState.init=!1,this.cursorState.dead=!1,this.cursorState.killed=!1,this.cursorState.notified=!1,this.cursorState.documents=[],this.cursorState.cursorId=null,this.cursorState.cursorIndex=0)}_read(){if(this.s&&this.s.state===iM.CLOSED||this.isDead())return this.push(null);this._next((t,r)=>{if(t)return this.listeners("error")&&this.listeners("error").length>0&&this.emit("error",t),this.isDead()||this.close(),this.emit("end"),this.emit("finish");if(this.cursorState.streamOptions&&typeof this.cursorState.streamOptions.transform=="function"&&r!=null)return this.push(this.cursorState.streamOptions.transform(r));this.push(r),r===null&&this.isDead()&&this.once("end",()=>{this.close(),this.emit("finish")})})}_endSession(t,r){typeof t=="function"&&(r=t,t={}),t=t||{};let n=this.cursorState.session;return n&&(t.force||n.owner===this)?(this.cursorState.session=void 0,this.operation&&this.operation.clearSession(),n.endSession(r),!0):(r&&r(),!1)}_getMore(t){this.logger.isDebug()&&this.logger.debug(`schedule getMore call for query [${JSON.stringify(this.query)}]`);let r=this.cursorState.batchSize;this.cursorState.limit>0&&this.cursorState.currentLimit+r>this.cursorState.limit&&(r=this.cursorState.limit-this.cursorState.currentLimit);let n=this.cursorState;this.server.getMore(this.ns,n,r,this.options,(i,s,o)=>{(i||n.cursorId&&n.cursorId.isZero())&&this._endSession(),t(i,s,o)})}_initializeCursor(t){let r=this;if(fJ(r.topology)&&r.topology.shouldCheckForSessionSupport()){r.topology.selectServer(lJ.primaryPreferred,o=>{if(o){t(o);return}this._initializeCursor(t)});return}function n(o,a){let u=r.cursorState;if((o||u.cursorId&&u.cursorId.isZero())&&r._endSession(),u.documents.length===0&&u.cursorId&&u.cursorId.isZero()&&!r.cmd.tailable&&!r.cmd.awaitData)return fd(r,t);t(o,a)}let i=(o,a)=>{if(o)return n(o);let u=a.message;if(Array.isArray(u.documents)&&u.documents.length===1){let f=u.documents[0];if(u.queryFailure)return n(new Qi(f),null);if(!r.cmd.find||r.cmd.find&&r.cmd.virtual===!1){if(f.$err||f.errmsg)return n(new Qi(f),null);if(f.cursor!=null&&typeof f.cursor!="string"){let h=f.cursor.id;return f.cursor.ns&&(r.ns=f.cursor.ns),r.cursorState.cursorId=typeof h=="number"?hi.fromNumber(h):h,r.cursorState.lastCursorId=r.cursorState.cursorId,r.cursorState.operationTime=f.operationTime,Array.isArray(f.cursor.firstBatch)&&(r.cursorState.documents=f.cursor.firstBatch),n(null,u)}}}let c=u.cursorId||0;r.cursorState.cursorId=c instanceof hi?c:hi.fromNumber(c),r.cursorState.documents=u.documents,r.cursorState.lastCursorId=u.cursorId,r.cursorState.transforms&&typeof r.cursorState.transforms.query=="function"&&(r.cursorState.documents=r.cursorState.transforms.query(u)),n(null,u)};if(r.operation){r.logger.isDebug()&&r.logger.debug(`issue initial query [${JSON.stringify(r.cmd)}] with flags [${JSON.stringify(r.query)}]`),hJ(r.topology,r.operation,(o,a)=>{if(o){n(o);return}if(r.server=r.operation.server,r.cursorState.init=!0,r.cursorState.cursorId!=null)return n();i(o,a)});return}let s={};return r.cursorState.session&&(s.session=r.cursorState.session),r.operation?s.readPreference=r.operation.readPreference:r.options.readPreference&&(s.readPreference=r.options.readPreference),r.topology.selectServer(s,(o,a)=>{if(o){let c=r.disconnectHandler;return c!=null?c.addObjectAndMethod("cursor",r,"next",[t],t):t(o)}if(r.server=a,r.cursorState.init=!0,cJ(r.server,r.cmd))return t(new Qi(`server ${r.server.name} does not support collation`));if(r.cursorState.cursorId!=null)return n();if(r.logger.isDebug()&&r.logger.debug(`issue initial query [${JSON.stringify(r.cmd)}] with flags [${JSON.stringify(r.query)}]`),r.cmd.find!=null){a.query(r.ns,r.cmd,r.cursorState,r.options,i);return}let u=Object.assign({session:r.cursorState.session},r.options);a.command(r.ns,r.cmd,u,i)})}};pJ.ASYNC_ITERATOR&&(ld.prototype[Symbol.asyncIterator]=F_().asyncIterator);function wJ(e,t){if(e.pool&&e.pool.isDestroyed()){e.cursorState.killed=!0;let r=new nM(`connection to host ${e.pool.host}:${e.pool.port} was destroyed`);return sM(e,()=>t(r)),!0}return!1}function vJ(e,t){return e.cursorState.dead&&!e.cursorState.killed?(e.cursorState.killed=!0,fd(e,t),!0):!1}function SJ(e,t){return e.cursorState.dead&&e.cursorState.killed?(ko(t,new Qi("cursor is dead")),!0):!1}function OJ(e,t){return e.cursorState.killed?(fd(e,t),!0):!1}function il(e,t){e.cursorState.dead=!0,fd(e,t)}function fd(e,t){sM(e,()=>ko(t,null,null))}function sM(e,t){if(e.cursorState.notified=!0,e.cursorState.documents=[],e.cursorState.cursorIndex=0,e.cursorState.session){e._endSession(t);return}return t()}function cd(e,t){if(e.cursorState.notified)return t(new Error("cursor is exhausted"));if(!OJ(e,t)&&!vJ(e,t)&&!SJ(e,t)){if(!e.cursorState.init){if(!e.topology.isConnected(e.options)){if(e.topology._type==="server"&&!e.topology.s.options.reconnect)return t(new Qi("no connection available"));if(e.disconnectHandler!=null){if(e.topology.isDestroyed())return t(new Qi("Topology was destroyed"));e.disconnectHandler.addObjectAndMethod("cursor",e,"next",[t],t);return}}e._initializeCursor((r,n)=>{if(r||n===null){t(r,n);return}cd(e,t)});return}if(e.cursorState.limit>0&&e.cursorState.currentLimit>=e.cursorState.limit)e.kill(()=>il(e,t));else if(e.cursorState.cursorIndex===e.cursorState.documents.length&&!hi.ZERO.equals(e.cursorState.cursorId)){if(e.cursorState.documents=[],e.cursorState.cursorIndex=0,e.topology.isDestroyed())return t(new nM("connection destroyed, not possible to instantiate cursor"));if(wJ(e,t))return;e._getMore(function(r,n,i){if(r)return ko(t,r);if(e.connection=i,e.cursorState.documents.length===0&&e.cmd.tailable&&hi.ZERO.equals(e.cursorState.cursorId))return ko(t,new Qi({message:"No more documents in tailed cursor",tailable:e.cmd.tailable,awaitData:e.cmd.awaitData}));if(e.cursorState.documents.length===0&&e.cmd.tailable&&!hi.ZERO.equals(e.cursorState.cursorId))return cd(e,t);if(e.cursorState.limit>0&&e.cursorState.currentLimit>=e.cursorState.limit)return il(e,t);cd(e,t)})}else{if(e.cursorState.documents.length===e.cursorState.cursorIndex&&e.cmd.tailable&&hi.ZERO.equals(e.cursorState.cursorId))return ko(t,new Qi({message:"No more documents in tailed cursor",tailable:e.cmd.tailable,awaitData:e.cmd.awaitData}));if(e.cursorState.documents.length===e.cursorState.cursorIndex&&hi.ZERO.equals(e.cursorState.cursorId))il(e,t);else{if(e.cursorState.limit>0&&e.cursorState.currentLimit>=e.cursorState.limit){e.kill(()=>il(e,t));return}e.cursorState.currentLimit+=1;let r=e.cursorState.documents[e.cursorState.cursorIndex++];if(!r||r.$err){e.kill(()=>il(e,function(){ko(t,new Qi(r?r.$err:void 0))}));return}e.cursorState.transforms&&typeof e.cursorState.transforms.doc=="function"&&(r=e.cursorState.transforms.doc(r)),ko(t,null,r)}}}}oM.exports={CursorState:iM,CoreCursor:ld}});var md=_((MTe,cM)=>{"use strict";var bJ=require("util").inherits,Uo=require("util").format,aM=require("events").EventEmitter,EJ=ir(),CJ=Mn(),TJ=Yt().debugOptions,AJ=Yt().retrieveBSON,xJ=Rq(),Vs=se().MongoError,qJ=se().MongoNetworkError,Vo=zw(),MJ=$n().CoreCursor,Us=xt(),NJ=xt().createCompressionInfo,$J=xt().resolveClusterTime,PJ=xt().SessionMixins,IJ=Io().extractCommand,RJ=he().relayEvents,Qw=he().collationNotSupported,DJ=he().makeClientMetadata,jJ=["reconnect","reconnectTries","reconnectInterval","emitError","cursorFactory","host","port","size","keepAlive","keepAliveInitialDelay","noDelay","connectionTimeout","checkServerIdentity","socketTimeout","ssl","ca","crl","cert","key","rejectUnauthorized","promoteLongs","promoteValues","promoteBuffers","bsonRegExp","servername"],BJ=0,sl=!1,ol={},_r=AJ();function hd(e){return e.s.parent==null?e.id:e.s.parent.id}var Ye=function(e){e=e||{},aM.call(this),this.id=BJ++,this.s={options:Object.assign({metadata:DJ(e)},e),logger:CJ("Server",e),Cursor:e.cursorFactory||MJ,bson:e.bson||new _r([_r.Binary,_r.Code,_r.DBRef,_r.Decimal128,_r.Double,_r.Int32,_r.Long,_r.Map,_r.MaxKey,_r.MinKey,_r.ObjectId,_r.BSONRegExp,_r.Symbol,_r.Timestamp]),pool:null,disconnectHandler:e.disconnectHandler,monitoring:typeof e.monitoring=="boolean"?e.monitoring:!0,inTopology:!!e.parent,monitoringInterval:typeof e.monitoringInterval=="number"?e.monitoringInterval:5e3,compression:{compressors:NJ(e)},parent:e.parent},this.s.parent||(this.s.clusterTime=null),this.ismaster=null,this.lastIsMasterMS=-1,this.monitoringProcessId=null,this.initialConnect=!0,this._type="server",this.lastUpdateTime=0,this.lastWriteDate=0,this.staleness=0};bJ(Ye,aM);Object.assign(Ye.prototype,PJ);Object.defineProperty(Ye.prototype,"type",{enumerable:!0,get:function(){return this._type}});Object.defineProperty(Ye.prototype,"parserType",{enumerable:!0,get:function(){return _r.native?"c++":"js"}});Object.defineProperty(Ye.prototype,"logicalSessionTimeoutMinutes",{enumerable:!0,get:function(){return this.ismaster&&this.ismaster.logicalSessionTimeoutMinutes||null}});Object.defineProperty(Ye.prototype,"clientMetadata",{enumerable:!0,get:function(){return this.s.options.metadata}});Object.defineProperty(Ye.prototype,"clusterTime",{enumerable:!0,set:function(e){let t=this.s.parent?this.s.parent:this.s;$J(t,e)},get:function(){return(this.s.parent?this.s.parent:this.s).clusterTime||null}});Ye.enableServerAccounting=function(){sl=!0,ol={}};Ye.disableServerAccounting=function(){sl=!1};Ye.servers=function(){return ol};Object.defineProperty(Ye.prototype,"name",{enumerable:!0,get:function(){return this.s.options.host+":"+this.s.options.port}});function dd(e,t,r,n,i,s){if(!e.s.pool.isConnected()&&e.s.options.reconnect&&e.s.disconnectHandler!=null&&!i.monitoring)return e.s.disconnectHandler.add(t,r,n,i,s),!0;if(!e.s.pool.isConnected())return s(new Vs(Uo("no connection available to server %s",e.name))),!0}function uM(e){return function(){if(!e.s.pool.isDestroyed()){e.emit("monitoring",e);var t=new Date().getTime();e.command("admin.$cmd",{ismaster:!0},{socketTimeout:typeof e.s.options.connectionTimeout!="number"?2e3:e.s.options.connectionTimeout,monitoring:!0},(r,n)=>{e.lastIsMasterMS=new Date().getTime()-t,!e.s.pool.isDestroyed()&&(n&&(e.ismaster=n.result),e.monitoringProcessId=setTimeout(uM(e),e.s.monitoringInterval))})}}}var Fo=function(e,t){return function(r,n){if(e.s.logger.isInfo()){var i=r instanceof Vs?JSON.stringify(r):{};e.s.logger.info(Uo("server %s fired event %s out with message %s",e.name,t,i))}if(t==="connect"){if(e.initialConnect=!1,e.ismaster=n.ismaster,e.lastIsMasterMS=n.lastIsMasterMS,n.agreedCompressor&&(e.s.pool.options.agreedCompressor=n.agreedCompressor),n.zlibCompressionLevel&&(e.s.pool.options.zlibCompressionLevel=n.zlibCompressionLevel),n.ismaster.$clusterTime){let s=n.ismaster.$clusterTime;e.clusterTime=s}e.ismaster.msg==="isdbgrid"&&(e._type="mongos"),e.s.monitoring&&(e.monitoringProcessId=setTimeout(uM(e),e.s.monitoringInterval)),Us.emitServerDescriptionChanged(e,{address:e.name,arbiters:[],hosts:[],passives:[],type:Us.getTopologyType(e)}),e.s.inTopology||Us.emitTopologyDescriptionChanged(e,{topologyType:"Single",servers:[{address:e.name,arbiters:[],hosts:[],passives:[],type:Us.getTopologyType(e)}]}),e.s.logger.isInfo()&&e.s.logger.info(Uo("server %s connected with ismaster [%s]",e.name,JSON.stringify(e.ismaster))),e.emit("connect",e)}else if(t==="error"||t==="parseError"||t==="close"||t==="timeout"||t==="reconnect"||t==="attemptReconnect"||t==="reconnectFailed"){if(sl&&["close","timeout","error","parseError","reconnectFailed"].indexOf(t)!==-1&&(e.s.inTopology||e.emit("topologyOpening",{topologyId:e.id}),delete ol[e.id]),t==="close"&&Us.emitServerDescriptionChanged(e,{address:e.name,arbiters:[],hosts:[],passives:[],type:"Unknown"}),t==="reconnectFailed"){e.emit("reconnectFailed",r),e.listeners("error").length>0&&e.emit("error",r);return}if(["disconnected","connecting"].indexOf(e.s.pool.state)!==-1&&e.initialConnect&&["close","timeout","error","parseError"].indexOf(t)!==-1)return e.initialConnect=!1,e.emit("error",new qJ(Uo("failed to connect to server [%s] on first connect [%s]",e.name,r)));if(t==="reconnect")return Us.emitServerDescriptionChanged(e,{address:e.name,arbiters:[],hosts:[],passives:[],type:Us.getTopologyType(e)}),e.emit(t,e);e.emit(t,r)}}};Ye.prototype.connect=function(e){var t=this;if(e=e||{},sl&&(ol[this.id]=this),t.s.pool&&!t.s.pool.isDisconnected()&&!t.s.pool.isDestroyed())throw new Vs(Uo("server instance in invalid state %s",t.s.pool.state));t.s.pool=new xJ(this,Object.assign(t.s.options,e,{bson:this.s.bson})),t.s.pool.on("close",Fo(t,"close")),t.s.pool.on("error",Fo(t,"error")),t.s.pool.on("timeout",Fo(t,"timeout")),t.s.pool.on("parseError",Fo(t,"parseError")),t.s.pool.on("connect",Fo(t,"connect")),t.s.pool.on("reconnect",Fo(t,"reconnect")),t.s.pool.on("reconnectFailed",Fo(t,"reconnectFailed")),RJ(t.s.pool,t,["commandStarted","commandSucceeded","commandFailed"]),t.s.inTopology||this.emit("topologyOpening",{topologyId:hd(t)}),t.emit("serverOpening",{topologyId:hd(t),address:t.name}),t.s.pool.connect()};Ye.prototype.auth=function(e,t){typeof t=="function"&&t(null,null)};Ye.prototype.getDescription=function(){var e=this.ismaster||{},t={type:Us.getTopologyType(this),address:this.name};return e.hosts&&(t.hosts=e.hosts),e.arbiters&&(t.arbiters=e.arbiters),e.passives&&(t.passives=e.passives),e.setName&&(t.setName=e.setName),t};Ye.prototype.lastIsMaster=function(){return this.ismaster};Ye.prototype.unref=function(){this.s.pool.unref()};Ye.prototype.isConnected=function(){return this.s.pool?this.s.pool.isConnected():!1};Ye.prototype.isDestroyed=function(){return this.s.pool?this.s.pool.isDestroyed():!1};function pd(e){if(!e.s.pool)return new Vs("server instance is not connected");if(e.s.pool.isDestroyed())return new Vs("server instance pool was destroyed")}function LJ(e,t){if(pd(e,t),t.readPreference&&!(t.readPreference instanceof EJ))throw new Error("readPreference must be an instance of ReadPreference")}Ye.prototype.command=function(e,t,r,n){var i=this;typeof r=="function"&&(n=r,r={},r=r||{});var s=LJ(i,r);if(s)return n(s);if(r=Object.assign({},r,{wireProtocolCommand:!1}),i.s.logger.isDebug()){let o=IJ(t);i.s.logger.debug(Uo("executing command [%s] against %s",JSON.stringify({ns:e,cmd:o.shouldRedact?`${o.name} details REDACTED`:t,options:TJ(jJ,r)}),i.name))}if(!dd(i,"command",e,t,r,n)){if(Qw(this,t))return n(new Vs(`server ${this.name} does not support collation`));Vo.command(i,e,t,r,n)}};Ye.prototype.query=function(e,t,r,n,i){Vo.query(this,e,t,r,n,i)};Ye.prototype.getMore=function(e,t,r,n,i){Vo.getMore(this,e,t,r,n,i)};Ye.prototype.killCursors=function(e,t,r){Vo.killCursors(this,e,t,r)};Ye.prototype.insert=function(e,t,r,n){var i=this;typeof r=="function"&&(n=r,r={},r=r||{});var s=pd(i,r);if(s)return n(s);if(!dd(i,"insert",e,t,r,n))return t=Array.isArray(t)?t:[t],Vo.insert(i,e,t,r,n)};Ye.prototype.update=function(e,t,r,n){var i=this;typeof r=="function"&&(n=r,r={},r=r||{});var s=pd(i,r);if(s)return n(s);if(!dd(i,"update",e,t,r,n))return Qw(this,r)?n(new Vs(`server ${this.name} does not support collation`)):(t=Array.isArray(t)?t:[t],Vo.update(i,e,t,r,n))};Ye.prototype.remove=function(e,t,r,n){var i=this;typeof r=="function"&&(n=r,r={},r=r||{});var s=pd(i,r);if(s)return n(s);if(!dd(i,"remove",e,t,r,n))return Qw(this,r)?n(new Vs(`server ${this.name} does not support collation`)):(t=Array.isArray(t)?t:[t],Vo.remove(i,e,t,r,n))};Ye.prototype.cursor=function(e,t,r){r=r||{};let n=r.topology||this;var i=r.cursorFactory||this.s.Cursor;return new i(n,e,t,r)};Ye.prototype.equals=function(e){return typeof e=="string"?this.name.toLowerCase()===e.toLowerCase():e.name?this.name.toLowerCase()===e.name.toLowerCase():!1};Ye.prototype.connections=function(){return this.s.pool.allConnections()};Ye.prototype.selectServer=function(e,t,r){typeof e=="function"&&typeof r>"u"&&(r=e,e=void 0,t={}),typeof t=="function"&&(r=t,t=e,e=void 0),r(null,this)};var kJ=["close","error","timeout","parseError","connect"];Ye.prototype.destroy=function(e,t){if(this._destroyed){typeof t=="function"&&t(null,null);return}typeof e=="function"&&(t=e,e={}),e=e||{};var r=this;if(sl&&delete ol[this.id],this.monitoringProcessId&&clearTimeout(this.monitoringProcessId),!r.s.pool||this._destroyed){this._destroyed=!0,typeof t=="function"&&t(null,null);return}this._destroyed=!0,e.emitClose&&r.emit("close",r),e.emitDestroy&&r.emit("destroy",r),kJ.forEach(function(n){r.s.pool.removeAllListeners(n)}),r.listeners("serverClosed").length>0&&r.emit("serverClosed",{topologyId:hd(r),address:r.name}),r.listeners("topologyClosed").length>0&&!r.s.inTopology&&r.emit("topologyClosed",{topologyId:hd(r)}),r.s.logger.isDebug()&&r.s.logger.debug(Uo("destroy called on server %s",r.name)),this.s.pool.destroy(e.force,t)};cM.exports=Ye});var mM=_((NTe,pM)=>{"use strict";var FJ=require("util").inherits,lM=require("util").format,UJ=xt().diff,hM=require("events").EventEmitter,VJ=Mn(),Ws=ir(),Wo=se().MongoError,yd=jt().Buffer,st={Single:"Single",ReplicaSetNoPrimary:"ReplicaSetNoPrimary",ReplicaSetWithPrimary:"ReplicaSetWithPrimary",Sharded:"Sharded",Unknown:"Unknown"},wr={Standalone:"Standalone",Mongos:"Mongos",PossiblePrimary:"PossiblePrimary",RSPrimary:"RSPrimary",RSSecondary:"RSSecondary",RSArbiter:"RSArbiter",RSOther:"RSOther",RSGhost:"RSGhost",Unknown:"Unknown"},Zr=function(e){e=e||{},hM.call(this),this.topologyType=e.setName?st.ReplicaSetNoPrimary:st.Unknown,this.setName=e.setName,this.set={},this.id=e.id,this.setName=e.setName,this.logger=e.logger||VJ("ReplSet",e),this.index=0,this.acceptableLatency=e.acceptableLatency||15,this.heartbeatFrequencyMS=e.heartbeatFrequencyMS||1e4,this.primary=null,this.secondaries=[],this.arbiters=[],this.passives=[],this.ghosts=[],this.unknownServers=[],this.set={},this.maxElectionId=null,this.maxSetVersion=0,this.replicasetDescription={topologyType:"Unknown",servers:[]},this.logicalSessionTimeoutMinutes=void 0};FJ(Zr,hM);Zr.prototype.hasPrimaryAndSecondary=function(){return this.primary!=null&&this.secondaries.length>0};Zr.prototype.hasPrimaryOrSecondary=function(){return this.hasPrimary()||this.hasSecondary()};Zr.prototype.hasPrimary=function(){return this.primary!=null};Zr.prototype.hasSecondary=function(){return this.secondaries.length>0};Zr.prototype.get=function(e){for(var t=this.allServers(),r=0;r<t.length;r++)if(t[r].name.toLowerCase()===e.toLowerCase())return t[r];return null};Zr.prototype.allServers=function(e){e=e||{};var t=this.primary?[this.primary]:[];return t=t.concat(this.secondaries),e.ignoreArbiters||(t=t.concat(this.arbiters)),t=t.concat(this.passives),t};Zr.prototype.destroy=function(e,t){let r=this.secondaries.concat(this.arbiters).concat(this.passives).concat(this.ghosts);this.primary&&r.push(this.primary);let n=r.length,i=()=>{n--,!(n>0)&&(this.secondaries=[],this.arbiters=[],this.passives=[],this.ghosts=[],this.unknownServers=[],this.set={},this.primary=null,ou(this),typeof t=="function"&&t(null,null))};if(n===0){i();return}r.forEach(s=>s.destroy(e,i))};Zr.prototype.remove=function(e,t){t=t||{};var r=e.name.toLowerCase(),n=this.primary?[this.primary]:[];n=n.concat(this.secondaries),n=n.concat(this.arbiters),n=n.concat(this.passives);for(var i=0;i<n.length;i++)if(!t.force&&n[i].equals(e)&&n[i].isConnected&&n[i].isConnected())return;this.set[r]&&(this.set[r].type=wr.Unknown,this.set[r].electionId=null,this.set[r].setName=null,this.set[r].setVersion=null);var s=null;this.primary&&this.primary.equals(e)&&(this.primary=null,this.topologyType=st.ReplicaSetNoPrimary,s="primary"),s=Rr(e,this.secondaries)?"secondary":s,s=Rr(e,this.arbiters)?"arbiter":s,s=Rr(e,this.passives)?"secondary":s,Rr(e,this.ghosts),Rr(e,this.unknownServers),this.unknownServers.push(r),s&&this.emit("left",s,e)};var fM=e=>e.arbiterOnly&&e.setName;Zr.prototype.update=function(e){var t=this;let r=e.lastIsMaster();r&&r.isWritablePrimary&&(r.ismaster=r.isWritablePrimary);var n=e.name.toLowerCase();if(r){var i=Array.isArray(r.hosts)?r.hosts:[];i=i.concat(Array.isArray(r.arbiters)?r.arbiters:[]),i=i.concat(Array.isArray(r.passives)?r.passives:[]),i=i.map(function(y){return y.toLowerCase()});for(var s=0;s<i.length;s++)this.unknownServers.indexOf(i[s])===-1&&(!this.set[i[s]]||this.set[i[s]].type===wr.Unknown)&&this.unknownServers.push(i[s].toLowerCase()),this.set[i[s]]||(this.set[i[s]]={type:wr.Unknown,electionId:null,setName:null,setVersion:null})}if(!r&&!gd(r,e,this.unknownServers))return t.set[n]={type:wr.Unknown,setVersion:null,electionId:null,setName:null},t.set[n].type=wr.Unknown,t.set[n].electionId=r&&r.electionId,t.set[n].setName=r&&r.setName,t.set[n].setVersion=r&&r.setVersion,t.unknownServers.indexOf(e.name)===-1&&t.unknownServers.push(n),!1;if(r.logicalSessionTimeoutMinutes!==void 0&&!fM(r)&&(t.logicalSessionTimeoutMinutes===void 0||r.logicalSessionTimeoutMinutes===null?t.logicalSessionTimeoutMinutes=r.logicalSessionTimeoutMinutes:t.logicalSessionTimeoutMinutes=Math.min(t.logicalSessionTimeoutMinutes,r.logicalSessionTimeoutMinutes)),r&&r.msg==="isdbgrid")return this.primary&&this.primary.name===n&&(this.primary=null,this.topologyType=st.ReplicaSetNoPrimary),!1;if(r.isreplicaset)return t.set[n]={type:wr.RSGhost,setVersion:null,electionId:null,setName:r.setName},this.primary&&this.primary.name===n&&(this.primary=null),this.topologyType=this.primary?st.ReplicaSetWithPrimary:st.ReplicaSetNoPrimary,r.setName&&(this.setName=r.setName),!1;if(r.setName&&r.hidden||r.setName&&!r.ismaster&&!r.secondary&&!r.arbiterOnly&&!r.passive)return t.set[n]={type:wr.RSOther,setVersion:null,electionId:null,setName:r.setName},this.topologyType=this.primary?st.ReplicaSetWithPrimary:st.ReplicaSetNoPrimary,r.setName&&(this.setName=r.setName),!1;if(r&&r.ismaster&&!r.setName)return this.remove(e,{force:!0}),!1;if(r&&!r.ismaster&&!r.secondary&&!r.arbiterOnly)return this.remove(e,{force:!0}),!1;if(r.me&&r.me.toLowerCase()!==n)return this.logger.isWarn()&&this.logger.warn(lM("the seedlist server was removed due to its address %s not matching its ismaster.me address %s",e.name,r.me)),delete this.set[n],Rr(e,t.unknownServers),e.destroy({force:!0}),this.primary&&!this.primary.equals(e)?this.topologyType=st.ReplicaSetWithPrimary:this.topologyType=st.ReplicaSetNoPrimary,!this.primary&&r.primary&&(this.set[r.primary.toLowerCase()]={type:wr.PossiblePrimary,setName:null,electionId:null,setVersion:null}),!1;if(!this.primary&&r.ismaster&&r.setName){var o=e.lastIsMaster().electionId;if(this.setName&&this.setName!==r.setName)return this.topologyType=st.ReplicaSetNoPrimary,new Wo(lM("setName from ismaster does not match provided connection setName [%s] != [%s]",r.setName,this.setName));if(!this.maxElectionId&&o)this.maxElectionId=o;else if(this.maxElectionId&&o){var a=Zw(this.maxElectionId,o),u=e.lastIsMaster().setVersion;if(a===1)return this.topologyType=st.ReplicaSetNoPrimary,!1;if(a===0&&u&&u<this.maxSetVersion)return this.topologyType=st.ReplicaSetNoPrimary,!1;this.maxSetVersion=u,this.maxElectionId=o}var c=r.hosts.map(function(y){return y.toLowerCase()}),f=c.indexOf(n);return f!==-1?(t.primary=e,t.set[n]={type:wr.RSPrimary,setVersion:r.setVersion,electionId:r.electionId,setName:r.setName},this.topologyType=st.ReplicaSetWithPrimary,r.setName&&(this.setName=r.setName),Rr(e,t.unknownServers),Rr(e,t.secondaries),Rr(e,t.passives),t.emit("joined","primary",e)):this.topologyType=st.ReplicaSetNoPrimary,ou(t),!0}else if(r.ismaster&&r.setName){var h=t.set[t.primary.name.toLowerCase()].electionId,d=t.set[t.primary.name.toLowerCase()].setVersion,p=t.set[t.primary.name.toLowerCase()].setName;o=e.lastIsMaster().electionId,u=e.lastIsMaster().setVersion;var m=e.lastIsMaster().setName;if(this.primary.equals(e)&&p===m)return!1;if(p&&p!==m)return this.primary.equals(e)?this.topologyType=st.ReplicaSetNoPrimary:this.topologyType=st.ReplicaSetWithPrimary,!1;if(h&&o){if(a=Zw(h,o),a===1)return!1;if(a===0&&d>u)return!1}else if(!h&&o&&u&&u<this.maxSetVersion)return!1;if(!this.maxElectionId&&o)this.maxElectionId=o;else if(this.maxElectionId&&o){if(a=Zw(this.maxElectionId,o),a===1)return!1;if(a===0&&d&&u){if(u<this.maxSetVersion)return!1}else if(u<this.maxSetVersion)return!1;this.maxElectionId=o,this.maxSetVersion=u}else this.maxSetVersion=u;return t.set[t.primary.name.toLowerCase()]={type:wr.Unknown,setVersion:null,electionId:null,setName:null},t.emit("left","primary",this.primary),t.primary.destroy({force:!0}),t.primary=e,t.set[n]={type:wr.RSPrimary,setVersion:r.setVersion,electionId:r.electionId,setName:r.setName},this.topologyType=st.ReplicaSetWithPrimary,r.setName&&(this.setName=r.setName),Rr(e,t.unknownServers),Rr(e,t.secondaries),Rr(e,t.passives),t.emit("joined","primary",e),ou(t),!0}return!this.primary&&r.primary&&(t.set[r.primary.toLowerCase()]={type:wr.PossiblePrimary,setVersion:null,electionId:null,setName:null}),r.secondary&&r.setName&&!gd(r,e,this.secondaries)&&this.setName&&this.setName===r.setName?(Xw(t,wr.RSSecondary,r,e,this.secondaries),this.topologyType=this.primary?st.ReplicaSetWithPrimary:st.ReplicaSetNoPrimary,r.setName&&(this.setName=r.setName),Rr(e,t.unknownServers),this.primary&&this.primary.name.toLowerCase()===n&&(e.destroy({force:!0}),this.primary=null,t.emit("left","primary",e)),t.emit("joined","secondary",e),ou(t),!0):fM(r)&&!gd(r,e,this.arbiters)&&this.setName&&this.setName===r.setName?(Xw(t,wr.RSArbiter,r,e,this.arbiters),this.topologyType=this.primary?st.ReplicaSetWithPrimary:st.ReplicaSetNoPrimary,r.setName&&(this.setName=r.setName),Rr(e,t.unknownServers),t.emit("joined","arbiter",e),ou(t),!0):r.passive&&r.setName&&!gd(r,e,this.passives)&&this.setName&&this.setName===r.setName?(Xw(t,wr.RSSecondary,r,e,this.passives),this.topologyType=this.primary?st.ReplicaSetWithPrimary:st.ReplicaSetNoPrimary,r.setName&&(this.setName=r.setName),Rr(e,t.unknownServers),this.primary&&this.primary.name.toLowerCase()===n&&(e.destroy({force:!0}),this.primary=null,t.emit("left","primary",e)),t.emit("joined","secondary",e),ou(t),!0):this.set[n]&&this.set[n].type===wr.RSPrimary?(t.emit("left","primary",this.primary),this.primary.destroy({force:!0}),this.primary=null,this.topologyType=st.ReplicaSetNoPrimary,!1):(this.topologyType=this.primary?st.ReplicaSetWithPrimary:st.ReplicaSetNoPrimary,!1)};Zr.prototype.updateServerMaxStaleness=function(e,t){for(var r=0,n=0;n<this.secondaries.length;n++)r=Math.max(r,this.secondaries[n].lastWriteDate);e.ismaster.maxWireVersion>=5&&e.ismaster.secondary&&this.hasPrimary()?e.staleness=e.lastUpdateTime-e.lastWriteDate-(this.primary.lastUpdateTime-this.primary.lastWriteDate)+t:e.ismaster.maxWireVersion>=5&&e.ismaster.secondary&&(e.staleness=r-e.lastWriteDate+t)};Zr.prototype.updateSecondariesMaxStaleness=function(e){for(var t=0;t<this.secondaries.length;t++)this.updateServerMaxStaleness(this.secondaries[t],e)};Zr.prototype.pickServer=function(e){if(e=e||Ws.primary,e.preference==="primary"&&e.maxStalenessSeconds!=null)return new Wo("primary readPreference incompatible with maxStalenessSeconds");var t=this.primary?[this.primary]:[];if(t=t.concat(this.secondaries),e.maxStalenessSeconds!=null){for(var r=0;r<t.length;r++)if(t[r].ismaster.maxWireVersion<5)return new Wo("maxStalenessSeconds not supported by at least one of the replicaset members")}if(e.preference==="nearest"&&e.maxStalenessSeconds==null)return Jw(this,e);if(e.preference==="nearest"&&e.maxStalenessSeconds!=null)return Yw(this,e);var n=this.secondaries;if(e.equals(Ws.secondary)&&n.length===0)return new Wo("no secondary server available");if(e.equals(Ws.secondaryPreferred)&&n.length===0&&this.primary==null)return new Wo("no secondary or primary server available");if(e.equals(Ws.primary)&&this.primary==null)return new Wo("no primary server available");if(e.equals(Ws.secondaryPreferred)||e.equals(Ws.secondary)){if(n.length>0&&e.maxStalenessSeconds==null){var i=Jw(this,e);if(i)return i}else if(n.length>0&&e.maxStalenessSeconds!=null&&(i=Yw(this,e),i))return i;return e.equals(Ws.secondaryPreferred)?this.primary:null}if(e.equals(Ws.primaryPreferred)){if(i=null,this.primary)return this.primary;if(n.length>0&&e.maxStalenessSeconds==null?i=Jw(this,e):n.length>0&&e.maxStalenessSeconds!=null&&(i=Yw(this,e)),i)return i}return this.primary};var dM=function(e,t){if(e.tags==null)return t;for(var r=[],n=Array.isArray(e.tags)?e.tags:[e.tags],i=0;i<n.length;i++)for(var s=n[i],o=0;o<t.length;o++){var a=t[o].lastIsMaster().tags||{},u=!0;for(var c in s)a[c]!==s[c]&&(u=!1);u&&r.push(t[o])}return r};function Yw(e,t){var r=[],n=t.maxStalenessSeconds*1e3;if(n<90*1e3)return new Wo("maxStalenessSeconds must be set to at least 90 seconds");e.primary&&t.preference!=="secondary"&&t.preference!=="secondaryPreferred"&&r.push(e.primary);for(var i=0;i<e.secondaries.length;i++)r.push(e.secondaries[i]);if(e.primary&&r.length===0&&t.preference!=="secondaryPreferred"&&r.push(e.primary),r=dM(t,r),r=r.filter(function(o){return o.staleness<=n}),r.sort(function(o,a){return o.lastIsMasterMS-a.lastIsMasterMS}),r.length===0)return null;e.index=e.index%r.length;var s=r[e.index];return e.index=e.index+1,s}function Jw(e,t){var r=[];e.primary&&t.preference!=="secondary"&&t.preference!=="secondaryPreferred"&&r.push(e.primary);for(var n=0;n<e.secondaries.length;n++)r.push(e.secondaries[n]);r.length===0&&e.primary&&t.preference!=="secondaryPreferred"&&r.push(e.primary),r=dM(t,r),r.sort(function(o,a){return o.lastIsMasterMS-a.lastIsMasterMS});var i=r.length>0?r[0].lastIsMasterMS:0;if(r=r.filter(function(o){return o.lastIsMasterMS<=i+e.acceptableLatency}),r.length===0)return null;e.index=e.index%r.length;var s=r[e.index];return e.index=e.index+1,s}function gd(e,t,r){for(var n=0;n<r.length;n++)if(r[n]&&r[n].name&&r[n].name.toLowerCase()===t.name.toLowerCase())return!0;return!1}function Xw(e,t,r,n,i){var s=n.name.toLowerCase();e.set[s].type=t,e.set[s].electionId=r&&r.electionId,e.set[s].setName=r&&r.setName,e.set[s].setVersion=r&&r.setVersion,i.push(n)}function Zw(e,t){var r=yd.from(e.toHexString(),"hex"),n=yd.from(t.toHexString(),"hex");if(r===n)return 0;if(typeof yd.compare=="function")return yd.compare(r,n);for(var i=r.length,s=n.length,o=Math.min(i,s),a=0;a<o&&r[a]===n[a];a++);return a!==o&&(i=r[a],s=n[a]),i<s?-1:s<i?1:0}function Rr(e,t){for(var r=0;r<t.length;r++){if(t[r].equals&&t[r].equals(e))return t.splice(r,1),!0;if(typeof t[r]=="string"&&t[r].toLowerCase()===e.name.toLowerCase())return t.splice(r,1),!0}return!1}function ou(e){if(e.listeners("topologyDescriptionChanged").length>0){var t="Unknown",r=e.setName;e.hasPrimaryAndSecondary()?t="ReplicaSetWithPrimary":!e.hasPrimary()&&e.hasSecondary()&&(t="ReplicaSetNoPrimary");var n={topologyType:t,setName:r,servers:[]};if(e.hasPrimary()){var i=e.primary.getDescription();i.type="RSPrimary",n.servers.push(i)}n.servers=n.servers.concat(e.secondaries.map(function(a){var u=a.getDescription();return u.type="RSSecondary",u})),n.servers=n.servers.concat(e.arbiters.map(function(a){var u=a.getDescription();return u.type="RSArbiter",u})),n.servers=n.servers.concat(e.passives.map(function(a){var u=a.getDescription();return u.type="RSSecondary",u}));var s=UJ(e.replicasetDescription,n),o={topologyId:e.id,previousDescription:e.replicasetDescription,newDescription:n,diff:s};e.emit("topologyDescriptionChanged",o),e.replicasetDescription=n}}pM.exports=Zr});var TM=_(($Te,CM)=>{"use strict";var WJ=require("util").inherits,Ji=require("util").format,_M=require("events").EventEmitter,Yi=ir(),zJ=$n().CoreCursor,HJ=Yt().retrieveBSON,KJ=Mn(),Pn=se().MongoError,vd=md(),GJ=mM(),au=xt().Timeout,wM=xt().Interval,QJ=xt().SessionMixins,vM=xt().isRetryableWritesSupported,SM=he().relayEvents,vr=HJ(),YJ=xt().getMMAPError,JJ=he().makeClientMetadata,OM=xt().legacyIsRetryableWriteError,bM=N().now,XJ=N().calculateDurationInMs,zo="disconnected",Ho="connecting",_d="connected",en="unreferenced",Lt="destroyed";function Hs(e,t){var r={disconnected:[Ho,Lt,zo],connecting:[Ho,Lt,_d,zo],connected:[_d,zo,Lt,en],unreferenced:[en,Lt],destroyed:[Lt]},n=r[e.state];n&&n.indexOf(t)!==-1?e.state=t:e.s.logger.error(Ji("Pool with id [%s] failed attempted illegal state transition from [%s] to [%s] only following state allowed [%s]",e.id,e.state,t,n))}var ZJ=1,wd=["connect","close","error","timeout","parseError"],kt=function(e,t){var r=this;if(t=t||{},!Array.isArray(e))throw new Pn("seedlist must be an array");if(e.length===0)throw new Pn("seedlist must contain at least one entry");e.forEach(function(o){if(typeof o.host!="string"||typeof o.port!="number")throw new Pn("seedlist entry must contain a host and port")}),_M.call(this),this.id=ZJ++;var n=t.localThresholdMS||15;t.acceptableLatency&&(n=t.acceptableLatency);var i=KJ("ReplSet",t);this.s={options:Object.assign({metadata:JJ(t)},t),bson:t.bson||new vr([vr.Binary,vr.Code,vr.DBRef,vr.Decimal128,vr.Double,vr.Int32,vr.Long,vr.Map,vr.MaxKey,vr.MinKey,vr.ObjectId,vr.BSONRegExp,vr.Symbol,vr.Timestamp]),Cursor:t.cursorFactory||zJ,logger:i,seedlist:e,replicaSetState:new GJ({id:this.id,setName:t.setName,acceptableLatency:n,heartbeatFrequencyMS:t.haInterval?t.haInterval:1e4,logger:i}),connectingServers:[],haInterval:t.haInterval?t.haInterval:1e4,minHeartbeatFrequencyMS:500,disconnectHandler:t.disconnectHandler,index:0,connectOptions:{},debug:typeof t.debug=="boolean"?t.debug:!1},this.s.replicaSetState.on("topologyDescriptionChanged",function(o){r.emit("topologyDescriptionChanged",o)}),this.s.logger.isWarn()&&this.s.options.socketTimeout!==0&&this.s.options.socketTimeout<this.s.haInterval&&this.s.logger.warn(Ji("warning socketTimeout %s is less than haInterval %s. This might cause unnecessary server reconnections due to socket timeouts",this.s.options.socketTimeout,this.s.haInterval));var s=["joined","left"];s.forEach(function(o){r.s.replicaSetState.on(o,function(a,u){r.emit(o,a,u)})}),this.initialConnectState={connect:!1,fullsetup:!1,all:!1},this.state=zo,this.haTimeoutId=null,this.ismaster=null,this.intervalIds=[],this.clusterTime=null};WJ(kt,_M);Object.assign(kt.prototype,QJ);Object.defineProperty(kt.prototype,"type",{enumerable:!0,get:function(){return"replset"}});Object.defineProperty(kt.prototype,"parserType",{enumerable:!0,get:function(){return vr.native?"c++":"js"}});Object.defineProperty(kt.prototype,"logicalSessionTimeoutMinutes",{enumerable:!0,get:function(){return this.s.replicaSetState.logicalSessionTimeoutMinutes||null}});function ev(e){e.s.replicaSetState.hasPrimaryAndSecondary()&&e.s.disconnectHandler?e.s.disconnectHandler.execute():e.s.replicaSetState.hasPrimary()&&e.s.disconnectHandler?e.s.disconnectHandler.execute({executePrimary:!0}):e.s.replicaSetState.hasSecondary()&&e.s.disconnectHandler&&e.s.disconnectHandler.execute({executeSecondary:!0})}function yM(e,t,r){if(t.length===0)return r();var n=t.length,i=null;function s(){n=n-1,n===0&&r(i)}var o=function(c,f){return function(h){var d=this;if(c.state===Lt||c.state===en)return this.destroy({force:!0}),s();if(f==="connect"){var p=c.s.replicaSetState.update(d);if(p){d.lastIsMaster()&&d.lastIsMaster().ismaster&&(c.ismaster=d.lastIsMaster());for(let m=0;m<wd.length;m++)d.removeAllListeners(wd[m]);d.on("error",zs(c,"error")),d.on("close",zs(c,"close")),d.on("timeout",zs(c,"timeout")),d.on("parseError",zs(c,"parseError")),tv(d.lastIsMaster().me,c,{}),ev(c)}else d.destroy({force:!0})}else f==="error"&&(i=h);ev(c),s()}};function a(c,f){setTimeout(function(){if(e.state===Lt||e.state===en)return;let h=e.s.connectingServers.findIndex(p=>p.name===c);if(h>=0)return e.s.connectingServers[h].destroy({force:!0}),e.s.connectingServers.splice(h,1),s();var d=new vd(Object.assign({},e.s.options,{host:c.split(":")[0],port:parseInt(c.split(":")[1],10),reconnect:!1,monitoring:!1,parent:e}));d.once("connect",o(e,"connect")),d.once("close",o(e,"close")),d.once("timeout",o(e,"timeout")),d.once("error",o(e,"error")),d.once("parseError",o(e,"parseError")),d.on("serverOpening",p=>e.emit("serverOpening",p)),d.on("serverDescriptionChanged",p=>e.emit("serverDescriptionChanged",p)),d.on("serverClosed",p=>e.emit("serverClosed",p)),SM(d,e,["commandStarted","commandSucceeded","commandFailed"]),e.s.connectingServers.push(d),d.connect(e.s.connectOptions)},f)}for(var u=0;u<t.length;u++)a(t[u],u)}var eX=function(e,t,r){var n=new Date().getTime();ul(e,"serverHeartbeatStarted",{connectionId:t.name}),t.command("admin.$cmd",{ismaster:!0},{monitoring:!0,socketTimeout:e.s.options.connectionTimeout||2e3},function(i,s){if(e.state===Lt||e.state===en)return t.destroy({force:!0}),r(i,s);var o=new Date().getTime()-n;t.lastUpdateTime=bM(),i?(ul(e,"serverHeartbeatFailed",{durationMS:o,failure:i,connectionId:t.name}),e.s.replicaSetState.remove(t)):(t.ismaster=s.result,t.ismaster.lastWrite&&t.ismaster.lastWrite.lastWriteDate&&(t.lastWriteDate=t.ismaster.lastWrite.lastWriteDate.getTime()),t.lastIsMasterMS===-1?t.lastIsMasterMS=o:t.lastIsMasterMS&&(t.lastIsMasterMS=.2*o+(1-.2)*t.lastIsMasterMS),e.s.replicaSetState.update(t)&&t.lastIsMaster()&&t.lastIsMaster().ismaster&&(e.ismaster=t.lastIsMaster()),ul(e,"serverHeartbeatSucceeded",{durationMS:o,reply:s.result,connectionId:t.name})),e.s.replicaSetState.updateServerMaxStaleness(t,e.s.haInterval),r(i,s)})},tv=function(e,t,r){if(!r.haInterval){for(var n=0;n<t.intervalIds.length;n++)if(t.intervalIds[n].__host===e)return}var i=r.haInterval?au:wM,s=r.haInterval?r.haInterval:t.s.haInterval,o=new i(function(){if(t.state===Lt||t.state===en){o.stop();return}var a=t.s.replicaSetState.get(e);if(a)return eX(t,a,function(u){if(!u){if(t.state===Lt||t.state===en){o.stop();return}t.intervalIds=t.intervalIds.filter(function(c){return c.isRunning()}),i===au?t.state===Ho&&(t.s.replicaSetState.hasSecondary()&&t.s.options.secondaryOnlyConnectionAllowed||t.s.replicaSetState.hasPrimary())&&(Hs(t,_d),process.nextTick(function(){t.emit("connect",t)}),rv(t,{})):t.state===zo&&(t.s.replicaSetState.hasSecondary()&&t.s.options.secondaryOnlyConnectionAllowed||t.s.replicaSetState.hasPrimary())&&(Hs(t,Ho),ev(t),process.nextTick(function(){t.emit("reconnect",t)})),t.initialConnectState.connect&&!t.initialConnectState.fullsetup&&t.s.replicaSetState.hasPrimaryAndSecondary()&&(t.initialConnectState.fullsetup=!0,t.initialConnectState.all=!0,process.nextTick(function(){t.emit("fullsetup",t),t.emit("all",t)}))}})},s);o.start(),o.__host=e,t.intervalIds.push(o)};function rv(e,t){if(e.state===Lt||e.state===en)return;t=t||{};var r=Object.keys(e.s.replicaSetState.set),n=t.haInterval?au:wM,i=t.haInterval?t.haInterval:e.s.haInterval;if(n===au)return yM(e,e.s.replicaSetState.unknownServers,function(u){if(!(e.state===Lt||e.state===en)){if(!e.s.replicaSetState.hasPrimary()&&!e.s.options.secondaryOnlyConnectionAllowed)return u?e.emit("error",u):(e.emit("error",new Pn("no primary found in replicaset or invalid replica set name")),e.destroy({force:!0}));if(!e.s.replicaSetState.hasSecondary()&&e.s.options.secondaryOnlyConnectionAllowed)return u?e.emit("error",u):(e.emit("error",new Pn("no secondary found in replicaset or invalid replica set name")),e.destroy({force:!0}));for(var c=0;c<r.length;c++)tv(r[c],e,t)}});for(var s=0;s<r.length;s++)tv(r[s],e,t);function o(u){return function(){u.state===Lt||u.state===en||yM(u,u.s.replicaSetState.unknownServers,function(){var c=u.s.replicaSetState.hasPrimary()?i:u.s.minHeartbeatFrequencyMS;u.intervalIds.push(new au(o(u),c).start())})}}var a=e.s.replicaSetState.hasPrimary()?i:e.s.minHeartbeatFrequencyMS;e.intervalIds.push(new au(o(e),a).start())}function EM(e,t){for(var r=0;r<e.length;r++)if(e[r].name.toLowerCase()===t.name.toLowerCase())return!0;e.push(t)}function zs(e,t){return function(){e.state===Lt||e.state===en||(e.s.logger.isDebug()&&e.s.logger.debug(Ji("handleEvent %s from server %s in replset with id %s",t,this.name,e.id)),e.s.replicaSetState.remove(this),!(e.state===Lt||e.state===en)&&(!e.s.replicaSetState.hasPrimary()&&!e.s.replicaSetState.hasSecondary()&&e.s.options.secondaryOnlyConnectionAllowed?Hs(e,zo):e.s.replicaSetState.hasPrimary()||Hs(e,zo),EM(e.s.connectingServers,this)))}}function tX(e){let t=e.state===Ho,r=e.s.replicaSetState.hasPrimary(),n=e.s.replicaSetState.hasSecondary(),i=e.s.options.secondaryOnlyConnectionAllowed,s=e.s.connectOptions.readPreference&&e.s.connectOptions.readPreference.equals(Yi.secondary);return t&&(s&&n||!s&&r)||n&&i}function al(e,t){return function(){var r=this;if(e.s.logger.isDebug()&&e.s.logger.debug(Ji("handleInitialConnectEvent %s from server %s in replset with id %s",t,this.name,e.id)),e.state===Lt||e.state===en)return this.destroy({force:!0});if(t==="connect"){var n=e.s.replicaSetState.update(r);if(n===!0){r.lastIsMaster()&&r.lastIsMaster().ismaster&&(e.ismaster=r.lastIsMaster()),e.s.logger.isDebug()&&e.s.logger.debug(Ji("handleInitialConnectEvent %s from server %s in replset with id %s has state [%s]",t,r.name,e.id,JSON.stringify(e.s.replicaSetState.set)));for(let s=0;s<wd.length;s++)r.removeAllListeners(wd[s]);r.on("error",zs(e,"error")),r.on("close",zs(e,"close")),r.on("timeout",zs(e,"timeout")),r.on("parseError",zs(e,"parseError")),tX(e)&&(Hs(e,_d),e.initialConnectState.connect=!0,process.nextTick(function(){e.emit("connect",e)}),rv(e,{}))}else{if(n instanceof Pn)return r.destroy({force:!0}),e.destroy({force:!0}),e.emit("error",n);r.destroy({force:!0})}}else e.emit("failed",this),EM(e.s.connectingServers,this),e.s.replicaSetState.remove(this);e.initialConnectState.connect&&!e.initialConnectState.fullsetup&&e.s.replicaSetState.hasPrimaryAndSecondary()&&(e.initialConnectState.fullsetup=!0,e.initialConnectState.all=!0,process.nextTick(function(){e.emit("fullsetup",e),e.emit("all",e)}));for(var i=0;i<e.s.connectingServers.length;i++)e.s.connectingServers[i].equals(this)&&e.s.connectingServers.splice(i,1);e.s.connectingServers.length===0&&e.state===Ho&&rv(e,{haInterval:1})}}function rX(e,t){e.s.connectingServers=e.s.connectingServers.concat(t);var r=0;function n(i,s){setTimeout(function(){e.s.replicaSetState.update(i)&&i.lastIsMaster()&&i.lastIsMaster().ismaster&&(e.ismaster=i.lastIsMaster()),i.once("close",al(e,"close")),i.once("timeout",al(e,"timeout")),i.once("parseError",al(e,"parseError")),i.once("error",al(e,"error")),i.once("connect",al(e,"connect")),i.on("serverOpening",o=>e.emit("serverOpening",o)),i.on("serverDescriptionChanged",o=>e.emit("serverDescriptionChanged",o)),i.on("serverClosed",o=>e.emit("serverClosed",o)),SM(i,e,["commandStarted","commandSucceeded","commandFailed"]),i.connect(e.s.connectOptions)},s)}for(;t.length>0;)n(t.shift(),r++)}function ul(e,t,r){e.listeners(t).length>0&&e.emit(t,r)}kt.prototype.connect=function(e){var t=this;this.s.connectOptions=e||{},Hs(this,Ho);var r=this.s.seedlist.map(function(n){return new vd(Object.assign({},t.s.options,n,e,{reconnect:!1,monitoring:!1,parent:t}))});if(this.s.options.socketTimeout>0&&this.s.options.socketTimeout<=this.s.options.haInterval)return t.emit("error",new Pn(Ji("haInterval [%s] MS must be set to less than socketTimeout [%s] MS",this.s.options.haInterval,this.s.options.socketTimeout)));ul(this,"topologyOpening",{topologyId:this.id}),rX(t,r)};kt.prototype.auth=function(e,t){typeof t=="function"&&t(null,null)};kt.prototype.destroy=function(e,t){typeof e=="function"&&(t=e,e={}),e=e||{};let r=this.s.connectingServers.length+1,n=()=>{r--,!(r>0)&&(ul(this,"topologyClosed",{topologyId:this.id}),typeof t=="function"&&t(null,null))};if(this.state===Lt){typeof t=="function"&&t(null,null);return}Hs(this,Lt),this.haTimeoutId&&clearTimeout(this.haTimeoutId);for(var i=0;i<this.intervalIds.length;i++)this.intervalIds[i].stop();if(this.intervalIds=[],r===0){n();return}this.s.replicaSetState.destroy(e,n),this.s.connectingServers.forEach(function(s){s.destroy(e,n)})};kt.prototype.unref=function(){Hs(this,en),this.s.replicaSetState.allServers().forEach(function(e){e.unref()}),clearTimeout(this.haTimeoutId)};kt.prototype.lastIsMaster=function(){return this.s.options.secondaryOnlyConnectionAllowed&&!this.s.replicaSetState.hasPrimary()&&this.s.replicaSetState.hasSecondary()?this.s.replicaSetState.secondaries[0].lastIsMaster():this.s.replicaSetState.primary?this.s.replicaSetState.primary.lastIsMaster():this.ismaster};kt.prototype.connections=function(){for(var e=this.s.replicaSetState.allServers(),t=[],r=0;r<e.length;r++)t=t.concat(e[r].connections());return t};kt.prototype.isConnected=function(e){return e=e||{},e.readPreference&&e.readPreference.equals(Yi.secondary)?this.s.replicaSetState.hasSecondary():e.readPreference&&e.readPreference.equals(Yi.primary)?this.s.replicaSetState.hasPrimary():e.readPreference&&e.readPreference.equals(Yi.primaryPreferred)?this.s.replicaSetState.hasSecondary()||this.s.replicaSetState.hasPrimary():e.readPreference&&e.readPreference.equals(Yi.secondaryPreferred)?this.s.replicaSetState.hasSecondary()||this.s.replicaSetState.hasPrimary():this.s.options.secondaryOnlyConnectionAllowed&&this.s.replicaSetState.hasSecondary()?!0:this.s.replicaSetState.hasPrimary()};kt.prototype.isDestroyed=function(){return this.state===Lt};var nX=1e4,gM=1e3;kt.prototype.selectServer=function(e,t,r){typeof e=="function"&&typeof r>"u"&&(r=e,e=void 0,t={}),typeof t=="function"&&(r=t,t=e),t=t||{};let n;e instanceof Yi?n=e:n=t.readPreference||Yi.primary;let i,s=bM(),o=()=>{if(XJ(s)>=nX){i!=null?r(i,null):r(new Pn("Server selection timed out"));return}let a=this.s.replicaSetState.pickServer(n);if(a==null){setTimeout(o,gM);return}if(!(a instanceof vd)){i=a,setTimeout(o,gM);return}this.s.debug&&this.emit("pickedServer",t.readPreference,a),r(null,a)};o()};kt.prototype.getServers=function(){return this.s.replicaSetState.allServers()};function Sd(e,t,r){typeof t=="function"&&(r=t,t={}),t=t||{};let n=e.self,i=e.op,s=e.ns,o=e.ops;if(n.state===Lt)return r(new Pn(Ji("topology was destroyed")));let a=!e.retrying&&!!t.retryWrites&&t.session&&vM(n)&&!t.session.inTransaction()&&t.explain===void 0;if(!n.s.replicaSetState.hasPrimary()){if(n.s.disconnectHandler)return n.s.disconnectHandler.add(i,s,o,t,r);if(!a)return r(new Pn("no primary server found"))}let u=(c,f)=>{if(!c)return r(null,f);if(!OM(c,n))return c=YJ(c),r(c);if(a){let h=Object.assign({},e,{retrying:!0});return Sd(h,t,r)}return n.s.replicaSetState.primary&&(n.s.replicaSetState.primary.destroy(),n.s.replicaSetState.remove(n.s.replicaSetState.primary,{force:!0})),r(c)};r.operationId&&(u.operationId=r.operationId),a&&(t.session.incrementTransactionNumber(),t.willRetryWrite=a),n.s.replicaSetState.primary[i](s,o,t,u)}kt.prototype.insert=function(e,t,r,n){Sd({self:this,op:"insert",ns:e,ops:t},r,n)};kt.prototype.update=function(e,t,r,n){Sd({self:this,op:"update",ns:e,ops:t},r,n)};kt.prototype.remove=function(e,t,r,n){Sd({self:this,op:"remove",ns:e,ops:t},r,n)};var iX=["findAndModify","insert","update","delete"];function sX(e){return iX.some(t=>e[t])}kt.prototype.command=function(e,t,r,n){if(typeof r=="function"&&(n=r,r={},r=r||{}),this.state===Lt)return n(new Pn(Ji("topology was destroyed")));var i=this,s=r.readPreference?r.readPreference:Yi.primary;if(s.preference==="primary"&&!this.s.replicaSetState.hasPrimary()&&this.s.disconnectHandler!=null)return this.s.disconnectHandler.add("command",e,t,r,n);if(s.preference==="secondary"&&!this.s.replicaSetState.hasSecondary()&&this.s.disconnectHandler!=null)return this.s.disconnectHandler.add("command",e,t,r,n);if(s.preference!=="primary"&&!this.s.replicaSetState.hasSecondary()&&!this.s.replicaSetState.hasPrimary()&&this.s.disconnectHandler!=null)return this.s.disconnectHandler.add("command",e,t,r,n);var o=this.s.replicaSetState.pickServer(s);if(!(o instanceof vd))return n(o);if(i.s.debug&&i.emit("pickedServer",Yi.primary,o),o==null)return n(new Pn(Ji("no server found that matches the provided readPreference %s",s)));let a=!r.retrying&&!!r.retryWrites&&r.session&&vM(i)&&!r.session.inTransaction()&&sX(t),u=(c,f)=>{if(!c)return n(null,f);if(!OM(c,i))return n(c);if(a){let h=Object.assign({},r,{retrying:!0});return this.command(e,t,h,n)}return this.s.replicaSetState.primary&&(this.s.replicaSetState.primary.destroy(),this.s.replicaSetState.remove(this.s.replicaSetState.primary,{force:!0})),n(c)};a&&(r.session.incrementTransactionNumber(),r.willRetryWrite=a),o.command(e,t,r,u)};kt.prototype.cursor=function(e,t,r){r=r||{};let n=r.topology||this;var i=r.cursorFactory||this.s.Cursor;return new i(n,e,t,r)};CM.exports=kt});var RM=_((PTe,IM)=>{"use strict";var oX=require("util").inherits,Gs=require("util").format,xM=require("events").EventEmitter,aX=$n().CoreCursor,uX=Mn(),cX=Yt().retrieveBSON,Dn=se().MongoError,qM=md(),lX=xt().diff,fX=xt().cloneOptions,hX=xt().SessionMixins,MM=xt().isRetryableWritesSupported,bd=he().relayEvents,Sr=cX(),dX=xt().getMMAPError,pX=he().makeClientMetadata,NM=xt().legacyIsRetryableWriteError,Od="disconnected",uu="connecting",nv="connected",In="unreferenced",Dr="destroying",Mt="destroyed";function fl(e,t){var r={disconnected:[uu,Dr,Mt,Od],connecting:[uu,Dr,Mt,nv,Od],connected:[nv,Od,Dr,Mt,In],unreferenced:[In,Dr,Mt],destroyed:[Mt]},n=r[e.state];n&&n.indexOf(t)!==-1?e.state=t:e.s.logger.error(Gs("Mongos with id [%s] failed attempted illegal state transition from [%s] to [%s] only following state allowed [%s]",e.id,e.state,t,n))}var mX=1,Ed=["connect","close","error","timeout","parseError"],Wt=function(e,t){t=t||{},this.id=mX++,Array.isArray(e)&&(e=e.reduce((r,n)=>(r.find(i=>i.host===n.host&&i.port===n.port)||r.push(n),r),[])),this.s={options:Object.assign({metadata:pX(t)},t),bson:t.bson||new Sr([Sr.Binary,Sr.Code,Sr.DBRef,Sr.Decimal128,Sr.Double,Sr.Int32,Sr.Long,Sr.Map,Sr.MaxKey,Sr.MinKey,Sr.ObjectId,Sr.BSONRegExp,Sr.Symbol,Sr.Timestamp]),Cursor:t.cursorFactory||aX,logger:uX("Mongos",t),seedlist:e,haInterval:t.haInterval?t.haInterval:1e4,disconnectHandler:t.disconnectHandler,index:0,connectOptions:{},debug:typeof t.debug=="boolean"?t.debug:!1,localThresholdMS:t.localThresholdMS||15},this.s.logger.isWarn()&&this.s.options.socketTimeout!==0&&this.s.options.socketTimeout<this.s.haInterval&&this.s.logger.warn(Gs("warning socketTimeout %s is less than haInterval %s. This might cause unnecessary server reconnections due to socket timeouts",this.s.options.socketTimeout,this.s.haInterval)),this.state=Od,this.connectingProxies=[],this.connectedProxies=[],this.disconnectedProxies=[],this.index=0,this.haTimeoutId=null,this.ismaster=null,this.topologyDescription={topologyType:"Unknown",servers:[]},this.clusterTime=null,xM.call(this)};oX(Wt,xM);Object.assign(Wt.prototype,hX);Object.defineProperty(Wt.prototype,"type",{enumerable:!0,get:function(){return"mongos"}});Object.defineProperty(Wt.prototype,"parserType",{enumerable:!0,get:function(){return Sr.native?"c++":"js"}});Object.defineProperty(Wt.prototype,"logicalSessionTimeoutMinutes",{enumerable:!0,get:function(){return this.ismaster&&this.ismaster.logicalSessionTimeoutMinutes||null}});function ll(e,t,r){e.listeners(t).length>0&&e.emit(t,r)}var yX=["serverDescriptionChanged","error","close","timeout","parseError"];function $M(e,t,r){t=t||{},yX.forEach(n=>e.removeAllListeners(n)),e.destroy(t,r)}Wt.prototype.connect=function(e){var t=this;this.s.connectOptions=e||{},fl(this,uu);var r=this.s.seedlist.map(function(n){let i=new qM(Object.assign({},t.s.options,n,e,{reconnect:!1,monitoring:!1,parent:t}));return bd(i,t,["serverDescriptionChanged"]),i});ll(this,"topologyOpening",{topologyId:this.id}),gX(t,r)};Wt.prototype.auth=function(e,t){typeof t=="function"&&t(null,null)};function Ks(e){return function(){e.state===Mt||e.state===Dr||(Rn(e.connectedProxies,e.disconnectedProxies,this),Ko(e),e.emit("left","mongos",this),e.emit("serverClosed",{topologyId:e.id,address:this.name}))}}function cl(e,t){return function(){var r=this;if(e.state===Mt)return Ko(e),Rn(e.connectingProxies,e.disconnectedProxies,this),this.destroy();if(t==="connect")if(e.ismaster=r.lastIsMaster(),e.ismaster.msg==="isdbgrid"){for(let i=0;i<e.connectedProxies.length;i++)if(e.connectedProxies[i].name===r.name)return Rn(e.connectingProxies,e.disconnectedProxies,r),Ko(e),r.destroy(),e.emit("failed",r);for(let i=0;i<Ed.length;i++)r.removeAllListeners(Ed[i]);r.on("error",Ks(e,"error")),r.on("close",Ks(e,"close")),r.on("timeout",Ks(e,"timeout")),r.on("parseError",Ks(e,"parseError")),Rn(e.connectingProxies,e.connectedProxies,r),e.emit("joined","mongos",r)}else{if(e.s.logger.isWarn()){var n="expected mongos proxy, but found replicaset member mongod for server %s";e.ismaster.hosts||(n="expected mongos proxy, but found standalone mongod for server %s"),e.s.logger.warn(Gs(n,r.name))}r.destroy(!0),PM(e.connectingProxies,r),e.emit("left","server",r),e.emit("failed",r)}else Rn(e.connectingProxies,e.disconnectedProxies,this),e.emit("left","mongos",this),e.emit("failed",this);if(Ko(e),e.connectingProxies.length===0){if(e.connectedProxies.length>0&&e.state===uu)fl(e,nv),e.emit("connect",e),e.emit("fullsetup",e),e.emit("all",e);else if(e.disconnectedProxies.length===0)return e.s.logger.isWarn()&&e.s.logger.warn(Gs("no mongos proxies found in seed list, did you mean to connect to a replicaset")),e.emit("error",new Dn("no mongos proxies found in seed list"));iv(e,{firstConnect:!0})}}}function gX(e,t){e.connectingProxies=e.connectingProxies.concat(t);var r=0;function n(i,s){setTimeout(function(){e.emit("serverOpening",{topologyId:e.id,address:i.name}),Ko(e),i.once("close",cl(e,"close")),i.once("timeout",cl(e,"timeout")),i.once("parseError",cl(e,"parseError")),i.once("error",cl(e,"error")),i.once("connect",cl(e,"connect")),bd(i,e,["commandStarted","commandSucceeded","commandFailed"]),i.connect(e.s.connectOptions)},s)}t.forEach(i=>n(i,r++))}function Cd(e,t){let r=t&&t.transaction;if(r&&r.server){if(r.server.isConnected())return r.server;r.unpinServer()}for(var n=e.connectedProxies.slice(0),i=Number.MAX_VALUE,s=0;s<n.length;s++)n[s].lastIsMasterMS<i&&(i=n[s].lastIsMasterMS);n=n.filter(function(a){if(a.lastIsMasterMS<=i+e.s.localThresholdMS&&a.isConnected())return!0});let o;return n.length===0?o=e.connectedProxies[0]:(o=n[e.index%n.length],e.index=(e.index+1)%n.length),r&&r.isActive&&o&&o.isConnected()&&r.pinServer(o),o}function Rn(e,t,r){for(var n=0;n<e.length;n++)e[n].name===r.name&&e.splice(n,1);for(n=0;n<t.length;n++)t[n].name===r.name&&t.splice(n,1);t.push(r)}function PM(e,t){for(var r=0;r<e.length;r++)e[r].name===t.name&&e.splice(r,1)}function AM(e,t,r){var n=t.length,i=function(a,u){return function(){var c=this;if(n=n-1,a.state===Mt||a.state===Dr||a.state===In)return Rn(a.connectingProxies,a.disconnectedProxies,c),this.destroy();if(u==="connect"){if(a.state===Mt||a.state===Dr||a.state===In)return Rn(a.connectingProxies,a.disconnectedProxies,c),c.destroy();for(var f=0;f<Ed.length;f++)c.removeAllListeners(Ed[f]);c.on("error",Ks(a,"error")),c.on("close",Ks(a,"close")),c.on("timeout",Ks(a,"timeout")),c.on("parseError",Ks(a,"parseError")),Rn(a.connectingProxies,a.connectedProxies,c),Ko(a),a.emit("joined","mongos",c)}else Rn(a.connectingProxies,a.disconnectedProxies,c),this.destroy();n===0&&r()}};if(n===0)return r();function s(a,u){setTimeout(function(){if(!(e.state===Mt||e.state===Dr||e.state===In)){var c=new qM(Object.assign({},e.s.options,{host:a.name.split(":")[0],port:parseInt(a.name.split(":")[1],10),reconnect:!1,monitoring:!1,parent:e}));$M(a,{force:!0}),PM(e.disconnectedProxies,a),bd(c,e,["serverDescriptionChanged"]),e.emit("serverOpening",{topologyId:c.s.topologyId!==-1?c.s.topologyId:e.id,address:c.name}),c.once("connect",i(e,"connect")),c.once("close",i(e,"close")),c.once("timeout",i(e,"timeout")),c.once("error",i(e,"error")),c.once("parseError",i(e,"parseError")),bd(c,e,["commandStarted","commandSucceeded","commandFailed"]),e.connectingProxies.push(c),c.connect(e.s.connectOptions)}},u)}for(var o=0;o<t.length;o++)s(t[o],o)}function iv(e,t){t=t||{},!(e.state===Mt||e.state===Dr||e.state===In)&&(e.haTimeoutId=setTimeout(function(){if(e.state===Mt||e.state===Dr||e.state===In)return;e.isConnected()&&e.s.disconnectHandler&&e.s.disconnectHandler.execute();var r=e.connectedProxies.slice(0),n=r.length;function i(o,a,u){var c=new Date().getTime();ll(e,"serverHeartbeatStarted",{connectionId:a.name}),a.command("admin.$cmd",{ismaster:!0},{monitoring:!0,socketTimeout:e.s.options.connectionTimeout||2e3},function(f,h){if(e.state===Mt||e.state===Dr||e.state===In)return Rn(e.connectedProxies,e.disconnectedProxies,a),a.destroy(),u(f,h);var d=new Date().getTime()-c;f?(ll(e,"serverHeartbeatFailed",{durationMS:d,failure:f,connectionId:a.name}),Rn(e.connectedProxies,e.disconnectedProxies,a)):(a.ismaster=h.result,a.lastIsMasterMS=d,ll(e,"serverHeartbeatSucceeded",{durationMS:d,reply:h.result,connectionId:a.name})),u(f,h)})}if(r.length===0)return e.listeners("close").length>0&&e.state===uu?e.emit("error",new Dn("no mongos proxy available")):e.emit("close",e),AM(e,e.disconnectedProxies,function(){e.state===Mt||e.state===Dr||e.state===In||(e.state===uu&&t.firstConnect?(e.emit("connect",e),e.emit("fullsetup",e),e.emit("all",e)):e.isConnected()?e.emit("reconnect",e):!e.isConnected()&&e.listeners("close").length>0&&e.emit("close",e),iv(e))});for(var s=0;s<r.length;s++)i(e,r[s],function(){if(n=n-1,n===0){if(e.state===Mt||e.state===Dr||e.state===In)return;AM(e,e.disconnectedProxies,function(){e.state===Mt||e.state===Dr||e.state===In||iv(e)})}})},e.s.haInterval))}Wt.prototype.lastIsMaster=function(){return this.ismaster};Wt.prototype.unref=function(){fl(this,In);var e=this.connectedProxies.concat(this.connectingProxies);e.forEach(function(t){t.unref()}),clearTimeout(this.haTimeoutId)};Wt.prototype.destroy=function(e,t){typeof e=="function"&&(t=e,e={}),e=e||{},fl(this,Dr),this.haTimeoutId&&clearTimeout(this.haTimeoutId);let r=this.connectedProxies.concat(this.connectingProxies),n=r.length,i=()=>{n--,!(n>0)&&(Ko(this),ll(this,"topologyClosed",{topologyId:this.id}),fl(this,Mt),typeof t=="function"&&t(null,null))};if(n===0){i();return}r.forEach(s=>{this.emit("serverClosed",{topologyId:this.id,address:s.name}),$M(s,e,i),Rn(this.connectedProxies,this.disconnectedProxies,s)})};Wt.prototype.isConnected=function(){return this.connectedProxies.length>0};Wt.prototype.isDestroyed=function(){return this.state===Mt};function Td(e,t,r){typeof t=="function"&&(r=t,t={}),t=t||{};let n=e.self,i=e.op,s=e.ns,o=e.ops,a=Cd(n,t.session);if(!a)return r(new Dn("no mongos proxy available"));let u=!e.retrying&&!!t.retryWrites&&t.session&&MM(n)&&!t.session.inTransaction()&&t.explain===void 0,c=(f,h)=>{if(!f)return r(null,h);if(!NM(f,n)||!u)return f=dX(f),r(f);if(a=Cd(n,t.session),!a)return r(f);let d=Object.assign({},e,{retrying:!0});return Td(d,t,r)};r.operationId&&(c.operationId=r.operationId),u&&(t.session.incrementTransactionNumber(),t.willRetryWrite=u),a[i](s,o,t,c)}Wt.prototype.insert=function(e,t,r,n){if(typeof r=="function"&&(n=r,r={},r=r||{}),this.state===Mt)return n(new Dn(Gs("topology was destroyed")));if(!this.isConnected()&&this.s.disconnectHandler!=null)return this.s.disconnectHandler.add("insert",e,t,r,n);if(!this.isConnected())return n(new Dn("no mongos proxy available"));Td({self:this,op:"insert",ns:e,ops:t},r,n)};Wt.prototype.update=function(e,t,r,n){if(typeof r=="function"&&(n=r,r={},r=r||{}),this.state===Mt)return n(new Dn(Gs("topology was destroyed")));if(!this.isConnected()&&this.s.disconnectHandler!=null)return this.s.disconnectHandler.add("update",e,t,r,n);if(!this.isConnected())return n(new Dn("no mongos proxy available"));Td({self:this,op:"update",ns:e,ops:t},r,n)};Wt.prototype.remove=function(e,t,r,n){if(typeof r=="function"&&(n=r,r={},r=r||{}),this.state===Mt)return n(new Dn(Gs("topology was destroyed")));if(!this.isConnected()&&this.s.disconnectHandler!=null)return this.s.disconnectHandler.add("remove",e,t,r,n);if(!this.isConnected())return n(new Dn("no mongos proxy available"));Td({self:this,op:"remove",ns:e,ops:t},r,n)};var _X=["findAndModify","insert","update","delete"];function wX(e){return _X.some(t=>e[t])}Wt.prototype.command=function(e,t,r,n){if(typeof r=="function"&&(n=r,r={},r=r||{}),this.state===Mt)return n(new Dn(Gs("topology was destroyed")));var i=this,s=Cd(i,r.session);if((s==null||!s.isConnected())&&this.s.disconnectHandler!=null)return this.s.disconnectHandler.add("command",e,t,r,n);if(s==null)return n(new Dn("no mongos proxy available"));var o=fX(r);o.topology=i;let a=!r.retrying&&r.retryWrites&&r.session&&MM(i)&&!r.session.inTransaction()&&wX(t),u=(c,f)=>{if(!c)return n(null,f);if(!NM(c,i))return n(c);if(a){let h=Object.assign({},o,{retrying:!0});return this.command(e,t,h,n)}return n(c)};a&&(o.session.incrementTransactionNumber(),o.willRetryWrite=a),s.command(e,t,o,u)};Wt.prototype.cursor=function(e,t,r){r=r||{};let n=r.topology||this;var i=r.cursorFactory||this.s.Cursor;return new i(n,e,t,r)};Wt.prototype.selectServer=function(e,t,r){typeof e=="function"&&typeof r>"u"&&(r=e,e=void 0,t={}),typeof t=="function"&&(r=t,t=e,e=void 0),t=t||{};let n=Cd(this,t.session);if(n==null){r(new Dn("server selection failed"));return}this.s.debug&&this.emit("pickedServer",null,n),r(null,n)};Wt.prototype.connections=function(){for(var e=[],t=0;t<this.connectedProxies.length;t++)e=e.concat(this.connectedProxies[t].connections());return e};function Ko(e){if(e.listeners("topologyDescriptionChanged").length>0){var t="Unknown";e.connectedProxies.length>0&&(t="Sharded");var r={topologyType:t,servers:[]},n=e.disconnectedProxies.concat(e.connectingProxies);r.servers=r.servers.concat(n.map(function(o){var a=o.getDescription();return a.type="Unknown",a})),r.servers=r.servers.concat(e.connectedProxies.map(function(o){var a=o.getDescription();return a.type="Mongos",a}));var i=lX(e.topologyDescription,r),s={topologyId:e.id,previousDescription:e.topologyDescription,newDescription:r,diff:i};i.servers.length>0&&e.emit("topologyDescriptionChanged",s),e.topologyDescription=r}}IM.exports=Wt});var Ad=_((ITe,DM)=>{"use strict";function Nt(e,r){var r=r||{};this._head=0,this._tail=0,this._capacity=r.capacity,this._capacityMask=3,this._list=new Array(4),Array.isArray(e)&&this._fromArray(e)}Nt.prototype.peekAt=function(t){var r=t;if(r===(r|0)){var n=this.size();if(!(r>=n||r<-n))return r<0&&(r+=n),r=this._head+r&this._capacityMask,this._list[r]}};Nt.prototype.get=function(t){return this.peekAt(t)};Nt.prototype.peek=function(){if(this._head!==this._tail)return this._list[this._head]};Nt.prototype.peekFront=function(){return this.peek()};Nt.prototype.peekBack=function(){return this.peekAt(-1)};Object.defineProperty(Nt.prototype,"length",{get:function(){return this.size()}});Nt.prototype.size=function(){return this._head===this._tail?0:this._head<this._tail?this._tail-this._head:this._capacityMask+1-(this._head-this._tail)};Nt.prototype.unshift=function(t){if(t===void 0)return this.size();var r=this._list.length;return this._head=this._head-1+r&this._capacityMask,this._list[this._head]=t,this._tail===this._head&&this._growArray(),this._capacity&&this.size()>this._capacity&&this.pop(),this._head<this._tail?this._tail-this._head:this._capacityMask+1-(this._head-this._tail)};Nt.prototype.shift=function(){var t=this._head;if(t!==this._tail){var r=this._list[t];return this._list[t]=void 0,this._head=t+1&this._capacityMask,t<2&&this._tail>1e4&&this._tail<=this._list.length>>>2&&this._shrinkArray(),r}};Nt.prototype.push=function(t){if(t===void 0)return this.size();var r=this._tail;return this._list[r]=t,this._tail=r+1&this._capacityMask,this._tail===this._head&&this._growArray(),this._capacity&&this.size()>this._capacity&&this.shift(),this._head<this._tail?this._tail-this._head:this._capacityMask+1-(this._head-this._tail)};Nt.prototype.pop=function(){var t=this._tail;if(t!==this._head){var r=this._list.length;this._tail=t-1+r&this._capacityMask;var n=this._list[this._tail];return this._list[this._tail]=void 0,this._head<2&&t>1e4&&t<=r>>>2&&this._shrinkArray(),n}};Nt.prototype.removeOne=function(t){var r=t;if(r===(r|0)&&this._head!==this._tail){var n=this.size(),i=this._list.length;if(!(r>=n||r<-n)){r<0&&(r+=n),r=this._head+r&this._capacityMask;var s=this._list[r],o;if(t<n/2){for(o=t;o>0;o--)this._list[r]=this._list[r=r-1+i&this._capacityMask];this._list[r]=void 0,this._head=this._head+1+i&this._capacityMask}else{for(o=n-1-t;o>0;o--)this._list[r]=this._list[r=r+1+i&this._capacityMask];this._list[r]=void 0,this._tail=this._tail-1+i&this._capacityMask}return s}}};Nt.prototype.remove=function(t,r){var n=t,i,s=r;if(n===(n|0)&&this._head!==this._tail){var o=this.size(),a=this._list.length;if(!(n>=o||n<-o||r<1)){if(n<0&&(n+=o),r===1||!r)return i=new Array(1),i[0]=this.removeOne(n),i;if(n===0&&n+r>=o)return i=this.toArray(),this.clear(),i;n+r>o&&(r=o-n);var u;for(i=new Array(r),u=0;u<r;u++)i[u]=this._list[this._head+n+u&this._capacityMask];if(n=this._head+n&this._capacityMask,t+r===o){for(this._tail=this._tail-r+a&this._capacityMask,u=r;u>0;u--)this._list[n=n+1+a&this._capacityMask]=void 0;return i}if(t===0){for(this._head=this._head+r+a&this._capacityMask,u=r-1;u>0;u--)this._list[n=n+1+a&this._capacityMask]=void 0;return i}if(n<o/2){for(this._head=this._head+t+r+a&this._capacityMask,u=t;u>0;u--)this.unshift(this._list[n=n-1+a&this._capacityMask]);for(n=this._head-1+a&this._capacityMask;s>0;)this._list[n=n-1+a&this._capacityMask]=void 0,s--;t<0&&(this._tail=n)}else{for(this._tail=n,n=n+r+a&this._capacityMask,u=o-(r+t);u>0;u--)this.push(this._list[n++]);for(n=this._tail;s>0;)this._list[n=n+1+a&this._capacityMask]=void 0,s--}return this._head<2&&this._tail>1e4&&this._tail<=a>>>2&&this._shrinkArray(),i}}};Nt.prototype.splice=function(t,r){var n=t;if(n===(n|0)){var i=this.size();if(n<0&&(n+=i),!(n>i))if(arguments.length>2){var s,o,a,u=arguments.length,c=this._list.length,f=2;if(!i||n<i/2){for(o=new Array(n),s=0;s<n;s++)o[s]=this._list[this._head+s&this._capacityMask];for(r===0?(a=[],n>0&&(this._head=this._head+n+c&this._capacityMask)):(a=this.remove(n,r),this._head=this._head+n+c&this._capacityMask);u>f;)this.unshift(arguments[--u]);for(s=n;s>0;s--)this.unshift(o[s-1])}else{o=new Array(i-(n+r));var h=o.length;for(s=0;s<h;s++)o[s]=this._list[this._head+n+r+s&this._capacityMask];for(r===0?(a=[],n!=i&&(this._tail=this._head+n+c&this._capacityMask)):(a=this.remove(n,r),this._tail=this._tail-h+c&this._capacityMask);f<u;)this.push(arguments[f++]);for(s=0;s<h;s++)this.push(o[s])}return a}else return this.remove(n,r)}};Nt.prototype.clear=function(){this._head=0,this._tail=0};Nt.prototype.isEmpty=function(){return this._head===this._tail};Nt.prototype.toArray=function(){return this._copyArray(!1)};Nt.prototype._fromArray=function(t){for(var r=0;r<t.length;r++)this.push(t[r])};Nt.prototype._copyArray=function(t){var r=[],n=this._list,i=n.length,s;if(t||this._head>this._tail){for(s=this._head;s<i;s++)r.push(n[s]);for(s=0;s<this._tail;s++)r.push(n[s])}else for(s=this._head;s<this._tail;s++)r.push(n[s]);return r};Nt.prototype._growArray=function(){this._head&&(this._list=this._copyArray(!0),this._head=0),this._tail=this._list.length,this._list.length<<=1,this._capacityMask=this._capacityMask<<1|1};Nt.prototype._shrinkArray=function(){this._list.length>>>=1,this._capacityMask>>>=1};DM.exports=Nt});var pv=_((RTe,jM)=>{"use strict";var sv=class{constructor(t,r,n,i){Object.assign(this,{topologyId:t,address:r,previousDescription:n,newDescription:i})}},ov=class{constructor(t,r){Object.assign(this,{topologyId:t,address:r})}},av=class{constructor(t,r){Object.assign(this,{topologyId:t,address:r})}},uv=class{constructor(t,r,n){Object.assign(this,{topologyId:t,previousDescription:r,newDescription:n})}},cv=class{constructor(t){Object.assign(this,{topologyId:t})}},lv=class{constructor(t){Object.assign(this,{topologyId:t})}},fv=class{constructor(t){Object.assign(this,{connectionId:t})}},hv=class{constructor(t,r,n){Object.assign(this,{connectionId:n,duration:t,reply:r})}},dv=class{constructor(t,r,n){Object.assign(this,{connectionId:n,duration:t,failure:r})}};jM.exports={ServerDescriptionChangedEvent:sv,ServerOpeningEvent:ov,ServerClosedEvent:av,TopologyDescriptionChangedEvent:uv,TopologyOpeningEvent:cv,TopologyClosedEvent:lv,ServerHeartbeatStartedEvent:fv,ServerHeartbeatSucceededEvent:hv,ServerHeartbeatFailedEvent:dv}});var hl=_((DTe,mv)=>{"use strict";typeof process>"u"||!process.version||process.version.indexOf("v0.")===0||process.version.indexOf("v1.")===0&&process.version.indexOf("v1.8.")!==0?mv.exports={nextTick:vX}:mv.exports=process;function vX(e,t,r,n){if(typeof e!="function")throw new TypeError('"callback" argument must be a function');var i=arguments.length,s,o;switch(i){case 0:case 1:return process.nextTick(e);case 2:return process.nextTick(function(){e.call(null,t)});case 3:return process.nextTick(function(){e.call(null,t,r)});case 4:return process.nextTick(function(){e.call(null,t,r,n)});default:for(s=new Array(i-1),o=0;o<s.length;)s[o++]=arguments[o];return process.nextTick(function(){e.apply(null,s)})}}});var LM=_((jTe,BM)=>{var SX={}.toString;BM.exports=Array.isArray||function(e){return SX.call(e)=="[object Array]"}});var yv=_((BTe,kM)=>{kM.exports=require("stream")});var cu=_(Or=>{function OX(e){return Array.isArray?Array.isArray(e):xd(e)==="[object Array]"}Or.isArray=OX;function bX(e){return typeof e=="boolean"}Or.isBoolean=bX;function EX(e){return e===null}Or.isNull=EX;function CX(e){return e==null}Or.isNullOrUndefined=CX;function TX(e){return typeof e=="number"}Or.isNumber=TX;function AX(e){return typeof e=="string"}Or.isString=AX;function xX(e){return typeof e=="symbol"}Or.isSymbol=xX;function qX(e){return e===void 0}Or.isUndefined=qX;function MX(e){return xd(e)==="[object RegExp]"}Or.isRegExp=MX;function NX(e){return typeof e=="object"&&e!==null}Or.isObject=NX;function $X(e){return xd(e)==="[object Date]"}Or.isDate=$X;function PX(e){return xd(e)==="[object Error]"||e instanceof Error}Or.isError=PX;function IX(e){return typeof e=="function"}Or.isFunction=IX;function RX(e){return e===null||typeof e=="boolean"||typeof e=="number"||typeof e=="string"||typeof e=="symbol"||typeof e>"u"}Or.isPrimitive=RX;Or.isBuffer=require("buffer").Buffer.isBuffer;function xd(e){return Object.prototype.toString.call(e)}});var FM=_((kTe,gv)=>{typeof Object.create=="function"?gv.exports=function(t,r){r&&(t.super_=r,t.prototype=Object.create(r.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}))}:gv.exports=function(t,r){if(r){t.super_=r;var n=function(){};n.prototype=r.prototype,t.prototype=new n,t.prototype.constructor=t}}});var lu=_((FTe,wv)=>{try{if(_v=require("util"),typeof _v.inherits!="function")throw"";wv.exports=_v.inherits}catch{wv.exports=FM()}var _v});var VM=_((UTe,vv)=>{"use strict";function DX(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var UM=jt().Buffer,dl=require("util");function jX(e,t,r){e.copy(t,r)}vv.exports=function(){function e(){DX(this,e),this.head=null,this.tail=null,this.length=0}return e.prototype.push=function(r){var n={data:r,next:null};this.length>0?this.tail.next=n:this.head=n,this.tail=n,++this.length},e.prototype.unshift=function(r){var n={data:r,next:this.head};this.length===0&&(this.tail=n),this.head=n,++this.length},e.prototype.shift=function(){if(this.length!==0){var r=this.head.data;return this.length===1?this.head=this.tail=null:this.head=this.head.next,--this.length,r}},e.prototype.clear=function(){this.head=this.tail=null,this.length=0},e.prototype.join=function(r){if(this.length===0)return"";for(var n=this.head,i=""+n.data;n=n.next;)i+=r+n.data;return i},e.prototype.concat=function(r){if(this.length===0)return UM.alloc(0);if(this.length===1)return this.head.data;for(var n=UM.allocUnsafe(r>>>0),i=this.head,s=0;i;)jX(i.data,n,s),s+=i.data.length,i=i.next;return n},e}();dl&&dl.inspect&&dl.inspect.custom&&(vv.exports.prototype[dl.inspect.custom]=function(){var e=dl.inspect({length:this.length});return this.constructor.name+" "+e})});var Sv=_((VTe,HM)=>{"use strict";var WM=hl();function BX(e,t){var r=this,n=this._readableState&&this._readableState.destroyed,i=this._writableState&&this._writableState.destroyed;return n||i?(t?t(e):e&&(!this._writableState||!this._writableState.errorEmitted)&&WM.nextTick(zM,this,e),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(e||null,function(s){!t&&s?(WM.nextTick(zM,r,s),r._writableState&&(r._writableState.errorEmitted=!0)):t&&t(s)}),this)}function LX(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)}function zM(e,t){e.emit("error",t)}HM.exports={destroy:BX,undestroy:LX}});var GM=_((WTe,KM)=>{KM.exports=require("util").deprecate});var bv=_((zTe,rN)=>{"use strict";var Go=hl();rN.exports=zt;function YM(e){var t=this;this.next=null,this.entry=null,this.finish=function(){nZ(t,e)}}var kX=!process.browser&&["v0.10","v0.9."].indexOf(process.version.slice(0,5))>-1?setImmediate:Go.nextTick,fu;zt.WritableState=ml;var JM=Object.create(cu());JM.inherits=lu();var FX={deprecate:GM()},XM=yv(),Md=jt().Buffer,UX=global.Uint8Array||function(){};function VX(e){return Md.from(e)}function WX(e){return Md.isBuffer(e)||e instanceof UX}var ZM=Sv();JM.inherits(zt,XM);function zX(){}function ml(e,t){fu=fu||Qo(),e=e||{};var r=t instanceof fu;this.objectMode=!!e.objectMode,r&&(this.objectMode=this.objectMode||!!e.writableObjectMode);var n=e.highWaterMark,i=e.writableHighWaterMark,s=this.objectMode?16:16*1024;n||n===0?this.highWaterMark=n:r&&(i||i===0)?this.highWaterMark=i:this.highWaterMark=s,this.highWaterMark=Math.floor(this.highWaterMark),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var o=e.decodeStrings===!1;this.decodeStrings=!o,this.defaultEncoding=e.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(a){XX(t,a)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.bufferedRequestCount=0,this.corkedRequestsFree=new YM(this)}ml.prototype.getBuffer=function(){for(var t=this.bufferedRequest,r=[];t;)r.push(t),t=t.next;return r};(function(){try{Object.defineProperty(ml.prototype,"buffer",{get:FX.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch{}})();var qd;typeof Symbol=="function"&&Symbol.hasInstance&&typeof Function.prototype[Symbol.hasInstance]=="function"?(qd=Function.prototype[Symbol.hasInstance],Object.defineProperty(zt,Symbol.hasInstance,{value:function(e){return qd.call(this,e)?!0:this!==zt?!1:e&&e._writableState instanceof ml}})):qd=function(e){return e instanceof this};function zt(e){if(fu=fu||Qo(),!qd.call(zt,this)&&!(this instanceof fu))return new zt(e);this._writableState=new ml(e,this),this.writable=!0,e&&(typeof e.write=="function"&&(this._write=e.write),typeof e.writev=="function"&&(this._writev=e.writev),typeof e.destroy=="function"&&(this._destroy=e.destroy),typeof e.final=="function"&&(this._final=e.final)),XM.call(this)}zt.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe, not readable"))};function HX(e,t){var r=new Error("write after end");e.emit("error",r),Go.nextTick(t,r)}function KX(e,t,r,n){var i=!0,s=!1;return r===null?s=new TypeError("May not write null values to stream"):typeof r!="string"&&r!==void 0&&!t.objectMode&&(s=new TypeError("Invalid non-string/buffer chunk")),s&&(e.emit("error",s),Go.nextTick(n,s),i=!1),i}zt.prototype.write=function(e,t,r){var n=this._writableState,i=!1,s=!n.objectMode&&WX(e);return s&&!Md.isBuffer(e)&&(e=VX(e)),typeof t=="function"&&(r=t,t=null),s?t="buffer":t||(t=n.defaultEncoding),typeof r!="function"&&(r=zX),n.ended?HX(this,r):(s||KX(this,n,e,r))&&(n.pendingcb++,i=QX(this,n,s,e,t,r)),i};zt.prototype.cork=function(){var e=this._writableState;e.corked++};zt.prototype.uncork=function(){var e=this._writableState;e.corked&&(e.corked--,!e.writing&&!e.corked&&!e.finished&&!e.bufferProcessing&&e.bufferedRequest&&eN(this,e))};zt.prototype.setDefaultEncoding=function(t){if(typeof t=="string"&&(t=t.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((t+"").toLowerCase())>-1))throw new TypeError("Unknown encoding: "+t);return this._writableState.defaultEncoding=t,this};function GX(e,t,r){return!e.objectMode&&e.decodeStrings!==!1&&typeof t=="string"&&(t=Md.from(t,r)),t}Object.defineProperty(zt.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}});function QX(e,t,r,n,i,s){if(!r){var o=GX(t,n,i);n!==o&&(r=!0,i="buffer",n=o)}var a=t.objectMode?1:n.length;t.length+=a;var u=t.length<t.highWaterMark;if(u||(t.needDrain=!0),t.writing||t.corked){var c=t.lastBufferedRequest;t.lastBufferedRequest={chunk:n,encoding:i,isBuf:r,callback:s,next:null},c?c.next=t.lastBufferedRequest:t.bufferedRequest=t.lastBufferedRequest,t.bufferedRequestCount+=1}else Ov(e,t,!1,a,n,i,s);return u}function Ov(e,t,r,n,i,s,o){t.writelen=n,t.writecb=o,t.writing=!0,t.sync=!0,r?e._writev(i,t.onwrite):e._write(i,s,t.onwrite),t.sync=!1}function YX(e,t,r,n,i){--t.pendingcb,r?(Go.nextTick(i,n),Go.nextTick(pl,e,t),e._writableState.errorEmitted=!0,e.emit("error",n)):(i(n),e._writableState.errorEmitted=!0,e.emit("error",n),pl(e,t))}function JX(e){e.writing=!1,e.writecb=null,e.length-=e.writelen,e.writelen=0}function XX(e,t){var r=e._writableState,n=r.sync,i=r.writecb;if(JX(r),t)YX(e,r,n,t,i);else{var s=tN(r);!s&&!r.corked&&!r.bufferProcessing&&r.bufferedRequest&&eN(e,r),n?kX(QM,e,r,s,i):QM(e,r,s,i)}}function QM(e,t,r,n){r||ZX(e,t),t.pendingcb--,n(),pl(e,t)}function ZX(e,t){t.length===0&&t.needDrain&&(t.needDrain=!1,e.emit("drain"))}function eN(e,t){t.bufferProcessing=!0;var r=t.bufferedRequest;if(e._writev&&r&&r.next){var n=t.bufferedRequestCount,i=new Array(n),s=t.corkedRequestsFree;s.entry=r;for(var o=0,a=!0;r;)i[o]=r,r.isBuf||(a=!1),r=r.next,o+=1;i.allBuffers=a,Ov(e,t,!0,t.length,i,"",s.finish),t.pendingcb++,t.lastBufferedRequest=null,s.next?(t.corkedRequestsFree=s.next,s.next=null):t.corkedRequestsFree=new YM(t),t.bufferedRequestCount=0}else{for(;r;){var u=r.chunk,c=r.encoding,f=r.callback,h=t.objectMode?1:u.length;if(Ov(e,t,!1,h,u,c,f),r=r.next,t.bufferedRequestCount--,t.writing)break}r===null&&(t.lastBufferedRequest=null)}t.bufferedRequest=r,t.bufferProcessing=!1}zt.prototype._write=function(e,t,r){r(new Error("_write() is not implemented"))};zt.prototype._writev=null;zt.prototype.end=function(e,t,r){var n=this._writableState;typeof e=="function"?(r=e,e=null,t=null):typeof t=="function"&&(r=t,t=null),e!=null&&this.write(e,t),n.corked&&(n.corked=1,this.uncork()),!n.ending&&!n.finished&&rZ(this,n,r)};function tN(e){return e.ending&&e.length===0&&e.bufferedRequest===null&&!e.finished&&!e.writing}function eZ(e,t){e._final(function(r){t.pendingcb--,r&&e.emit("error",r),t.prefinished=!0,e.emit("prefinish"),pl(e,t)})}function tZ(e,t){!t.prefinished&&!t.finalCalled&&(typeof e._final=="function"?(t.pendingcb++,t.finalCalled=!0,Go.nextTick(eZ,e,t)):(t.prefinished=!0,e.emit("prefinish")))}function pl(e,t){var r=tN(t);return r&&(tZ(e,t),t.pendingcb===0&&(t.finished=!0,e.emit("finish"))),r}function rZ(e,t,r){t.ending=!0,pl(e,t),r&&(t.finished?Go.nextTick(r):e.once("finish",r)),t.ended=!0,e.writable=!1}function nZ(e,t,r){var n=e.entry;for(e.entry=null;n;){var i=n.callback;t.pendingcb--,i(r),n=n.next}t.corkedRequestsFree?t.corkedRequestsFree.next=e:t.corkedRequestsFree=e}Object.defineProperty(zt.prototype,"destroyed",{get:function(){return this._writableState===void 0?!1:this._writableState.destroyed},set:function(e){!this._writableState||(this._writableState.destroyed=e)}});zt.prototype.destroy=ZM.destroy;zt.prototype._undestroy=ZM.undestroy;zt.prototype._destroy=function(e,t){this.end(),t(e)}});var Qo=_((HTe,oN)=>{"use strict";var nN=hl(),iZ=Object.keys||function(e){var t=[];for(var r in e)t.push(r);return t};oN.exports=Xi;var iN=Object.create(cu());iN.inherits=lu();var sN=Tv(),Cv=bv();iN.inherits(Xi,sN);for(Ev=iZ(Cv.prototype),Nd=0;Nd<Ev.length;Nd++)$d=Ev[Nd],Xi.prototype[$d]||(Xi.prototype[$d]=Cv.prototype[$d]);var Ev,$d,Nd;function Xi(e){if(!(this instanceof Xi))return new Xi(e);sN.call(this,e),Cv.call(this,e),e&&e.readable===!1&&(this.readable=!1),e&&e.writable===!1&&(this.writable=!1),this.allowHalfOpen=!0,e&&e.allowHalfOpen===!1&&(this.allowHalfOpen=!1),this.once("end",sZ)}Object.defineProperty(Xi.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}});function sZ(){this.allowHalfOpen||this._writableState.ended||nN.nextTick(oZ,this)}function oZ(e){e.end()}Object.defineProperty(Xi.prototype,"destroyed",{get:function(){return this._readableState===void 0||this._writableState===void 0?!1:this._readableState.destroyed&&this._writableState.destroyed},set:function(e){this._readableState===void 0||this._writableState===void 0||(this._readableState.destroyed=e,this._writableState.destroyed=e)}});Xi.prototype._destroy=function(e,t){this.push(null),this.end(),nN.nextTick(t,e)}});var qv=_(uN=>{"use strict";var xv=jt().Buffer,aN=xv.isEncoding||function(e){switch(e=""+e,e&&e.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function aZ(e){if(!e)return"utf8";for(var t;;)switch(e){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return e;default:if(t)return;e=(""+e).toLowerCase(),t=!0}}function uZ(e){var t=aZ(e);if(typeof t!="string"&&(xv.isEncoding===aN||!aN(e)))throw new Error("Unknown encoding: "+e);return t||e}uN.StringDecoder=yl;function yl(e){this.encoding=uZ(e);var t;switch(this.encoding){case"utf16le":this.text=pZ,this.end=mZ,t=4;break;case"utf8":this.fillLast=fZ,t=4;break;case"base64":this.text=yZ,this.end=gZ,t=3;break;default:this.write=_Z,this.end=wZ;return}this.lastNeed=0,this.lastTotal=0,this.lastChar=xv.allocUnsafe(t)}yl.prototype.write=function(e){if(e.length===0)return"";var t,r;if(this.lastNeed){if(t=this.fillLast(e),t===void 0)return"";r=this.lastNeed,this.lastNeed=0}else r=0;return r<e.length?t?t+this.text(e,r):this.text(e,r):t||""};yl.prototype.end=dZ;yl.prototype.text=hZ;yl.prototype.fillLast=function(e){if(this.lastNeed<=e.length)return e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,e.length),this.lastNeed-=e.length};function Av(e){return e<=127?0:e>>5===6?2:e>>4===14?3:e>>3===30?4:e>>6===2?-1:-2}function cZ(e,t,r){var n=t.length-1;if(n<r)return 0;var i=Av(t[n]);return i>=0?(i>0&&(e.lastNeed=i-1),i):--n<r||i===-2?0:(i=Av(t[n]),i>=0?(i>0&&(e.lastNeed=i-2),i):--n<r||i===-2?0:(i=Av(t[n]),i>=0?(i>0&&(i===2?i=0:e.lastNeed=i-3),i):0))}function lZ(e,t,r){if((t[0]&192)!==128)return e.lastNeed=0,"\uFFFD";if(e.lastNeed>1&&t.length>1){if((t[1]&192)!==128)return e.lastNeed=1,"\uFFFD";if(e.lastNeed>2&&t.length>2&&(t[2]&192)!==128)return e.lastNeed=2,"\uFFFD"}}function fZ(e){var t=this.lastTotal-this.lastNeed,r=lZ(this,e,t);if(r!==void 0)return r;if(this.lastNeed<=e.length)return e.copy(this.lastChar,t,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);e.copy(this.lastChar,t,0,e.length),this.lastNeed-=e.length}function hZ(e,t){var r=cZ(this,e,t);if(!this.lastNeed)return e.toString("utf8",t);this.lastTotal=r;var n=e.length-(r-this.lastNeed);return e.copy(this.lastChar,0,n),e.toString("utf8",t,n)}function dZ(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+"\uFFFD":t}function pZ(e,t){if((e.length-t)%2===0){var r=e.toString("utf16le",t);if(r){var n=r.charCodeAt(r.length-1);if(n>=55296&&n<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1],r.slice(0,-1)}return r}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=e[e.length-1],e.toString("utf16le",t,e.length-1)}function mZ(e){var t=e&&e.length?this.write(e):"";if(this.lastNeed){var r=this.lastTotal-this.lastNeed;return t+this.lastChar.toString("utf16le",0,r)}return t}function yZ(e,t){var r=(e.length-t)%3;return r===0?e.toString("base64",t):(this.lastNeed=3-r,this.lastTotal=3,r===1?this.lastChar[0]=e[e.length-1]:(this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1]),e.toString("base64",t,e.length-r))}function gZ(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+this.lastChar.toString("base64",0,3-this.lastNeed):t}function _Z(e){return e.toString(this.encoding)}function wZ(e){return e&&e.length?this.write(e):""}});var Tv=_((QTe,vN)=>{"use strict";var du=hl();vN.exports=yt;var vZ=LM(),gl;yt.ReadableState=mN;var GTe=require("events").EventEmitter,hN=function(e,t){return e.listeners(t).length},Iv=yv(),_l=jt().Buffer,SZ=global.Uint8Array||function(){};function OZ(e){return _l.from(e)}function bZ(e){return _l.isBuffer(e)||e instanceof SZ}var dN=Object.create(cu());dN.inherits=lu();var Mv=require("util"),Je=void 0;Mv&&Mv.debuglog?Je=Mv.debuglog("stream"):Je=function(){};var EZ=VM(),pN=Sv(),hu;dN.inherits(yt,Iv);var Nv=["error","close","destroy","pause","resume"];function CZ(e,t,r){if(typeof e.prependListener=="function")return e.prependListener(t,r);!e._events||!e._events[t]?e.on(t,r):vZ(e._events[t])?e._events[t].unshift(r):e._events[t]=[r,e._events[t]]}function mN(e,t){gl=gl||Qo(),e=e||{};var r=t instanceof gl;this.objectMode=!!e.objectMode,r&&(this.objectMode=this.objectMode||!!e.readableObjectMode);var n=e.highWaterMark,i=e.readableHighWaterMark,s=this.objectMode?16:16*1024;n||n===0?this.highWaterMark=n:r&&(i||i===0)?this.highWaterMark=i:this.highWaterMark=s,this.highWaterMark=Math.floor(this.highWaterMark),this.buffer=new EZ,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.destroyed=!1,this.defaultEncoding=e.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,e.encoding&&(hu||(hu=qv().StringDecoder),this.decoder=new hu(e.encoding),this.encoding=e.encoding)}function yt(e){if(gl=gl||Qo(),!(this instanceof yt))return new yt(e);this._readableState=new mN(e,this),this.readable=!0,e&&(typeof e.read=="function"&&(this._read=e.read),typeof e.destroy=="function"&&(this._destroy=e.destroy)),Iv.call(this)}Object.defineProperty(yt.prototype,"destroyed",{get:function(){return this._readableState===void 0?!1:this._readableState.destroyed},set:function(e){!this._readableState||(this._readableState.destroyed=e)}});yt.prototype.destroy=pN.destroy;yt.prototype._undestroy=pN.undestroy;yt.prototype._destroy=function(e,t){this.push(null),t(e)};yt.prototype.push=function(e,t){var r=this._readableState,n;return r.objectMode?n=!0:typeof e=="string"&&(t=t||r.defaultEncoding,t!==r.encoding&&(e=_l.from(e,t),t=""),n=!0),yN(this,e,t,!1,n)};yt.prototype.unshift=function(e){return yN(this,e,null,!0,!1)};function yN(e,t,r,n,i){var s=e._readableState;if(t===null)s.reading=!1,qZ(e,s);else{var o;i||(o=TZ(s,t)),o?e.emit("error",o):s.objectMode||t&&t.length>0?(typeof t!="string"&&!s.objectMode&&Object.getPrototypeOf(t)!==_l.prototype&&(t=OZ(t)),n?s.endEmitted?e.emit("error",new Error("stream.unshift() after end event")):$v(e,s,t,!0):s.ended?e.emit("error",new Error("stream.push() after EOF")):(s.reading=!1,s.decoder&&!r?(t=s.decoder.write(t),s.objectMode||t.length!==0?$v(e,s,t,!1):gN(e,s)):$v(e,s,t,!1))):n||(s.reading=!1)}return AZ(s)}function $v(e,t,r,n){t.flowing&&t.length===0&&!t.sync?(e.emit("data",r),e.read(0)):(t.length+=t.objectMode?1:r.length,n?t.buffer.unshift(r):t.buffer.push(r),t.needReadable&&Pd(e)),gN(e,t)}function TZ(e,t){var r;return!bZ(t)&&typeof t!="string"&&t!==void 0&&!e.objectMode&&(r=new TypeError("Invalid non-string/buffer chunk")),r}function AZ(e){return!e.ended&&(e.needReadable||e.length<e.highWaterMark||e.length===0)}yt.prototype.isPaused=function(){return this._readableState.flowing===!1};yt.prototype.setEncoding=function(e){return hu||(hu=qv().StringDecoder),this._readableState.decoder=new hu(e),this._readableState.encoding=e,this};var cN=8388608;function xZ(e){return e>=cN?e=cN:(e--,e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,e|=e>>>16,e++),e}function lN(e,t){return e<=0||t.length===0&&t.ended?0:t.objectMode?1:e!==e?t.flowing&&t.length?t.buffer.head.data.length:t.length:(e>t.highWaterMark&&(t.highWaterMark=xZ(e)),e<=t.length?e:t.ended?t.length:(t.needReadable=!0,0))}yt.prototype.read=function(e){Je("read",e),e=parseInt(e,10);var t=this._readableState,r=e;if(e!==0&&(t.emittedReadable=!1),e===0&&t.needReadable&&(t.length>=t.highWaterMark||t.ended))return Je("read: emitReadable",t.length,t.ended),t.length===0&&t.ended?Pv(this):Pd(this),null;if(e=lN(e,t),e===0&&t.ended)return t.length===0&&Pv(this),null;var n=t.needReadable;Je("need readable",n),(t.length===0||t.length-e<t.highWaterMark)&&(n=!0,Je("length less than watermark",n)),t.ended||t.reading?(n=!1,Je("reading or ended",n)):n&&(Je("do read"),t.reading=!0,t.sync=!0,t.length===0&&(t.needReadable=!0),this._read(t.highWaterMark),t.sync=!1,t.reading||(e=lN(r,t)));var i;return e>0?i=_N(e,t):i=null,i===null?(t.needReadable=!0,e=0):t.length-=e,t.length===0&&(t.ended||(t.needReadable=!0),r!==e&&t.ended&&Pv(this)),i!==null&&this.emit("data",i),i};function qZ(e,t){if(!t.ended){if(t.decoder){var r=t.decoder.end();r&&r.length&&(t.buffer.push(r),t.length+=t.objectMode?1:r.length)}t.ended=!0,Pd(e)}}function Pd(e){var t=e._readableState;t.needReadable=!1,t.emittedReadable||(Je("emitReadable",t.flowing),t.emittedReadable=!0,t.sync?du.nextTick(fN,e):fN(e))}function fN(e){Je("emit readable"),e.emit("readable"),Rv(e)}function gN(e,t){t.readingMore||(t.readingMore=!0,du.nextTick(MZ,e,t))}function MZ(e,t){for(var r=t.length;!t.reading&&!t.flowing&&!t.ended&&t.length<t.highWaterMark&&(Je("maybeReadMore read 0"),e.read(0),r!==t.length);)r=t.length;t.readingMore=!1}yt.prototype._read=function(e){this.emit("error",new Error("_read() is not implemented"))};yt.prototype.pipe=function(e,t){var r=this,n=this._readableState;switch(n.pipesCount){case 0:n.pipes=e;break;case 1:n.pipes=[n.pipes,e];break;default:n.pipes.push(e);break}n.pipesCount+=1,Je("pipe count=%d opts=%j",n.pipesCount,t);var i=(!t||t.end!==!1)&&e!==process.stdout&&e!==process.stderr,s=i?a:g;n.endEmitted?du.nextTick(s):r.once("end",s),e.on("unpipe",o);function o(w,S){Je("onunpipe"),w===r&&S&&S.hasUnpiped===!1&&(S.hasUnpiped=!0,f())}function a(){Je("onend"),e.end()}var u=NZ(r);e.on("drain",u);var c=!1;function f(){Je("cleanup"),e.removeListener("close",m),e.removeListener("finish",y),e.removeListener("drain",u),e.removeListener("error",p),e.removeListener("unpipe",o),r.removeListener("end",a),r.removeListener("end",g),r.removeListener("data",d),c=!0,n.awaitDrain&&(!e._writableState||e._writableState.needDrain)&&u()}var h=!1;r.on("data",d);function d(w){Je("ondata"),h=!1;var S=e.write(w);S===!1&&!h&&((n.pipesCount===1&&n.pipes===e||n.pipesCount>1&&wN(n.pipes,e)!==-1)&&!c&&(Je("false write response, pause",r._readableState.awaitDrain),r._readableState.awaitDrain++,h=!0),r.pause())}function p(w){Je("onerror",w),g(),e.removeListener("error",p),hN(e,"error")===0&&e.emit("error",w)}CZ(e,"error",p);function m(){e.removeListener("finish",y),g()}e.once("close",m);function y(){Je("onfinish"),e.removeListener("close",m),g()}e.once("finish",y);function g(){Je("unpipe"),r.unpipe(e)}return e.emit("pipe",r),n.flowing||(Je("pipe resume"),r.resume()),e};function NZ(e){return function(){var t=e._readableState;Je("pipeOnDrain",t.awaitDrain),t.awaitDrain&&t.awaitDrain--,t.awaitDrain===0&&hN(e,"data")&&(t.flowing=!0,Rv(e))}}yt.prototype.unpipe=function(e){var t=this._readableState,r={hasUnpiped:!1};if(t.pipesCount===0)return this;if(t.pipesCount===1)return e&&e!==t.pipes?this:(e||(e=t.pipes),t.pipes=null,t.pipesCount=0,t.flowing=!1,e&&e.emit("unpipe",this,r),this);if(!e){var n=t.pipes,i=t.pipesCount;t.pipes=null,t.pipesCount=0,t.flowing=!1;for(var s=0;s<i;s++)n[s].emit("unpipe",this,r);return this}var o=wN(t.pipes,e);return o===-1?this:(t.pipes.splice(o,1),t.pipesCount-=1,t.pipesCount===1&&(t.pipes=t.pipes[0]),e.emit("unpipe",this,r),this)};yt.prototype.on=function(e,t){var r=Iv.prototype.on.call(this,e,t);if(e==="data")this._readableState.flowing!==!1&&this.resume();else if(e==="readable"){var n=this._readableState;!n.endEmitted&&!n.readableListening&&(n.readableListening=n.needReadable=!0,n.emittedReadable=!1,n.reading?n.length&&Pd(this):du.nextTick($Z,this))}return r};yt.prototype.addListener=yt.prototype.on;function $Z(e){Je("readable nexttick read 0"),e.read(0)}yt.prototype.resume=function(){var e=this._readableState;return e.flowing||(Je("resume"),e.flowing=!0,PZ(this,e)),this};function PZ(e,t){t.resumeScheduled||(t.resumeScheduled=!0,du.nextTick(IZ,e,t))}function IZ(e,t){t.reading||(Je("resume read 0"),e.read(0)),t.resumeScheduled=!1,t.awaitDrain=0,e.emit("resume"),Rv(e),t.flowing&&!t.reading&&e.read(0)}yt.prototype.pause=function(){return Je("call pause flowing=%j",this._readableState.flowing),this._readableState.flowing!==!1&&(Je("pause"),this._readableState.flowing=!1,this.emit("pause")),this};function Rv(e){var t=e._readableState;for(Je("flow",t.flowing);t.flowing&&e.read()!==null;);}yt.prototype.wrap=function(e){var t=this,r=this._readableState,n=!1;e.on("end",function(){if(Je("wrapped end"),r.decoder&&!r.ended){var o=r.decoder.end();o&&o.length&&t.push(o)}t.push(null)}),e.on("data",function(o){if(Je("wrapped data"),r.decoder&&(o=r.decoder.write(o)),!(r.objectMode&&o==null)&&!(!r.objectMode&&(!o||!o.length))){var a=t.push(o);a||(n=!0,e.pause())}});for(var i in e)this[i]===void 0&&typeof e[i]=="function"&&(this[i]=function(o){return function(){return e[o].apply(e,arguments)}}(i));for(var s=0;s<Nv.length;s++)e.on(Nv[s],this.emit.bind(this,Nv[s]));return this._read=function(o){Je("wrapped _read",o),n&&(n=!1,e.resume())},this};Object.defineProperty(yt.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}});yt._fromList=_N;function _N(e,t){if(t.length===0)return null;var r;return t.objectMode?r=t.buffer.shift():!e||e>=t.length?(t.decoder?r=t.buffer.join(""):t.buffer.length===1?r=t.buffer.head.data:r=t.buffer.concat(t.length),t.buffer.clear()):r=RZ(e,t.buffer,t.decoder),r}function RZ(e,t,r){var n;return e<t.head.data.length?(n=t.head.data.slice(0,e),t.head.data=t.head.data.slice(e)):e===t.head.data.length?n=t.shift():n=r?DZ(e,t):jZ(e,t),n}function DZ(e,t){var r=t.head,n=1,i=r.data;for(e-=i.length;r=r.next;){var s=r.data,o=e>s.length?s.length:e;if(o===s.length?i+=s:i+=s.slice(0,e),e-=o,e===0){o===s.length?(++n,r.next?t.head=r.next:t.head=t.tail=null):(t.head=r,r.data=s.slice(o));break}++n}return t.length-=n,i}function jZ(e,t){var r=_l.allocUnsafe(e),n=t.head,i=1;for(n.data.copy(r),e-=n.data.length;n=n.next;){var s=n.data,o=e>s.length?s.length:e;if(s.copy(r,r.length-e,0,o),e-=o,e===0){o===s.length?(++i,n.next?t.head=n.next:t.head=t.tail=null):(t.head=n,n.data=s.slice(o));break}++i}return t.length-=i,r}function Pv(e){var t=e._readableState;if(t.length>0)throw new Error('"endReadable()" called on non-empty stream');t.endEmitted||(t.ended=!0,du.nextTick(BZ,t,e))}function BZ(e,t){!e.endEmitted&&e.length===0&&(e.endEmitted=!0,t.readable=!1,t.emit("end"))}function wN(e,t){for(var r=0,n=e.length;r<n;r++)if(e[r]===t)return r;return-1}});var Dv=_((YTe,bN)=>{"use strict";bN.exports=Zi;var Id=Qo(),ON=Object.create(cu());ON.inherits=lu();ON.inherits(Zi,Id);function LZ(e,t){var r=this._transformState;r.transforming=!1;var n=r.writecb;if(!n)return this.emit("error",new Error("write callback called multiple times"));r.writechunk=null,r.writecb=null,t!=null&&this.push(t),n(e);var i=this._readableState;i.reading=!1,(i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}function Zi(e){if(!(this instanceof Zi))return new Zi(e);Id.call(this,e),this._transformState={afterTransform:LZ.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,e&&(typeof e.transform=="function"&&(this._transform=e.transform),typeof e.flush=="function"&&(this._flush=e.flush)),this.on("prefinish",kZ)}function kZ(){var e=this;typeof this._flush=="function"?this._flush(function(t,r){SN(e,t,r)}):SN(this,null,null)}Zi.prototype.push=function(e,t){return this._transformState.needTransform=!1,Id.prototype.push.call(this,e,t)};Zi.prototype._transform=function(e,t,r){throw new Error("_transform() is not implemented")};Zi.prototype._write=function(e,t,r){var n=this._transformState;if(n.writecb=r,n.writechunk=e,n.writeencoding=t,!n.transforming){var i=this._readableState;(n.needTransform||i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}};Zi.prototype._read=function(e){var t=this._transformState;t.writechunk!==null&&t.writecb&&!t.transforming?(t.transforming=!0,this._transform(t.writechunk,t.writeencoding,t.afterTransform)):t.needTransform=!0};Zi.prototype._destroy=function(e,t){var r=this;Id.prototype._destroy.call(this,e,function(n){t(n),r.emit("close")})};function SN(e,t,r){if(t)return e.emit("error",t);if(r!=null&&e.push(r),e._writableState.length)throw new Error("Calling transform done when ws.length != 0");if(e._transformState.transforming)throw new Error("Calling transform done when still transforming");return e.push(null)}});var AN=_((JTe,TN)=>{"use strict";TN.exports=wl;var EN=Dv(),CN=Object.create(cu());CN.inherits=lu();CN.inherits(wl,EN);function wl(e){if(!(this instanceof wl))return new wl(e);EN.call(this,e)}wl.prototype._transform=function(e,t,r){r(null,e)}});var xN=_((ar,Rd)=>{var di=require("stream");process.env.READABLE_STREAM==="disable"&&di?(Rd.exports=di,ar=Rd.exports=di.Readable,ar.Readable=di.Readable,ar.Writable=di.Writable,ar.Duplex=di.Duplex,ar.Transform=di.Transform,ar.PassThrough=di.PassThrough,ar.Stream=di):(ar=Rd.exports=Tv(),ar.Stream=di||ar,ar.Readable=ar,ar.Writable=bv(),ar.Duplex=Qo(),ar.Transform=Dv(),ar.PassThrough=AN())});var MN=_((XTe,qN)=>{"use strict";var jv=xN().Duplex,FZ=require("util"),pi=jt().Buffer;function it(e){if(!(this instanceof it))return new it(e);if(this._bufs=[],this.length=0,typeof e=="function"){this._callback=e;var t=function(n){this._callback&&(this._callback(n),this._callback=null)}.bind(this);this.on("pipe",function(n){n.on("error",t)}),this.on("unpipe",function(n){n.removeListener("error",t)})}else this.append(e);jv.call(this)}FZ.inherits(it,jv);it.prototype._offset=function(t){var r=0,n=0,i;if(t===0)return[0,0];for(;n<this._bufs.length;n++){if(i=r+this._bufs[n].length,t<i||n==this._bufs.length-1)return[n,t-r];r=i}};it.prototype._reverseOffset=function(e){for(var t=e[0],r=e[1],n=0;n<t;n++)r+=this._bufs[n].length;return r};it.prototype.append=function(t){var r=0;if(pi.isBuffer(t))this._appendBuffer(t);else if(Array.isArray(t))for(;r<t.length;r++)this.append(t[r]);else if(t instanceof it)for(;r<t._bufs.length;r++)this.append(t._bufs[r]);else t!=null&&(typeof t=="number"&&(t=t.toString()),this._appendBuffer(pi.from(t)));return this};it.prototype._appendBuffer=function(t){this._bufs.push(t),this.length+=t.length};it.prototype._write=function(t,r,n){this._appendBuffer(t),typeof n=="function"&&n()};it.prototype._read=function(t){if(!this.length)return this.push(null);t=Math.min(t,this.length),this.push(this.slice(0,t)),this.consume(t)};it.prototype.end=function(t){jv.prototype.end.call(this,t),this._callback&&(this._callback(null,this.slice()),this._callback=null)};it.prototype.get=function(t){if(!(t>this.length||t<0)){var r=this._offset(t);return this._bufs[r[0]][r[1]]}};it.prototype.slice=function(t,r){return typeof t=="number"&&t<0&&(t+=this.length),typeof r=="number"&&r<0&&(r+=this.length),this.copy(null,0,t,r)};it.prototype.copy=function(t,r,n,i){if((typeof n!="number"||n<0)&&(n=0),(typeof i!="number"||i>this.length)&&(i=this.length),n>=this.length||i<=0)return t||pi.alloc(0);var s=!!t,o=this._offset(n),a=i-n,u=a,c=s&&r||0,f=o[1],h,d;if(n===0&&i==this.length){if(!s)return this._bufs.length===1?this._bufs[0]:pi.concat(this._bufs,this.length);for(d=0;d<this._bufs.length;d++)this._bufs[d].copy(t,c),c+=this._bufs[d].length;return t}if(u<=this._bufs[o[0]].length-f)return s?this._bufs[o[0]].copy(t,r,f,f+u):this._bufs[o[0]].slice(f,f+u);for(s||(t=pi.allocUnsafe(a)),d=o[0];d<this._bufs.length;d++){if(h=this._bufs[d].length-f,u>h)this._bufs[d].copy(t,c,f),c+=h;else{this._bufs[d].copy(t,c,f,f+u),c+=h;break}u-=h,f&&(f=0)}return t.length>c?t.slice(0,c):t};it.prototype.shallowSlice=function(t,r){if(t=t||0,r=typeof r!="number"?this.length:r,t<0&&(t+=this.length),r<0&&(r+=this.length),t===r)return new it;var n=this._offset(t),i=this._offset(r),s=this._bufs.slice(n[0],i[0]+1);return i[1]==0?s.pop():s[s.length-1]=s[s.length-1].slice(0,i[1]),n[1]!=0&&(s[0]=s[0].slice(n[1])),new it(s)};it.prototype.toString=function(t,r,n){return this.slice(r,n).toString(t)};it.prototype.consume=function(t){if(t=Math.trunc(t),Number.isNaN(t)||t<=0)return this;for(;this._bufs.length;)if(t>=this._bufs[0].length)t-=this._bufs[0].length,this.length-=this._bufs[0].length,this._bufs.shift();else{this._bufs[0]=this._bufs[0].slice(t),this.length-=t;break}return this};it.prototype.duplicate=function(){for(var t=0,r=new it;t<this._bufs.length;t++)r.append(this._bufs[t]);return r};it.prototype.destroy=function(){this._bufs.length=0,this.length=0,this.push(null)};it.prototype.indexOf=function(e,t,r){if(r===void 0&&typeof t=="string"&&(r=t,t=void 0),typeof e=="function"||Array.isArray(e))throw new TypeError('The "value" argument must be one of type string, Buffer, BufferList, or Uint8Array.');if(typeof e=="number"?e=pi.from([e]):typeof e=="string"?e=pi.from(e,r):e instanceof it?e=e.slice():pi.isBuffer(e)||(e=pi.from(e)),t=Number(t||0),isNaN(t)&&(t=0),t<0&&(t=this.length+t),t<0&&(t=0),e.length===0)return t>this.length?this.length:t;var n=this._offset(t),i=n[0],s=n[1];for(i;i<this._bufs.length;i++){for(var o=this._bufs[i];s<o.length;){var a=o.length-s;if(a>=e.length){var u=o.indexOf(e,s);if(u!==-1)return this._reverseOffset([i,u]);s=o.length-e.length+1}else{var c=this._reverseOffset([i,s]);if(this._match(c,e))return c;s++}}s=0}return-1};it.prototype._match=function(e,t){if(this.length-e<t.length)return!1;for(var r=0;r<t.length;r++)if(this.get(e+r)!==t[r])return!1;return!0};(function(){var e={readDoubleBE:8,readDoubleLE:8,readFloatBE:4,readFloatLE:4,readInt32BE:4,readInt32LE:4,readUInt32BE:4,readUInt32LE:4,readInt16BE:2,readInt16LE:2,readUInt16BE:2,readUInt16LE:2,readInt8:1,readUInt8:1,readIntBE:null,readIntLE:null,readUIntBE:null,readUIntLE:null};for(var t in e)(function(r){e[r]===null?it.prototype[r]=function(n,i){return this.slice(n,n+i)[r](0,i)}:it.prototype[r]=function(n){return this.slice(n,n+e[r])[r](0)}})(t)})();qN.exports=it});var jN=_((ZTe,DN)=>{"use strict";var UZ=require("stream").Duplex,VZ=MN(),NN=se().MongoParseError,WZ=zi().decompress,$N=dn().Response,PN=$o().BinMsg,zZ=se().MongoError,HZ=nt().opcodes.OP_COMPRESSED,IN=nt().opcodes.OP_MSG,Qs=nt().MESSAGE_HEADER_SIZE,RN=nt().COMPRESSION_DETAILS_SIZE,KZ=nt().opcodes,GZ=zi().compress,QZ=zi().compressorIDs,YZ=zi().uncompressibleCommands,JZ=$o().Msg,XZ=1024*1024*16*4,Bv=Symbol("buffer"),Lv=class extends UZ{constructor(t){t=t||{},super(t),this.bson=t.bson,this.maxBsonMessageSize=t.maxBsonMessageSize||XZ,this[Bv]=new VZ}_write(t,r,n){this[Bv].append(t),kv(this,n)}_read(){}writeCommand(t,r){if(!(r&&!!r.agreedCompressor)||!ZZ(t)){let a=t.toBin();this.push(Array.isArray(a)?Buffer.concat(a):a);return}let i=Buffer.concat(t.toBin()),s=i.slice(Qs),o=i.readInt32LE(12);GZ({options:r},s,(a,u)=>{if(a){r.cb(a,null);return}let c=Buffer.alloc(Qs);c.writeInt32LE(Qs+RN+u.length,0),c.writeInt32LE(t.requestId,4),c.writeInt32LE(0,8),c.writeInt32LE(KZ.OP_COMPRESSED,12);let f=Buffer.alloc(RN);f.writeInt32LE(o,0),f.writeInt32LE(s.length,4),f.writeUInt8(QZ[r.agreedCompressor],8),this.push(Buffer.concat([c,f,u]))})}};function ZZ(e){let t=e instanceof JZ?e.command:e.query,r=Object.keys(t)[0];return!YZ.has(r)}function kv(e,t){let r=e[Bv];if(r.length<4){t();return}let n=r.readInt32LE(0);if(n<0){t(new NN(`Invalid message size: ${n}`));return}if(n>e.maxBsonMessageSize){t(new NN(`Invalid message size: ${n}, max allowed: ${e.maxBsonMessageSize}`));return}if(n>r.length){t();return}let i=r.slice(0,n);r.consume(n);let s={length:i.readInt32LE(0),requestId:i.readInt32LE(4),responseTo:i.readInt32LE(8),opCode:i.readInt32LE(12)},o=s.opCode===IN?PN:$N,a=e.responseOptions;if(s.opCode!==HZ){let f=i.slice(Qs);e.emit("message",new o(e.bson,i,s,f,a)),r.length>=4?kv(e,t):t();return}s.fromCompressed=!0,s.opCode=i.readInt32LE(Qs),s.length=i.readInt32LE(Qs+4);let u=i[Qs+8],c=i.slice(Qs+9);o=s.opCode===IN?PN:$N,WZ(u,c,(f,h)=>{if(f){t(f);return}if(h.length!==s.length){t(new zZ("Decompressing a compressed message from the server failed. The message is corrupt."));return}e.emit("message",new o(e.bson,i,s,h,a)),r.length>=4?kv(e,t):t()})}DN.exports=Lv});var kN=_((eAe,LN)=>{"use strict";var BN=Mo().parseServerType,eee=["minWireVersion","maxWireVersion","maxBsonObjectSize","maxMessageSizeBytes","maxWriteBatchSize","__nodejs_mock_server__"],Fv=class{constructor(t,r){this.address=t,this.type=BN(null),this.minWireVersion=void 0,this.maxWireVersion=void 0,this.maxBsonObjectSize=16777216,this.maxMessageSizeBytes=48e6,this.maxWriteBatchSize=1e5,this.compressors=r&&r.compression&&Array.isArray(r.compression.compressors)?r.compression.compressors:[]}receiveResponse(t){this.type=BN(t),eee.forEach(r=>{typeof t[r]<"u"&&(this[r]=t[r])}),t.compression&&(this.compressor=this.compressors.filter(r=>t.compression.indexOf(r)!==-1)[0])}};LN.exports={StreamDescription:Fv}});var Kv=_((tAe,WN)=>{"use strict";var tee=require("events"),ree=jN(),FN=se().MongoError,nee=se().MongoNetworkError,iee=se().MongoNetworkTimeoutError,see=se().MongoWriteConcernError,oee=Fh(),aee=kN().StreamDescription,Yo=zw(),Dd=fw(),uee=Bs().updateSessionFromResponse,cee=he().uuidV4,Vv=N().now,lee=N().calculateDurationInMs,Ys=Symbol("stream"),es=Symbol("queue"),pu=Symbol("messageStream"),UN=Symbol("generation"),Uv=Symbol("lastUseTime"),Hv=Symbol("clusterTime"),Js=Symbol("description"),VN=Symbol("ismaster"),Wv=Symbol("autoEncrypter"),zv=class extends tee{constructor(t,r){super(r),this.id=r.id,this.address=hee(t),this.bson=r.bson,this.socketTimeout=typeof r.socketTimeout=="number"?r.socketTimeout:0,this.host=r.host||"localhost",this.port=r.port||27017,this.monitorCommands=typeof r.monitorCommands=="boolean"?r.monitorCommands:!1,this.serverApi=r.serverApi,this.closed=!1,this.destroyed=!1,this[Js]=new aee(this.address,r),this[UN]=r.generation,this[Uv]=Vv(),r.autoEncrypter&&(this[Wv]=r.autoEncrypter),this[es]=new Map,this[pu]=new ree(r),this[pu].on("message",fee(this)),this[Ys]=t,t.on("error",()=>{}),this[pu].on("error",n=>this.handleIssue({destroy:n})),t.on("close",()=>this.handleIssue({isClose:!0})),t.on("timeout",()=>this.handleIssue({isTimeout:!0,destroy:!0})),t.pipe(this[pu]),this[pu].pipe(t)}get description(){return this[Js]}get ismaster(){return this[VN]}set ismaster(t){this[Js].receiveResponse(t),this[VN]=t}get generation(){return this[UN]||0}get idleTime(){return lee(this[Uv])}get clusterTime(){return this[Hv]}get stream(){return this[Ys]}markAvailable(){this[Uv]=Vv()}handleIssue(t){if(!this.closed){t.destroy&&this[Ys].destroy(typeof t.destroy=="boolean"?void 0:t.destroy),this.closed=!0;for(let r of this[es]){let n=r[1];t.isTimeout?n.cb(new iee(`connection ${this.id} to ${this.address} timed out`,{beforeHandshake:this.ismaster==null})):t.isClose?n.cb(new nee(`connection ${this.id} to ${this.address} closed`)):n.cb(typeof t.destroy=="boolean"?void 0:t.destroy)}this[es].clear(),this.emit("close")}}destroy(t,r){if(typeof t=="function"&&(r=t,t={}),t=Object.assign({force:!1},t),this[Ys]==null||this.destroyed){this.destroyed=!0,typeof r=="function"&&r();return}if(t.force){this[Ys].destroy(),this.destroyed=!0,typeof r=="function"&&r();return}this[Ys].end(n=>{this.destroyed=!0,typeof r=="function"&&r(n)})}applyApiVersion(t){return this.serverApi&&(t.serverApi=this.serverApi),t}command(t,r,n,i){typeof n=="function"&&(i=n,n={}),Yo.command(Jo(this),t,r,this.applyApiVersion(n),i)}query(t,r,n,i,s){Yo.query(Jo(this),t,r,n,this.applyApiVersion(i),s)}getMore(t,r,n,i,s){Yo.getMore(Jo(this),t,r,n,this.applyApiVersion(i),s)}killCursors(t,r,n){Yo.killCursors(Jo(this),t,r,this.applyApiVersion({}),n)}insert(t,r,n,i){Yo.insert(Jo(this),t,r,this.applyApiVersion(n),i)}update(t,r,n,i){Yo.update(Jo(this),t,r,this.applyApiVersion(n),i)}remove(t,r,n,i){Yo.remove(Jo(this),t,r,this.applyApiVersion(n),i)}};function Jo(e){let t={description:e.description,clusterTime:e[Hv],s:{bson:e.bson,pool:{write:dee.bind(e),isConnected:()=>!0}}};return e[Wv]&&(t.autoEncrypter=e[Wv]),t}function fee(e){return function(r){if(e.emit("message",r),!e[es].has(r.responseTo))return;let n=e[es].get(r.responseTo),i=n.cb;e[es].delete(r.responseTo),r.moreToCome?e[es].set(r.requestId,n):n.socketTimeoutOverride&&e[Ys].setTimeout(e.socketTimeout);try{r.parse(n)}catch(s){i(new FN(s));return}if(r.documents[0]){let s=r.documents[0],o=n.session;if(o&&uee(o,s),s.$clusterTime&&(e[Hv]=s.$clusterTime,e.emit("clusterTimeReceived",s.$clusterTime)),n.command){if(s.writeConcernError){i(new see(s.writeConcernError,s));return}if(s.ok===0||s.$err||s.errmsg||s.code){i(new FN(s));return}}}i(void 0,new oee(n.fullResult?r:r.documents[0],e,r))}}function hee(e){return typeof e.address=="function"?`${e.remoteAddress}:${e.remotePort}`:cee().toString("hex")}function dee(e,t,r){typeof t=="function"&&(r=t),t=t||{};let n={requestId:e.requestId,cb:r,session:t.session,fullResult:typeof t.fullResult=="boolean"?t.fullResult:!1,noResponse:typeof t.noResponse=="boolean"?t.noResponse:!1,documentsReturnedIn:t.documentsReturnedIn,command:!!t.command,promoteLongs:typeof t.promoteLongs=="boolean"?t.promoteLongs:!0,promoteValues:typeof t.promoteValues=="boolean"?t.promoteValues:!0,promoteBuffers:typeof t.promoteBuffers=="boolean"?t.promoteBuffers:!1,bsonRegExp:typeof t.bsonRegExp=="boolean"?t.bsonRegExp:!1,raw:typeof t.raw=="boolean"?t.raw:!1};this[Js]&&this[Js].compressor&&(n.agreedCompressor=this[Js].compressor,this[Js].zlibCompressionLevel&&(n.zlibCompressionLevel=this[Js].zlibCompressionLevel)),typeof t.socketTimeout=="number"&&(n.socketTimeoutOverride=!0,this[Ys].setTimeout(t.socketTimeout)),this.monitorCommands&&(this.emit("commandStarted",new Dd.CommandStartedEvent(this,e)),n.started=Vv(),n.cb=(i,s)=>{i?this.emit("commandFailed",new Dd.CommandFailedEvent(this,e,i,n.started)):s&&s.result&&(s.result.ok===0||s.result.$err)?this.emit("commandFailed",new Dd.CommandFailedEvent(this,e,s.result,n.started)):this.emit("commandSucceeded",new Dd.CommandSucceededEvent(this,e,s,n.started)),typeof r=="function"&&r(i,s)}),n.noResponse||this[es].set(n.requestId,n);try{this[pu].writeCommand(e,n)}catch(i){if(!n.noResponse){this[es].delete(n.requestId),n.cb(i);return}}n.noResponse&&n.cb()}WN.exports={Connection:zv}});var KN=_((rAe,HN)=>{"use strict";var zN=se().MongoError,Gv=class extends zN{constructor(t){super("Attempted to check out a connection from closed connection pool"),this.name="MongoPoolClosedError",this.address=t.address}},Qv=class extends zN{constructor(t){super("Timed out while checking out a connection from connection pool"),this.name="MongoWaitQueueTimeoutError",this.address=t.address}};HN.exports={PoolClosedError:Gv,WaitQueueTimeoutError:Qv}});var vl=_((nAe,GN)=>{"use strict";var jn=class{constructor(t){this.time=new Date,this.address=t.address}},Yv=class extends jn{constructor(t){super(t),this.options=t.options}},Jv=class extends jn{constructor(t){super(t)}},Xv=class extends jn{constructor(t,r){super(t),this.connectionId=r.id}},Zv=class extends jn{constructor(t,r){super(t),this.connectionId=r.id}},eS=class extends jn{constructor(t,r,n){super(t),this.connectionId=r.id,this.reason=n||"unknown"}},tS=class extends jn{constructor(t){super(t)}},rS=class extends jn{constructor(t,r){super(t),this.reason=r}},nS=class extends jn{constructor(t,r){super(t),this.connectionId=r.id}},iS=class extends jn{constructor(t,r){super(t),this.connectionId=r.id}},sS=class extends jn{constructor(t){super(t)}},pee=["connectionPoolCreated","connectionPoolClosed","connectionCreated","connectionReady","connectionClosed","connectionCheckOutStarted","connectionCheckOutFailed","connectionCheckedOut","connectionCheckedIn","connectionPoolCleared"];GN.exports={CMAP_EVENT_NAMES:pee,ConnectionPoolCreatedEvent:Yv,ConnectionPoolClosedEvent:Jv,ConnectionCreatedEvent:Xv,ConnectionReadyEvent:Zv,ConnectionClosedEvent:eS,ConnectionCheckOutStartedEvent:tS,ConnectionCheckOutFailedEvent:rS,ConnectionCheckedOutEvent:nS,ConnectionCheckedInEvent:iS,ConnectionPoolClearedEvent:sS}});var o$=_((iAe,s$)=>{"use strict";var QN=Ad(),YN=require("events").EventEmitter,mee=Mn(),yee=N().makeCounter,gee=se().MongoError,_ee=Kv().Connection,wee=he().eachAsync,vee=Zh(),See=he().relayEvents,XN=KN(),Oee=XN.PoolClosedError,bee=XN.WaitQueueTimeoutError,mi=vl(),Eee=mi.ConnectionPoolCreatedEvent,Cee=mi.ConnectionPoolClosedEvent,Tee=mi.ConnectionCreatedEvent,Aee=mi.ConnectionReadyEvent,ZN=mi.ConnectionClosedEvent,xee=mi.ConnectionCheckOutStartedEvent,oS=mi.ConnectionCheckOutFailedEvent,JN=mi.ConnectionCheckedOutEvent,qee=mi.ConnectionCheckedInEvent,Mee=mi.ConnectionPoolClearedEvent,e$=Symbol("logger"),ts=Symbol("connections"),Ol=Symbol("permits"),jd=Symbol("minPoolSizeTimer"),Sl=Symbol("generation"),Bd=Symbol("connectionCounter"),Ld=Symbol("cancellationToken"),Xs=Symbol("waitQueue"),kd=Symbol("cancelled"),Nee=new Set(["ssl","bson","connectionType","serverApi","monitorCommands","socketTimeout","credentials","compression","host","port","localAddress","localPort","family","hints","lookup","path","ca","cert","sigalgs","ciphers","clientCertEngine","crl","dhparam","ecdhCurve","honorCipherOrder","key","privateKeyEngine","privateKeyIdentifier","maxVersion","minVersion","passphrase","pfx","secureOptions","secureProtocol","sessionIdContext","allowHalfOpen","rejectUnauthorized","pskCallback","ALPNProtocols","servername","checkServerIdentity","session","minDHSize","secureContext","maxPoolSize","minPoolSize","maxIdleTimeMS","waitQueueTimeoutMS"]);function $ee(e,t){let r=Array.from(Nee).reduce((n,i)=>(Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i]),n),{});return Object.freeze(Object.assign({},t,r))}var aS=class extends YN{constructor(t){if(super(),t=t||{},this.closed=!1,this.options=$ee(t,{connectionType:_ee,maxPoolSize:typeof t.maxPoolSize=="number"?t.maxPoolSize:100,minPoolSize:typeof t.minPoolSize=="number"?t.minPoolSize:0,maxIdleTimeMS:typeof t.maxIdleTimeMS=="number"?t.maxIdleTimeMS:0,waitQueueTimeoutMS:typeof t.waitQueueTimeoutMS=="number"?t.waitQueueTimeoutMS:0,autoEncrypter:t.autoEncrypter,metadata:t.metadata,useUnifiedTopology:t.useUnifiedTopology}),t.minSize>t.maxSize)throw new TypeError("Connection pool minimum size must not be greater than maximum pool size");this[e$]=mee("ConnectionPool",t),this[ts]=new QN,this[Ol]=this.options.maxPoolSize,this[jd]=void 0,this[Sl]=0,this[Bd]=yee(1),this[Ld]=new YN,this[Ld].setMaxListeners(1/0),this[Xs]=new QN,process.nextTick(()=>{this.emit("connectionPoolCreated",new Eee(this)),t$(this)})}get address(){return`${this.options.host}:${this.options.port}`}get generation(){return this[Sl]}get totalConnectionCount(){return this[ts].length+(this.options.maxPoolSize-this[Ol])}get availableConnectionCount(){return this[ts].length}get waitQueueSize(){return this[Xs].length}checkOut(t){if(this.emit("connectionCheckOutStarted",new xee(this)),this.closed){this.emit("connectionCheckOutFailed",new oS(this,"poolClosed")),t(new Oee(this));return}let r={callback:t},n=this,i=this.options.waitQueueTimeoutMS;i&&(r.timer=setTimeout(()=>{r[kd]=!0,r.timer=void 0,n.emit("connectionCheckOutFailed",new oS(n,"timeout")),r.callback(new bee(n))},i)),this[Xs].push(r),process.nextTick(()=>uS(this))}checkIn(t){let r=this.closed,n=r$(this,t),i=!!(r||n||t.closed);if(i||(t.markAvailable(),this[ts].push(t)),this.emit("connectionCheckedIn",new qee(this,t)),i){let s=t.closed?"error":r?"poolClosed":"stale";i$(this,t,s)}process.nextTick(()=>uS(this))}clear(){this[Sl]+=1,this.emit("connectionPoolCleared",new Mee(this))}close(t,r){if(typeof t=="function"&&(r=t),t=Object.assign({force:!1},t),this.closed)return r();for(this[Ld].emit("cancel");this.waitQueueSize;){let n=this[Xs].pop();clearTimeout(n.timer),n[kd]||n.callback(new gee("connection pool closed"))}this[jd]&&clearTimeout(this[jd]),typeof this[Bd].return=="function"&&this[Bd].return(),this.closed=!0,wee(this[ts].toArray(),(n,i)=>{this.emit("connectionClosed",new ZN(this,n,"poolClosed")),n.destroy(t,i)},n=>{this[ts].clear(),this.emit("connectionPoolClosed",new Cee(this)),r(n)})}withConnection(t,r){this.checkOut((n,i)=>{t(n,i,(s,o)=>{typeof r=="function"&&(s?r(s):r(void 0,o)),i&&this.checkIn(i)})})}};function t$(e){if(e.closed||e.options.minPoolSize===0)return;let t=e.options.minPoolSize;for(let r=e.totalConnectionCount;r<t;++r)n$(e);e[jd]=setTimeout(()=>t$(e),10)}function r$(e,t){return t.generation!==e[Sl]}function Pee(e,t){return!!(e.options.maxIdleTimeMS&&t.idleTime>e.options.maxIdleTimeMS)}function n$(e,t){let r=Object.assign({id:e[Bd].next().value,generation:e[Sl]},e.options);e[Ol]--,vee(r,e[Ld],(n,i)=>{if(n){e[Ol]++,e[e$].debug(`connection attempt failed with error [${JSON.stringify(n)}]`),typeof t=="function"&&t(n);return}if(e.closed){i.destroy({force:!0});return}if(See(i,e,["commandStarted","commandFailed","commandSucceeded","clusterTimeReceived"]),e.emit("connectionCreated",new Tee(e,i)),i.markAvailable(),e.emit("connectionReady",new Aee(e,i)),typeof t=="function"){t(void 0,i);return}e[ts].push(i),process.nextTick(()=>uS(e))})}function i$(e,t,r){e.emit("connectionClosed",new ZN(e,t,r)),e[Ol]++,process.nextTick(()=>t.destroy())}function uS(e){if(e.closed)return;for(;e.waitQueueSize;){let r=e[Xs].peekFront();if(r[kd]){e[Xs].shift();continue}if(!e.availableConnectionCount)break;let n=e[ts].shift(),i=r$(e,n),s=Pee(e,n);if(!i&&!s&&!n.closed){e.emit("connectionCheckedOut",new JN(e,n)),clearTimeout(r.timer),e[Xs].shift(),r.callback(void 0,n);return}let o=n.closed?"error":i?"stale":"idle";i$(e,n,o)}let t=e.options.maxPoolSize;if(e.waitQueueSize&&(t<=0||e.totalConnectionCount<t)){n$(e,(r,n)=>{let i=e[Xs].shift();if(i==null||i[kd]){r==null&&e[ts].push(n);return}r?e.emit("connectionCheckOutFailed",new oS(e,r)):e.emit("connectionCheckedOut",new JN(e,n)),clearTimeout(i.timer),i.callback(r,n)});return}}s$.exports={ConnectionPool:aS}});var g$=_((sAe,y$)=>{"use strict";var Iee=mr().ServerType,a$=require("events"),d$=Zh(),Ree=Kv().Connection,p$=mr(),Dee=he().makeStateMachine,jee=se().MongoNetworkError,Bee=Yt().retrieveBSON(),u$=N().makeInterruptableAsyncInterval,Fd=N().calculateDurationInMs,cS=N().now,hS=pv(),c$=hS.ServerHeartbeatStartedEvent,l$=hS.ServerHeartbeatSucceededEvent,Lee=hS.ServerHeartbeatFailedEvent,El=Symbol("server"),jr=Symbol("monitorId"),$t=Symbol("connection"),Xo=Symbol("cancellationToken"),ns=Symbol("rttPinger"),bl=Symbol("roundTripTime"),eo=p$.STATE_CLOSED,Zs=p$.STATE_CLOSING,mu="idle",yu="monitoring",gu=Dee({[Zs]:[Zs,mu,eo],[eo]:[eo,yu],[mu]:[mu,yu,Zs],[yu]:[yu,mu,Zs]}),kee=new Set([Zs,eo,yu]);function Cl(e){return e.s.state===eo||e.s.state===Zs}var lS=class extends a${constructor(t,r){super(r),this[El]=t,this[$t]=void 0,this[Xo]=new a$,this[Xo].setMaxListeners(1/0),this[jr]=null,this.s={state:eo},this.address=t.description.address,this.options=Object.freeze({connectTimeoutMS:typeof r.connectionTimeout=="number"?r.connectionTimeout:typeof r.connectTimeoutMS=="number"?r.connectTimeoutMS:1e4,heartbeatFrequencyMS:typeof r.heartbeatFrequencyMS=="number"?r.heartbeatFrequencyMS:1e4,minHeartbeatFrequencyMS:typeof r.minHeartbeatFrequencyMS=="number"?r.minHeartbeatFrequencyMS:500,useUnifiedTopology:r.useUnifiedTopology});let n=Object.assign({id:"<monitor>",host:t.description.host,port:t.description.port,bson:t.s.bson,connectionType:Ree},t.s.options,this.options,{raw:!1,promoteLongs:!0,promoteValues:!0,promoteBuffers:!0,bsonRegExp:!0});delete n.credentials,delete n.autoEncrypter,this.connectOptions=Object.freeze(n)}connect(){if(this.s.state!==eo)return;let t=this.options.heartbeatFrequencyMS,r=this.options.minHeartbeatFrequencyMS;this[jr]=u$(h$(this),{interval:t,minInterval:r,immediate:!0})}requestCheck(){kee.has(this.s.state)||this[jr].wake()}reset(){let t=this[El].description.topologyVersion;if(Cl(this)||t==null)return;gu(this,Zs),f$(this),gu(this,mu);let r=this.options.heartbeatFrequencyMS,n=this.options.minHeartbeatFrequencyMS;this[jr]=u$(h$(this),{interval:r,minInterval:n})}close(){Cl(this)||(gu(this,Zs),f$(this),this.emit("close"),gu(this,eo))}};function f$(e){e[jr]&&(e[jr].stop(),e[jr]=null),e[ns]&&(e[ns].close(),e[ns]=void 0),e[Xo].emit("cancel"),e[jr]&&(clearTimeout(e[jr]),e[jr]=void 0),e[$t]&&e[$t].destroy({force:!0})}function Fee(e,t){let r=cS();e.emit("serverHeartbeatStarted",new c$(e.address));function n(i){e[$t]&&(e[$t].destroy({force:!0}),e[$t]=void 0),e.emit("serverHeartbeatFailed",new Lee(Fd(r),i,e.address)),e.emit("resetServer",i),e.emit("resetConnectionPool"),t(i)}if(e[$t]!=null&&!e[$t].closed){let i=e.options.connectTimeoutMS,s=e.options.heartbeatFrequencyMS,o=e[El].description.topologyVersion,a=o!=null,u=e[$t].serverApi,c=e[$t].helloOk,f={[u||c?"hello":"ismaster"]:!0};c&&(f.helloOk=c);let h={socketTimeout:i};a&&(f.maxAwaitTimeMS=s,f.topologyVersion=Uee(o),i&&(h.socketTimeout=i+s),h.exhaustAllowed=!0,e[ns]==null&&(e[ns]=new fS(e[Xo],e.connectOptions))),e[$t].command("admin.$cmd",f,h,(d,p)=>{if(d){n(d);return}let m=p.result,y=e[ns];"isWritablePrimary"in m&&(m.ismaster=m.isWritablePrimary);let g=a&&y?y.roundTripTime:Fd(r);e.emit("serverHeartbeatSucceeded",new l$(g,m,e.address)),a&&m.topologyVersion?(e.emit("serverHeartbeatStarted",new c$(e.address)),r=cS()):(e[ns]&&(e[ns].close(),e[ns]=void 0),t(void 0,m))});return}d$(e.connectOptions,e[Xo],(i,s)=>{if(s&&Cl(e)){s.destroy({force:!0});return}if(i){e[$t]=void 0,i instanceof jee||e.emit("resetConnectionPool"),n(i);return}e[$t]=s,e.emit("serverHeartbeatSucceeded",new l$(Fd(r),s.ismaster,e.address)),t(void 0,s.ismaster)})}function h$(e){return t=>{gu(e,yu);function r(){Cl(e)||gu(e,mu),t()}process.nextTick(()=>e.emit("monitoring",e[El])),Fee(e,(n,i)=>{if(n&&e[El].description.type===Iee.Unknown)return e.emit("resetServer",n),r();i&&i.topologyVersion&&setTimeout(()=>{Cl(e)||e[jr].wake()}),r()})}}function Uee(e){return{processId:e.processId,counter:Bee.Long.fromNumber(e.counter)}}var fS=class{constructor(t,r){this[$t]=null,this[Xo]=t,this[bl]=0,this.closed=!1;let n=r.heartbeatFrequencyMS;this[jr]=setTimeout(()=>m$(this,r),n)}get roundTripTime(){return this[bl]}close(){this.closed=!0,clearTimeout(this[jr]),this[jr]=void 0,this[$t]&&this[$t].destroy({force:!0})}};function m$(e,t){let r=cS(),n=e[Xo],i=t.heartbeatFrequencyMS;if(e.closed)return;function s(o){if(e.closed){o.destroy({force:!0});return}e[$t]==null&&(e[$t]=o),e[bl]=Fd(r),e[jr]=setTimeout(()=>m$(e,t),i)}if(e[$t]==null){d$(t,n,(o,a)=>{if(o){e[$t]=void 0,e[bl]=0;return}s(a)});return}e[$t].command("admin.$cmd",{ismaster:1},o=>{if(o){e[$t]=void 0,e[bl]=0;return}s()})}y$.exports={Monitor:lS}});var T$=_((oAe,C$)=>{"use strict";var Vee=require("events"),Wee=o$().ConnectionPool,zee=vl().CMAP_EVENT_NAMES,ss=se().MongoError,_$=he().relayEvents,Br=Yt().retrieveBSON(),Hee=Mn(),v$=Mo().ServerDescription,Kee=Mo().compareTopologyVersion,Gee=ir(),Qee=g$().Monitor,S$=se().MongoNetworkError,O$=se().MongoNetworkTimeoutError,b$=he().collationNotSupported,Yee=Yt().debugOptions,Jee=se().isSDAMUnrecoverableError,Xee=se().isRetryableWriteError,Zee=se().isNodeShuttingDownError,ete=se().isNetworkErrorBeforeHandshake,pS=he().maxWireVersion,tte=he().makeStateMachine,rte=Io().extractCommand,xl=mr(),nte=xl.ServerType,ite=eu().isTransactionCommand,ste=["reconnect","reconnectTries","reconnectInterval","emitError","cursorFactory","host","port","size","keepAlive","keepAliveInitialDelay","noDelay","connectionTimeout","checkServerIdentity","socketTimeout","ssl","ca","crl","cert","key","rejectUnauthorized","promoteLongs","promoteValues","promoteBuffers","bsonRegExp","servername"],yi=xl.STATE_CLOSING,tn=xl.STATE_CLOSED,Al=xl.STATE_CONNECTING,Vd=xl.STATE_CONNECTED,Ud=tte({[tn]:[tn,Al],[Al]:[Al,yi,Vd,tn],[Vd]:[Vd,yi,tn],[yi]:[yi,tn]}),is=Symbol("monitor"),Wd=class extends Vee{constructor(t,r,n){super(),this.s={description:t,options:r,logger:Hee("Server",r),bson:r.bson||new Br([Br.Binary,Br.Code,Br.DBRef,Br.Decimal128,Br.Double,Br.Int32,Br.Long,Br.Map,Br.MaxKey,Br.MinKey,Br.ObjectId,Br.BSONRegExp,Br.Symbol,Br.Timestamp]),state:tn,credentials:r.credentials,topology:n},this.serverApi=r.serverApi;let i=Object.assign({host:this.description.host,port:this.description.port,bson:this.s.bson},r);this.s.pool=new Wee(i),_$(this.s.pool,this,["commandStarted","commandSucceeded","commandFailed"].concat(zee)),this.s.pool.on("clusterTimeReceived",s=>{this.clusterTime=s}),this[is]=new Qee(this,this.s.options),_$(this[is],this,["serverHeartbeatStarted","serverHeartbeatSucceeded","serverHeartbeatFailed","monitoring"]),this[is].on("resetConnectionPool",()=>{this.s.pool.clear()}),this[is].on("resetServer",s=>to(this,s)),this[is].on("serverHeartbeatSucceeded",s=>{this.emit("descriptionReceived",new v$(this.description.address,s.reply,{roundTripTime:ote(this.description.roundTripTime,s.duration)})),this.s.state===Al&&(Ud(this,Vd),this.emit("connect",this))})}get description(){return this.s.description}get supportsRetryableWrites(){return E$(this)}get name(){return this.s.description.address}get autoEncrypter(){return this.s.options&&this.s.options.autoEncrypter?this.s.options.autoEncrypter:null}connect(){this.s.state===tn&&(Ud(this,Al),this[is].connect())}destroy(t,r){if(typeof t=="function"&&(r=t,t={}),t=Object.assign({},{force:!1},t),this.s.state===tn){typeof r=="function"&&r();return}Ud(this,yi),this[is].close(),this.s.pool.close(t,n=>{Ud(this,tn),this.emit("closed"),typeof r=="function"&&r(n)})}requestCheck(){this[is].requestCheck()}command(t,r,n,i){if(typeof n=="function"&&(i=n,n={},n=n||{}),n.serverApi=this.serverApi,this.s.state===yi||this.s.state===tn){i(new ss("server is closed"));return}let s=ate(this,n);if(s)return i(s);if(n=Object.assign({},n,{wireProtocolCommand:!1}),this.s.logger.isDebug()){let o=rte(r);this.s.logger.debug(`executing command [${JSON.stringify({ns:t,cmd:o.shouldRedact?`${o.name} details REDACTED`:r,options:Yee(ste,n)})}] against ${this.name}`)}if(b$(this,r)){i(new ss(`server ${this.name} does not support collation`));return}this.s.pool.withConnection((o,a,u)=>{if(o)return to(this,o),u(o);a.command(t,r,n,Tl(this,a,r,n,u))},i)}query(t,r,n,i,s){if(this.s.state===yi||this.s.state===tn){s(new ss("server is closed"));return}this.s.pool.withConnection((o,a,u)=>{if(o)return to(this,o),u(o);a.query(t,r,n,i,Tl(this,a,r,i,u))},s)}getMore(t,r,n,i,s){if(this.s.state===yi||this.s.state===tn){s(new ss("server is closed"));return}this.s.pool.withConnection((o,a,u)=>{if(o)return to(this,o),u(o);a.getMore(t,r,n,i,Tl(this,a,null,i,u))},s)}killCursors(t,r,n){if(this.s.state===yi||this.s.state===tn){typeof n=="function"&&n(new ss("server is closed"));return}this.s.pool.withConnection((i,s,o)=>{if(i)return to(this,i),o(i);s.killCursors(t,r,Tl(this,s,null,void 0,o))},n)}insert(t,r,n,i){dS({server:this,op:"insert",ns:t,ops:r},n,i)}update(t,r,n,i){dS({server:this,op:"update",ns:t,ops:r},n,i)}remove(t,r,n,i){dS({server:this,op:"remove",ns:t,ops:r},n,i)}};Object.defineProperty(Wd.prototype,"clusterTime",{get:function(){return this.s.topology.clusterTime},set:function(e){this.s.topology.clusterTime=e}});function E$(e){return e.description.maxWireVersion>=6&&e.description.logicalSessionTimeoutMinutes&&e.description.type!==nte.Standalone}function ote(e,t){if(e===-1)return t;let r=.2;return r*t+(1-r)*e}function ate(e,t){if(t.readPreference&&!(t.readPreference instanceof Gee))return new ss("readPreference must be an instance of ReadPreference")}function dS(e,t,r){typeof t=="function"&&(r=t,t={}),t=t||{};let n=e.server,i=e.op,s=e.ns,o=Array.isArray(e.ops)?e.ops:[e.ops];if(n.s.state===yi||n.s.state===tn){r(new ss("server is closed"));return}if(b$(n,t)){r(new ss(`server ${n.name} does not support collation`));return}if((t.writeConcern&&t.writeConcern.w===0||pS(n)<5)&&(i==="update"||i==="remove")&&o.find(u=>u.hint)){r(new ss(`servers < 3.4 do not support hint on ${i}`));return}n.s.pool.withConnection((u,c,f)=>{if(u)return to(n,u),f(u);c[i](s,o,t,Tl(n,c,o,t,f))},r)}function to(e,t){t instanceof S$&&!(t instanceof O$)&&e[is].reset(),e.emit("descriptionReceived",new v$(e.description.address,null,{error:t,topologyVersion:t&&t.topologyVersion?t.topologyVersion:e.description.topologyVersion}))}function ute(e,t){return t.generation!==e.generation}function cte(e,t){let r=t.topologyVersion,n=e.description.topologyVersion;return Kee(n,r)<0}function w$(e,t){return e&&e.inTransaction()&&!ite(t)}function Tl(e,t,r,n,i){let s=n&&n.session;return function(a,u){a&&!ute(e.s.pool,t)&&(a instanceof S$?(s&&!s.hasEnded&&(s.serverSession.isDirty=!0),E$(e)&&!w$(s,r)&&a.addErrorLabel("RetryableWriteError"),(!(a instanceof O$)||ete(a))&&(to(e,a),e.s.pool.clear())):(pS(e)<9&&Xee(a)&&!w$(s,r)&&a.addErrorLabel("RetryableWriteError"),Jee(a)&&cte(e,a)&&((pS(e)<=7||Zee(a))&&e.s.pool.clear(),to(e,a),process.nextTick(()=>e.requestCheck())))),i(a,u)}}C$.exports={Server:Wd}});var A$=_((aAe,yS)=>{"use strict";var lte=Mn(),fte=require("events").EventEmitter,hte=require("dns");function dte(e,t){let r=/^.*?\./,n=`.${e.replace(r,"")}`,i=`.${t.replace(r,"")}`;return n.endsWith(i)}var zd=class{constructor(t){this.srvRecords=t}addresses(){return new Set(this.srvRecords.map(t=>`${t.name}:${t.port}`))}},mS=class extends fte{constructor(t){if(super(),!t||!t.srvHost)throw new TypeError("options for SrvPoller must exist and include srvHost");this.srvHost=t.srvHost,this.rescanSrvIntervalMS=6e4,this.heartbeatFrequencyMS=t.heartbeatFrequencyMS||1e4,this.logger=lte("srvPoller",t),this.haMode=!1,this.generation=0,this._timeout=null}get srvAddress(){return`_mongodb._tcp.${this.srvHost}`}get intervalMS(){return this.haMode?this.heartbeatFrequencyMS:this.rescanSrvIntervalMS}start(){this._timeout||this.schedule()}stop(){this._timeout&&(clearTimeout(this._timeout),this.generation+=1,this._timeout=null)}schedule(){clearTimeout(this._timeout),this._timeout=setTimeout(()=>this._poll(),this.intervalMS)}success(t){this.haMode=!1,this.schedule(),this.emit("srvRecordDiscovery",new zd(t))}failure(t,r){this.logger.warn(t,r),this.haMode=!0,this.schedule()}parentDomainMismatch(t){this.logger.warn(`parent domain mismatch on SRV record (${t.name}:${t.port})`,t)}_poll(){let t=this.generation;hte.resolveSrv(this.srvAddress,(r,n)=>{if(t!==this.generation)return;if(r){this.failure("DNS error",r);return}let i=[];if(n.forEach(s=>{dte(s.name,this.srvHost)?i.push(s):this.parentDomainMismatch(s)}),!i.length){this.failure("No valid addresses found at host");return}this.success(i)})}};yS.exports.SrvPollingEvent=zd;yS.exports.SrvPoller=mS});var M$=_((uAe,q$)=>{"use strict";var Ml=mr().ServerType,ql=mr().TopologyType,Hd=ir(),gS=se().MongoError,pte=1e4,x$=90;function mte(){return function(e,t){return _S(e,t.filter(r=>r.isWritable))}}function yte(e,t,r){if(e.maxStalenessSeconds==null||e.maxStalenessSeconds<0)return r;let n=e.maxStalenessSeconds,i=(t.heartbeatFrequencyMS+pte)/1e3;if(n<i)throw new gS(`maxStalenessSeconds must be at least ${i} seconds`);if(n<x$)throw new gS(`maxStalenessSeconds must be at least ${x$} seconds`);if(t.type===ql.ReplicaSetWithPrimary){let s=Array.from(t.servers.values()).filter(Kd)[0];return r.reduce((o,a)=>((a.lastUpdateTime-a.lastWriteDate-(s.lastUpdateTime-s.lastWriteDate)+t.heartbeatFrequencyMS)/1e3<=e.maxStalenessSeconds&&o.push(a),o),[])}if(t.type===ql.ReplicaSetNoPrimary){if(r.length===0)return r;let s=r.reduce((o,a)=>a.lastWriteDate>o.lastWriteDate?a:o);return r.reduce((o,a)=>((s.lastWriteDate-a.lastWriteDate+t.heartbeatFrequencyMS)/1e3<=e.maxStalenessSeconds&&o.push(a),o),[])}return r}function gte(e,t){let r=Object.keys(e),n=Object.keys(t);for(let i=0;i<r.length;++i){let s=r[i];if(n.indexOf(s)===-1||t[s]!==e[s])return!1}return!0}function _te(e,t){if(e.tags==null||Array.isArray(e.tags)&&e.tags.length===0)return t;for(let r=0;r<e.tags.length;++r){let n=e.tags[r],i=t.reduce((s,o)=>(gte(n,o.tags)&&s.push(o),s),[]);if(i.length)return i}return[]}function _S(e,t){let r=t.reduce((i,s)=>i===-1?s.roundTripTime:Math.min(s.roundTripTime,i),-1),n=r+e.localThresholdMS;return t.reduce((i,s)=>(s.roundTripTime<=n&&s.roundTripTime>=r&&i.push(s),i),[])}function Kd(e){return e.type===Ml.RSPrimary}function wte(e){return e.type===Ml.RSSecondary}function vte(e){return e.type===Ml.RSSecondary||e.type===Ml.RSPrimary}function Ste(e){return e.type!==Ml.Unknown}function Ote(e){if(!e.isValid())throw new TypeError("Invalid read preference specified");return function(t,r){let n=t.commonWireVersion;if(n&&e.minWireVersion&&e.minWireVersion>n)throw new gS(`Minimum wire version '${e.minWireVersion}' required, but found '${n}'`);if(t.type===ql.Unknown)return[];if(t.type===ql.Single||t.type===ql.Sharded)return _S(t,r.filter(Ste));let i=e.mode;if(i===Hd.PRIMARY)return r.filter(Kd);if(i===Hd.PRIMARY_PREFERRED){let a=r.filter(Kd);if(a.length)return a}let s=i===Hd.NEAREST?vte:wte,o=_S(t,_te(e,yte(e,t,r.filter(s))));return i===Hd.SECONDARY_PREFERRED&&o.length===0?r.filter(Kd):o}}q$.exports={writableServerSelector:mte,readPreferenceServerSelector:Ote}});var F$=_((cAe,k$)=>{"use strict";var bte=Ad(),Ete=require("events"),Cte=Mo().ServerDescription,Tte=mr().ServerType,N$=K_().TopologyDescription,os=mr().TopologyType,ro=pv(),Ate=T$().Server,xte=he().relayEvents,Yn=ir(),qte=$n().CoreCursor,Mte=require("util").deprecate,br=Yt().retrieveBSON(),Nte=xt().createCompressionInfo,$te=Bs().ClientSession,Xd=se().MongoError,Pte=se().MongoServerSelectionError,Ite=xt().resolveClusterTime,Rte=A$().SrvPoller,Dte=xt().getMMAPError,jte=he().makeStateMachine,Bte=he().eachAsync,Lte=N().emitDeprecationWarning,kte=Bs().ServerSessionPool,Fte=he().makeClientMetadata,Ute=vl().CMAP_EVENT_NAMES,Vte=Mo().compareTopologyVersion,Wte=N().emitWarning,Zo=mr(),zte=Zo.drainTimerQueue,Hte=Zo.clearAndRemoveTimerFrom,P$=M$(),Gd=P$.readPreferenceServerSelector,Kte=P$.writableServerSelector,Gte=0,I$=["serverHeartbeatStarted","serverHeartbeatSucceeded","serverHeartbeatFailed","commandStarted","commandSucceeded","commandFailed","monitoring"].concat(Ute),Qte=["connect","descriptionReceived","close","ended"],_u=Zo.STATE_CLOSING,_i=Zo.STATE_CLOSED,Yd=Zo.STATE_CONNECTING,wu=Zo.STATE_CONNECTED,Qd=jte({[_i]:[_i,Yd],[Yd]:[Yd,_u,wu,_i],[wu]:[wu,_u,_i],[_u]:[_u,_i]}),Yte=new Set(["autoReconnect","reconnectTries","reconnectInterval","bufferMaxEntries"]),wS=Symbol("cancelled"),gi=Symbol("waitQueue"),vu=class extends Ete{constructor(t,r){super(),typeof r>"u"&&typeof t!="string"&&(r=t,t=[],r.host&&t.push({host:r.host,port:r.port})),t=t||[],typeof t=="string"&&(t=ere(t)),r=Object.assign({},Zo.TOPOLOGY_DEFAULTS,r),r=Object.freeze(Object.assign(r,{metadata:Fte(r),compression:{compressors:Nte(r)}})),Yte.forEach(o=>{r[o]&&Lte(`The option \`${o}\` is incompatible with the unified topology, please read more by visiting http://bit.ly/2D8WfT6`,"DeprecationWarning")});let n=tre(t,r),i=Gte++,s=t.reduce((o,a)=>{a.domain_socket&&(a.host=a.domain_socket);let u=a.port?`${a.host}:${a.port}`:`${a.host}:27017`;return o.set(u,new Cte(u)),o},new Map);this[gi]=new bte,this.s={id:i,options:r,seedlist:t,state:_i,description:new N$(n,s,r.replicaSet,null,null,null,r),serverSelectionTimeoutMS:r.serverSelectionTimeoutMS,heartbeatFrequencyMS:r.heartbeatFrequencyMS,minHeartbeatFrequencyMS:r.minHeartbeatFrequencyMS,Cursor:r.cursorFactory||qte,bson:r.bson||new br([br.Binary,br.Code,br.DBRef,br.Decimal128,br.Double,br.Int32,br.Long,br.Map,br.MaxKey,br.MinKey,br.ObjectId,br.BSONRegExp,br.Symbol,br.Timestamp]),servers:new Map,sessionPool:new kte(this),sessions:new Set,promiseLibrary:r.promiseLibrary||Promise,credentials:r.credentials,clusterTime:null,connectionTimers:new Set},this.serverApi=r.serverApi,r.srvHost&&(this.s.srvPoller=r.srvPoller||new Rte({heartbeatFrequencyMS:this.s.heartbeatFrequencyMS,srvHost:r.srvHost,logger:r.logger,loggerLevel:r.loggerLevel}),this.s.detectTopologyDescriptionChange=o=>{let a=o.previousDescription.type,u=o.newDescription.type;a!==os.Sharded&&u===os.Sharded&&(this.s.handleSrvPolling=ire(this),this.s.srvPoller.on("srvRecordDiscovery",this.s.handleSrvPolling),this.s.srvPoller.start())},this.on("topologyDescriptionChanged",this.s.detectTopologyDescriptionChange)),this.setMaxListeners(1/0)}get description(){return this.s.description}get parserType(){return br.native?"c++":"js"}connect(t,r){if(typeof t=="function"&&(r=t,t={}),t=t||{},this.s.state===wu){typeof r=="function"&&r();return}Qd(this,Yd),this.emit("topologyOpening",new ro.TopologyOpeningEvent(this.s.id)),this.emit("topologyDescriptionChanged",new ro.TopologyDescriptionChangedEvent(this.s.id,new N$(os.Unknown),this.s.description)),nre(this,Array.from(this.s.description.servers.values())),Yn.translate(t);let n=t.readPreference||Yn.primary,i=s=>{if(s){this.close(),typeof r=="function"?r(s):this.emit("error",s);return}Qd(this,wu),this.emit("open",s,this),this.emit("connect",this),typeof r=="function"&&r(s,this)};if(this.s.credentials){this.command("admin.$cmd",{ping:1},{readPreference:n},i);return}this.selectServer(Gd(n),t,i)}close(t,r){if(typeof t=="function"&&(r=t,t={}),typeof t=="boolean"&&(t={force:t}),t=t||{},this.s.state===_i||this.s.state===_u){typeof r=="function"&&r();return}Qd(this,_u),L$(this[gi],new Xd("Topology closed")),zte(this.s.connectionTimers),this.s.srvPoller&&(this.s.srvPoller.stop(),this.s.handleSrvPolling&&(this.s.srvPoller.removeListener("srvRecordDiscovery",this.s.handleSrvPolling),delete this.s.handleSrvPolling)),this.s.detectTopologyDescriptionChange&&(this.removeListener("topologyDescriptionChanged",this.s.detectTopologyDescriptionChange),delete this.s.detectTopologyDescriptionChange),this.s.sessions.forEach(n=>n.endSession()),this.s.sessionPool.endAllPooledSessions(()=>{Bte(Array.from(this.s.servers.values()),(n,i)=>R$(n,this,t,i),n=>{this.s.servers.clear(),this.emit("topologyClosed",new ro.TopologyClosedEvent(this.s.id)),Qd(this,_i),typeof r=="function"&&r(n)})})}selectServer(t,r,n){if(typeof r=="function")if(n=r,typeof t!="function"){r=t;let f;t instanceof Yn?f=t:typeof t=="string"?f=new Yn(t):(Yn.translate(r),f=r.readPreference||Yn.primary),t=Gd(f)}else r={};r=Object.assign({},{serverSelectionTimeoutMS:this.s.serverSelectionTimeoutMS},r);let i=this.description.type===os.Sharded,s=r.session,o=s&&s.transaction;if(i&&o&&o.server){n(void 0,o.server);return}let a=t;if(typeof t=="object"){let f=t.readPreference?t.readPreference:Yn.primary;a=Gd(f)}let u={serverSelector:a,transaction:o,callback:n},c=r.serverSelectionTimeoutMS;c&&(u.timer=setTimeout(()=>{u[wS]=!0,u.timer=void 0;let f=new Pte(`Server selection timed out after ${c} ms`,this.description);u.callback(f)},c)),this[gi].push(u),$$(this)}shouldCheckForSessionSupport(){return this.description.type===os.Single?!this.description.hasKnownServers:!this.description.hasDataBearingServers}hasSessionSupport(){return this.description.logicalSessionTimeoutMinutes!=null}startSession(t,r){let n=new $te(this,this.s.sessionPool,t,r);return n.once("ended",()=>{this.s.sessions.delete(n)}),this.s.sessions.add(n),n}endSessions(t,r){Array.isArray(t)||(t=[t]),this.command("admin.$cmd",{endSessions:t},{readPreference:Yn.primaryPreferred,noResponse:!0,serverApi:this.serverApi},()=>{typeof r=="function"&&r()})}serverUpdateHandler(t){if(!this.s.description.hasServer(t.address)||Zte(this.s.description,t))return;let r=this.s.description,n=this.s.description.servers.get(t.address),i=t.$clusterTime;i&&Ite(this,i);let s=n&&n.equals(t);if(this.s.description=this.s.description.update(t),this.s.description.compatibilityError){this.emit("error",new Xd(this.s.description.compatibilityError));return}s||this.emit("serverDescriptionChanged",new ro.ServerDescriptionChangedEvent(this.s.id,t.address,n,this.s.description.servers.get(t.address))),j$(this,t),this[gi].length>0&&$$(this),s||this.emit("topologyDescriptionChanged",new ro.TopologyDescriptionChangedEvent(this.s.id,r,this.s.description))}auth(t,r){typeof t=="function"&&(r=t,t=null),typeof r=="function"&&r(null,!0)}logout(t){typeof t=="function"&&t(null,!0)}insert(t,r,n,i){Jd({topology:this,op:"insert",ns:t,ops:r},n,i)}update(t,r,n,i){Jd({topology:this,op:"update",ns:t,ops:r},n,i)}remove(t,r,n,i){Jd({topology:this,op:"remove",ns:t,ops:r},n,i)}command(t,r,n,i){typeof n=="function"&&(i=n,n={},n=n||{}),Yn.translate(n);let s=n.readPreference||Yn.primary;this.selectServer(Gd(s),n,(o,a)=>{if(o){i(o);return}let u=!n.retrying,c=!!n.retryWrites,f=!!n.session,h=a.supportsRetryableWrites,d=!f||!n.session.inTransaction(),p=u&&c&&f&&h&&d&&Xte(r),m=(y,g)=>{if(!y)return i(null,g);if(!B$(y))return i(y);if(p){let w=Object.assign({},n,{retrying:!0});return this.command(t,r,w,i)}return i(y)};p&&(n.session.incrementTransactionNumber(),n.willRetryWrite=p),a.command(t,r,n,m)})}cursor(t,r,n){n=n||{};let i=n.topology||this,s=n.cursorFactory||this.s.Cursor;return Yn.translate(n),new s(i,t,r,n)}get clientMetadata(){return this.s.options.metadata}isConnected(){return this.s.state===wu}isDestroyed(){return this.s.state===_i}unref(){Wte("`unref` is a noop and will be removed in the next major version")}lastIsMaster(){let t=Array.from(this.description.servers.values());return t.length===0?{}:t.filter(i=>i.type!==Tte.Unknown)[0]||{maxWireVersion:this.description.commonWireVersion}}get logicalSessionTimeoutMinutes(){return this.description.logicalSessionTimeoutMinutes}get bson(){return this.s.bson}};Object.defineProperty(vu.prototype,"clusterTime",{enumerable:!0,get:function(){return this.s.clusterTime},set:function(e){this.s.clusterTime=e}});vu.prototype.destroy=Mte(vu.prototype.close,"destroy() is deprecated, please use close() instead");var Jte=["findAndModify","insert","update","delete"];function Xte(e){return Jte.some(t=>e[t])}function Zte(e,t){let n=e.servers.get(t.address).topologyVersion;return Vte(n,t.topologyVersion)>0}function R$(e,t,r,n){r=r||{},Qte.forEach(i=>e.removeAllListeners(i)),e.destroy(r,()=>{t.emit("serverClosed",new ro.ServerClosedEvent(t.s.id,e.description.address)),I$.forEach(i=>e.removeAllListeners(i)),typeof n=="function"&&n()})}function ere(e){return e.split(",").map(t=>({host:t.split(":")[0],port:t.split(":")[1]||27017}))}function tre(e,t){return t.directConnection?os.Single:(t.replicaSet||t.setName||t.rs_name)==null?os.Unknown:os.ReplicaSetNoPrimary}function rre(e){return e[Math.floor(Math.random()*e.length)]}function D$(e,t,r){e.emit("serverOpening",new ro.ServerOpeningEvent(e.s.id,t.address));let n=new Ate(t,e.s.options,e);if(xte(n,e,I$),n.on("descriptionReceived",e.serverUpdateHandler.bind(e)),r){let i=setTimeout(()=>{Hte(i,e.s.connectionTimers),n.connect()},r);return e.s.connectionTimers.add(i),n}return n.connect(),n}function nre(e,t){e.s.servers=t.reduce((r,n)=>{let i=D$(e,n);return r.set(n.address,i),r},new Map)}function j$(e,t){if(t&&e.s.servers.has(t.address)){let r=e.s.servers.get(t.address);r.s.description=t}for(let r of e.description.servers.values())if(!e.s.servers.has(r.address)){let n=D$(e,r);e.s.servers.set(r.address,n)}for(let r of e.s.servers){let n=r[0];if(e.description.hasServer(n))continue;let i=e.s.servers.get(n);e.s.servers.delete(n),R$(i,e)}}function Jd(e,t,r){typeof t=="function"&&(r=t,t={}),t=t||{};let n=e.topology,i=e.op,s=e.ns,o=e.ops;n.selectServer(Kte(),t,(a,u)=>{if(a){r(a,null);return}let c=!e.retrying,f=!!t.retryWrites,h=!!t.session,d=u.supportsRetryableWrites,p=!h||!t.session.inTransaction(),m=t.explain===void 0,y=c&&f&&h&&d&&p&&m,g=(w,S)=>{if(!w)return r(null,S);if(!B$(w))return w=Dte(w),r(w);if(y){let v=Object.assign({},e,{retrying:!0});return Jd(v,t,r)}return r(w)};r.operationId&&(g.operationId=r.operationId),y&&(t.session.incrementTransactionNumber(),t.willRetryWrite=y),u[i](s,o,t,g)})}function B$(e){return e instanceof Xd&&e.hasErrorLabel("RetryableWriteError")}function ire(e){return function(r){let n=e.s.description;e.s.description=e.s.description.updateFromSrvPollingEvent(r),e.s.description!==n&&(j$(e),e.emit("topologyDescriptionChanged",new ro.TopologyDescriptionChangedEvent(e.s.id,n,e.s.description)))}}function L$(e,t){for(;e.length;){let r=e.shift();clearTimeout(r.timer),r[wS]||r.callback(t)}}function $$(e){if(e.s.state===_i){L$(e[gi],new Xd("Topology is closed, please connect"));return}let t=Array.from(e.description.servers.values()),r=e[gi].length;for(let n=0;n<r&&e[gi].length;++n){let i=e[gi].shift();if(i[wS])continue;let s;try{let f=i.serverSelector;s=f?f(e.description,t):t}catch(f){clearTimeout(i.timer),i.callback(f);continue}if(s.length===0){e[gi].push(i);continue}let o=rre(s),a=e.s.servers.get(o.address),u=i.transaction;e.description.type===os.Sharded&&u&&u.isActive&&u.pinServer(a),clearTimeout(i.timer),i.callback(void 0,a)}e[gi].length>0&&e.s.servers.forEach(n=>process.nextTick(()=>n.requestCheck()))}k$.exports={Topology:vu}});var G$=_((lAe,K$)=>{"use strict";var Zd=require("url"),ea=require("querystring"),U$=require("dns"),Ae=se().MongoParseError,sre=ir(),ore=N().emitWarningOnce,are=/(mongodb(?:\+srv|)):\/\/(?: (?:[^:]*) (?: : ([^@]*) )? @ )?([^/?]*)(?:\/|)(.*)/,ure=new Set(["sslCA","sslCert","sslKey","tlsCAFile","tlsCertificateKeyFile"].map(e=>e.toLowerCase()));function cre(e,t){let r=/^.*?\./,n=`.${e.replace(r,"")}`,i=`.${t.replace(r,"")}`;return n.endsWith(i)}function lre(e,t,r){let n=Zd.parse(e,!0);if(t.directConnection||t.directconnection)return r(new Ae("directConnection not supported with SRV URI"));if(n.hostname.split(".").length<3)return r(new Ae("URI does not have hostname, domain name and tld"));if(n.domainLength=n.hostname.split(".").length,e.substring(14).split("/")[0].match(","))return r(new Ae("Invalid URI, cannot contain multiple hostnames"));if(n.port)return r(new Ae(`Ports not accepted with '${SS}' URIs`));let s=n.host;U$.resolveSrv(`_mongodb._tcp.${s}`,(o,a)=>{if(o)return r(o);if(a.length===0)return r(new Ae("No addresses found at host"));for(let u=0;u<a.length;u++)if(!cre(a[u].name,n.hostname,n.domainLength))return r(new Ae("Server record does not share hostname with parent URI"));n.protocol="mongodb",n.host=a.map(u=>`${u.name}:${u.port}`).join(","),!("ssl"in t)&&(!n.search||!("ssl"in n.query)||n.query.ssl===null)&&(n.query.ssl=!0),U$.resolveTxt(s,(u,c)=>{if(u){if(u.code!=="ENODATA"&&u.code!=="ENOTFOUND")return r(u);c=null}if(c){if(c.length>1)return r(new Ae("Multiple text records not allowed"));if(c=ea.parse(c[0].join("")),Object.keys(c).some(h=>h.toLowerCase()==="loadbalanced"))return r(new Ae("Load balancer mode requires driver version 4+"));if(Object.keys(c).some(h=>h!=="authSource"&&h!=="replicaSet"))return r(new Ae("Text record must only set `authSource` or `replicaSet`"));n.query=Object.assign({},c,n.query)}n.search=ea.stringify(n.query);let f=Zd.format(n);H$(f,t,(h,d)=>{if(h){r(h);return}r(null,Object.assign({},d,{srvHost:s}))})})})}function vS(e,t){if(Array.isArray(t))t=t.filter((r,n)=>t.indexOf(r)===n),t.length===1&&(t=t[0]);else if(t.indexOf(":")>0)t=t.split(",").reduce((r,n)=>{let i=n.split(":");return r[i[0]]=vS(e,i[1]),r},{});else if(t.indexOf(",")>0)t=t.split(",").map(r=>vS(e,r));else if(t.toLowerCase()==="true"||t.toLowerCase()==="false")t=t.toLowerCase()==="true";else if(!Number.isNaN(t)&&!hre.has(e)){let r=parseFloat(t);Number.isNaN(r)||(t=parseFloat(t))}return t}var fre=new Set(["slaveok","slave_ok","sslvalidate","fsync","safe","retrywrites","j"]),hre=new Set(["authsource","replicaset"]),V$=new Set(["GSSAPI","MONGODB-AWS","MONGODB-X509","MONGODB-CR","DEFAULT","SCRAM-SHA-1","SCRAM-SHA-256","PLAIN"]),W$={replicaset:"replicaSet",connecttimeoutms:"connectTimeoutMS",sockettimeoutms:"socketTimeoutMS",maxpoolsize:"maxPoolSize",minpoolsize:"minPoolSize",maxidletimems:"maxIdleTimeMS",waitqueuemultiple:"waitQueueMultiple",waitqueuetimeoutms:"waitQueueTimeoutMS",wtimeoutms:"wtimeoutMS",readconcern:"readConcern",readconcernlevel:"readConcernLevel",readpreference:"readPreference",maxstalenessseconds:"maxStalenessSeconds",readpreferencetags:"readPreferenceTags",authsource:"authSource",authmechanism:"authMechanism",authmechanismproperties:"authMechanismProperties",gssapiservicename:"gssapiServiceName",localthresholdms:"localThresholdMS",serverselectiontimeoutms:"serverSelectionTimeoutMS",serverselectiontryonce:"serverSelectionTryOnce",heartbeatfrequencyms:"heartbeatFrequencyMS",retrywrites:"retryWrites",uuidrepresentation:"uuidRepresentation",zlibcompressionlevel:"zlibCompressionLevel",tlsallowinvalidcertificates:"tlsAllowInvalidCertificates",tlsallowinvalidhostnames:"tlsAllowInvalidHostnames",tlsinsecure:"tlsInsecure",tlscafile:"tlsCAFile",tlscertificatekeyfile:"tlsCertificateKeyFile",tlscertificatekeyfilepassword:"tlsCertificateKeyFilePassword",wtimeout:"wTimeoutMS",j:"journal",directconnection:"directConnection"};function dre(e,t,r,n){if(t==="journal"?t="j":t==="wtimeoutms"&&(t="wtimeout"),fre.has(t)?r=r==="true"||r===!0:t==="appname"?r=decodeURIComponent(r):t==="readconcernlevel"&&(e.readConcernLevel=r,t="readconcern",r={level:r}),t==="compressors"&&(r=Array.isArray(r)?r:[r],!r.every(i=>i==="snappy"||i==="zlib")))throw new Ae("Value for `compressors` must be at least one of: `snappy`, `zlib`");if(t==="authmechanism"&&!V$.has(r))throw new Ae(`Value for authMechanism must be one of: ${Array.from(V$).join(", ")}, found: ${r}`);if(t==="readpreference"&&!sre.isValid(r))throw new Ae("Value for `readPreference` must be one of: `primary`, `primaryPreferred`, `secondary`, `secondaryPreferred`, `nearest`");if(t==="zlibcompressionlevel"&&(r<-1||r>9))throw new Ae("zlibCompressionLevel must be an integer between -1 and 9");if((t==="compressors"||t==="zlibcompressionlevel")&&(e.compression=e.compression||{},e=e.compression),t==="authmechanismproperties"&&(typeof r.SERVICE_NAME=="string"&&(e.gssapiServiceName=r.SERVICE_NAME),typeof r.SERVICE_REALM=="string"&&(e.gssapiServiceRealm=r.SERVICE_REALM),typeof r.CANONICALIZE_HOST_NAME<"u"&&(e.gssapiCanonicalizeHostName=r.CANONICALIZE_HOST_NAME)),t==="readpreferencetags"&&(r=Array.isArray(r)?mre(r):[r]),n.caseTranslate&&W$[t]){e[W$[t]]=r;return}e[t]=r}var pre=new Set(["GSSAPI","MONGODB-CR","PLAIN","SCRAM-SHA-1","SCRAM-SHA-256"]);function mre(e){let t=[];for(let r=0;r<e.length;r++)t[r]={},e[r].split(",").forEach(n=>{let i=n.split(":");t[r][i[0]]=i[1]});return t}function yre(e){if(e.options==null)return;let t=e.options,r=t.authsource||t.authSource;r!=null&&(e.auth=Object.assign({},e.auth,{db:r}));let n=t.authmechanism||t.authMechanism;if(n!=null){if(pre.has(n)&&(!e.auth||e.auth.username==null))throw new Ae(`Username required for mechanism \`${n}\``);if(n==="GSSAPI"){if(r!=null&&r!=="$external")throw new Ae(`Invalid source \`${r}\` for mechanism \`${n}\` specified.`);e.auth=Object.assign({},e.auth,{db:"$external"})}if(n==="MONGODB-AWS"){if(r!=null&&r!=="$external")throw new Ae(`Invalid source \`${r}\` for mechanism \`${n}\` specified.`);e.auth=Object.assign({},e.auth,{db:"$external"})}if(n==="MONGODB-X509"){if(e.auth&&e.auth.password!=null)throw new Ae(`Password not allowed for mechanism \`${n}\``);if(r!=null&&r!=="$external")throw new Ae(`Invalid source \`${r}\` for mechanism \`${n}\` specified.`);e.auth=Object.assign({},e.auth,{db:"$external"})}n==="PLAIN"&&e.auth&&e.auth.db==null&&(e.auth=Object.assign({},e.auth,{db:"$external"}))}return e.auth&&e.auth.db==null&&(e.auth=Object.assign({},e.auth,{db:"admin"})),e}function gre(e,t){let r={},n=ea.parse(e);wre(n);for(let i in n){let s=n[i];if(s===""||s==null)throw new Ae("Incomplete key value pair for option");let o=i.toLowerCase();if(o==="serverapi")throw new Ae("URI cannot contain `serverApi`, it can only be passed to the client");let a=ure.has(o)?s:vS(o,s);dre(r,o,a,t)}return r.wtimeout&&r.wtimeoutms&&(delete r.wtimeout,ore("Unsupported option `wtimeout` specified")),Object.keys(r).length?r:null}function _re(e){return e.tls&&(e.ssl=e.tls),e.tlsInsecure?(e.checkServerIdentity=!1,e.sslValidate=!1):Object.assign(e,{checkServerIdentity:!e.tlsAllowInvalidHostnames,sslValidate:!e.tlsAllowInvalidCertificates}),e.tlsCAFile&&(e.ssl=!0,e.sslCA=e.tlsCAFile),e.tlsCertificateKeyFile&&(e.ssl=!0,e.tlsCertificateFile?(e.sslCert=e.tlsCertificateFile,e.sslKey=e.tlsCertificateKeyFile):(e.sslKey=e.tlsCertificateKeyFile,e.sslCert=e.tlsCertificateKeyFile)),e.tlsCertificateKeyFilePassword&&(e.ssl=!0,e.sslPass=e.tlsCertificateKeyFilePassword),e}function wre(e){let t=Object.keys(e);if(t.indexOf("tlsInsecure")!==-1&&(t.indexOf("tlsAllowInvalidCertificates")!==-1||t.indexOf("tlsAllowInvalidHostnames")!==-1))throw new Ae("The `tlsInsecure` option cannot be used with `tlsAllowInvalidCertificates` or `tlsAllowInvalidHostnames`.");let r=z$("tls",e,t),n=z$("ssl",e,t);if(r!=null&&n!=null&&r!==n)throw new Ae("All values of `tls` and `ssl` must be the same.")}function z$(e,t,r){let n=r.indexOf(e)!==-1,i;if(Array.isArray(t[e])?i=t[e][0]:i=t[e],n&&Array.isArray(t[e])){let s=t[e][0];t[e].forEach(o=>{if(o!==s)throw new Ae(`All values of ${e} must be the same.`)})}return i}var vre="mongodb",SS="mongodb+srv",Sre=[vre,SS];function H$(e,t,r){typeof t=="function"&&(r=t,t={}),t=Object.assign({},{caseTranslate:!0},t);try{Zd.parse(e)}catch{return r(new Ae("URI malformed, cannot be parsed"))}let n=e.match(are);if(!n)return r(new Ae("Invalid connection string"));let i=n[1];if(Sre.indexOf(i)===-1)return r(new Ae("Invalid protocol provided"));let s=n[4].split("?"),o=s.length>0?s[0]:null,a=s.length>1?s[1]:null,u;try{u=gre(a,t)}catch(y){return r(y)}if(u=Object.assign({},u,t),Object.keys(u).some(y=>y.toLowerCase()==="loadbalanced"))return r(new Ae("Load balancer mode requires driver version 4+"));if(i===SS)return lre(e,u,r);let c={username:null,password:null,db:o&&o!==""?ea.unescape(o):null};if(u.auth?(u.auth.username&&(c.username=u.auth.username),u.auth.user&&(c.username=u.auth.user),u.auth.password&&(c.password=u.auth.password)):(u.username&&(c.username=u.username),u.user&&(c.username=u.user),u.password&&(c.password=u.password)),n[4].split("?")[0].indexOf("@")!==-1)return r(new Ae("Unescaped slash in userinfo section"));let f=n[3].split("@");if(f.length>2)return r(new Ae("Unescaped at-sign in authority section"));if(f[0]==null||f[0]==="")return r(new Ae("No username provided in authority section"));if(f.length>1){let y=f.shift().split(":");if(y.length>2)return r(new Ae("Unescaped colon in authority section"));if(y[0]==="")return r(new Ae("Invalid empty username provided"));c.username||(c.username=ea.unescape(y[0])),c.password||(c.password=y[1]?ea.unescape(y[1]):null)}let h=null,d=f.shift().split(",").map(y=>{let g=Zd.parse(`mongodb://${y}`);if(g.path==="/:")return h=new Ae("Double colon in host identifier"),null;if(y.match(/\.sock/)&&(g.hostname=ea.unescape(y),g.port=null),Number.isNaN(g.port)){h=new Ae("Invalid port (non-numeric string)");return}let w={host:g.hostname,port:g.port?parseInt(g.port):27017};if(w.port===0){h=new Ae("Invalid port (zero) with hostname");return}if(w.port>65535){h=new Ae("Invalid port (larger than 65535) with hostname");return}if(w.port<0){h=new Ae("Invalid port (negative number)");return}return w}).filter(y=>!!y);if(h)return r(h);if(d.length===0||d[0].host===""||d[0].host===null)return r(new Ae("No hostname or hostnames provided in connection string"));if(!!u.directConnection&&d.length!==1)return r(new Ae("directConnection option requires exactly one host"));u.directConnection==null&&d.length===1&&u.replicaSet==null&&(u.directConnection=!0);let m={hosts:d,auth:c.db||c.username?c:null,options:Object.keys(u).length?u:null};m.auth&&m.auth.db?m.defaultDatabase=m.auth.db:m.defaultDatabase="test",m.options=_re(m.options);try{yre(m)}catch(y){return r(y)}r(null,m)}K$.exports=H$});var ie=_((fAe,Y$)=>{"use strict";var Q$=I_(),Ore=Mh()(require),bre=he().retrieveEJSON();try{let e=Ore("bson-ext");e&&(Q$=e)}catch{}var OS=Object.freeze({v1:"1"}),Ere=Object.keys(OS).map(e=>OS[e]);Y$.exports={ServerApiVersion:OS,ValidServerApiVersions:Ere,MongoError:se().MongoError,MongoNetworkError:se().MongoNetworkError,MongoParseError:se().MongoParseError,MongoTimeoutError:se().MongoTimeoutError,MongoServerSelectionError:se().MongoServerSelectionError,MongoWriteConcernError:se().MongoWriteConcernError,Connection:iw(),Server:md(),ReplSet:TM(),Mongos:RM(),Logger:Mn(),Cursor:$n().CoreCursor,ReadPreference:ir(),Sessions:Bs(),BSON:Q$,EJSON:bre,Topology:F$().Topology,Query:dn().Query,MongoCredentials:xw().MongoCredentials,defaultAuthProviders:$w().defaultAuthProviders,MongoCR:mw(),X509:gw(),Plain:ww(),GSSAPI:Ow(),ScramSHA1:Yc().ScramSHA1,ScramSHA256:Yc().ScramSHA256,parseConnectionString:G$()}});var X$=_((hAe,J$)=>{"use strict";var Cre=require("events").EventEmitter,bS=class extends Cre{constructor(){super()}instrument(t,r){this.$MongoClient=t;let n=this.$prototypeConnect=t.prototype.connect,i=this;t.prototype.connect=function(s){return this.s.options.monitorCommands=!0,this.on("commandStarted",o=>i.emit("started",o)),this.on("commandSucceeded",o=>i.emit("succeeded",o)),this.on("commandFailed",o=>i.emit("failed",o)),n.call(this,s)},typeof r=="function"&&r(null,this)}uninstrument(){this.$MongoClient.prototype.connect=this.$prototypeConnect}};J$.exports=bS});var Nl=_((dAe,eP)=>{"use strict";var Tre=ie().MongoNetworkError,Ht=xo().MONGODB_ERROR_CODES,Z$=new Set([Ht.HostUnreachable,Ht.HostNotFound,Ht.NetworkTimeout,Ht.ShutdownInProgress,Ht.PrimarySteppedDown,Ht.ExceededTimeLimit,Ht.SocketException,Ht.NotMaster,Ht.InterruptedAtShutdown,Ht.InterruptedDueToReplStateChange,Ht.NotMasterNoSlaveOk,Ht.NotMasterOrSecondary,Ht.StaleShardVersion,Ht.StaleEpoch,Ht.StaleConfig,Ht.RetryChangeStream,Ht.FailedToSatisfyReadPreference,Ht.CursorNotFound]);function Are(e,t){return e instanceof Tre?!0:t>=9?e.code===Ht.CursorNotFound?!0:e.hasErrorLabel("ResumableChangeStreamError"):Z$.has(e.code)}eP.exports={GET_MORE_RESUMABLE_CODES:Z$,isResumableError:Are,MONGODB_ERROR_CODES:Ht}});var ep=_((pAe,tP)=>{"use strict";tP.exports={SYSTEM_NAMESPACE_COLLECTION:"system.namespaces",SYSTEM_INDEX_COLLECTION:"system.indexes",SYSTEM_PROFILE_COLLECTION:"system.profile",SYSTEM_USER_COLLECTION:"system.users",SYSTEM_COMMAND_COLLECTION:"$cmd",SYSTEM_JS_COLLECTION:"system.js"}});var ur=_((mAe,aP)=>{"use strict";var ta=xo().MONGODB_ERROR_CODES,ES=N().applyWriteConcern,xre=ie().BSON.Code,qre=N().debugOptions,bt=N().handleCallback,yn=ie().MongoError,rP=N().parseIndexOptions,Su=ie().ReadPreference,nP=N().toError,Mre=Io().extractCommand,Nre=ep(),$re=N().MongoDBNamespace,Pre=["authSource","w","wtimeout","j","native_parser","forceServerObjectId","serializeFunctions","raw","promoteLongs","promoteValues","promoteBuffers","bsonRegExp","bufferMaxEntries","numberOfRetries","retryMiliSeconds","readPreference","pkFactory","parentDb","promiseLibrary","noListener"];function iP(e,t,r,n,i){let s=Object.assign({},{readPreference:Su.PRIMARY},n);if(s=ES(s,{db:e},n),s.writeConcern&&typeof i!="function")throw yn.create({message:"Cannot use a writeConcern without a provided callback",driver:!0});if(e.serverConfig&&e.serverConfig.isDestroyed())return i(new yn("topology was destroyed"));kre(e,t,r,s,(o,a)=>{if(o==null||o.code===ta.CannotCreateIndex||o.code===ta.DuplicateKey||o.code===ta.IndexOptionsConflict||o.code===ta.IndexKeySpecsConflict||o.code===ta.InterruptedAtShutdown||o.code===ta.InvalidIndexSpecificationOption)return bt(i,o,a);let u=oP(e,t,r,n);s.checkKeys=!1,e.s.topology.insert(e.s.namespace.withCollection(Nre.SYSTEM_INDEX_COLLECTION),u,s,(c,f)=>{if(i!=null){if(c)return bt(i,c);if(f==null)return bt(i,null,null);if(f.result.writeErrors)return bt(i,yn.create(f.result.writeErrors[0]),null);bt(i,null,u.name)}})})}function Ire(e,t,r){function n(i){if(r.listeners(t).length>0){r.emit(t,i,e);for(let s=0;s<e.s.children.length;s++)e.s.children[s].emit(t,i,e.s.children[s])}}return n}function Rre(e,t,r,n,i){let s=ES({},{db:e},n),a=oP(e,t,r,n).name;if(e.serverConfig&&e.serverConfig.isDestroyed())return i(new yn("topology was destroyed"));s.readPreference=Su.PRIMARY,sP(e,t,s,(u,c)=>{if(u!=null&&u.code!==ta.NamespaceNotFound)return bt(i,u,null);if(c==null||!c[a])iP(e,t,r,n,i);else if(typeof i=="function")return bt(i,null,a)})}function Dre(e,t,r,n,i){let s=t,o=[];if(e.serverConfig&&e.serverConfig.isDestroyed())return i(new yn("topology was destroyed"));s&&s._bsontype==="Code"||(s=new xre(s)),r!=null&&!Array.isArray(r)&&typeof r!="function"?o=[r]:r!=null&&Array.isArray(r)&&typeof r!="function"&&(o=r);let a={$eval:s,args:o};n.nolock&&(a.nolock=n.nolock),n.readPreference=new Su(Su.PRIMARY),CS(e,a,n,(u,c)=>{if(u)return bt(i,u,null);if(c&&c.ok===1)return bt(i,null,c.retval);if(c)return bt(i,yn.create({message:`eval failed: ${c.errmsg}`,driver:!0}),null);bt(i,u,c)})}function CS(e,t,r,n){if(e.serverConfig&&e.serverConfig.isDestroyed())return n(new yn("topology was destroyed"));let i=r.dbName||r.authdb||e.databaseName;if(r.readPreference=Su.resolve(e,r),e.s.logger.isDebug()){let s=Mre(t);e.s.logger.debug(`executing command ${JSON.stringify(s.shouldRedact?`${s.name} details REDACTED`:t)} against ${i}.$cmd with options [${JSON.stringify(qre(Pre,r))}]`)}e.s.topology.command(e.s.namespace.withCollection("$cmd"),t,r,(s,o)=>{if(s)return bt(n,s);if(r.full)return bt(n,null,o);bt(n,null,o.result)})}function jre(e,t,r,n){let i=new $re("admin","$cmd");e.s.topology.command(i,t,r,(s,o)=>{if(e.serverConfig&&e.serverConfig.isDestroyed())return n(new yn("topology was destroyed"));if(s)return bt(n,s);bt(n,null,o.result)})}function sP(e,t,r,n){let i=r.full==null?!1:r.full;if(e.serverConfig&&e.serverConfig.isDestroyed())return n(new yn("topology was destroyed"));function s(o){let a={};for(let u=0;u<o.length;u++){let c=o[u];a[c.name]=[];for(let f in c.key)a[c.name].push([f,c.key[f]])}return a}e.collection(t).listIndexes(r).toArray((o,a)=>{if(o)return n(nP(o));if(!Array.isArray(a))return bt(n,null,[]);if(i)return bt(n,null,a);bt(n,null,s(a))})}function Bre(e,t,r){try{e.collection("system.profile").find({},t).toArray(r)}catch(n){return r(n,null)}}function Lre(e){if(typeof e!="string")throw yn.create({message:"database name must be a string",driver:!0});if(e.length===0)throw yn.create({message:"database name cannot be the empty string",driver:!0});if(e==="$external")return;let t=[" ",".","$","/","\\"];for(let r=0;r<t.length;r++)if(e.indexOf(t[r])!==-1)throw yn.create({message:"database names cannot contain the character '"+t[r]+"'",driver:!0})}function oP(e,t,r,n){let i=rP(r),s=i.fieldHash,o=typeof n.name=="string"?n.name:i.name,a={ns:e.s.namespace.withCollection(t).toString(),key:s,name:o},u=n==null||typeof n=="object"?!1:n;n=n==null||typeof n=="boolean"?{}:n;let c=Object.keys(a);for(let h in n)c.indexOf(h)===-1&&(a[h]=n[h]);a.unique==null&&(a.unique=u);let f=["w","wtimeout","j","fsync","readPreference","session"];for(let h=0;h<f.length;h++)delete a[f[h]];return a}function kre(e,t,r,n,i){let s=rP(r),o=typeof n.name=="string"?n.name:s.name,a=[{name:o,key:s.fieldHash}],u=Object.keys(a[0]).concat(["writeConcern","w","wtimeout","j","fsync","readPreference","session"]);for(let h in n)u.indexOf(h)===-1&&(a[0][h]=n[h]);let c=e.s.topology.capabilities();if(a[0].collation&&c&&!c.commandsTakeCollation){let h=new yn("server/primary/mongos does not support collation");return h.code=67,i(h)}let f=ES({createIndexes:t,indexes:a},{db:e},n);n.readPreference=Su.PRIMARY,CS(e,f,n,(h,d)=>{if(h)return bt(i,h,null);if(d.ok===0)return bt(i,nP(d),null);bt(i,null,o)})}aP.exports={createListener:Ire,createIndex:iP,ensureIndex:Rre,evaluate:Dre,executeCommand:CS,executeDbAdminCommand:jre,indexInformation:sP,profilingInfo:Bre,validateDatabaseName:Lre}});var Lr=_((yAe,fP)=>{"use strict";var tp=N().applyRetryableWrites,rp=N().applyWriteConcern,$l=N().decorateWithCollation,Fre=N().decorateWithReadConcern,Ure=ur().executeCommand,uP=N().formattedOrderClause,Ot=N().handleCallback,np=ie().MongoError,Vre=ie().ReadPreference,as=N().toError,TS=$n().CursorState,cP=he().maxWireVersion;function Wre(e,t,r){let n=r.skip,i=r.limit,s=r.hint,o=r.maxTimeMS;t=t||{};let a={count:r.collectionName,query:t};return e.s.numberOfRetries?(e.options.hint?s=e.options.hint:e.cmd.hint&&(s=e.cmd.hint),$l(a,e,e.cmd)):$l(a,e,r),typeof n=="number"&&(a.skip=n),typeof i=="number"&&(a.limit=i),typeof o=="number"&&(a.maxTimeMS=o),s&&(a.hint=s),Fre(a,e),a}function zre(e,t,r,n,i,s){let o={findAndModify:e.collectionName,query:t};r=uP(r),r&&(o.sort=r),o.new=!!i.new,o.remove=!!i.remove,o.upsert=!!i.upsert;let a=i.projection||i.fields;a&&(o.fields=a),i.arrayFilters&&(o.arrayFilters=i.arrayFilters,delete i.arrayFilters),n&&!i.remove&&(o.update=n),i.maxTimeMS&&(o.maxTimeMS=i.maxTimeMS),i.serializeFunctions=i.serializeFunctions||e.s.serializeFunctions,i.checkKeys=!1;let u=Object.assign({},i);u=tp(u,e.s.db),u=rp(u,{db:e.s.db,collection:e},i),u.writeConcern&&(o.writeConcern=u.writeConcern),u.bypassDocumentValidation===!0&&(o.bypassDocumentValidation=u.bypassDocumentValidation),u.readPreference=Vre.primary;try{$l(o,e,u)}catch(c){return s(c,null)}Ure(e.s.db,o,u,(c,f)=>c?Ot(s,c,null):Ot(s,null,f))}function Hre(e,t,r,n){let i=r.full==null?!1:r.full;if(e.serverConfig&&e.serverConfig.isDestroyed())return n(new np("topology was destroyed"));function s(o){let a={};for(let u=0;u<o.length;u++){let c=o[u];a[c.name]=[];for(let f in c.key)a[c.name].push([f,c.key[f]])}return a}e.collection(t).listIndexes(r).toArray((o,a)=>{if(o)return n(as(o));if(!Array.isArray(a))return Ot(n,null,[]);if(i)return Ot(n,null,a);Ot(n,null,s(a))})}function lP(e,t,r){let n=typeof r.forceServerObjectId=="boolean"?r.forceServerObjectId:e.s.db.options.forceServerObjectId;return n===!0?t:t.map(i=>(n!==!0&&i._id==null&&(i._id=e.s.pkFactory.createPk()),i))}function Kre(e,t){if(e.s.state===TS.CLOSED||e.isDead&&e.isDead())return Ot(t,np.create({message:"Cursor is closed",driver:!0}));if(e.s.state===TS.INIT&&e.cmd&&e.cmd.sort)try{e.cmd.sort=uP(e.cmd.sort)}catch(r){return Ot(t,r)}e._next((r,n)=>{if(e.s.state=TS.OPEN,r)return Ot(t,r);Ot(t,null,n)})}function Gre(e,t,r,n){typeof r=="function"&&(n=r,r={}),r=r||{},t=Array.isArray(t)?t:[t];let i=Object.assign({},r);i=tp(i,e.s.db),i=rp(i,{db:e.s.db,collection:e},r),i.keepGoing===!0&&(i.ordered=!1),i.serializeFunctions=r.serializeFunctions||e.s.serializeFunctions,t=lP(e,t,r),e.s.topology.insert(e.s.namespace,t,i,(s,o)=>{if(n!=null){if(s)return Ot(n,s);if(o==null)return Ot(n,null,null);if(o.result.code)return Ot(n,as(o.result));if(o.result.writeErrors)return Ot(n,as(o.result.writeErrors[0]));o.ops=t,Ot(n,null,o)}})}function Qre(e,t,r,n){typeof r=="function"?(n=r,r={}):typeof t=="function"&&(n=t,r={},t={}),r=r||{};let i=Object.assign({},r);i=tp(i,e.s.db),i=rp(i,{db:e.s.db,collection:e},r),t==null&&(t={});let s={q:t,limit:0};r.single?s.limit=1:i.retryWrites&&(i.retryWrites=!1),r.hint&&(s.hint=r.hint);try{$l(i,e,r)}catch(o){return n(o,null)}if(r.explain!==void 0&&cP(e.s.topology)<3)return n?n(new np("server does not support explain on remove")):void 0;e.s.topology.remove(e.s.namespace,[s],i,(o,a)=>{if(n!=null){if(o)return Ot(n,o,null);if(a==null)return Ot(n,null,null);if(a.result.code)return Ot(n,as(a.result));if(a.result.writeErrors)return Ot(n,as(a.result.writeErrors[0]));Ot(n,null,a)}})}function Yre(e,t,r,n,i){if(typeof n=="function"&&(i=n,n=null),n==null&&(n={}),typeof i!="function"&&(i=null),t==null||typeof t!="object")return i(as("selector must be a valid JavaScript object"));if(r==null||typeof r!="object")return i(as("document must be a valid JavaScript object"));let s=Object.assign({},n);s=tp(s,e.s.db),s=rp(s,{db:e.s.db,collection:e},n),s.serializeFunctions=n.serializeFunctions||e.s.serializeFunctions;let o={q:t,u:r};o.upsert=n.upsert!==void 0?!!n.upsert:!1,o.multi=n.multi!==void 0?!!n.multi:!1,n.hint&&(o.hint=n.hint),s.arrayFilters&&(o.arrayFilters=s.arrayFilters,delete s.arrayFilters),s.retryWrites&&o.multi&&(s.retryWrites=!1);try{$l(s,e,n)}catch(a){return i(a,null)}if(n.explain!==void 0&&cP(e.s.topology)<3)return i?i(new np("server does not support explain on update")):void 0;e.s.topology.update(e.s.namespace,[o],s,(a,u)=>{if(i!=null){if(a)return Ot(i,a,null);if(u==null)return Ot(i,null,null);if(u.result.code)return Ot(i,as(u.result));if(u.result.writeErrors)return Ot(i,as(u.result.writeErrors[0]));Ot(i,null,u)}})}fP.exports={buildCountCommand:Wre,findAndModify:zre,indexInformation:Hre,nextObject:Kre,prepareDocs:lP,insertDocuments:Gre,removeDocuments:Qre,updateDocuments:Yre}});var Ou=_((gAe,yP)=>{"use strict";var Jre=N().applyWriteConcern,AS=ie().BSON.Code,Xre=ur().createIndex,Zre=N().decorateWithCollation,hP=N().decorateWithReadConcern,ene=ur().ensureIndex,tne=ur().evaluate,xS=ur().executeCommand,rn=N().handleCallback,dP=ur().indexInformation,rne=ie().BSON.Long,nne=ie().MongoError,pP=ie().ReadPreference,ine=Lr().insertDocuments,sne=Lr().updateDocuments,one=`function () {
var c = db[ns].find(condition);
var map = new Map();
var reduce_function = reduce;

while (c.hasNext()) {
var obj = c.next();
var key = {};

for (var i = 0, len = keys.length; i < len; ++i) {
var k = keys[i];
key[k] = obj[k];
}

var aggObj = map.get(key);

if (aggObj == null) {
var newObj = Object.extend({}, key);
aggObj = Object.extend(newObj, initial);
map.put(key, aggObj);
}

reduce_function(obj, aggObj);
}

return { "result": map.values() };
}`;function ane(e,t,r,n){Xre(e.s.db,e.collectionName,t,r,n)}function une(e,t,r,n){let i=e.s.topology.capabilities();for(let s=0;s<t.length;s++)if(t[s].name==null){let o=[];if(t[s].collation&&i&&!i.commandsTakeCollation)return n(new nne("server/primary/mongos does not support collation"));for(let a in t[s].key)o.push(`${a}_${t[s].key[a]}`);t[s].name=o.join("_")}r=Object.assign({},r,{readPreference:pP.PRIMARY}),xS(e.s.db,{createIndexes:e.collectionName,indexes:t},r,n)}function cne(e,t,r,n){ene(e.s.db,e.collectionName,t,r,n)}function lne(e,t,r,n,i,s,o,a,u){if(o){let c=i&&i._bsontype==="Code"?i:new AS(i),f={group:{ns:e.collectionName,$reduce:c,cond:r,initial:n,out:"inline"}};if(s!=null&&(f.group.finalize=s),typeof t=="function"||t&&t._bsontype==="Code")f.group.$keyf=t&&t._bsontype==="Code"?t:new AS(t);else{let h={};t.forEach(d=>{h[d]=1}),f.group.key=h}a=Object.assign({},a),a.readPreference=pP.resolve(e,a),hP(f,e,a);try{Zre(f,e,a)}catch(h){return u(h,null)}xS(e.s.db,f,a,(h,d)=>{if(h)return rn(u,h,null);rn(u,null,d.retval)})}else{let c=i!=null&&i._bsontype==="Code"?i.scope:{};c.ns=e.collectionName,c.keys=t,c.condition=r,c.initial=n;let f=one.replace(/ reduce;/,i.toString()+";");tne(e.s.db,new AS(f,c),null,a,(h,d)=>{if(h)return rn(u,h,null);rn(u,null,d.result||d)})}}function fne(e,t,r){t=Object.assign({},{full:!0},t),dP(e.s.db,e.collectionName,t,r)}function hne(e,t,r,n){mP(e,r,(i,s)=>{if(i!=null)return rn(n,i,null);if(!Array.isArray(t))return rn(n,null,s[t]!=null);for(let o=0;o<t.length;o++)if(s[t[o]]==null)return rn(n,null,!1);return rn(n,null,!0)})}function mP(e,t,r){dP(e.s.db,e.collectionName,t,r)}function dne(e,t,r){let n={parallelCollectionScan:e.collectionName,numCursors:t.numCursors};hP(n,e,t);let i=t.raw;delete t.raw,xS(e.s.db,n,t,(s,o)=>{if(s)return rn(r,s,null);if(o==null)return rn(r,new Error("no result returned for parallelCollectionScan"),null);t=Object.assign({explicitlyIgnoreSession:!0},t);let a=[];i&&(t.raw=i);for(let u=0;u<o.cursors.length;u++){let c=o.cursors[u].cursor.id,f=typeof c=="number"?rne.fromNumber(c):c;a.push(e.s.topology.cursor(e.namespace,f,t))}rn(r,null,a)})}function pne(e,t,r,n){let i=Jre(Object.assign({},r),{db:e.s.db,collection:e},r);if(t._id!=null)return i.upsert=!0,sne(e,{_id:t._id},t,i,n);ine(e,[t],i,(s,o)=>{if(n!=null){if(t==null)return rn(n,null,null);if(s)return rn(n,s,null);rn(n,null,o)}})}yP.exports={createIndex:ane,createIndexes:une,ensureIndex:cne,group:lne,indexes:fne,indexExists:hne,indexInformation:mP,parallelCollectionScan:dne,save:pne}});var vP=_((_Ae,wP)=>{"use strict";var mne=Ou().buildCountCommand,bu=N().handleCallback,gP=ie().MongoError,yne=Array.prototype.push,ip=$n().CursorState;function gne(e,t,r,n){t&&(typeof e.cursorSkip()=="number"&&(r.skip=e.cursorSkip()),typeof e.cursorLimit()=="number"&&(r.limit=e.cursorLimit())),r.readPreference&&e.setReadPreference(r.readPreference),typeof r.maxTimeMS!="number"&&e.cmd&&typeof e.cmd.maxTimeMS=="number"&&(r.maxTimeMS=e.cmd.maxTimeMS);let i={};i.skip=r.skip,i.limit=r.limit,i.hint=r.hint,i.maxTimeMS=r.maxTimeMS,i.collectionName=e.namespace.collection;let s;try{s=mne(e,e.cmd.query,i)}catch(o){return n(o)}e.server=e.topology.s.coreTopology,e.topology.command(e.namespace.withCollection("$cmd"),s,e.options,(o,a)=>{n(o,a?a.result.n:null)})}function qS(e,t){if(!t)throw gP.create({message:"callback is mandatory",driver:!0});if(e.isNotified())return;if(e.s.state===ip.CLOSED||e.isDead())return bu(t,gP.create({message:"Cursor is closed",driver:!0}));e.s.state===ip.INIT&&(e.s.state=ip.OPEN);let r=null;if(e.bufferedCount()>0){for(;r=_P(e,t);)r(e,t);qS(e,t)}else e.next((n,i)=>{if(n)return bu(t,n);if(i==null)return e.close({skipKillCursors:!0},()=>bu(t,null,null));bu(t,null,i)!==!1&&qS(e,t)})}function _P(e,t){if(e.bufferedCount()!==0)return e._next(t),_P}function _ne(e,t){let r=[];e.rewind(),e.s.state=ip.INIT;let n=()=>{e._next((i,s)=>{if(i)return bu(t,i);if(s==null)return e.close({skipKillCursors:!0},()=>bu(t,null,r));if(r.push(s),e.bufferedCount()>0){let o=e.readBufferedDocuments(e.bufferedCount());e.s.transforms&&typeof e.s.transforms.doc=="function"&&(o=o.map(e.s.transforms.doc)),yne.apply(r,o)}n()})};n()}wP.exports={count:gne,each:qS,toArray:_ne}});var OP=_((wAe,SP)=>{"use strict";var wne=Lr().buildCountCommand,vne=ne().OperationBase,MS=class extends vne{constructor(t,r,n){super(n),this.cursor=t,this.applySkipLimit=r}execute(t){let r=this.cursor,n=this.applySkipLimit,i=this.options;n&&(typeof r.cursorSkip()=="number"&&(i.skip=r.cursorSkip()),typeof r.cursorLimit()=="number"&&(i.limit=r.cursorLimit())),i.readPreference&&r.setReadPreference(i.readPreference),typeof i.maxTimeMS!="number"&&r.cmd&&typeof r.cmd.maxTimeMS=="number"&&(i.maxTimeMS=r.cmd.maxTimeMS);let s={};s.skip=i.skip,s.limit=i.limit,s.hint=i.hint,s.maxTimeMS=i.maxTimeMS,s.collectionName=r.namespace.collection;let o;try{o=wne(r,r.cmd.query,s)}catch(a){return t(a)}r.server=r.topology.s.coreTopology,r.topology.command(r.namespace.withCollection("$cmd"),o,r.options,(a,u)=>{t(a,u?u.result.n:null)})}};SP.exports=MS});var vi=_((vAe,xP)=>{"use strict";var Sne=require("stream").Transform,One=require("stream").PassThrough,$S=require("util").deprecate,bP=N().handleCallback,EP=ie().ReadPreference,xe=ie().MongoError,CP=$n().CoreCursor,ye=$n().CursorState,bne=ie().BSON.Map,Pl=N().maybePromise,Ene=su(),Cne=N().formattedOrderClause,Tne=nl().Explain,Ane=ne().Aspect,NS=vP().each,xne=OP(),TP=["tailable","oplogReplay","noCursorTimeout","awaitData","exhaust","partial"],AP=["numberOfRetries","tailableRetryInterval"],wi=class extends CP{constructor(t,r,n,i){super(t,r,n,i),this.operation&&(i=this.operation.options);let s=i.numberOfRetries||5,o=i.tailableRetryInterval||500,a=s,u=i.promiseLibrary||Promise;this.s={numberOfRetries:s,tailableRetryInterval:o,currentNumberOfRetries:a,state:ye.INIT,promiseLibrary:u,explicitlyIgnoreSession:!!i.explicitlyIgnoreSession},!i.explicitlyIgnoreSession&&i.session&&(this.cursorState.session=i.session),this.options.noCursorTimeout===!0&&this.addCursorFlag("noCursorTimeout",!0);let c=1e3;this.cmd.cursor&&this.cmd.cursor.batchSize?c=this.cmd.cursor.batchSize:i.cursor&&i.cursor.batchSize?c=i.cursor.batchSize:typeof i.batchSize=="number"&&(c=i.batchSize),this.setCursorBatchSize(c)}get readPreference(){return this.operation?this.operation.readPreference:this.options.readPreference}get sortValue(){return this.cmd.sort}set session(t){this.cursorState.session=t}_initializeCursor(t){this.operation&&this.operation.session!=null?this.cursorState.session=this.operation.session:!this.s.explicitlyIgnoreSession&&!this.cursorState.session&&this.topology.hasSessionSupport()&&(this.cursorState.session=this.topology.startSession({owner:this}),this.operation&&(this.operation.session=this.cursorState.session)),super._initializeCursor(t)}hasNext(t){if(this.s.state===ye.CLOSED||this.isDead&&this.isDead())throw xe.create({message:"Cursor is closed",driver:!0});return Pl(this,t,r=>{let n=this;if(n.isNotified())return r(null,!1);n._next((i,s)=>{if(i)return r(i);if(s==null||n.s.state===wi.CLOSED||n.isDead())return r(null,!1);n.s.state=ye.OPEN,n.cursorState.cursorIndex--,n.cursorState.limit>0&&n.cursorState.currentLimit--,r(null,!0)})})}next(t){return Pl(this,t,r=>{let n=this;if(n.s.state===ye.CLOSED||n.isDead&&n.isDead()){r(xe.create({message:"Cursor is closed",driver:!0}));return}if(n.s.state===ye.INIT&&n.cmd.sort)try{n.cmd.sort=Cne(n.cmd.sort)}catch(i){return r(i)}n._next((i,s)=>{if(i)return r(i);n.s.state=ye.OPEN,r(null,s)})})}filter(t){if(this.s.state===ye.CLOSED||this.s.state===ye.OPEN||this.isDead())throw xe.create({message:"Cursor is closed",driver:!0});return this.cmd.query=t,this}maxScan(t){if(this.s.state===ye.CLOSED||this.s.state===ye.OPEN||this.isDead())throw xe.create({message:"Cursor is closed",driver:!0});return this.cmd.maxScan=t,this}hint(t){if(this.s.state===ye.CLOSED||this.s.state===ye.OPEN||this.isDead())throw xe.create({message:"Cursor is closed",driver:!0});return this.cmd.hint=t,this}min(t){if(this.s.state===ye.CLOSED||this.s.state===ye.OPEN||this.isDead())throw xe.create({message:"Cursor is closed",driver:!0});return this.cmd.min=t,this}max(t){if(this.s.state===ye.CLOSED||this.s.state===ye.OPEN||this.isDead())throw xe.create({message:"Cursor is closed",driver:!0});return this.cmd.max=t,this}returnKey(t){if(this.s.state===ye.CLOSED||this.s.state===ye.OPEN||this.isDead())throw xe.create({message:"Cursor is closed",driver:!0});return this.cmd.returnKey=t,this}showRecordId(t){if(this.s.state===ye.CLOSED||this.s.state===ye.OPEN||this.isDead())throw xe.create({message:"Cursor is closed",driver:!0});return this.cmd.showDiskLoc=t,this}snapshot(t){if(this.s.state===ye.CLOSED||this.s.state===ye.OPEN||this.isDead())throw xe.create({message:"Cursor is closed",driver:!0});return this.cmd.snapshot=t,this}setCursorOption(t,r){if(this.s.state===ye.CLOSED||this.s.state===ye.OPEN||this.isDead())throw xe.create({message:"Cursor is closed",driver:!0});if(AP.indexOf(t)===-1)throw xe.create({message:`option ${t} is not a supported option ${AP}`,driver:!0});return this.s[t]=r,t==="numberOfRetries"&&(this.s.currentNumberOfRetries=r),this}addCursorFlag(t,r){if(this.s.state===ye.CLOSED||this.s.state===ye.OPEN||this.isDead())throw xe.create({message:"Cursor is closed",driver:!0});if(TP.indexOf(t)===-1)throw xe.create({message:`flag ${t} is not a supported flag ${TP}`,driver:!0});if(typeof r!="boolean")throw xe.create({message:`flag ${t} must be a boolean value`,driver:!0});return this.cmd[t]=r,this}addQueryModifier(t,r){if(this.s.state===ye.CLOSED||this.s.state===ye.OPEN||this.isDead())throw xe.create({message:"Cursor is closed",driver:!0});if(t[0]!=="$")throw xe.create({message:`${t} is not a valid query modifier`,driver:!0});let n=t.substr(1);return this.cmd[n]=r,n==="orderby"&&(this.cmd.sort=this.cmd[n]),this}comment(t){if(this.s.state===ye.CLOSED||this.s.state===ye.OPEN||this.isDead())throw xe.create({message:"Cursor is closed",driver:!0});return this.cmd.comment=t,this}maxAwaitTimeMS(t){if(typeof t!="number")throw xe.create({message:"maxAwaitTimeMS must be a number",driver:!0});if(this.s.state===ye.CLOSED||this.s.state===ye.OPEN||this.isDead())throw xe.create({message:"Cursor is closed",driver:!0});return this.cmd.maxAwaitTimeMS=t,this}maxTimeMS(t){if(typeof t!="number")throw xe.create({message:"maxTimeMS must be a number",driver:!0});if(this.s.state===ye.CLOSED||this.s.state===ye.OPEN||this.isDead())throw xe.create({message:"Cursor is closed",driver:!0});return this.cmd.maxTimeMS=t,this}project(t){if(this.s.state===ye.CLOSED||this.s.state===ye.OPEN||this.isDead())throw xe.create({message:"Cursor is closed",driver:!0});return this.cmd.fields=t,this}sort(t,r){if(this.options.tailable)throw xe.create({message:"Tailable cursor doesn't support sorting",driver:!0});if(this.s.state===ye.CLOSED||this.s.state===ye.OPEN||this.isDead())throw xe.create({message:"Cursor is closed",driver:!0});let n=t;return Array.isArray(n)&&Array.isArray(n[0])&&(n=new bne(n.map(i=>{let s=[i[0],null];if(i[1]==="asc")s[1]=1;else if(i[1]==="desc")s[1]=-1;else if(i[1]===1||i[1]===-1||i[1].$meta)s[1]=i[1];else throw new xe("Illegal sort clause, must be of the form [['field1', '(ascending|descending)'], ['field2', '(ascending|descending)']]");return s}))),r!=null&&(n=[[t,r]]),this.cmd.sort=n,this}batchSize(t){if(this.options.tailable)throw xe.create({message:"Tailable cursor doesn't support batchSize",driver:!0});if(this.s.state===ye.CLOSED||this.isDead())throw xe.create({message:"Cursor is closed",driver:!0});if(typeof t!="number")throw xe.create({message:"batchSize requires an integer",driver:!0});return this.cmd.batchSize=t,this.setCursorBatchSize(t),this}collation(t){return this.cmd.collation=t,this}limit(t){if(this.options.tailable)throw xe.create({message:"Tailable cursor doesn't support limit",driver:!0});if(this.s.state===ye.OPEN||this.s.state===ye.CLOSED||this.isDead())throw xe.create({message:"Cursor is closed",driver:!0});if(typeof t!="number")throw xe.create({message:"limit requires an integer",driver:!0});return this.cmd.limit=t,this.setCursorLimit(t),this}skip(t){if(this.options.tailable)throw xe.create({message:"Tailable cursor doesn't support skip",driver:!0});if(this.s.state===ye.OPEN||this.s.state===ye.CLOSED||this.isDead())throw xe.create({message:"Cursor is closed",driver:!0});if(typeof t!="number")throw xe.create({message:"skip requires an integer",driver:!0});return this.cmd.skip=t,this.setCursorSkip(t),this}each(t){this.rewind(),this.s.state=ye.INIT,NS(this,t)}forEach(t,r){if(this.rewind(),this.s.state=ye.INIT,typeof r=="function")NS(this,(n,i)=>{if(n)return r(n),!1;if(i!=null){try{t(i)}catch(s){return r(s),!1}return!0}if(i==null&&r){let s=r;return r=null,s(null),!1}});else return new this.s.promiseLibrary((n,i)=>{NS(this,(s,o)=>{if(s)return i(s),!1;if(o==null)return n(null),!1;try{t(o)}catch(a){return i(a),!1}return!0})})}setReadPreference(t){if(this.s.state!==ye.INIT)throw xe.create({message:"cannot change cursor readPreference after cursor has been accessed",driver:!0});if(t instanceof EP)this.options.readPreference=t;else if(typeof t=="string")this.options.readPreference=new EP(t);else throw new TypeError("Invalid read preference: "+t);return this}toArray(t){if(this.options.tailable)throw xe.create({message:"Tailable cursor cannot be converted to array",driver:!0});return Pl(this,t,r=>{let n=this,i=[];n.rewind(),n.s.state=ye.INIT;let s=()=>{n._next((o,a)=>{if(o)return bP(r,o);if(a==null)return n.close({skipKillCursors:!0},()=>bP(r,null,i));if(i.push(a),n.bufferedCount()>0){let u=n.readBufferedDocuments(n.bufferedCount());Array.prototype.push.apply(i,u)}s()})};s()})}count(t,r,n){if(this.cmd.query==null)throw xe.create({message:"count can only be used with find command",driver:!0});typeof r=="function"&&(n=r,r={}),r=r||{},typeof t=="function"&&(n=t,t=!0),this.cursorState.session&&(r=Object.assign({},r,{session:this.cursorState.session}));let i=new xne(this,t,r);return Ene(this.topology,i,n)}close(t,r){return typeof t=="function"&&(r=t,t={}),t=Object.assign({},{skipKillCursors:!1},t),Pl(this,r,n=>{this.s.state=ye.CLOSED,t.skipKillCursors||this.kill(),this._endSession(()=>{this.emit("close"),n(null,this)})})}map(t){if(this.cursorState.transforms&&this.cursorState.transforms.doc){let r=this.cursorState.transforms.doc;this.cursorState.transforms.doc=n=>t(r(n))}else this.cursorState.transforms={doc:t};return this}isClosed(){return this.isDead()}destroy(t){t&&this.emit("error",t),this.pause(),this.close()}stream(t){return this.cursorState.streamOptions=t||{},this}transformStream(t){let r=t||{};if(typeof r.transform=="function"){let n=new Sne({objectMode:!0,transform:function(i,s,o){this.push(r.transform(i)),o()}});return this.pipe(n)}return this.pipe(new One({objectMode:!0}))}explain(t,r){if(typeof t=="function"&&(r=t,t=!0),t===void 0&&(t=!0),!this.operation||!this.operation.hasAspect(Ane.EXPLAINABLE))throw new xe("This command cannot be explained");return this.operation.explain=new Tne(t),Pl(this,r,n=>{CP.prototype._next.apply(this,[n])})}getLogger(){return this.logger}};wi.prototype.maxTimeMs=wi.prototype.maxTimeMS;$S(wi.prototype.each,"Cursor.each is deprecated. Use Cursor.forEach instead.");$S(wi.prototype.maxScan,"Cursor.maxScan is deprecated, and will be removed in a later version");$S(wi.prototype.snapshot,"Cursor Snapshot is deprecated, and will be removed in a later version");xP.exports=wi});var Si=_((SAe,NP)=>{"use strict";var sp=ne().Aspect,qne=ne().OperationBase,qP=ie().ReadPreference,Mne=Lo(),Nne=Wi(),$ne=he().maxWireVersion,Pne=N().decorateWithExplain,Ine=Bs().commandSupportsReadConcern,Rne=se().MongoError,Dne=Io().extractCommand,MP=5,PS=class extends qne{constructor(t,r,n){super(r),this.ns=t.s.namespace.withCollection("$cmd");let i=this.hasAspect(sp.NO_INHERIT_OPTIONS)?void 0:t;this.readPreference=this.hasAspect(sp.WRITE_OPERATION)?qP.primary:qP.resolve(i,this.options),this.readConcern=Bne(i,this.options),this.writeConcern=jne(i,this.options),n&&typeof n.fullResponse=="boolean"&&(this.fullResponse=!0),this.options.readPreference=this.readPreference,t.s.logger?this.logger=t.s.logger:t.s.db&&t.s.db.logger&&(this.logger=t.s.db.logger)}executeCommand(t,r,n){this.server=t;let i=this.options,s=$ne(t),o=this.session&&this.session.inTransaction();if(this.readConcern&&Ine(r)&&!o&&Object.assign(r,{readConcern:this.readConcern}),i.collation&&s<MP){n(new Rne(`Server ${t.name}, which reports wire version ${s}, does not support collation`));return}if(s>=MP&&(this.writeConcern&&this.hasAspect(sp.WRITE_OPERATION)&&Object.assign(r,{writeConcern:this.writeConcern}),i.collation&&typeof i.collation=="object"&&Object.assign(r,{collation:i.collation})),typeof i.maxTimeMS=="number"&&(r.maxTimeMS=i.maxTimeMS),typeof i.comment=="string"&&(r.comment=i.comment),this.hasAspect(sp.EXPLAINABLE)&&this.explain&&(s<6&&r.aggregate?r.explain=!0:r=Pne(r,this.explain)),this.logger&&this.logger.isDebug()){let a=Dne(r);this.logger.debug(`executing command ${JSON.stringify(a.shouldRedact?`${a.name} details REDACTED`:r)} against ${this.ns}`)}t.command(this.ns.toString(),r,this.options,(a,u)=>{if(a){n(a,null);return}if(this.fullResponse){n(null,u);return}n(null,u.result)})}};function jne(e,t){return Nne.fromOptions(t)||e&&e.writeConcern}function Bne(e,t){return Mne.fromOptions(t)||e&&e.readConcern}NP.exports=PS});var Il=_((OAe,PP)=>{"use strict";var Lne=Si(),$P=ie().MongoError,kne=he().maxWireVersion,Fne=ie().ReadPreference,op=ne().Aspect,Une=ne().defineAspects,Vne=1,Wne=8,ap=class extends Lne{constructor(t,r,n){if(super(t,n,{fullResponse:!0}),this.target=t.s.namespace&&t.s.namespace.collection?t.s.namespace.collection:Vne,this.pipeline=r,this.hasWriteStage=!1,typeof n.out=="string")this.pipeline=this.pipeline.concat({$out:n.out}),this.hasWriteStage=!0;else if(r.length>0){let i=r[r.length-1];(i.$out||i.$merge)&&(this.hasWriteStage=!0)}if(this.hasWriteStage&&(this.readPreference=Fne.primary),this.explain&&this.writeConcern)throw new $P('"explain" cannot be used on an aggregate call with writeConcern');if(n.cursor!=null&&typeof n.cursor!="object")throw new $P("cursor options must be an object")}get canRetryRead(){return!this.hasWriteStage}addToPipeline(t){this.pipeline.push(t)}execute(t,r){let n=this.options,i=kne(t),s={aggregate:this.target,pipeline:this.pipeline};this.hasWriteStage&&i<Wne&&(this.readConcern=null),i>=5&&this.hasWriteStage&&this.writeConcern&&Object.assign(s,{writeConcern:this.writeConcern}),n.bypassDocumentValidation===!0&&(s.bypassDocumentValidation=n.bypassDocumentValidation),typeof n.allowDiskUse=="boolean"&&(s.allowDiskUse=n.allowDiskUse),n.hint&&(s.hint=n.hint),this.explain&&(n.full=!1),s.cursor=n.cursor||{},n.batchSize&&!this.hasWriteStage&&(s.cursor.batchSize=n.batchSize),super.executeCommand(t,s,r)}};Une(ap,[op.READ_OPERATION,op.RETRYABLE,op.EXECUTE_WITH_SELECTION,op.EXPLAINABLE]);PP.exports=ap});var pp=_((bAe,jP)=>{"use strict";var RP=ie().BSON.Long,zne=ie().MongoError,up=ie().BSON.ObjectID,kr=ie().BSON,IP=ie().MongoWriteConcernError,IS=N().emitWarningOnce,ra=N().toError,ia=N().handleCallback,Hne=N().applyRetryableWrites,Kne=N().applyWriteConcern,Gne=N().executeLegacyOperation,Qne=N().isPromiseLike,lp=N().hasAtomicOperators,Yne=he().maxWireVersion,Jne=64,na=1,us=2,no=3,Xne=new kr([kr.Binary,kr.Code,kr.DBRef,kr.Decimal128,kr.Double,kr.Int32,kr.Long,kr.Map,kr.MaxKey,kr.MinKey,kr.ObjectId,kr.BSONRegExp,kr.Symbol,kr.Timestamp]),RS=class{constructor(t,r){this.originalZeroIndex=r,this.currentIndex=0,this.originalIndexes=[],this.batchType=t,this.operations=[],this.size=0,this.sizeBytes=0}},Eu=Symbol("upsertedIds"),Cu=Symbol("insertedIds"),Tu=class{constructor(t){this.result=t,this[Eu]=void 0,this[Cu]=void 0}get insertedCount(){return typeof this.result.nInserted!="number"?0:this.result.nInserted}get matchedCount(){return typeof this.result.nMatched!="number"?0:this.result.nMatched}get modifiedCount(){return typeof this.result.nModified!="number"?0:this.result.nModified}get deletedCount(){return typeof this.result.nRemoved!="number"?0:this.result.nRemoved}get upsertedCount(){return this.result.upserted?this.result.upserted.length:0}get upsertedIds(){if(this[Eu])return this[Eu];this[Eu]={};for(let t of this.result.upserted||[])this[Eu][t.index]=t._id;return this[Eu]}get insertedIds(){if(this[Cu])return this[Cu];this[Cu]={};for(let t of this.result.insertedIds||[])this[Cu][t.index]=t._id;return this[Cu]}get n(){return this.result.insertedCount}get ok(){return this.result.ok}get nInserted(){return this.result.nInserted}get nUpserted(){return this.result.nUpserted}get nMatched(){return this.result.nMatched}get nModified(){return this.result.nModified}get nRemoved(){return this.result.nRemoved}getInsertedIds(){return this.result.insertedIds}getUpsertedIds(){return this.result.upserted}getUpsertedIdAt(t){return this.result.upserted[t]}getRawResponse(){return this.result}hasWriteErrors(){return this.result.writeErrors.length>0}getWriteErrorCount(){return this.result.writeErrors.length}getWriteErrorAt(t){return t<this.result.writeErrors.length?this.result.writeErrors[t]:null}getWriteErrors(){return this.result.writeErrors}getLastOp(){return this.result.lastOp}getWriteConcernError(){if(this.result.writeConcernErrors.length===0)return null;if(this.result.writeConcernErrors.length===1)return this.result.writeConcernErrors[0];{let t="";for(let r=0;r<this.result.writeConcernErrors.length;r++){let n=this.result.writeConcernErrors[r];t=t+n.errmsg,r===0&&(t=t+" and ")}return new Rl({errmsg:t,code:Jne})}}toJSON(){return this.result}toString(){return`BulkWriteResult(${this.toJSON(this.result)})`}isOk(){return this.result.ok===1}},Rl=class{constructor(t){this.err=t}get code(){return this.err.code}get errmsg(){return this.err.errmsg}toJSON(){return{code:this.err.code,errmsg:this.err.errmsg}}toString(){return`WriteConcernError(${this.err.errmsg})`}},fp=class{constructor(t){this.err=t}get code(){return this.err.code}get index(){return this.err.index}get errmsg(){return this.err.errmsg}getOperation(){return this.err.op}toJSON(){return{code:this.err.code,index:this.err.index,errmsg:this.err.errmsg,op:this.err.op}}toString(){return`WriteError(${JSON.stringify(this.toJSON())})`}};function cp(e){return typeof e=="number"?RP.fromNumber(e):e}function dp(e,t,r,n){if(r)n=r;else if(n&&n.result)n=n.result;else if(n==null)return;if(n.ok===0&&t.ok===1){t.ok=0;let s={index:0,code:n.code||0,errmsg:n.message,op:e.operations[0]};t.writeErrors.push(new fp(s));return}else if(n.ok===0&&t.ok===0)return;if(n.opTime||n.lastOp){let s=n.lastOp||n.opTime;if(s._bsontype==="Timestamp"&&(s={ts:s,t:RP.ZERO}),!t.lastOp)t.lastOp=s;else{let o=cp(t.lastOp.ts),a=cp(s.ts);if(a.greaterThan(o))t.lastOp=s;else if(a.equals(o)){let u=cp(t.lastOp.t);cp(s.t).greaterThan(u)&&(t.lastOp=s)}}}e.batchType===na&&n.n&&(t.nInserted=t.nInserted+n.n),e.batchType===no&&n.n&&(t.nRemoved=t.nRemoved+n.n);let i=0;if(Array.isArray(n.upserted)){i=n.upserted.length;for(let s=0;s<n.upserted.length;s++)t.upserted.push({index:n.upserted[s].index+e.originalZeroIndex,_id:n.upserted[s]._id})}else n.upserted&&(i=1,t.upserted.push({index:e.originalZeroIndex,_id:n.upserted}));if(e.batchType===us&&n.n){let s=n.nModified;t.nUpserted=t.nUpserted+i,t.nMatched=t.nMatched+(n.n-i),typeof s=="number"?t.nModified=t.nModified+s:t.nModified=null}if(Array.isArray(n.writeErrors))for(let s=0;s<n.writeErrors.length;s++){let o={index:e.originalIndexes[n.writeErrors[s].index],code:n.writeErrors[s].code,errmsg:n.writeErrors[s].errmsg,op:e.operations[n.writeErrors[s].index]};t.writeErrors.push(new fp(o))}n.writeConcernError&&t.writeConcernErrors.push(new Rl(n.writeConcernError))}function DP(e,t,r){if(e.s.batches.length===0)return ia(r,null,new Tu(e.s.bulkResult));let n=e.s.batches.shift();function i(s,o){if((s&&s.driver||s&&s.message)&&!(s instanceof IP))return ia(r,s);if(s&&(s.ok=0),s instanceof IP)return Zne(n,e.s.bulkResult,s,r);let a=new Tu(e.s.bulkResult);if(dp(n,e.s.bulkResult,s,o)!=null)return ia(r,null,a);e.handleWriteError(r,a)||DP(e,t,r)}e.finalOptionsHandler({options:t,batch:n,resultHandler:i},r)}function Zne(e,t,r,n){dp(e,t,null,r.result);let i=new Rl({errmsg:r.result.writeConcernError.errmsg,code:r.result.writeConcernError.result});return ia(n,new Au(ra(i),new Tu(t)),null)}var Au=class extends zne{constructor(t,r){let n=t.err||t.errmsg||t.errMessage||t;super(n),Object.assign(this,t),this.name="BulkWriteError",this.result=r}get insertedCount(){return this.result.insertedCount}get matchedCount(){return this.result.matchedCount}get modifiedCount(){return this.result.modifiedCount}get deletedCount(){return this.result.deletedCount}get upsertedCount(){return this.result.upsertedCount}get insertedIds(){return this.result.insertedIds}get upsertedIds(){return this.result.upsertedIds}},DS=class{constructor(t){this.s=t.s}update(t){let r=typeof this.s.currentOp.upsert=="boolean"?this.s.currentOp.upsert:!1,n={q:this.s.currentOp.selector,u:t,multi:!0,upsert:r};return t.hint&&(n.hint=t.hint),this.s.currentOp=null,this.s.options.addToOperationsList(this,us,n)}updateOne(t){let r=typeof this.s.currentOp.upsert=="boolean"?this.s.currentOp.upsert:!1,n={q:this.s.currentOp.selector,u:t,multi:!1,upsert:r};if(t.hint&&(n.hint=t.hint),!lp(t))throw new TypeError("Update document requires atomic operators");return this.s.currentOp=null,this.s.options.addToOperationsList(this,us,n)}replaceOne(t){let r=typeof this.s.currentOp.upsert=="boolean"?this.s.currentOp.upsert:!1,n={q:this.s.currentOp.selector,u:t,multi:!1,upsert:r};if(t.hint&&(n.hint=t.hint),lp(t))throw new TypeError("Replacement document must not use atomic operators");return this.s.currentOp=null,this.s.options.addToOperationsList(this,us,n)}upsert(){return this.s.currentOp.upsert=!0,this}deleteOne(){let t={q:this.s.currentOp.selector,limit:1};return this.s.currentOp=null,this.s.options.addToOperationsList(this,no,t)}delete(){let t={q:this.s.currentOp.selector,limit:0};return this.s.currentOp=null,this.s.options.addToOperationsList(this,no,t)}removeOne(){return IS("bulk operation `removeOne` has been deprecated, please use `deleteOne`"),this.deleteOne()}remove(){return IS("bulk operation `remove` has been deprecated, please use `delete`"),this.delete()}},hp=class{constructor(t,r,n,i){this.isOrdered=i,n=n??{};let s=r.s.namespace,o=!1,a=null,u=t.bson,c=t.lastIsMaster(),f=!!(t.s.options&&t.s.options.autoEncrypter),h=c&&c.maxBsonObjectSize?c.maxBsonObjectSize:1024*1024*16,d=f?1024*1024*2:h,p=c&&c.maxWriteBatchSize?c.maxWriteBatchSize:1e3,m=(p-1).toString(10).length+2,y=Object.assign({},n);y=Hne(y,r.s.db),y=Kne(y,{collection:r},n);let g=y.writeConcern,w=n.promiseLibrary||Promise,S={ok:1,writeErrors:[],writeConcernErrors:[],insertedIds:[],nInserted:0,nUpserted:0,nMatched:0,nModified:0,nRemoved:0,upserted:[]};this.s={bulkResult:S,currentBatch:null,currentIndex:0,currentBatchSize:0,currentBatchSizeBytes:0,currentInsertBatch:null,currentUpdateBatch:null,currentRemoveBatch:null,batches:[],writeConcern:g,maxBsonObjectSize:h,maxBatchSizeBytes:d,maxWriteBatchSize:p,maxKeySize:m,namespace:s,bson:u,topology:t,options:y,currentOp:a,executed:o,collection:r,promiseLibrary:w,err:null,checkKeys:typeof n.checkKeys=="boolean"?n.checkKeys:!0},n.bypassDocumentValidation===!0&&(this.s.bypassDocumentValidation=!0)}insert(t){return this.s.collection.s.db.options.forceServerObjectId!==!0&&t._id==null&&(t._id=new up),this.s.options.addToOperationsList(this,na,t)}find(t){if(!t)throw ra("Bulk find operation must specify a selector");return this.s.currentOp={selector:t},new DS(this)}raw(t){let r=Object.keys(t)[0],n=typeof this.s.options.forceServerObjectId=="boolean"?this.s.options.forceServerObjectId:this.s.collection.s.db.options.forceServerObjectId;if(t.updateOne&&t.updateOne.q||t.updateMany&&t.updateMany.q||t.replaceOne&&t.replaceOne.q)return t[r].multi=!(t.updateOne||t.replaceOne),this.s.options.addToOperationsList(this,us,t[r]);if(t.updateOne||t.updateMany||t.replaceOne){if(t.replaceOne&&lp(t[r].replacement))throw new TypeError("Replacement document must not use atomic operators");if((t.updateOne||t.updateMany)&&!lp(t[r].update))throw new TypeError("Update document requires atomic operators");let i=!(t.updateOne||t.replaceOne),s={q:t[r].filter,u:t[r].update||t[r].replacement,multi:i};if(t[r].hint&&(s.hint=t[r].hint),this.isOrdered?(s.upsert=!!t[r].upsert,t.collation&&(s.collation=t.collation)):t[r].upsert&&(s.upsert=!0),t[r].arrayFilters){if(Yne(this.s.topology)<6)throw new TypeError("arrayFilters are only supported on MongoDB 3.6+");s.arrayFilters=t[r].arrayFilters}return this.s.options.addToOperationsList(this,us,s)}if(t.removeOne||t.removeMany||t.deleteOne&&t.deleteOne.q||t.deleteMany&&t.deleteMany.q)return t[r].limit=t.removeOne?1:0,this.s.options.addToOperationsList(this,no,t[r]);if(t.deleteOne||t.deleteMany){let i=t.deleteOne?1:0,s={q:t[r].filter,limit:i};return t[r].hint&&(s.hint=t[r].hint),this.isOrdered&&t.collation&&(s.collation=t.collation),this.s.options.addToOperationsList(this,no,s)}if(t.insertOne&&t.insertOne.document==null)return n!==!0&&t.insertOne._id==null&&(t.insertOne._id=new up),this.s.options.addToOperationsList(this,na,t.insertOne);if(t.insertOne&&t.insertOne.document)return n!==!0&&t.insertOne.document._id==null&&(t.insertOne.document._id=new up),this.s.options.addToOperationsList(this,na,t.insertOne.document);if(t.insertMany){IS("bulk operation `insertMany` has been deprecated; use multiple `insertOne` ops instead");for(let i=0;i<t.insertMany.length;i++)n!==!0&&t.insertMany[i]._id==null&&(t.insertMany[i]._id=new up),this.s.options.addToOperationsList(this,na,t.insertMany[i]);return}throw ra("bulkWrite only supports insertOne, insertMany, updateOne, updateMany, removeOne, removeMany, deleteOne, deleteMany")}_handleEarlyError(t,r){if(typeof r=="function"){r(t,null);return}return this.s.promiseLibrary.reject(t)}bulkExecute(t,r,n){typeof r=="function"&&(n=r);let i=Object.assign({},this.s.options,r);if(typeof t=="function"?n=t:t&&typeof t=="object"&&(this.s.writeConcern=t),this.s.executed){let s=ra("batch cannot be re-executed");return this._handleEarlyError(s,n)}if(this.isOrdered?this.s.currentBatch&&this.s.batches.push(this.s.currentBatch):(this.s.currentInsertBatch&&this.s.batches.push(this.s.currentInsertBatch),this.s.currentUpdateBatch&&this.s.batches.push(this.s.currentUpdateBatch),this.s.currentRemoveBatch&&this.s.batches.push(this.s.currentRemoveBatch)),this.s.batches.length===0){let s=ra("Invalid Operation, no operations specified");return this._handleEarlyError(s,n)}return{options:i,callback:n}}execute(t,r,n){let i=this.bulkExecute(t,r,n);return!i||Qne(i)?i:(r=i.options,n=i.callback,Gne(this.s.topology,DP,[this,r,n]))}finalOptionsHandler(t,r){let n=Object.assign({ordered:this.isOrdered},t.options);this.s.writeConcern!=null&&(n.writeConcern=this.s.writeConcern),n.bypassDocumentValidation!==!0&&delete n.bypassDocumentValidation,this.operationId&&(t.resultHandler.operationId=this.operationId),this.s.options.serializeFunctions&&(n.serializeFunctions=!0),this.s.options.ignoreUndefined&&(n.ignoreUndefined=!0),this.s.bypassDocumentValidation===!0&&(n.bypassDocumentValidation=!0),this.s.checkKeys===!1&&(n.checkKeys=!1),n.retryWrites&&(t.batch.batchType===us&&(n.retryWrites=n.retryWrites&&!t.batch.operations.some(i=>i.multi)),t.batch.batchType===no&&(n.retryWrites=n.retryWrites&&!t.batch.operations.some(i=>i.limit===0)));try{t.batch.batchType===na?this.s.topology.insert(this.s.namespace,t.batch.operations,n,t.resultHandler):t.batch.batchType===us?this.s.topology.update(this.s.namespace,t.batch.operations,n,t.resultHandler):t.batch.batchType===no&&this.s.topology.remove(this.s.namespace,t.batch.operations,n,t.resultHandler)}catch(i){i.ok=0,ia(r,null,dp(t.batch,this.s.bulkResult,i,null))}}handleWriteError(t,r){if(this.s.bulkResult.writeErrors.length>0){let n=this.s.bulkResult.writeErrors[0].errmsg?this.s.bulkResult.writeErrors[0].errmsg:"write operation failed";return ia(t,new Au(ra({message:n,code:this.s.bulkResult.writeErrors[0].code,writeErrors:this.s.bulkResult.writeErrors}),r),null),!0}if(r.getWriteConcernError())return ia(t,new Au(ra(r.getWriteConcernError()),r),null),!0}};Object.defineProperty(hp.prototype,"length",{enumerable:!0,get:function(){return this.s.currentIndex}});jP.exports={Batch:RS,BulkOperationBase:hp,mergeBatchResults:dp,bson:Xne,INSERT:na,UPDATE:us,REMOVE:no,BulkWriteError:Au,BulkWriteResult:Tu}});var FP=_((EAe,jS)=>{"use strict";var cs=pp(),eie=cs.BulkOperationBase,BP=cs.Batch,tie=cs.bson,rie=N(),LP=rie.toError;function nie(e,t,r){let n=tie.calculateObjectSize(r,{checkKeys:!1,ignoreUndefined:!1});if(n>=e.s.maxBsonObjectSize)throw LP("document is larger than the maximum size "+e.s.maxBsonObjectSize);e.s.currentBatch=null,t===cs.INSERT?e.s.currentBatch=e.s.currentInsertBatch:t===cs.UPDATE?e.s.currentBatch=e.s.currentUpdateBatch:t===cs.REMOVE&&(e.s.currentBatch=e.s.currentRemoveBatch);let i=e.s.maxKeySize;if(e.s.currentBatch==null&&(e.s.currentBatch=new BP(t,e.s.currentIndex)),(e.s.currentBatch.size+1>=e.s.maxWriteBatchSize||e.s.currentBatch.size>0&&e.s.currentBatch.sizeBytes+i+n>=e.s.maxBatchSizeBytes||e.s.currentBatch.batchType!==t)&&(e.s.batches.push(e.s.currentBatch),e.s.currentBatch=new BP(t,e.s.currentIndex)),Array.isArray(r))throw LP("operation passed in cannot be an Array");return e.s.currentBatch.operations.push(r),e.s.currentBatch.originalIndexes.push(e.s.currentIndex),e.s.currentIndex=e.s.currentIndex+1,t===cs.INSERT?(e.s.currentInsertBatch=e.s.currentBatch,e.s.bulkResult.insertedIds.push({index:e.s.bulkResult.insertedIds.length,_id:r._id})):t===cs.UPDATE?e.s.currentUpdateBatch=e.s.currentBatch:t===cs.REMOVE&&(e.s.currentRemoveBatch=e.s.currentBatch),e.s.currentBatch.size+=1,e.s.currentBatch.sizeBytes+=i+n,e}var Dl=class extends eie{constructor(t,r,n){n=n||{},n=Object.assign(n,{addToOperationsList:nie}),super(t,r,n,!1)}handleWriteError(t,r){return this.s.batches.length?!1:super.handleWriteError(t,r)}};function kP(e,t,r){return new Dl(e,t,r)}kP.UnorderedBulkOperation=Dl;jS.exports=kP;jS.exports.Bulk=Dl});var zP=_((CAe,BS)=>{"use strict";var mp=pp(),iie=mp.BulkOperationBase,UP=mp.Batch,sie=mp.bson,oie=N(),VP=oie.toError;function aie(e,t,r){let n=sie.calculateObjectSize(r,{checkKeys:!1,ignoreUndefined:!1});if(n>=e.s.maxBsonObjectSize)throw VP("document is larger than the maximum size "+e.s.maxBsonObjectSize);e.s.currentBatch==null&&(e.s.currentBatch=new UP(t,e.s.currentIndex));let i=e.s.maxKeySize;if((e.s.currentBatchSize+1>=e.s.maxWriteBatchSize||e.s.currentBatchSize>0&&e.s.currentBatchSizeBytes+i+n>=e.s.maxBatchSizeBytes||e.s.currentBatch.batchType!==t)&&(e.s.batches.push(e.s.currentBatch),e.s.currentBatch=new UP(t,e.s.currentIndex),e.s.currentBatchSize=0,e.s.currentBatchSizeBytes=0),t===mp.INSERT&&e.s.bulkResult.insertedIds.push({index:e.s.currentIndex,_id:r._id}),Array.isArray(r))throw VP("operation passed in cannot be an Array");return e.s.currentBatch.originalIndexes.push(e.s.currentIndex),e.s.currentBatch.operations.push(r),e.s.currentBatchSize+=1,e.s.currentBatchSizeBytes+=i+n,e.s.currentIndex+=1,e}var jl=class extends iie{constructor(t,r,n){n=n||{},n=Object.assign(n,{addToOperationsList:aie}),super(t,r,n,!0)}};function WP(e,t,r){return new jl(e,t,r)}WP.OrderedBulkOperation=jl;BS.exports=WP;BS.exports.Bulk=jl});var yp=_((TAe,KP)=>{"use strict";var HP=ie().MongoError,uie=vi(),cie=$n().CursorState,Bl=class extends uie{constructor(t,r,n){super(t,r,n)}batchSize(t){if(this.s.state===cie.CLOSED||this.isDead())throw HP.create({message:"Cursor is closed",driver:!0});if(typeof t!="number")throw HP.create({message:"batchSize requires an integer",driver:!0});return this.operation.options.batchSize=t,this.setCursorBatchSize(t),this}geoNear(t){return this.operation.addToPipeline({$geoNear:t}),this}group(t){return this.operation.addToPipeline({$group:t}),this}limit(t){return this.operation.addToPipeline({$limit:t}),this}match(t){return this.operation.addToPipeline({$match:t}),this}maxTimeMS(t){return this.operation.options.maxTimeMS=t,this}out(t){return this.operation.addToPipeline({$out:t}),this}project(t){return this.operation.addToPipeline({$project:t}),this}lookup(t){return this.operation.addToPipeline({$lookup:t}),this}redact(t){return this.operation.addToPipeline({$redact:t}),this}skip(t){return this.operation.addToPipeline({$skip:t}),this}sort(t){return this.operation.addToPipeline({$sort:t}),this}unwind(t){return this.operation.addToPipeline({$unwind:t}),this}getLogger(){return this.logger}};Bl.prototype.get=Bl.prototype.toArray;KP.exports=Bl});var _p=_((AAe,QP)=>{"use strict";var GP=ie().ReadPreference,gp=ie().MongoError,lie=vi(),LS=$n().CursorState,Ll=class extends lie{constructor(t,r,n,i){super(t,r,n,i)}setReadPreference(t){if(this.s.state===LS.CLOSED||this.isDead())throw gp.create({message:"Cursor is closed",driver:!0});if(this.s.state!==LS.INIT)throw gp.create({message:"cannot change cursor readPreference after cursor has been accessed",driver:!0});if(t instanceof GP)this.options.readPreference=t;else if(typeof t=="string")this.options.readPreference=new GP(t);else throw new TypeError("Invalid read preference: "+t);return this}batchSize(t){if(this.s.state===LS.CLOSED||this.isDead())throw gp.create({message:"Cursor is closed",driver:!0});if(typeof t!="number")throw gp.create({message:"batchSize requires an integer",driver:!0});return this.cmd.cursor&&(this.cmd.cursor.batchSize=t),this.setCursorBatchSize(t),this}maxTimeMS(t){return this.topology.lastIsMaster().minWireVersion>2&&(this.cmd.maxTimeMS=t),this}getLogger(){return this.logger}};Ll.prototype.get=Ll.prototype.toArray;QP.exports=Ll});var FS=_((xAe,YP)=>{"use strict";var fie=N().applyRetryableWrites,hie=N().applyWriteConcern,die=ie().MongoError,pie=ne().OperationBase,kS=class extends pie{constructor(t,r,n){super(n),this.collection=t,this.operations=r}execute(t){let r=this.collection,n=this.operations,i=this.options;r.s.options.ignoreUndefined&&(i=Object.assign({},i),i.ignoreUndefined=r.s.options.ignoreUndefined);let s=i.ordered===!0||i.ordered==null?r.initializeOrderedBulkOp(i):r.initializeUnorderedBulkOp(i),o=!1;try{for(let f=0;f<n.length;f++){let h=Object.keys(n[f])[0];n[f][h].collation&&(o=!0),s.raw(n[f])}}catch(f){return t(f,null)}let a=Object.assign({},i);a=fie(a,r.s.db),a=hie(a,{db:r.s.db,collection:r},i);let u=a.writeConcern?a.writeConcern:{},c=r.s.topology.capabilities();if(o&&c&&!c.commandsTakeCollation)return t(new die("server/primary/mongos does not support collation"));s.execute(u,a,(f,h)=>{if(!h&&f)return t(f,null);t(null,h)})}};YP.exports=kS});var VS=_((qAe,JP)=>{"use strict";var mie=Il(),US=class extends mie{constructor(t,r,n){let i=[{$match:r}];typeof n.skip=="number"&&i.push({$skip:n.skip}),typeof n.limit=="number"&&i.push({$limit:n.limit}),i.push({$group:{_id:1,n:{$sum:1}}}),super(t,i,n)}execute(t,r){super.execute(t,(n,i)=>{if(n){r(n,null);return}let s=i.result;if(s.cursor==null||s.cursor.firstBatch==null){r(null,0);return}let o=s.cursor.firstBatch;r(null,o.length?o[0].n:0)})}};JP.exports=US});var WS=_((MAe,eI)=>{"use strict";var XP=ne().Aspect,yie=ne().defineAspects,gie=Si(),ZP=ie().MongoError,_ie=N().parseIndexOptions,wie=he().maxWireVersion,vie=new Set(["background","unique","name","partialFilterExpression","sparse","expireAfterSeconds","storageEngine","collation","weights","default_language","language_override","textIndexVersion","2dsphereIndexVersion","bits","min","max","bucketSize","wildcardProjection"]),wp=class extends gie{constructor(t,r,n,i){if(super(t,i),this.collection=r,!Array.isArray(n)||Array.isArray(n[0])){this.onlyReturnNameOfCreatedIndex=!0;let s=_ie(n),a={name:typeof i.name=="string"?i.name:s.name,key:s.fieldHash};for(let u in i)vie.has(u)&&(a[u]=i[u]);this.indexes=[a];return}this.indexes=n}execute(t,r){let n=this.options,i=this.indexes,s=wie(t);for(let a=0;a<i.length;a++){if(i[a].collation&&s<5){r(new ZP(`Server ${t.name}, which reports wire version ${s}, does not support collation`));return}if(i[a].name==null){let u=[];for(let c in i[a].key)u.push(`${c}_${i[a].key[c]}`);i[a].name=u.join("_")}}let o={createIndexes:this.collection,indexes:i};if(n.commitQuorum!=null){if(s<9){r(new ZP("`commitQuorum` option for `createIndexes` not supported on servers < 4.4"));return}o.commitQuorum=n.commitQuorum}this.options.collation=void 0,super.executeCommand(t,o,(a,u)=>{if(a){r(a);return}r(null,this.onlyReturnNameOfCreatedIndex?i[0].name:u)})}};yie(wp,[XP.WRITE_OPERATION,XP.EXECUTE_WITH_SELECTION]);eI.exports=wp});var rI=_((NAe,tI)=>{"use strict";var Sie=ne().OperationBase,Oie=Lr().removeDocuments,bie=ne().Aspect,Eie=ne().defineAspects,vp=class extends Sie{constructor(t,r,n){super(n),this.collection=t,this.filter=r}execute(t){let r=this.collection,n=this.filter,i=this.options;i.single=!1,Oie(r,n,i,(s,o)=>{if(t!=null){if(s&&t)return t(s);if(o==null)return t(null,{result:{ok:1}});if(this.explain)return t(void 0,o.result);o.deletedCount=o.result.n,t(null,o)}})}};Eie(vp,[bie.EXPLAINABLE]);tI.exports=vp});var iI=_(($Ae,nI)=>{"use strict";var Cie=ne().OperationBase,Tie=Lr().removeDocuments,Aie=ne().Aspect,xie=ne().defineAspects,Sp=class extends Cie{constructor(t,r,n){super(n),this.collection=t,this.filter=r}execute(t){let r=this.collection,n=this.filter,i=this.options;i.single=!0,Tie(r,n,i,(s,o)=>{if(t!=null){if(s&&t)return t(s);if(o==null)return t(null,{result:{ok:1}});if(this.explain)return t(void 0,o.result);o.deletedCount=o.result.n,t(null,o)}})}};xie(Sp,[Aie.EXPLAINABLE]);nI.exports=Sp});var oI=_((PAe,sI)=>{"use strict";var Op=ne().Aspect,qie=ne().defineAspects,Mie=Si(),Nie=N().decorateWithCollation,$ie=N().decorateWithReadConcern,Pie=he().maxWireVersion,Iie=Nl().MongoError,bp=class extends Mie{constructor(t,r,n,i){super(t,i),this.collection=t,this.key=r,this.query=n}execute(t,r){let n=this.collection,i=this.key,s=this.query,o=this.options,a={distinct:n.collectionName,key:i,query:s};typeof o.maxTimeMS=="number"&&(a.maxTimeMS=o.maxTimeMS),$ie(a,n,o);try{Nie(a,n,o)}catch(u){return r(u,null)}if(this.explain&&Pie(t)<4){r(new Iie("server does not support explain on distinct"));return}super.executeCommand(t,a,(u,c)=>{if(u){r(u);return}r(null,this.options.full||this.explain?c:c.values)})}};qie(bp,[Op.READ_OPERATION,Op.RETRYABLE,Op.EXECUTE_WITH_SELECTION,Op.EXPLAINABLE]);sI.exports=bp});var Jn=_((IAe,cI)=>{"use strict";var aI=ne().Aspect,Rie=ne().OperationBase,uI=N().applyWriteConcern,Die=N().debugOptions,zS=N().handleCallback,jie=ie().MongoError,HS=ie().ReadPreference,Bie=N().MongoDBNamespace,Lie=Io().extractCommand,kie=["authSource","w","wtimeout","j","native_parser","forceServerObjectId","serializeFunctions","raw","promoteLongs","promoteValues","promoteBuffers","bsonRegExp","bufferMaxEntries","numberOfRetries","retryMiliSeconds","readPreference","pkFactory","parentDb","promiseLibrary","noListener"],KS=class extends Rie{constructor(t,r,n,i){super(r),this.hasAspect(aI.WRITE_OPERATION)?(n!=null?uI(this.options,{db:t,coll:n},this.options):uI(this.options,{db:t},this.options),this.options.readPreference=HS.primary):n!=null?this.options.readPreference=HS.resolve(n,r):this.options.readPreference=HS.resolve(t,r),this.db=t,i!=null&&(this.command=i),n!=null&&(this.collection=n)}_buildCommand(){if(this.command!=null)return this.command}execute(t){let r=this.db,n=Object.assign({},this.options);if(r.serverConfig&&r.serverConfig.isDestroyed())return t(new jie("topology was destroyed"));let i;try{i=this._buildCommand()}catch(a){return t(a)}let s=n.dbName||n.authdb||r.databaseName;if(this.hasAspect(aI.WRITE_OPERATION)&&n.writeConcern&&(!n.session||!n.session.inTransaction())&&(i.writeConcern=n.writeConcern),r.s.logger.isDebug()){let a=Lie(i);r.s.logger.debug(`executing command ${JSON.stringify(a.shouldRedact?`${a.name} details REDACTED`:i)} against ${s}.$cmd with options [${JSON.stringify(Die(kie,n))}]`)}let o=this.namespace!=null?this.namespace:new Bie(s,"$cmd");r.s.topology.command(o,i,n,(a,u)=>{if(a)return zS(t,a);if(n.full)return zS(t,null,u);zS(t,null,u.result)})}};cI.exports=KS});var Ep=_((RAe,lI)=>{"use strict";var Fie=ne().Aspect,Uie=Jn(),Vie=ne().defineAspects,GS=N().handleCallback,xu=class extends Uie{constructor(t,r){let n=Object.assign({},r,t.s.options);r.session&&(n.session=r.session),super(t,n)}execute(t){super.execute((r,n)=>{if(r)return GS(t,r);if(n.ok)return GS(t,null,!0);GS(t,null,!1)})}};Vie(xu,Fie.WRITE_OPERATION);var QS=class extends xu{constructor(t,r,n){super(t,n),this.name=r,this.namespace=`${t.namespace}.${r}`}_buildCommand(){return{drop:this.name}}},YS=class extends xu{_buildCommand(){return{dropDatabase:1}}};lI.exports={DropOperation:xu,DropCollectionOperation:QS,DropDatabaseOperation:YS}});var JS=_((DAe,hI)=>{"use strict";var Wie=ne().Aspect,zie=ne().defineAspects,Hie=Jn(),Kie=N().applyWriteConcern,fI=N().handleCallback,Cp=class extends Hie{constructor(t,r,n){super(t.s.db,n,t),this.collection=t,this.indexName=r}_buildCommand(){let t=this.collection,r=this.indexName,n=this.options,i={dropIndexes:t.collectionName,index:r};return i=Kie(i,{db:t.s.db,collection:t},n),i}execute(t){super.execute((r,n)=>{if(typeof t=="function"){if(r)return fI(t,r,null);fI(t,null,n)}})}};zie(Cp,Wie.WRITE_OPERATION);hI.exports=Cp});var mI=_((jAe,pI)=>{"use strict";var Gie=ne().Aspect,Qie=ne().defineAspects,Yie=JS(),dI=N().handleCallback,Tp=class extends Yie{constructor(t,r){super(t,"*",r)}execute(t){super.execute(r=>{if(r)return dI(t,r,!1);dI(t,null,!0)})}};Qie(Tp,Gie.WRITE_OPERATION);pI.exports=Tp});var gI=_((BAe,yI)=>{"use strict";var Jie=xo().MONGODB_ERROR_CODES,XS=ne().Aspect,Xie=ne().defineAspects,Zie=Si(),ese=he().maxWireVersion,tse=VS(),Ap=class extends Zie{constructor(t,r){super(t,r),this.collection=t,this.collectionName=t.s.namespace.collection}execute(t,r){if(ese(t)<12)return this.executeLegacy(t,r);if(this.options.query)return new tse(this.collection,this.options.query,this.options).execute(t,r);let n=[{$collStats:{count:{}}},{$group:{_id:1,n:{$sum:"$count"}}}],i={aggregate:this.collectionName,pipeline:n,cursor:{}};typeof this.options.maxTimeMS=="number"&&(i.maxTimeMS=this.options.maxTimeMS),super.executeCommand(t,i,(s,o)=>{if(s&&s.code!==Jie.NamespaceNotFound){r(s);return}r(void 0,o&&o.cursor&&o.cursor.firstBatch&&o.cursor.firstBatch[0].n||0)})}executeLegacy(t,r){let n={count:this.collectionName},i=this.options;i.query&&(n.query=i.query),i.hint&&(n.hint=i.hint),typeof i.maxTimeMS=="number"&&(n.maxTimeMS=i.maxTimeMS),typeof i.skip=="number"&&(n.skip=i.skip),typeof i.limit=="number"&&(n.limit=i.limit),super.executeCommand(t,n,(s,o)=>{if(s){r(s);return}r(null,o.n)})}};Xie(Ap,[XS.READ_OPERATION,XS.RETRYABLE,XS.EXECUTE_WITH_SELECTION]);yI.exports=Ap});var vI=_((LAe,wI)=>{"use strict";var rse=ne().OperationBase,xp=ne().Aspect,nse=ne().defineAspects,_I=ie().ReadPreference,ise=he().maxWireVersion,sse=se().MongoError,qp=class extends rse{constructor(t,r,n,i){super(i),this.ns=r,this.cmd=n,this.readPreference=_I.resolve(t,this.options)}execute(t,r){if(this.server=t,this.readPreference=_I.resolve(this,this.options),typeof this.cmd.allowDiskUse<"u"&&ise(t)<4){r(new sse("The `allowDiskUse` option is not supported on MongoDB < 3.2"));return}this.explain&&(this.options.explain=this.explain.verbosity);let n=this.cursorState||{};t.query(this.ns.toString(),this.cmd,n,this.options,r)}};nse(qp,[xp.READ_OPERATION,xp.RETRYABLE,xp.EXECUTE_WITH_SELECTION,xp.EXPLAINABLE]);wI.exports=qp});var bI=_((kAe,OI)=>{"use strict";var SI=N().handleCallback,ose=ne().OperationBase,ase=N().toError,use=ne().Aspect,cse=ne().defineAspects,Mp=class extends ose{constructor(t,r,n){super(n),this.collection=t,this.query=r}execute(t){let r=this.collection,n=this.query,i=this.options;try{r.find(n,i).limit(-1).batchSize(1).next((o,a)=>{if(o!=null)return SI(t,ase(o),null);SI(t,null,a)})}catch(s){t(s)}}};cse(Mp,[use.EXPLAINABLE]);OI.exports=Mp});var kl=_((FAe,AI)=>{"use strict";var lse=ne().OperationBase,fse=N().applyRetryableWrites,hse=N().applyWriteConcern,dse=N().decorateWithCollation,pse=ur().executeCommand,mse=N().formattedOrderClause,EI=N().handleCallback,yse=ie().ReadPreference,CI=he().maxWireVersion,TI=Nl().MongoError,gse=ne().Aspect,_se=ne().defineAspects,wse=N().decorateWithExplain,Np=class extends lse{constructor(t,r,n,i,s){super(s),this.collection=t,this.query=r,this.sort=n,this.doc=i}execute(t){let r=this.collection,n=this.query,i=mse(this.sort),s=this.doc,o=this.options,a={findAndModify:r.collectionName,query:n};i&&(a.sort=i),a.new=!!o.new,a.remove=!!o.remove,a.upsert=!!o.upsert;let u=o.projection||o.fields;u&&(a.fields=u),o.arrayFilters&&(a.arrayFilters=o.arrayFilters),s&&!o.remove&&(a.update=s),o.maxTimeMS&&(a.maxTimeMS=o.maxTimeMS),o.serializeFunctions=o.serializeFunctions||r.s.serializeFunctions,o.checkKeys=!1,o=fse(o,r.s.db),o=hse(o,{db:r.s.db,collection:r},o),o.writeConcern&&(a.writeConcern=o.writeConcern),o.bypassDocumentValidation===!0&&(a.bypassDocumentValidation=o.bypassDocumentValidation),o.readPreference=yse.primary;try{dse(a,r,o)}catch(c){return t(c,null)}if(o.hint){if(o.writeConcern&&o.writeConcern.w===0||CI(r.s.topology)<8){t(new TI("The current topology does not support a hint on findAndModify commands"));return}a.hint=o.hint}if(this.explain){if(CI(r.s.topology)<4){t(new TI("server does not support explain on findAndModify"));return}a=wse(a,this.explain)}pse(r.s.db,a,o,(c,f)=>c?EI(t,c,null):EI(t,null,f))}};_se(Np,[gse.EXPLAINABLE]);AI.exports=Np});var qI=_((UAe,xI)=>{"use strict";var vse=kl(),ZS=class extends vse{constructor(t,r,n){let i=Object.assign({},n);if(i.fields=n.projection,i.remove=!0,r==null||typeof r!="object")throw new TypeError("Filter parameter must be an object");super(t,r,i.sort,null,i)}};xI.exports=ZS});var NI=_((VAe,MI)=>{"use strict";var Sse=ie().MongoError,Ose=kl(),bse=N().hasAtomicOperators,eO=class extends Ose{constructor(t,r,n,i){if("returnDocument"in i&&"returnOriginal"in i)throw new Sse("findOneAndReplace option returnOriginal is deprecated in favor of returnDocument and cannot be combined");let s=Object.assign({},i);if(s.fields=i.projection,s.update=!0,s.new=i.returnDocument==="after"||i.returnOriginal===!1,s.upsert=i.upsert===!0,r==null||typeof r!="object")throw new TypeError("Filter parameter must be an object");if(n==null||typeof n!="object")throw new TypeError("Replacement parameter must be an object");if(bse(n))throw new TypeError("Replacement document must not contain atomic operators");super(t,r,s.sort,n,s)}};MI.exports=eO});var PI=_((WAe,$I)=>{"use strict";var Ese=ie().MongoError,Cse=kl(),Tse=N().hasAtomicOperators,tO=class extends Cse{constructor(t,r,n,i){if("returnDocument"in i&&"returnOriginal"in i)throw new Ese("findOneAndUpdate option returnOriginal is deprecated in favor of returnDocument and cannot be combined");let s=Object.assign({},i);if(s.fields=i.projection,s.update=!0,s.new=i.returnDocument==="after"||i.returnOriginal===!1,s.upsert=i.upsert===!0,r==null||typeof r!="object")throw new TypeError("Filter parameter must be an object");if(n==null||typeof n!="object")throw new TypeError("Update parameter must be an object");if(!Tse(n))throw new TypeError("Update document requires atomic operators");super(t,r,s.sort,n,s)}};$I.exports=tO});var RI=_((zAe,II)=>{"use strict";var Ase=ne().Aspect,xse=ne().defineAspects,qse=ne().OperationBase,Mse=N().decorateCommand,Nse=N().decorateWithReadConcern,$se=ur().executeCommand,rO=N().handleCallback,Pse=ie().ReadPreference,Ise=N().toError,$p=class extends qse{constructor(t,r,n,i){super(i),this.collection=t,this.x=r,this.y=n}execute(t){let r=this.collection,n=this.x,i=this.y,s=this.options,o={geoSearch:r.collectionName,near:[n,i]};o=Mse(o,s,["readPreference","session"]),s=Object.assign({},s),s.readPreference=Pse.resolve(r,s),Nse(o,r,s),$se(r.s.db,o,s,(a,u)=>{if(a)return rO(t,a);(u.err||u.errmsg)&&rO(t,Ise(u)),rO(t,null,u)})}};xse($p,Ase.READ_OPERATION);II.exports=$p});var jI=_((HAe,DI)=>{"use strict";var Rse=ne().OperationBase,Dse=Lr().indexInformation,nO=class extends Rse{constructor(t,r){super(r),this.collection=t}execute(t){let r=this.collection,n=this.options;n=Object.assign({},{full:!0},n),Dse(r.s.db,r.collectionName,n,t)}};DI.exports=nO});var LI=_((KAe,BI)=>{"use strict";var jse=ne().OperationBase,Pp=N().handleCallback,Bse=ur().indexInformation,iO=class extends jse{constructor(t,r,n){super(n),this.collection=t,this.indexes=r}execute(t){let r=this.collection,n=this.indexes,i=this.options;Bse(r.s.db,r.collectionName,i,(s,o)=>{if(s!=null)return Pp(t,s,null);if(!Array.isArray(n))return Pp(t,null,o[n]!=null);for(let a=0;a<n.length;a++)if(o[n[a]]==null)return Pp(t,null,!1);return Pp(t,null,!0)})}};BI.exports=iO});var oO=_((GAe,kI)=>{"use strict";var Lse=ne().OperationBase,kse=Lr().indexInformation,sO=class extends Lse{constructor(t,r,n){super(n),this.db=t,this.name=r}execute(t){let r=this.db,n=this.name,i=this.options;kse(r,n,i,t)}};kI.exports=sO});var UI=_((QAe,FI)=>{"use strict";var Fse=ne().OperationBase,Use=FS(),Vse=ie().MongoError,Wse=Lr().prepareDocs,aO=class extends Fse{constructor(t,r,n){super(n),this.collection=t,this.docs=r}execute(t){let r=this.collection,n=this.docs,i=this.options;if(!Array.isArray(n))return t(Vse.create({message:"docs parameter must be an array of documents",driver:!0}));i.serializeFunctions=i.serializeFunctions||r.s.serializeFunctions,n=Wse(r,n,i);let s=n.map(a=>({insertOne:{document:a}}));new Use(r,s,i).execute((a,u)=>{if(a)return t(a,null);t(null,zse(n,u))})}};function zse(e,t){let r={result:{ok:1,n:t.insertedCount},ops:e,insertedCount:t.insertedCount,insertedIds:t.insertedIds};return t.getLastOp()&&(r.result.opTime=t.getLastOp()),r}FI.exports=aO});var WI=_((YAe,VI)=>{"use strict";var Hse=ie().MongoError,Kse=ne().OperationBase,Gse=Lr().insertDocuments,uO=class extends Kse{constructor(t,r,n){super(n),this.collection=t,this.doc=r}execute(t){let r=this.collection,n=this.doc,i=this.options;if(Array.isArray(n))return t(Hse.create({message:"doc parameter must be an object",driver:!0}));Gse(r,[n],i,(s,o)=>{if(t!=null){if(s&&t)return t(s);if(o==null)return t(null,{result:{ok:1}});o.insertedCount=o.result.n,o.insertedId=n._id,t&&t(null,o)}})}};VI.exports=uO});var fO=_((JAe,zI)=>{"use strict";var Qse=ne().OperationBase,cO=N().handleCallback,Yse=ie().MongoError,lO=class extends Qse{constructor(t,r){super(r),this.collection=t}execute(t){let r=this.collection,n=this.options;r.s.db.listCollections({name:r.collectionName},n).toArray((i,s)=>{if(i)return cO(t,i);if(s.length===0)return cO(t,Yse.create({message:`collection ${r.namespace} not found`,driver:!0}));cO(t,i,s[0].options||null)})}};zI.exports=lO});var GI=_((XAe,KI)=>{"use strict";var Jse=fO(),HI=N().handleCallback,hO=class extends Jse{constructor(t,r){super(t,r)}execute(t){super.execute((r,n)=>{if(r)return HI(t,r);HI(t,null,!!(n&&n.capped))})}};KI.exports=hO});var YI=_((ZAe,QI)=>{"use strict";var Xse=Si(),dO=ne().Aspect,Zse=ne().defineAspects,eoe=he().maxWireVersion,toe=3,Ip=class extends Xse{constructor(t,r){super(t,r,{fullResponse:!0}),this.collectionNamespace=t.s.namespace}execute(t,r){if(eoe(t)<toe){let s=this.collectionNamespace.withCollection("system.indexes").toString(),o=this.collectionNamespace.toString();t.query(s,{query:{ns:o}},{},this.options,r);return}let i=this.options.batchSize?{batchSize:this.options.batchSize}:{};super.executeCommand(t,{listIndexes:this.collectionNamespace.collection,cursor:i},r)}};Zse(Ip,[dO.READ_OPERATION,dO.RETRYABLE,dO.EXECUTE_WITH_SELECTION]);QI.exports=Ip});var pO=_((exe,XI)=>{"use strict";var roe=ne().Aspect,noe=Jn(),ioe=ne().defineAspects,soe=require("crypto"),JI=N().handleCallback,ooe=N().toError,aoe=N().emitWarning,Rp=class extends noe{constructor(t,r,n,i){super(t,i),this.username=r,this.password=n}_buildCommand(){let t=this.db,r=this.username,n=this.password,i=this.options,s=[];Array.isArray(i.roles)&&(s=i.roles),typeof i.roles=="string"&&(s=[i.roles]),s.length===0&&aoe("Creating a user without roles is deprecated in MongoDB >= 2.6"),(t.databaseName.toLowerCase()==="admin"||i.dbName==="admin")&&!Array.isArray(i.roles)?s=["root"]:Array.isArray(i.roles)||(s=["dbOwner"]);let o=t.s.topology.lastIsMaster().maxWireVersion>=7,a=n;if(!o){let c=soe.createHash("md5");c.update(r+":mongo:"+n),a=c.digest("hex")}let u={createUser:r,customData:i.customData||{},roles:s,digestPassword:o};return typeof n=="string"&&(u.pwd=a),u}execute(t){if(this.options.digestPassword!=null)return t(ooe("The digestPassword option is not supported via add_user. Please use db.command('createUser', ...) instead for this option."));super.execute((n,i)=>n?JI(t,n,null):JI(t,n,i))}};ioe(Rp,roe.WRITE_OPERATION);XI.exports=Rp});var t1=_((txe,e1)=>{"use strict";var uoe=ne().OperationBase,ZI=N().handleCallback,mO;function coe(){return mO||(mO=qu()),mO}var yO=class extends uoe{constructor(t,r){super(r),this.db=t}execute(t){let r=this.db,n=this.options,i=coe();n=Object.assign({},n,{nameOnly:!0}),r.listCollections({},n).toArray((s,o)=>{if(s!=null)return ZI(t,s,null);o=o.filter(a=>a.name.indexOf("$")===-1),ZI(t,null,o.map(a=>new i(r,r.s.topology,r.databaseName,a.name,r.s.pkFactory,r.s.options)))})}};e1.exports=yO});var i1=_((rxe,n1)=>{"use strict";var loe=Si(),foe=ne().defineAspects,r1=ne().Aspect,Dp=class extends loe{constructor(t,r,n){super(t,n),this.command=r}execute(t,r){let n=this.command;this.executeCommand(t,n,r)}};foe(Dp,[r1.EXECUTE_WITH_SELECTION,r1.NO_INHERIT_OPTIONS]);n1.exports=Dp});var o1=_((nxe,s1)=>{"use strict";var hoe=ne().Aspect,doe=ne().defineAspects,poe=Jn(),moe=N().applyWriteConcern,yoe=Bp().loadCollection,goe=ie().MongoError,_oe=ie().ReadPreference,woe=new Set(["w","wtimeout","j","fsync","autoIndexId","strict","serializeFunctions","pkFactory","raw","readPreference","session","readConcern","writeConcern"]),jp=class extends poe{constructor(t,r,n){super(t,n),this.name=r}_buildCommand(){let t=this.name,r=this.options,n={create:t};for(let i in r)r[i]!=null&&typeof r[i]!="function"&&!woe.has(i)&&(n[i]=r[i]);return n}execute(t){let r=this.db,n=this.name,i=this.options,s=yoe(),o=Object.assign({nameOnly:!0,strict:!1},i);o=moe(o,{db:r},o);function a(c){if(c)return t(c);try{t(null,new s(r,r.s.topology,r.databaseName,n,r.s.pkFactory,i))}catch(f){t(f)}}if(o.strict){r.listCollections({name:n},o).setReadPreference(_oe.PRIMARY).toArray((c,f)=>{if(c)return t(c);if(f.length>0)return t(new goe(`Collection ${n} already exists. Currently in strict mode.`));super.execute(a)});return}super.execute(a)}};doe(jp,hoe.WRITE_OPERATION);s1.exports=jp});var _O=_((ixe,u1)=>{"use strict";var voe=ne().OperationBase,a1=N().handleCallback,Soe=ie().MongoError,Ooe=N().MongoDBNamespace,gO=class extends voe{constructor(t,r,n){super(n),this.db=t,this.selector=r}execute(t){let r=this.db,n=this.selector,i=this.options,s=new Ooe("admin","$cmd");r.s.topology.command(s,n,i,(o,a)=>{if(r.serverConfig&&r.serverConfig.isDestroyed())return t(new Soe("topology was destroyed"));if(o)return a1(t,o);a1(t,null,a.result)})}};u1.exports=gO});var l1=_((sxe,c1)=>{"use strict";var boe=Si(),wO=ne().Aspect,Eoe=ne().defineAspects,Coe=he().maxWireVersion,Toe=ep(),Aoe=3;function xoe(e){let t=`${e}.`;return{doc:r=>{let n=r.name.indexOf(t);return r.name&&n===0&&(r.name=r.name.substr(n+t.length)),r}}}var Lp=class extends boe{constructor(t,r,n){super(t,n,{fullResponse:!0}),this.db=t,this.filter=r,this.nameOnly=!!this.options.nameOnly,typeof this.options.batchSize=="number"&&(this.batchSize=this.options.batchSize)}execute(t,r){if(Coe(t)<Aoe){let i=this.filter,s=this.db.s.namespace.db;typeof i.name=="string"&&!new RegExp("^"+s+"\\.").test(i.name)&&(i=Object.assign({},i),i.name=this.db.s.namespace.withCollection(i.name).toString()),i==null&&(i.name=`/${s}/`),i.name?i={$and:[{name:i.name},{name:/^((?!\$).)*$/}]}:i={name:/^((?!\$).)*$/};let o=xoe(s);t.query(`${s}.${Toe.SYSTEM_NAMESPACE_COLLECTION}`,{query:i},{batchSize:this.batchSize||1e3},{},(a,u)=>{u&&u.message&&u.message.documents&&Array.isArray(u.message.documents)&&(u.message.documents=u.message.documents.map(o.doc)),r(a,u)});return}let n={listCollections:1,filter:this.filter,cursor:this.batchSize?{batchSize:this.batchSize}:{},nameOnly:this.nameOnly};return super.executeCommand(t,n,r)}};Eoe(Lp,[wO.READ_OPERATION,wO.RETRYABLE,wO.EXECUTE_WITH_SELECTION]);c1.exports=Lp});var h1=_((oxe,f1)=>{"use strict";var qoe=Jn(),vO=class extends qoe{constructor(t,r,n){super(t,n)}_buildCommand(){return{profile:-1}}execute(t){super.execute((r,n)=>{if(r==null&&n.ok===1){let i=n.was;return i===0?t(null,"off"):i===1?t(null,"slow_only"):i===2?t(null,"all"):t(new Error("Error: illegal profiling level value "+i),null)}else r!=null?t(r,null):t(new Error("Error with profile command"),null)})}};f1.exports=vO});var SO=_((axe,p1)=>{"use strict";var Moe=ne().Aspect,Noe=Jn(),$oe=ne().defineAspects,d1=N().handleCallback,Poe=Wi(),kp=class extends Noe{constructor(t,r,n){let i={},s=Poe.fromOptions(n);s!=null&&(i.writeConcern=s),n.dbName&&(i.dbName=n.dbName),typeof n.maxTimeMS=="number"&&(i.maxTimeMS=n.maxTimeMS),super(t,i),this.username=r}_buildCommand(){return{dropUser:this.username}}execute(t){super.execute((r,n)=>{if(r)return d1(t,r,null);d1(t,r,!!n.ok)})}};$oe(kp,Moe.WRITE_OPERATION);p1.exports=kp});var bO=_((uxe,y1)=>{"use strict";var Ioe=ne().OperationBase,Roe=N().applyWriteConcern,Doe=N().checkCollectionName,joe=ur().executeDbAdminCommand,Fp=N().handleCallback,Boe=Bp().loadCollection,m1=N().toError,OO=class extends Ioe{constructor(t,r,n){super(n),this.collection=t,this.newName=r}execute(t){let r=this.collection,n=this.newName,i=this.options,s=Boe();Doe(n);let o=r.namespace,a=r.s.namespace.withCollection(n).toString(),u=typeof i.dropTarget=="boolean"?i.dropTarget:!1,c={renameCollection:o,to:a,dropTarget:u};Roe(c,{db:r.s.db,collection:r},i),joe(r.s.db.admin().s.db,c,i,(f,h)=>{if(f)return Fp(t,f,null);if(h.errmsg)return Fp(t,m1(h),null);try{return Fp(t,null,new s(r.s.db,r.s.topology,r.s.namespace.db,n,r.s.pkFactory,r.s.options))}catch(d){return Fp(t,m1(d),null)}})}};y1.exports=OO});var _1=_((cxe,g1)=>{"use strict";var Loe=Jn(),koe=new Set(["off","slow_only","all"]),EO=class extends Loe{constructor(t,r,n){let i=0;r==="off"?i=0:r==="slow_only"?i=1:r==="all"&&(i=2),super(t,n),this.level=r,this.profile=i}_buildCommand(){return{profile:this.profile}}execute(t){let r=this.level;if(!koe.has(r))return t(new Error("Error: illegal profiling level value "+r));super.execute((n,i)=>n==null&&i.ok===1?t(null,r):n!=null?t(n,null):t(new Error("Error with profile command"),null))}};g1.exports=EO});var v1=_((lxe,w1)=>{"use strict";var Foe=Jn(),CO=class extends Foe{constructor(t,r,n){let i={validate:r},s=Object.keys(n);for(let o=0;o<s.length;o++)Object.prototype.hasOwnProperty.call(n,s[o])&&s[o]!=="session"&&(i[s[o]]=n[s[o]]);super(t.s.db,n,null,i),this.collectionName=r}execute(t){let r=this.collectionName;super.execute((n,i)=>n!=null?t(n,null):i.ok===0?t(new Error("Error with validate command"),null):i.result!=null&&i.result.constructor!==String?t(new Error("Error with validation data"),null):i.result!=null&&i.result.match(/exception|corrupt/)!=null?t(new Error("Error: invalid collection "+r),null):i.valid!=null&&!i.valid?t(new Error("Error: invalid collection "+r),null):t(null,i))}};w1.exports=CO});var O1=_((fxe,S1)=>{"use strict";var Uoe=Si(),TO=ne().Aspect,Voe=ne().defineAspects,Woe=N().MongoDBNamespace,Up=class extends Uoe{constructor(t,r){super(t,r),this.ns=new Woe("admin","$cmd")}execute(t,r){let n={listDatabases:1};this.options.nameOnly&&(n.nameOnly=Number(n.nameOnly)),this.options.filter&&(n.filter=this.options.filter),typeof this.options.authorizedDatabases=="boolean"&&(n.authorizedDatabases=this.options.authorizedDatabases),super.executeCommand(t,n,r)}};Voe(Up,[TO.READ_OPERATION,TO.RETRYABLE,TO.EXECUTE_WITH_SELECTION]);S1.exports=Up});var AO=_((hxe,E1)=>{"use strict";var b1=N().applyWriteConcern,zoe=pO(),Mu=_O(),Hoe=SO(),Koe=v1(),Goe=O1(),Oi=su();function gn(e,t,r){if(!(this instanceof gn))return new gn(e,t);this.s={db:e,topology:t,promiseLibrary:r}}gn.prototype.command=function(e,t,r){let n=Array.prototype.slice.call(arguments,1);r=typeof n[n.length-1]=="function"?n.pop():void 0,t=n.length?n.shift():{};let i=new Mu(this.s.db,e,t);return Oi(this.s.db.s.topology,i,r)};gn.prototype.buildInfo=function(e,t){typeof e=="function"&&(t=e,e={}),e=e||{};let r={buildinfo:1},n=new Mu(this.s.db,r,e);return Oi(this.s.db.s.topology,n,t)};gn.prototype.serverInfo=function(e,t){typeof e=="function"&&(t=e,e={}),e=e||{};let r={buildinfo:1},n=new Mu(this.s.db,r,e);return Oi(this.s.db.s.topology,n,t)};gn.prototype.serverStatus=function(e,t){typeof e=="function"&&(t=e,e={}),e=e||{};let r=new Mu(this.s.db,{serverStatus:1},e);return Oi(this.s.db.s.topology,r,t)};gn.prototype.ping=function(e,t){typeof e=="function"&&(t=e,e={}),e=e||{};let r={ping:1},n=new Mu(this.s.db,r,e);return Oi(this.s.db.s.topology,n,t)};gn.prototype.addUser=function(e,t,r,n){let i=Array.prototype.slice.call(arguments,2);n=typeof i[i.length-1]=="function"?i.pop():void 0,typeof e=="string"&&t!=null&&typeof t=="object"&&(r=t,t=null),r=i.length?i.shift():{},r=Object.assign({},r),r=b1(r,{db:this.s.db}),r.dbName="admin";let s=new zoe(this.s.db,e,t,r);return Oi(this.s.db.s.topology,s,n)};gn.prototype.removeUser=function(e,t,r){let n=Array.prototype.slice.call(arguments,1);r=typeof n[n.length-1]=="function"?n.pop():void 0,t=n.length?n.shift():{},t=Object.assign({},t),t=b1(t,{db:this.s.db}),t.dbName="admin";let i=new Hoe(this.s.db,e,t);return Oi(this.s.db.s.topology,i,r)};gn.prototype.validateCollection=function(e,t,r){typeof t=="function"&&(r=t,t={}),t=t||{};let n=new Koe(this,e,t);return Oi(this.s.db.s.topology,n,r)};gn.prototype.listDatabases=function(e,t){return typeof e=="function"&&(t=e,e={}),e=e||{},Oi(this.s.db.s.topology,new Goe(this.s.db,e),t)};gn.prototype.replSetGetStatus=function(e,t){typeof e=="function"&&(t=e,e={}),e=e||{};let r=new Mu(this.s.db,{replSetGetStatus:1},e);return Oi(this.s.db.s.topology,r,t)};E1.exports=gn});var Ul=_((dxe,M1)=>{"use strict";var x1=require("events").EventEmitter,Qoe=require("util").inherits,xO=N().getSingleProperty,Yoe=_p(),Vp=N().handleCallback,Joe=N().filterOptions,C1=N().toError,Wp=ie().ReadPreference,T1=ie().MongoError,Xoe=ie().ObjectID,Zoe=ie().Logger,A1=qu(),eae=N().conditionallyMergeWriteConcern,qO=N().executeLegacyOperation,tae=zp(),Fl=require("util").deprecate,q1=N().deprecateOptions,rae=N().MongoDBNamespace,Nu=ep(),nae=Wi(),MO=Lo(),iae=yp(),io=ur().createListener,sae=ur().ensureIndex,oae=ur().evaluate,aae=ur().profilingInfo,uae=ur().validateDatabaseName,cae=Il(),lae=pO(),fae=t1(),hae=Jn(),dae=i1(),pae=o1(),mae=WS(),yae=Ep().DropCollectionOperation,gae=Ep().DropDatabaseOperation,_ae=_O(),wae=oO(),vae=l1(),Sae=h1(),Oae=SO(),bae=bO(),Eae=_1(),nn=su(),Cae=["w","wtimeout","fsync","j","writeConcern","readPreference","readPreferenceTags","native_parser","forceServerObjectId","pkFactory","serializeFunctions","raw","bufferMaxEntries","authSource","ignoreUndefined","promiseLibrary","readConcern","retryMiliSeconds","numberOfRetries","parentDb","noListener","loggerLevel","logger","promoteBuffers","promoteLongs","promoteValues","bsonRegExp","compression","retryWrites"];function we(e,t,r){if(r=r||{},!(this instanceof we))return new we(e,t,r);x1.call(this);let n=r.promiseLibrary||Promise;r=Joe(r,Cae),r.promiseLibrary=n,this.s={dbCache:{},children:[],topology:t,options:r,logger:Zoe("Db",r),bson:t?t.bson:null,readPreference:Wp.fromOptions(r),bufferMaxEntries:typeof r.bufferMaxEntries=="number"?r.bufferMaxEntries:-1,parentDb:r.parentDb||null,pkFactory:r.pkFactory||Xoe,nativeParser:r.nativeParser||r.native_parser,promiseLibrary:n,noListener:typeof r.noListener=="boolean"?r.noListener:!1,readConcern:MO.fromOptions(r),writeConcern:nae.fromOptions(r),namespace:new rae(e)},uae(e),xO(this,"serverConfig",this.s.topology),xO(this,"bufferMaxEntries",this.s.bufferMaxEntries),xO(this,"databaseName",this.s.namespace.db),!r.parentDb&&(this.s.noListener||(t.on("error",io(this,"error",this)),t.on("timeout",io(this,"timeout",this)),t.on("close",io(this,"close",this)),t.on("parseError",io(this,"parseError",this)),t.once("open",io(this,"open",this)),t.once("fullsetup",io(this,"fullsetup",this)),t.once("all",io(this,"all",this)),t.on("reconnect",io(this,"reconnect",this))))}Qoe(we,x1);we.prototype.on=Fl(function(){return we.super_.prototype.on.apply(this,arguments)},"Listening to events on the Db class has been deprecated and will be removed in the next major version.");we.prototype.once=Fl(function(){return we.super_.prototype.once.apply(this,arguments)},"Listening to events on the Db class has been deprecated and will be removed in the next major version.");Object.defineProperty(we.prototype,"topology",{enumerable:!0,get:function(){return this.s.topology}});Object.defineProperty(we.prototype,"options",{enumerable:!0,get:function(){return this.s.options}});Object.defineProperty(we.prototype,"slaveOk",{enumerable:!0,get:function(){return this.s.options.readPreference!=null&&(this.s.options.readPreference!=="primary"||this.s.options.readPreference.mode!=="primary")}});Object.defineProperty(we.prototype,"readConcern",{enumerable:!0,get:function(){return this.s.readConcern}});Object.defineProperty(we.prototype,"readPreference",{enumerable:!0,get:function(){return this.s.readPreference==null?Wp.primary:this.s.readPreference}});Object.defineProperty(we.prototype,"writeConcern",{enumerable:!0,get:function(){return this.s.writeConcern}});Object.defineProperty(we.prototype,"namespace",{enumerable:!0,get:function(){return this.s.namespace.toString()}});we.prototype.command=function(e,t,r){typeof t=="function"&&(r=t,t={}),t=Object.assign({},t);let n=new dae(this,e,t);return nn(this.s.topology,n,r)};we.prototype.aggregate=function(e,t,r){typeof t=="function"&&(r=t,t={}),t==null&&r==null&&(t={});let n=new iae(this.s.topology,new cae(this,e,t),t);if(typeof r=="function"){r(null,n);return}return n};we.prototype.admin=function(){let e=AO();return new e(this,this.s.topology,this.s.promiseLibrary)};var Tae=["pkFactory","readPreference","serializeFunctions","strict","readConcern","ignoreUndefined","promoteValues","promoteBuffers","promoteLongs","bsonRegExp"];we.prototype.collection=q1({name:"Db.collection",deprecatedOptions:["strict"],optionsIndex:1},function(e,t,r){typeof t=="function"&&(r=t,t={}),t=t||{},t=Object.assign({},t),t.promiseLibrary=this.s.promiseLibrary,t.readConcern=t.readConcern?new MO(t.readConcern.level):this.readConcern,this.s.options.ignoreUndefined&&(t.ignoreUndefined=this.s.options.ignoreUndefined);for(let i of Tae)!(i in t)&&this.s.options[i]!==void 0&&(t[i]=this.s.options[i]);if(t=eae(t,this.s.options),t==null||!t.strict)try{let i=new A1(this,this.s.topology,this.databaseName,e,this.s.pkFactory,t);return r&&r(null,i),i}catch(i){if(i instanceof T1&&r)return r(i);throw i}if(typeof r!="function")throw C1(`A callback is required in strict mode. While getting collection ${e}`);if(this.serverConfig&&this.serverConfig.isDestroyed())return r(new T1("topology was destroyed"));let n=Object.assign({},t,{nameOnly:!0});this.listCollections({name:e},n).toArray((i,s)=>{if(i!=null)return Vp(r,i,null);if(s.length===0)return Vp(r,C1(`Collection ${e} does not exist. Currently in strict mode.`),null);try{return Vp(r,null,new A1(this,this.s.topology,this.databaseName,e,this.s.pkFactory,t))}catch(o){return Vp(r,o,null)}})});we.prototype.createCollection=q1({name:"Db.createCollection",deprecatedOptions:["autoIndexId","strict","w","wtimeout","j"],optionsIndex:1},function(e,t,r){typeof t=="function"&&(r=t,t={}),t=t||{},t.promiseLibrary=t.promiseLibrary||this.s.promiseLibrary,t.readConcern=t.readConcern?new MO(t.readConcern.level):this.readConcern;let n=new pae(this,e,t);return nn(this.s.topology,n,r)});we.prototype.stats=function(e,t){typeof e=="function"&&(t=e,e={}),e=e||{};let r={dbStats:!0};e.scale!=null&&(r.scale=e.scale),e.readPreference==null&&this.s.readPreference&&(e.readPreference=this.s.readPreference);let n=new hae(this,e,null,r);return nn(this.s.topology,n,t)};we.prototype.listCollections=function(e,t){return e=e||{},t=t||{},new Yoe(this.s.topology,new vae(this,e,t),t)};we.prototype.eval=Fl(function(e,t,r,n){let i=Array.prototype.slice.call(arguments,1);return n=typeof i[i.length-1]=="function"?i.pop():void 0,t=i.length?i.shift():t,r=i.length?i.shift()||{}:{},qO(this.s.topology,oae,[this,e,t,r,n])},"Db.eval is deprecated as of MongoDB version 3.2");we.prototype.renameCollection=function(e,t,r,n){typeof r=="function"&&(n=r,r={}),r=Object.assign({},r,{readPreference:Wp.PRIMARY}),r.new_collection=!0;let i=new bae(this.collection(e),t,r);return nn(this.s.topology,i,n)};we.prototype.dropCollection=function(e,t,r){typeof t=="function"&&(r=t,t={}),t=t||{};let n=new yae(this,e,t);return nn(this.s.topology,n,r)};we.prototype.dropDatabase=function(e,t){typeof e=="function"&&(t=e,e={}),e=e||{};let r=new gae(this,e);return nn(this.s.topology,r,t)};we.prototype.collections=function(e,t){typeof e=="function"&&(t=e,e={}),e=e||{};let r=new fae(this,e);return nn(this.s.topology,r,t)};we.prototype.executeDbAdminCommand=function(e,t,r){typeof t=="function"&&(r=t,t={}),t=t||{},t.readPreference=Wp.resolve(this,t);let n=new _ae(this,e,t);return nn(this.s.topology,n,r)};we.prototype.createIndex=function(e,t,r,n){typeof r=="function"&&(n=r,r={}),r=r?Object.assign({},r):{};let i=new mae(this,e,t,r);return nn(this.s.topology,i,n)};we.prototype.ensureIndex=Fl(function(e,t,r,n){return typeof r=="function"&&(n=r,r={}),r=r||{},qO(this.s.topology,sae,[this,e,t,r,n])},"Db.ensureIndex is deprecated as of MongoDB version 3.0 / driver version 2.0");we.prototype.addChild=function(e){if(this.s.parentDb)return this.s.parentDb.addChild(e);this.s.children.push(e)};we.prototype.addUser=function(e,t,r,n){typeof r=="function"&&(n=r,r={}),r=r||{},typeof e=="string"&&t!=null&&typeof t=="object"&&(r=t,t=null);let i=new lae(this,e,t,r);return nn(this.s.topology,i,n)};we.prototype.removeUser=function(e,t,r){typeof t=="function"&&(r=t,t={}),t=t||{};let n=new Oae(this,e,t);return nn(this.s.topology,n,r)};we.prototype.setProfilingLevel=function(e,t,r){typeof t=="function"&&(r=t,t={}),t=t||{};let n=new Eae(this,e,t);return nn(this.s.topology,n,r)};we.prototype.profilingInfo=Fl(function(e,t){return typeof e=="function"&&(t=e,e={}),e=e||{},qO(this.s.topology,aae,[this,e,t])},"Db.profilingInfo is deprecated. Query the system.profile collection directly.");we.prototype.profilingLevel=function(e,t){typeof e=="function"&&(t=e,e={}),e=e||{};let r=new Sae(this,e);return nn(this.s.topology,r,t)};we.prototype.indexInformation=function(e,t,r){typeof t=="function"&&(r=t,t={}),t=t||{};let n=new wae(this,e,t);return nn(this.s.topology,n,r)};we.prototype.unref=function(){this.s.topology.unref()};we.prototype.watch=function(e,t){return e=e||[],t=t||{},Array.isArray(e)||(t=e,e=[]),new tae(this,e,t)};we.prototype.getLogger=function(){return this.s.logger};we.SYSTEM_NAMESPACE_COLLECTION=Nu.SYSTEM_NAMESPACE_COLLECTION;we.SYSTEM_INDEX_COLLECTION=Nu.SYSTEM_INDEX_COLLECTION;we.SYSTEM_PROFILE_COLLECTION=Nu.SYSTEM_PROFILE_COLLECTION;we.SYSTEM_USER_COLLECTION=Nu.SYSTEM_USER_COLLECTION;we.SYSTEM_COMMAND_COLLECTION=Nu.SYSTEM_COMMAND_COLLECTION;we.SYSTEM_JS_COLLECTION=Nu.SYSTEM_JS_COLLECTION;M1.exports=we});var Bp=_((pxe,N1)=>{"use strict";var NO,$O,PO;function Aae(){return NO||(NO=qu()),NO}function xae(){return $O||($O=vi()),$O}function qae(){return PO||(PO=Ul()),PO}N1.exports={loadCollection:Aae,loadCursor:xae,loadDb:qae}});var I1=_((mxe,P1)=>{"use strict";var Mae=N().applyWriteConcern,Nae=ie().BSON.Code,$ae=N().decorateWithCollation,Pae=N().decorateWithReadConcern,Iae=ur().executeCommand,$u=N().handleCallback,Rae=N().isObject,Dae=Bp().loadDb,jae=ne().OperationBase,Bae=ie().ReadPreference,Lae=N().toError,kae=ne().Aspect,Fae=ne().defineAspects,Uae=N().decorateWithExplain,Vae=he().maxWireVersion,Wae=Nl().MongoError,zae=["explain","readPreference","session","bypassDocumentValidation","w","wtimeout","j","writeConcern"],Hp=class extends jae{constructor(t,r,n,i){super(i),this.collection=t,this.map=r,this.reduce=n}execute(t){let r=this.collection,n=this.map,i=this.reduce,s=this.options,o={mapReduce:r.collectionName,map:n,reduce:i};for(let a in s)a==="scope"?o[a]=$1(s[a]):zae.indexOf(a)===-1&&(o[a]=s[a]);s=Object.assign({},s),s.readPreference=Bae.resolve(r,s),s.readPreference!==!1&&s.readPreference!=="primary"&&s.out&&s.out.inline!==1&&s.out!=="inline"?(s.readPreference="primary",Mae(o,{db:r.s.db,collection:r},s)):Pae(o,r,s),s.bypassDocumentValidation===!0&&(o.bypassDocumentValidation=s.bypassDocumentValidation);try{$ae(o,r,s)}catch(a){return t(a,null)}if(this.explain){if(Vae(r.s.topology)<9){t(new Wae("server does not support explain on mapReduce"));return}o=Uae(o,this.explain)}Iae(r.s.db,o,s,(a,u)=>{if(a)return $u(t,a);if(u.ok!==1||u.err||u.errmsg)return $u(t,Lae(u));if(this.explain)return t(void 0,u);let c={};if(u.timeMillis&&(c.processtime=u.timeMillis),u.counts&&(c.counts=u.counts),u.timing&&(c.timing=u.timing),u.results)return s.verbose==null||!s.verbose?$u(t,null,u.results):$u(t,null,{results:u.results,stats:c});let f=null;if(u.result!=null&&typeof u.result=="object"){let h=u.result,d=Dae();f=new d(h.db,r.s.db.s.topology,r.s.db.s.options).collection(h.collection)}else f=r.s.db.collection(u.result);if(s.verbose==null||!s.verbose)return $u(t,a,f);$u(t,a,{collection:f,stats:c})})}};function $1(e){if(!Rae(e)||e._bsontype==="ObjectID")return e;let t=Object.keys(e),r,n={};for(let i=t.length-1;i>=0;i--)r=t[i],typeof e[r]=="function"?n[r]=new Nae(String(e[r])):n[r]=$1(e[r]);return n}Fae(Hp,[kae.EXPLAINABLE]);P1.exports=Hp});var D1=_((yxe,R1)=>{"use strict";var Hae=ne().Aspect,Kae=ne().defineAspects,Gae=Si(),Qae=mr().serverType,Yae=mr().ServerType,Jae=ie().MongoError,Kp=class extends Gae{constructor(t,r){super(t,r),this.collectionName=t.collectionName}execute(t,r){if(Qae(t)!==Yae.Standalone){r(new Jae("reIndex can only be executed on standalone servers."));return}super.executeCommand(t,{reIndex:this.collectionName},(n,i)=>{if(n){r(n);return}r(null,!!i.ok)})}};Kae(Kp,[Hae.EXECUTE_WITH_SELECTION]);R1.exports=Kp});var B1=_((gxe,j1)=>{"use strict";var Xae=ne().OperationBase,Zae=Lr().updateDocuments,eue=N().hasAtomicOperators,IO=class extends Xae{constructor(t,r,n,i){if(super(i),eue(n))throw new TypeError("Replacement document must not contain atomic operators");this.collection=t,this.filter=r,this.replacement=n}execute(t){let r=this.collection,n=this.filter,i=this.replacement,s=this.options;s.multi=!1,Zae(r,n,i,s,(o,a)=>tue(o,a,i,t))}};function tue(e,t,r,n){if(n!=null){if(e&&n)return n(e);if(t==null)return n(null,{result:{ok:1}});t.modifiedCount=t.result.nModified!=null?t.result.nModified:t.result.n,t.upsertedId=Array.isArray(t.result.upserted)&&t.result.upserted.length>0?t.result.upserted[0]:null,t.upsertedCount=Array.isArray(t.result.upserted)&&t.result.upserted.length?t.result.upserted.length:0,t.matchedCount=Array.isArray(t.result.upserted)&&t.result.upserted.length>0?0:t.result.n,t.ops=[r],n&&n(null,t)}}j1.exports=IO});var k1=_((_xe,L1)=>{"use strict";var rue=ne().Aspect,nue=Jn(),iue=ne().defineAspects,Gp=class extends nue{constructor(t,r){super(t.s.db,r,t)}_buildCommand(){let t=this.collection,r=this.options,n={collStats:t.collectionName};return r.scale!=null&&(n.scale=r.scale),n}};iue(Gp,rue.READ_OPERATION);L1.exports=Gp});var U1=_((wxe,F1)=>{"use strict";var sue=ne().OperationBase,oue=Lr().updateDocuments,aue=N().hasAtomicOperators,uue=ne().Aspect,cue=ne().defineAspects,Qp=class extends sue{constructor(t,r,n,i){if(super(i),!aue(n))throw new TypeError("Update document requires atomic operators");this.collection=t,this.filter=r,this.update=n}execute(t){let r=this.collection,n=this.filter,i=this.update,s=this.options;s.multi=!0,oue(r,n,i,s,(o,a)=>{if(t!=null){if(o)return t(o);if(a==null)return t(null,{result:{ok:1}});if(this.explain)return t(void 0,a.result);a.modifiedCount=a.result.nModified!=null?a.result.nModified:a.result.n,a.upsertedId=Array.isArray(a.result.upserted)&&a.result.upserted.length>0?a.result.upserted[0]:null,a.upsertedCount=Array.isArray(a.result.upserted)&&a.result.upserted.length?a.result.upserted.length:0,a.matchedCount=Array.isArray(a.result.upserted)&&a.result.upserted.length>0?0:a.result.n,t(null,a)}})}};cue(Qp,[uue.EXPLAINABLE]);F1.exports=Qp});var W1=_((vxe,V1)=>{"use strict";var lue=ne().OperationBase,fue=Lr().updateDocuments,hue=N().hasAtomicOperators,due=ne().Aspect,pue=ne().defineAspects,Yp=class extends lue{constructor(t,r,n,i){if(super(i),!hue(n))throw new TypeError("Update document requires atomic operators");this.collection=t,this.filter=r,this.update=n}execute(t){let r=this.collection,n=this.filter,i=this.update,s=this.options;s.multi=!1,fue(r,n,i,s,(o,a)=>{if(t!=null){if(o)return t(o);if(a==null)return t(null,{result:{ok:1}});if(this.explain)return t(void 0,a.result);a.modifiedCount=a.result.nModified!=null?a.result.nModified:a.result.n,a.upsertedId=Array.isArray(a.result.upserted)&&a.result.upserted.length>0?a.result.upserted[0]:null,a.upsertedCount=Array.isArray(a.result.upserted)&&a.result.upserted.length?a.result.upserted.length:0,a.matchedCount=Array.isArray(a.result.upserted)&&a.result.upserted.length>0?0:a.result.n,t(null,a)}})}};pue(Yp,[due.EXPLAINABLE]);V1.exports=Yp});var qu=_((Sxe,Z1)=>{"use strict";var _n=require("util").deprecate,Jp=N().deprecateOptions,z1=N().emitWarningOnce,mue=N().checkCollectionName,yue=ie().BSON.ObjectID,H1=ie().MongoError,K1=N().normalizeHintField,gue=N().decorateCommand,_ue=N().decorateWithCollation,wue=N().decorateWithReadConcern,vue=N().formattedOrderClause,Pu=ie().ReadPreference,Sue=FP(),Oue=zP(),bue=zp(),Iu=N().executeLegacyOperation,Eue=Wi(),Cue=Lo(),Tue=N().MongoDBNamespace,Aue=yp(),xue=_p(),que=Ou().ensureIndex,Mue=Ou().group,Nue=Ou().parallelCollectionScan,$ue=Lr().removeDocuments,Pue=Ou().save,Iue=Lr().updateDocuments,Rue=Il(),Due=FS(),jue=VS(),G1=WS(),Bue=rI(),Lue=iI(),kue=oI(),Fue=Ep().DropCollectionOperation,Uue=JS(),Vue=mI(),Q1=gI(),Wue=vI(),zue=bI(),Y1=kl(),Hue=qI(),Kue=NI(),Gue=PI(),Que=RI(),Yue=jI(),Jue=LI(),Xue=oO(),Zue=UI(),ece=WI(),tce=GI(),rce=YI(),nce=I1(),ice=fO(),sce=bO(),oce=D1(),ace=B1(),uce=k1(),cce=U1(),lce=W1(),He=su(),fce=["ignoreUndefined"];function ue(e,t,r,n,i,s){mue(n);let o=null,a=s==null||s.slaveOk==null?e.slaveOk:s.slaveOk,u=s==null||s.serializeFunctions==null?e.s.options.serializeFunctions:s.serializeFunctions,c=s==null||s.raw==null?e.s.options.raw:s.raw,f=s==null||s.promoteLongs==null?e.s.options.promoteLongs:s.promoteLongs,h=s==null||s.promoteValues==null?e.s.options.promoteValues:s.promoteValues,d=s==null||s.promoteBuffers==null?e.s.options.promoteBuffers:s.promoteBuffers,p=s==null||s.bsonRegExp==null?e.s.options.bsonRegExp:s.bsonRegExp,m=null,y=new Tue(r,n),g=s.promiseLibrary||Promise;i=i??yue,this.s={pkFactory:i,db:e,topology:t,options:s,namespace:y,readPreference:Pu.fromOptions(s),slaveOk:a,serializeFunctions:u,raw:c,promoteLongs:f,promoteValues:h,promoteBuffers:d,bsonRegExp:p,internalHint:o,collectionHint:m,promiseLibrary:g,readConcern:Cue.fromOptions(s),writeConcern:Eue.fromOptions(s)}}Object.defineProperty(ue.prototype,"dbName",{enumerable:!0,get:function(){return this.s.namespace.db}});Object.defineProperty(ue.prototype,"collectionName",{enumerable:!0,get:function(){return this.s.namespace.collection}});Object.defineProperty(ue.prototype,"namespace",{enumerable:!0,get:function(){return this.s.namespace.toString()}});Object.defineProperty(ue.prototype,"readConcern",{enumerable:!0,get:function(){return this.s.readConcern==null?this.s.db.readConcern:this.s.readConcern}});Object.defineProperty(ue.prototype,"readPreference",{enumerable:!0,get:function(){return this.s.readPreference==null?this.s.db.readPreference:this.s.readPreference}});Object.defineProperty(ue.prototype,"writeConcern",{enumerable:!0,get:function(){return this.s.writeConcern==null?this.s.db.writeConcern:this.s.writeConcern}});Object.defineProperty(ue.prototype,"hint",{enumerable:!0,get:function(){return this.s.collectionHint},set:function(e){this.s.collectionHint=K1(e)}});var J1=["maxScan","fields","snapshot","oplogReplay"];ue.prototype.find=Jp({name:"collection.find",deprecatedOptions:J1,optionsIndex:1},function(e,t,r){typeof r=="object"&&z1("Third parameter to `find()` must be a callback or undefined");let n=e;typeof r!="function"&&(typeof t=="function"?(r=t,t=void 0):t==null&&(r=typeof n=="function"?n:void 0,n=typeof n=="object"?n:void 0)),n=n??{};let i=n;if(Buffer.isBuffer(i)){let c=i[0]|i[1]<<8|i[2]<<16|i[3]<<24;if(c!==i.length){let f=new Error("query selector raw message size does not match message header size ["+i.length+"] != ["+c+"]");throw f.name="MongoError",f}}n!=null&&n._bsontype==="ObjectID"&&(n={_id:n}),t||(t={});let s=t.projection||t.fields;s&&!Buffer.isBuffer(s)&&Array.isArray(s)&&(s=s.length?s.reduce((c,f)=>(c[f]=1,c),{}):{_id:1});let o=Object.assign({},t);for(let c in this.s.options)fce.indexOf(c)!==-1&&(o[c]=this.s.options[c]);if(o.skip=t.skip?t.skip:0,o.limit=t.limit?t.limit:0,o.raw=typeof t.raw=="boolean"?t.raw:this.s.raw,o.hint=t.hint!=null?K1(t.hint):this.s.collectionHint,o.timeout=typeof t.timeout>"u"?void 0:t.timeout,o.slaveOk=t.slaveOk!=null?t.slaveOk:this.s.db.slaveOk,o.readPreference=Pu.resolve(this,o),o.readPreference!=null&&(o.readPreference!=="primary"||o.readPreference.mode!=="primary")&&(o.slaveOk=!0),n!=null&&typeof n!="object")throw H1.create({message:"query selector must be an object",driver:!0});let a={find:this.s.namespace.toString(),limit:o.limit,skip:o.skip,query:n};typeof t.allowDiskUse=="boolean"&&(a.allowDiskUse=t.allowDiskUse),typeof o.awaitdata=="boolean"&&(o.awaitData=o.awaitdata),typeof o.timeout=="boolean"&&(o.noCursorTimeout=!o.timeout),gue(a,o,["session","collation"]),s&&(a.fields=s),o.db=this.s.db,o.promiseLibrary=this.s.promiseLibrary,o.raw==null&&typeof this.s.raw=="boolean"&&(o.raw=this.s.raw),o.promoteLongs==null&&typeof this.s.promoteLongs=="boolean"&&(o.promoteLongs=this.s.promoteLongs),o.promoteValues==null&&typeof this.s.promoteValues=="boolean"&&(o.promoteValues=this.s.promoteValues),o.promoteBuffers==null&&typeof this.s.promoteBuffers=="boolean"&&(o.promoteBuffers=this.s.promoteBuffers),o.bsonRegExp==null&&typeof this.s.bsonRegExp=="boolean"&&(o.bsonRegExp=this.s.bsonRegExp),a.sort&&(a.sort=vue(a.sort)),wue(a,this,t);try{_ue(a,this,t)}catch(c){if(typeof r=="function")return r(c,null);throw c}let u=this.s.topology.cursor(new Wue(this,this.s.namespace,a,o),o);if(typeof r=="function"){r(null,u);return}return u});ue.prototype.insertOne=function(e,t,r){typeof t=="function"&&(r=t,t={}),t=t||{},this.s.options.ignoreUndefined&&(t=Object.assign({},t),t.ignoreUndefined=this.s.options.ignoreUndefined);let n=new ece(this,e,t);return He(this.s.topology,n,r)};ue.prototype.insertMany=function(e,t,r){typeof t=="function"&&(r=t,t={}),t=t?Object.assign({},t):{ordered:!0};let n=new Zue(this,e,t);return He(this.s.topology,n,r)};ue.prototype.bulkWrite=function(e,t,r){if(typeof t=="function"&&(r=t,t={}),t=t||{ordered:!0},!Array.isArray(e))throw H1.create({message:"operations must be an array of documents",driver:!0});let n=new Due(this,e,t);return He(this.s.topology,n,r)};ue.prototype.insert=_n(function(e,t,r){return typeof t=="function"&&(r=t,t={}),t=t||{ordered:!1},e=Array.isArray(e)?e:[e],t.keepGoing===!0&&(t.ordered=!1),this.insertMany(e,t,r)},"collection.insert is deprecated. Use insertOne, insertMany or bulkWrite instead.");ue.prototype.updateOne=function(e,t,r,n){return typeof r=="function"&&(n=r,r={}),r=Object.assign({},r),this.s.options.ignoreUndefined&&(r=Object.assign({},r),r.ignoreUndefined=this.s.options.ignoreUndefined),He(this.s.topology,new lce(this,e,t,r),n)};ue.prototype.replaceOne=function(e,t,r,n){return typeof r=="function"&&(n=r,r={}),r=Object.assign({},r),this.s.options.ignoreUndefined&&(r=Object.assign({},r),r.ignoreUndefined=this.s.options.ignoreUndefined),He(this.s.topology,new ace(this,e,t,r),n)};ue.prototype.updateMany=function(e,t,r,n){return typeof r=="function"&&(n=r,r={}),r=Object.assign({},r),this.s.options.ignoreUndefined&&(r=Object.assign({},r),r.ignoreUndefined=this.s.options.ignoreUndefined),He(this.s.topology,new cce(this,e,t,r),n)};ue.prototype.update=_n(function(e,t,r,n){return typeof r=="function"&&(n=r,r={}),r=r||{},this.s.options.ignoreUndefined&&(r=Object.assign({},r),r.ignoreUndefined=this.s.options.ignoreUndefined),Iu(this.s.topology,Iue,[this,e,t,r,n])},"collection.update is deprecated. Use updateOne, updateMany, or bulkWrite instead.");ue.prototype.deleteOne=function(e,t,r){typeof t=="function"&&(r=t,t={}),t=Object.assign({},t),this.s.options.ignoreUndefined&&(t=Object.assign({},t),t.ignoreUndefined=this.s.options.ignoreUndefined);let n=new Lue(this,e,t);return He(this.s.topology,n,r)};ue.prototype.removeOne=ue.prototype.deleteOne;ue.prototype.deleteMany=function(e,t,r){typeof t=="function"&&(r=t,t={}),t=Object.assign({},t),this.s.options.ignoreUndefined&&(t=Object.assign({},t),t.ignoreUndefined=this.s.options.ignoreUndefined);let n=new Bue(this,e,t);return He(this.s.topology,n,r)};ue.prototype.removeMany=ue.prototype.deleteMany;ue.prototype.remove=_n(function(e,t,r){return typeof t=="function"&&(r=t,t={}),t=t||{},this.s.options.ignoreUndefined&&(t=Object.assign({},t),t.ignoreUndefined=this.s.options.ignoreUndefined),Iu(this.s.topology,$ue,[this,e,t,r])},"collection.remove is deprecated. Use deleteOne, deleteMany, or bulkWrite instead.");ue.prototype.save=_n(function(e,t,r){return typeof t=="function"&&(r=t,t={}),t=t||{},this.s.options.ignoreUndefined&&(t=Object.assign({},t),t.ignoreUndefined=this.s.options.ignoreUndefined),Iu(this.s.topology,Pue,[this,e,t,r])},"collection.save is deprecated. Use insertOne, insertMany, updateOne, or updateMany instead.");ue.prototype.findOne=Jp({name:"collection.find",deprecatedOptions:J1,optionsIndex:1},function(e,t,r){typeof r=="object"&&z1("Third parameter to `findOne()` must be a callback or undefined"),typeof e=="function"&&(r=e,e={},t={}),typeof t=="function"&&(r=t,t={}),e=e||{},t=t||{};let n=new zue(this,e,t);return He(this.s.topology,n,r)});ue.prototype.rename=function(e,t,r){typeof t=="function"&&(r=t,t={}),t=Object.assign({},t,{readPreference:Pu.PRIMARY});let n=new sce(this,e,t);return He(this.s.topology,n,r)};ue.prototype.drop=function(e,t){typeof e=="function"&&(t=e,e={}),e=e||{};let r=new Fue(this.s.db,this.collectionName,e);return He(this.s.topology,r,t)};ue.prototype.options=function(e,t){typeof e=="function"&&(t=e,e={}),e=e||{};let r=new ice(this,e);return He(this.s.topology,r,t)};ue.prototype.isCapped=function(e,t){typeof e=="function"&&(t=e,e={}),e=e||{};let r=new tce(this,e);return He(this.s.topology,r,t)};ue.prototype.createIndex=function(e,t,r){typeof t=="function"&&(r=t,t={}),t=t||{};let n=new G1(this,this.collectionName,e,t);return He(this.s.topology,n,r)};ue.prototype.createIndexes=function(e,t,r){typeof t=="function"&&(r=t,t={}),t=t?Object.assign({},t):{},typeof t.maxTimeMS!="number"&&delete t.maxTimeMS;let n=new G1(this,this.collectionName,e,t);return He(this.s.topology,n,r)};ue.prototype.dropIndex=function(e,t,r){let n=Array.prototype.slice.call(arguments,1);r=typeof n[n.length-1]=="function"?n.pop():void 0,t=n.length?n.shift()||{}:{},t.readPreference=Pu.PRIMARY;let i=new Uue(this,e,t);return He(this.s.topology,i,r)};ue.prototype.dropIndexes=function(e,t){typeof e=="function"&&(t=e,e={}),e=e?Object.assign({},e):{},typeof e.maxTimeMS!="number"&&delete e.maxTimeMS;let r=new Vue(this,e);return He(this.s.topology,r,t)};ue.prototype.dropAllIndexes=_n(ue.prototype.dropIndexes,"collection.dropAllIndexes is deprecated. Use dropIndexes instead.");ue.prototype.reIndex=_n(function(e,t){typeof e=="function"&&(t=e,e={}),e=e||{};let r=new oce(this,e);return He(this.s.topology,r,t)},"collection.reIndex is deprecated. Use db.command instead.");ue.prototype.listIndexes=function(e){return new xue(this.s.topology,new rce(this,e),e)};ue.prototype.ensureIndex=_n(function(e,t,r){return typeof t=="function"&&(r=t,t={}),t=t||{},Iu(this.s.topology,que,[this,e,t,r])},"collection.ensureIndex is deprecated. Use createIndexes instead.");ue.prototype.indexExists=function(e,t,r){typeof t=="function"&&(r=t,t={}),t=t||{};let n=new Jue(this,e,t);return He(this.s.topology,n,r)};ue.prototype.indexInformation=function(e,t){let r=Array.prototype.slice.call(arguments,0);t=typeof r[r.length-1]=="function"?r.pop():void 0,e=r.length?r.shift()||{}:{};let n=new Xue(this.s.db,this.collectionName,e);return He(this.s.topology,n,t)};ue.prototype.count=_n(function(e,t,r){let n=Array.prototype.slice.call(arguments,0);return r=typeof n[n.length-1]=="function"?n.pop():void 0,e=n.length?n.shift()||{}:{},t=n.length?n.shift()||{}:{},typeof t=="function"&&(r=t,t={}),t=t||{},He(this.s.topology,new Q1(this,Object.assign({query:e},t)),r)},"collection.count is deprecated, and will be removed in a future version. Use Collection.countDocuments or Collection.estimatedDocumentCount instead");ue.prototype.estimatedDocumentCount=function(e,t){typeof e=="function"&&(t=e,e={}),e=e||{};let r=new Q1(this,e);return He(this.s.topology,r,t)};ue.prototype.countDocuments=function(e,t,r){let n=Array.prototype.slice.call(arguments,0);r=typeof n[n.length-1]=="function"?n.pop():void 0,e=n.length?n.shift()||{}:{},t=n.length?n.shift()||{}:{};let i=new jue(this,e,t);return He(this.s.topology,i,r)};ue.prototype.distinct=function(e,t,r,n){let i=Array.prototype.slice.call(arguments,1);n=typeof i[i.length-1]=="function"?i.pop():void 0;let s=i.length?i.shift()||{}:{},o=i.length?i.shift()||{}:{},a=new kue(this,e,s,o);return He(this.s.topology,a,n)};ue.prototype.indexes=function(e,t){typeof e=="function"&&(t=e,e={}),e=e||{};let r=new Yue(this,e);return He(this.s.topology,r,t)};ue.prototype.stats=function(e,t){let r=Array.prototype.slice.call(arguments,0);t=typeof r[r.length-1]=="function"?r.pop():void 0,e=r.length?r.shift()||{}:{};let n=new uce(this,e);return He(this.s.topology,n,t)};ue.prototype.findOneAndDelete=function(e,t,r){return typeof t=="function"&&(r=t,t={}),t=t||{},this.s.options.ignoreUndefined&&(t=Object.assign({},t),t.ignoreUndefined=this.s.options.ignoreUndefined),He(this.s.topology,new Hue(this,e,t),r)};ue.prototype.findOneAndReplace=Jp({name:"collection.findOneAndReplace",deprecatedOptions:["returnOriginal"],optionsIndex:2},function(e,t,r,n){return typeof r=="function"&&(n=r,r={}),r=r||{},this.s.options.ignoreUndefined&&(r=Object.assign({},r),r.ignoreUndefined=this.s.options.ignoreUndefined),He(this.s.topology,new Kue(this,e,t,r),n)});ue.prototype.findOneAndUpdate=Jp({name:"collection.findOneAndUpdate",deprecatedOptions:["returnOriginal"],optionsIndex:2},function(e,t,r,n){return typeof r=="function"&&(n=r,r={}),r=r||{},this.s.options.ignoreUndefined&&(r=Object.assign({},r),r.ignoreUndefined=this.s.options.ignoreUndefined),He(this.s.topology,new Gue(this,e,t,r),n)});ue.prototype.findAndModify=_n(X1,"collection.findAndModify is deprecated. Use findOneAndUpdate, findOneAndReplace or findOneAndDelete instead.");ue.prototype._findAndModify=X1;function X1(e,t,r,n,i){let s=Array.prototype.slice.call(arguments,1);return i=typeof s[s.length-1]=="function"?s.pop():void 0,t=s.length?s.shift()||[]:[],r=s.length?s.shift():null,n=s.length?s.shift()||{}:{},n=Object.assign({},n),n.readPreference=Pu.PRIMARY,He(this.s.topology,new Y1(this,e,t,r,n),i)}ue.prototype.findAndRemove=_n(function(e,t,r,n){let i=Array.prototype.slice.call(arguments,1);return n=typeof i[i.length-1]=="function"?i.pop():void 0,t=i.length?i.shift()||[]:[],r=i.length?i.shift()||{}:{},r.remove=!0,He(this.s.topology,new Y1(this,e,t,null,r),n)},"collection.findAndRemove is deprecated. Use findOneAndDelete instead.");ue.prototype.aggregate=function(e,t,r){if(Array.isArray(e))typeof t=="function"&&(r=t,t={}),t==null&&r==null&&(t={});else{let i=Array.prototype.slice.call(arguments,0);r=i.pop();let s=i[i.length-1];t=s&&(s.readPreference||s.explain||s.cursor||s.out||s.maxTimeMS||s.hint||s.allowDiskUse)?i.pop():{},e=i}let n=new Aue(this.s.topology,new Rue(this,e,t),t);if(typeof r=="function"){r(null,n);return}return n};ue.prototype.watch=function(e,t){return e=e||[],t=t||{},Array.isArray(e)||(t=e,e=[]),new bue(this,e,t)};ue.prototype.parallelCollectionScan=_n(function(e,t){return typeof e=="function"&&(t=e,e={numCursors:1}),e.numCursors=e.numCursors||1,e.batchSize=e.batchSize||1e3,e=Object.assign({},e),e.readPreference=Pu.resolve(this,e),e.promiseLibrary=this.s.promiseLibrary,e.session&&(e.session=void 0),Iu(this.s.topology,Nue,[this,e,t],{skipSessions:!0})},"parallelCollectionScan is deprecated in MongoDB v4.1");ue.prototype.geoHaystackSearch=_n(function(e,t,r,n){let i=Array.prototype.slice.call(arguments,2);n=typeof i[i.length-1]=="function"?i.pop():void 0,r=i.length?i.shift()||{}:{};let s=new Que(this,e,t,r);return He(this.s.topology,s,n)},"geoHaystackSearch is deprecated, and will be removed in a future version.");ue.prototype.group=_n(function(e,t,r,n,i,s,o,a){let u=Array.prototype.slice.call(arguments,3);return a=typeof u[u.length-1]=="function"?u.pop():void 0,n=u.length?u.shift():null,i=u.length?u.shift():null,s=u.length?u.shift():null,o=u.length?u.shift()||{}:{},typeof i!="function"&&(s=i,i=null),!Array.isArray(e)&&e instanceof Object&&typeof e!="function"&&e._bsontype!=="Code"&&(e=Object.keys(e)),typeof n=="function"&&(n=n.toString()),typeof i=="function"&&(i=i.toString()),s=s??!0,Iu(this.s.topology,Mue,[this,e,t,r,n,i,s,o,a])},"MongoDB 3.6 or higher no longer supports the group command. We recommend rewriting using the aggregation framework.");ue.prototype.mapReduce=function(e,t,r,n){if(typeof r=="function"&&(n=r,r={}),r.out==null)throw new Error("the out option parameter must be defined, see mongodb docs for possible values");typeof e=="function"&&(e=e.toString()),typeof t=="function"&&(t=t.toString()),typeof r.finalize=="function"&&(r.finalize=r.finalize.toString());let i=new nce(this,e,t,r);return He(this.s.topology,i,n)};ue.prototype.initializeUnorderedBulkOp=function(e){return e=e||{},e.ignoreUndefined==null&&(e.ignoreUndefined=this.s.options.ignoreUndefined),e.promiseLibrary=this.s.promiseLibrary,Sue(this.s.topology,this,e)};ue.prototype.initializeOrderedBulkOp=function(e){return e=e||{},e.ignoreUndefined==null&&(e.ignoreUndefined=this.s.options.ignoreUndefined),e.promiseLibrary=this.s.promiseLibrary,Oue(this.s.topology,this,e)};ue.prototype.getLogger=function(){return this.s.db.s.logger};Z1.exports=ue});var zp=_((Oxe,cR)=>{"use strict";var hce=Ad(),dce=require("events"),pce=Nl().isResumableError,Wl=ie().MongoError,mce=vi(),yce=he().relayEvents,DO=he().maxWireVersion,RO=N().maybePromise,eR=N().now,gce=N().calculateDurationInMs,_ce=Il(),Vl=Symbol("resumeQueue"),iR=["resumeAfter","startAfter","startAtOperationTime","fullDocument"],sR=["batchSize","maxAwaitTimeMS","collation","readPreference"].concat(iR),Xp={COLLECTION:Symbol("Collection"),DATABASE:Symbol("Database"),CLUSTER:Symbol("Cluster")},jO=class extends dce{constructor(t,r,n){super();let i=qu(),s=Ul(),o=Ru();if(this.pipeline=r||[],this.options=n||{},this.parent=t,this.namespace=t.s.namespace,t instanceof i)this.type=Xp.COLLECTION,this.topology=t.s.db.serverConfig;else if(t instanceof s)this.type=Xp.DATABASE,this.topology=t.serverConfig;else if(t instanceof o)this.type=Xp.CLUSTER,this.topology=t.topology;else throw new TypeError("parent provided to ChangeStream constructor is not an instance of Collection, Db, or MongoClient");this.promiseLibrary=t.s.promiseLibrary,!this.options.readPreference&&t.s.readPreference&&(this.options.readPreference=t.s.readPreference),this[Vl]=new hce,this.cursor=oR(this,n),this.closed=!1,this.on("newListener",a=>{a==="change"&&this.cursor&&this.listenerCount("change")===0&&this.cursor.on("data",u=>LO(this,u))}),this.on("removeListener",a=>{a==="change"&&this.listenerCount("change")===0&&this.cursor&&this.cursor.removeAllListeners("data")})}get resumeToken(){return this.cursor.resumeToken}hasNext(t){return RO(this.parent,t,r=>{rR(this,(n,i)=>{if(n)return r(n);i.hasNext(r)})})}next(t){return RO(this.parent,t,r=>{rR(this,(n,i)=>{if(n)return r(n);i.next((s,o)=>{if(s){this[Vl].push(()=>this.next(r)),uR(this,s,r);return}LO(this,o,r)})})})}isClosed(){return this.closed||this.cursor&&this.cursor.isClosed()}close(t){return RO(this.parent,t,r=>{if(this.closed||(this.closed=!0,!this.cursor))return r();let n=this.cursor;return n.close(i=>(["data","close","end","error"].forEach(s=>n.removeAllListeners(s)),this.cursor=void 0,r(i)))})}pipe(t,r){return this.pipeDestinations||(this.pipeDestinations=[]),this.pipeDestinations.push(t),this.cursor.pipe(t,r)}unpipe(t){return this.pipeDestinations&&this.pipeDestinations.indexOf(t)>-1&&this.pipeDestinations.splice(this.pipeDestinations.indexOf(t),1),this.cursor.unpipe(t)}stream(t){return this.streamOptions=t,this.cursor.stream(t)}pause(){return this.cursor.pause()}resume(){return this.cursor.resume()}},BO=class extends mce{constructor(t,r,n){super(t,r,n),n=n||{},this._resumeToken=null,this.startAtOperationTime=n.startAtOperationTime,n.startAfter?this.resumeToken=n.startAfter:n.resumeAfter&&(this.resumeToken=n.resumeAfter)}set resumeToken(t){this._resumeToken=t,this.emit("resumeTokenChanged",t)}get resumeToken(){return this._resumeToken}get resumeOptions(){let t={};for(let r of sR)this.options[r]&&(t[r]=this.options[r]);if(this.resumeToken||this.startAtOperationTime)if(["resumeAfter","startAfter","startAtOperationTime"].forEach(r=>delete t[r]),this.resumeToken){let r=this.options.startAfter&&!this.hasReceived?"startAfter":"resumeAfter";t[r]=this.resumeToken}else this.startAtOperationTime&&DO(this.server)>=7&&(t.startAtOperationTime=this.startAtOperationTime);return t}cacheResumeToken(t){this.bufferedCount()===0&&this.cursorState.postBatchResumeToken?this.resumeToken=this.cursorState.postBatchResumeToken:this.resumeToken=t,this.hasReceived=!0}_processBatch(t,r){let n=r.cursor;n.postBatchResumeToken&&(this.cursorState.postBatchResumeToken=n.postBatchResumeToken,n[t].length===0&&(this.resumeToken=n.postBatchResumeToken))}_initializeCursor(t){super._initializeCursor((r,n)=>{if(r||n==null){t(r,n);return}let i=n.documents[0];this.startAtOperationTime==null&&this.resumeAfter==null&&this.startAfter==null&&DO(this.server)>=7&&(this.startAtOperationTime=i.operationTime),this._processBatch("firstBatch",i),this.emit("init",n),this.emit("response"),t(r,n)})}_getMore(t){super._getMore((r,n)=>{if(r){t(r);return}this._processBatch("nextBatch",n),this.emit("more",n),this.emit("response"),t(r,n)})}};function oR(e,t){let r={fullDocument:t.fullDocument||"default"};tR(r,t,iR),e.type===Xp.CLUSTER&&(r.allChangesForCluster=!0);let n=[{$changeStream:r}].concat(e.pipeline),i=tR({},t,sR),s=new BO(e.topology,new _ce(e.parent,n,t),i);if(yce(s,e,["resumeTokenChanged","end","close"]),e.listenerCount("change")>0&&s.on("data",function(o){LO(e,o)}),s.on("error",function(o){uR(e,o)}),e.pipeDestinations){let o=s.stream(e.streamOptions);for(let a of e.pipeDestinations)o.pipe(a)}return s}function tR(e,t,r){return r.forEach(n=>{t[n]&&(e[n]=t[n])}),e}var wce=3e4;function aR(e,t,r){setTimeout(()=>{t&&t.start==null&&(t.start=eR());let n=t.start||eR(),i=t.timeout||wce,s=t.readPreference;if(e.isConnected({readPreference:s}))return r();if(gce(n)>i)return r(new Wl("Timed out waiting for connection"));aR(e,t,r)},500)}function LO(e,t,r){let n=e.cursor;if(t==null&&(e.closed=!0),e.closed){r&&r(new Wl("ChangeStream is closed"));return}if(t&&!t._id){let i=new Error("A change stream document has been received that lacks a resume token (_id).");return r?r(i):e.emit("error",i)}return n.cacheResumeToken(t._id),e.options.startAtOperationTime=void 0,r?r(void 0,t):e.emit("change",t)}function uR(e,t,r){let n=e.topology,i=e.cursor;if(e.closed){r&&r(new Wl("ChangeStream is closed"));return}function s(a){e.cursor=a,nR(e)}function o(a){r||(e.emit("error",a),e.emit("close")),nR(e,a),e.closed=!0}if(i&&pce(t,DO(i.server))){e.cursor=void 0,["data","close","end","error"].forEach(a=>i.removeAllListeners(a)),i.close(),aR(n,{readPreference:i.options.readPreference},a=>{if(a)return o(a);let u=oR(e,i.resumeOptions);if(!r)return s(u);u.hasNext(c=>{if(c)return o(c);s(u)})});return}return r?r(t):e.emit("error",t)}function rR(e,t){if(e.isClosed()){t(new Wl("ChangeStream is closed."));return}if(e.cursor){t(void 0,e.cursor);return}e[Vl].push(t)}function nR(e,t){for(;e[Vl].length;){let r=e[Vl].pop();if(e.isClosed()&&!t){r(new Wl("Change Stream is not open."));return}r(t,e.cursor)}}cR.exports=jO});var so=_(Zp=>{"use strict";var vce=require("events"),sa=ie().MongoError,zl=require("util").format,kO=ie().ReadPreference,Sce=ie().Sessions.ClientSession,Du=function(e,t){var r=this,n=[];t=t||{force:!1,bufferMaxEntries:-1},this.s={storedOps:n,storeOptions:t,topology:e},Object.defineProperty(this,"length",{enumerable:!0,get:function(){return r.s.storedOps.length}})};Du.prototype.add=function(e,t,r,n,i){if(this.s.storeOptions.force)return i(sa.create({message:"db closed by application",driver:!0}));if(this.s.storeOptions.bufferMaxEntries===0)return i(sa.create({message:zl("no connection available for operation and number of stored operation > %s",this.s.storeOptions.bufferMaxEntries),driver:!0}));if(this.s.storeOptions.bufferMaxEntries>0&&this.s.storedOps.length>this.s.storeOptions.bufferMaxEntries){for(;this.s.storedOps.length>0;){var s=this.s.storedOps.shift();s.c(sa.create({message:zl("no connection available for operation and number of stored operation > %s",this.s.storeOptions.bufferMaxEntries),driver:!0}))}return}this.s.storedOps.push({t:e,n:t,o:r,op:n,c:i})};Du.prototype.addObjectAndMethod=function(e,t,r,n,i){if(this.s.storeOptions.force)return i(sa.create({message:"db closed by application",driver:!0}));if(this.s.storeOptions.bufferMaxEntries===0)return i(sa.create({message:zl("no connection available for operation and number of stored operation > %s",this.s.storeOptions.bufferMaxEntries),driver:!0}));if(this.s.storeOptions.bufferMaxEntries>0&&this.s.storedOps.length>this.s.storeOptions.bufferMaxEntries){for(;this.s.storedOps.length>0;){var s=this.s.storedOps.shift();s.c(sa.create({message:zl("no connection available for operation and number of stored operation > %s",this.s.storeOptions.bufferMaxEntries),driver:!0}))}return}this.s.storedOps.push({t:e,m:r,o:t,p:n,c:i})};Du.prototype.flush=function(e){for(;this.s.storedOps.length>0;)this.s.storedOps.shift().c(e||sa.create({message:zl("no connection available for operation"),driver:!0}))};var lR=["primary","primaryPreferred","nearest","secondaryPreferred"],fR=["secondary","secondaryPreferred"];Du.prototype.execute=function(e){e=e||{};var t=this.s.storedOps;this.s.storedOps=[];for(var r=typeof e.executePrimary=="boolean"?e.executePrimary:!0,n=typeof e.executeSecondary=="boolean"?e.executeSecondary:!0;t.length>0;){var i=t.shift();i.t==="cursor"?(r&&n||r&&i.o.options&&i.o.options.readPreference&&lR.indexOf(i.o.options.readPreference.mode)!==-1||!r&&n&&i.o.options&&i.o.options.readPreference&&fR.indexOf(i.o.options.readPreference.mode)!==-1)&&i.o[i.m].apply(i.o,i.p):i.t==="auth"?this.s.topology[i.t].apply(this.s.topology,i.o):r&&n?this.s.topology[i.t](i.n,i.o,i.op,i.c):r&&i.op&&i.op.readPreference&&lR.indexOf(i.op.readPreference.mode)!==-1?this.s.topology[i.t](i.n,i.o,i.op,i.c):!r&&n&&i.op&&i.op.readPreference&&fR.indexOf(i.op.readPreference.mode)!==-1&&this.s.topology[i.t](i.n,i.o,i.op,i.c)}};Du.prototype.all=function(){return this.s.storedOps};var hR=function(e){var t=function(h,d,p){Object.defineProperty(h,d,{enumerable:!0,get:function(){return p}})},r=!1,n=!1,i=!1,s=!1,o=!1,a=!1,u=e.maxWriteBatchSize||1e3,c=!1,f=!1;e.minWireVersion>=0&&(i=!0),e.maxWireVersion>=1&&(r=!0,s=!0),e.maxWireVersion>=2&&(n=!0),e.maxWireVersion>=3&&(o=!0,a=!0),e.maxWireVersion>=5&&(c=!0,f=!0),e.minWireVersion==null&&(e.minWireVersion=0),e.maxWireVersion==null&&(e.maxWireVersion=0),t(this,"hasAggregationCursor",r),t(this,"hasWriteCommands",n),t(this,"hasTextSearch",i),t(this,"hasAuthCommands",s),t(this,"hasListCollectionsCommand",o),t(this,"hasListIndexesCommand",a),t(this,"minWireVersion",e.minWireVersion),t(this,"maxWireVersion",e.maxWireVersion),t(this,"maxNumberOfDocsInBatch",u),t(this,"commandsTakeWriteConcern",c),t(this,"commandsTakeCollation",f)},oa=class extends vce{constructor(){super(),this.setMaxListeners(1/0)}hasSessionSupport(){return this.logicalSessionTimeoutMinutes!=null}startSession(t,r){let n=new Sce(this,this.s.sessionPool,t,r);return n.once("ended",()=>{this.s.sessions.delete(n)}),this.s.sessions.add(n),n}endSessions(t,r){return this.s.coreTopology.endSessions(t,r)}get clientMetadata(){return this.s.coreTopology.s.options.metadata}capabilities(){return this.s.sCapabilities?this.s.sCapabilities:this.s.coreTopology.lastIsMaster()==null?null:(this.s.sCapabilities=new hR(this.s.coreTopology.lastIsMaster()),this.s.sCapabilities)}command(t,r,n,i){this.s.coreTopology.command(t.toString(),r,kO.translate(n),i)}insert(t,r,n,i){this.s.coreTopology.insert(t.toString(),r,n,i)}update(t,r,n,i){this.s.coreTopology.update(t.toString(),r,n,i)}remove(t,r,n,i){this.s.coreTopology.remove(t.toString(),r,n,i)}isConnected(t){return t=t||{},t=kO.translate(t),this.s.coreTopology.isConnected(t)}isDestroyed(){return this.s.coreTopology.isDestroyed()}cursor(t,r,n){return n=n||{},n=kO.translate(n),n.disconnectHandler=this.s.store,n.topology=this,this.s.coreTopology.cursor(t,r,n)}lastIsMaster(){return this.s.coreTopology.lastIsMaster()}selectServer(t,r,n){return this.s.coreTopology.selectServer(t,r,n)}unref(){return this.s.coreTopology.unref()}connections(){return this.s.coreTopology.connections()}close(t,r){this.s.sessions.forEach(n=>n.endSession()),this.s.sessionPool&&this.s.sessionPool.endAllPooledSessions(),t===!0&&(this.s.storeOptions.force=t,this.s.store.flush()),this.s.coreTopology.destroy({force:typeof t=="boolean"?t:!1},r)}};Object.defineProperty(oa.prototype,"bson",{enumerable:!0,get:function(){return this.s.coreTopology.s.bson}});Object.defineProperty(oa.prototype,"parserType",{enumerable:!0,get:function(){return this.s.coreTopology.parserType}});Object.defineProperty(oa.prototype,"logicalSessionTimeoutMinutes",{enumerable:!0,get:function(){return this.s.coreTopology.logicalSessionTimeoutMinutes}});Object.defineProperty(oa.prototype,"type",{enumerable:!0,get:function(){return this.s.coreTopology.type}});Zp.Store=Du;Zp.ServerCapabilities=hR;Zp.TopologyBase=oa});var UO=_((Exe,pR)=>{"use strict";var Oce=ie().Topology,bce=so().ServerCapabilities,Ece=vi(),dR=N().translateOptions,FO=class extends Oce{constructor(t,r){r=r||{};let n=Object.assign({},{cursorFactory:Ece,reconnect:!1,emitError:typeof r.emitError=="boolean"?r.emitError:!0,maxPoolSize:typeof r.maxPoolSize=="number"?r.maxPoolSize:typeof r.poolSize=="number"?r.poolSize:10,minPoolSize:typeof r.minPoolSize=="number"?r.minPoolSize:typeof r.minSize=="number"?r.minSize:0,monitorCommands:typeof r.monitorCommands=="boolean"?r.monitorCommands:!1});n=dR(n,r);var i=r.socketOptions&&Object.keys(r.socketOptions).length>0?r.socketOptions:r;n=dR(n,i),n.serverApi=r.serverApi,n.useUnifiedTopology=r.useUnifiedTopology,super(t,n)}capabilities(){return this.s.sCapabilities?this.s.sCapabilities:this.lastIsMaster()==null?null:(this.s.sCapabilities=new bce(this.lastIsMaster()),this.s.sCapabilities)}command(t,r,n,i){super.command(t.toString(),r,n,i)}insert(t,r,n,i){super.insert(t.toString(),r,n,i)}update(t,r,n,i){super.update(t.toString(),r,n,i)}remove(t,r,n,i){super.remove(t.toString(),r,n,i)}};pR.exports=FO});var Hl=_((Cxe,yR)=>{"use strict";var Cce=ie().Server,Tce=vi(),Ace=so().TopologyBase,xce=so().Store,qce=ie().MongoError,Mce=N().MAX_JS_INT,mR=N().translateOptions,Nce=N().filterOptions,$ce=N().mergeOptions,Pce=["ha","haInterval","acceptableLatencyMS","poolSize","ssl","checkServerIdentity","sslValidate","sslCA","sslCRL","sslCert","ciphers","ecdhCurve","sslKey","sslPass","socketOptions","bufferMaxEntries","store","auto_reconnect","autoReconnect","emitError","keepAlive","keepAliveInitialDelay","noDelay","connectTimeoutMS","socketTimeoutMS","family","loggerLevel","logger","reconnectTries","reconnectInterval","monitoring","appname","domainsEnabled","servername","promoteLongs","promoteValues","promoteBuffers","bsonRegExp","compression","promiseLibrary","monitorCommands"],aa=class extends Ace{constructor(t,r,n){super();var i=this;n=Nce(n,Pce);let s=n.promiseLibrary;var o={force:!1,bufferMaxEntries:typeof n.bufferMaxEntries=="number"?n.bufferMaxEntries:Mce},a=n.store||new xce(i,o);if(t.indexOf("/")!==-1)r!=null&&typeof r=="object"&&(n=r,r=null);else if(r==null)throw qce.create({message:"port must be specified",driver:!0});var u=typeof n.auto_reconnect=="boolean"?n.auto_reconnect:!0;u=typeof n.autoReconnect=="boolean"?n.autoReconnect:u;var c=$ce({},{host:t,port:r,disconnectHandler:a,cursorFactory:Tce,reconnect:u,emitError:typeof n.emitError=="boolean"?n.emitError:!0,size:typeof n.poolSize=="number"?n.poolSize:5,monitorCommands:typeof n.monitorCommands=="boolean"?n.monitorCommands:!1});c=mR(c,n);var f=n.socketOptions&&Object.keys(n.socketOptions).length>0?n.socketOptions:n;c=mR(c,f),this.s={coreTopology:new Cce(c),sCapabilities:null,clonedOptions:c,reconnect:c.reconnect,emitError:c.emitError,poolSize:c.size,storeOptions:o,store:a,host:t,port:r,options:n,sessionPool:null,sessions:new Set,promiseLibrary:s||Promise}}connect(t,r){var n=this;typeof t=="function"&&(r=t,t={}),t==null&&(t=this.s.clonedOptions),typeof r!="function"&&(r=null),t=Object.assign({},this.s.clonedOptions,t),n.s.options=t,n.s.storeOptions.bufferMaxEntries=typeof t.bufferMaxEntries=="number"?t.bufferMaxEntries:-1;var i=function(){return function(d){var p=["timeout","error","close"];p.forEach(function(m){n.s.coreTopology.removeListener(m,h[m])}),n.s.coreTopology.removeListener("connect",i);try{r(d)}catch(m){process.nextTick(function(){throw m})}}},s=function(d){return function(p){d!=="error"&&n.emit(d,p)}},o=function(){n.emit("reconnect",n),n.s.store.execute()},a=function(d){n.emit("reconnectFailed",d),n.s.store.flush(d)},u=function(){n.s.store.flush()},c=function(d){return function(p,m){n.emit(d,p,m)}},f=function(){["timeout","error","close","destroy"].forEach(function(d){n.s.coreTopology.removeAllListeners(d)}),n.s.coreTopology.on("timeout",s("timeout")),n.s.coreTopology.once("error",s("error")),n.s.coreTopology.on("close",s("close")),n.s.coreTopology.on("destroy",u),n.emit("open",null,n);try{r(null,n)}catch(d){process.nextTick(function(){throw d})}},h={timeout:i("timeout"),error:i("error"),close:i("close")};["timeout","error","close","serverOpening","serverDescriptionChanged","serverHeartbeatStarted","serverHeartbeatSucceeded","serverHeartbeatFailed","serverClosed","topologyOpening","topologyClosed","topologyDescriptionChanged","commandStarted","commandSucceeded","commandFailed"].forEach(function(d){n.s.coreTopology.removeAllListeners(d)}),n.s.coreTopology.once("timeout",h.timeout),n.s.coreTopology.once("error",h.error),n.s.coreTopology.once("close",h.close),n.s.coreTopology.once("connect",f),n.s.coreTopology.on("reconnect",o),n.s.coreTopology.on("reconnectFailed",a),n.s.coreTopology.on("serverDescriptionChanged",c("serverDescriptionChanged")),n.s.coreTopology.on("serverHeartbeatStarted",c("serverHeartbeatStarted")),n.s.coreTopology.on("serverHeartbeatSucceeded",c("serverHeartbeatSucceeded")),n.s.coreTopology.on("serverHeartbeatFailed",c("serverHeartbeatFailed")),n.s.coreTopology.on("serverOpening",c("serverOpening")),n.s.coreTopology.on("serverClosed",c("serverClosed")),n.s.coreTopology.on("topologyOpening",c("topologyOpening")),n.s.coreTopology.on("topologyClosed",c("topologyClosed")),n.s.coreTopology.on("topologyDescriptionChanged",c("topologyDescriptionChanged")),n.s.coreTopology.on("commandStarted",c("commandStarted")),n.s.coreTopology.on("commandSucceeded",c("commandSucceeded")),n.s.coreTopology.on("commandFailed",c("commandFailed")),n.s.coreTopology.on("attemptReconnect",c("attemptReconnect")),n.s.coreTopology.on("monitoring",c("monitoring")),n.s.coreTopology.connect(t)}};Object.defineProperty(aa.prototype,"poolSize",{enumerable:!0,get:function(){return this.s.coreTopology.connections().length}});Object.defineProperty(aa.prototype,"autoReconnect",{enumerable:!0,get:function(){return this.s.reconnect}});Object.defineProperty(aa.prototype,"host",{enumerable:!0,get:function(){return this.s.host}});Object.defineProperty(aa.prototype,"port",{enumerable:!0,get:function(){return this.s.port}});yR.exports=aa});var VO=_((Txe,_R)=>{"use strict";var Ice=so().TopologyBase,Rce=ie().MongoError,Dce=ie().Mongos,jce=vi(),Bce=Hl(),Lce=so().Store,kce=N().MAX_JS_INT,gR=N().translateOptions,Fce=N().filterOptions,Uce=N().mergeOptions,Vce=["ha","haInterval","acceptableLatencyMS","poolSize","ssl","checkServerIdentity","sslValidate","sslCA","sslCRL","sslCert","ciphers","ecdhCurve","sslKey","sslPass","socketOptions","bufferMaxEntries","store","auto_reconnect","autoReconnect","emitError","keepAlive","keepAliveInitialDelay","noDelay","connectTimeoutMS","socketTimeoutMS","loggerLevel","logger","reconnectTries","appname","domainsEnabled","servername","promoteLongs","promoteValues","promoteBuffers","bsonRegExp","promiseLibrary","monitorCommands"],em=class extends Ice{constructor(t,r){super(),r=r||{};var n=this;r=Fce(r,Vce);for(var i=0;i<t.length;i++)if(!(t[i]instanceof Bce))throw Rce.create({message:"all seed list instances must be of the Server type",driver:!0});var s={force:!1,bufferMaxEntries:typeof r.bufferMaxEntries=="number"?r.bufferMaxEntries:kce},o=r.store||new Lce(n,s),a=t.map(function(h){return{host:h.host,port:h.port}}),u=typeof r.auto_reconnect=="boolean"?r.auto_reconnect:!0;u=typeof r.autoReconnect=="boolean"?r.autoReconnect:u;var c=Uce({},{disconnectHandler:o,cursorFactory:jce,reconnect:u,emitError:typeof r.emitError=="boolean"?r.emitError:!0,size:typeof r.poolSize=="number"?r.poolSize:5,monitorCommands:typeof r.monitorCommands=="boolean"?r.monitorCommands:!1});c=gR(c,r);var f=r.socketOptions&&Object.keys(r.socketOptions).length>0?r.socketOptions:r;c=gR(c,f),this.s={coreTopology:new Dce(a,c),sCapabilities:null,debug:c.debug,storeOptions:s,clonedOptions:c,store:o,options:r,sessionPool:null,sessions:new Set,promiseLibrary:r.promiseLibrary||Promise}}connect(t,r){var n=this;typeof t=="function"&&(r=t,t={}),t==null&&(t={}),typeof r!="function"&&(r=null),t=Object.assign({},this.s.clonedOptions,t),n.s.options=t,n.s.storeOptions.bufferMaxEntries=typeof t.bufferMaxEntries=="number"?t.bufferMaxEntries:-1;var i=function(){return function(f){var h=["timeout","error","close"];h.forEach(function(d){n.removeListener(d,i)}),n.s.coreTopology.removeListener("connect",i),n.close(!0);try{r(f)}catch(d){process.nextTick(function(){throw d})}}},s=function(f){return function(h){f!=="error"&&n.emit(f,h)}},o=function(){n.emit("reconnect"),n.s.store.execute()},a=function(f){return function(h,d){n.emit(f,h,d)}},u=function(){var f=["timeout","error","close","fullsetup"];f.forEach(function(h){n.s.coreTopology.removeAllListeners(h)}),n.s.coreTopology.on("timeout",s("timeout")),n.s.coreTopology.on("error",s("error")),n.s.coreTopology.on("close",s("close")),n.s.coreTopology.on("fullsetup",function(){n.emit("fullsetup",n)}),n.emit("open",null,n);try{r(null,n)}catch(h){process.nextTick(function(){throw h})}},c=["timeout","error","close","serverOpening","serverDescriptionChanged","serverHeartbeatStarted","serverHeartbeatSucceeded","serverHeartbeatFailed","serverClosed","topologyOpening","topologyClosed","topologyDescriptionChanged","commandStarted","commandSucceeded","commandFailed"];c.forEach(function(f){n.s.coreTopology.removeAllListeners(f)}),n.s.coreTopology.on("serverDescriptionChanged",a("serverDescriptionChanged")),n.s.coreTopology.on("serverHeartbeatStarted",a("serverHeartbeatStarted")),n.s.coreTopology.on("serverHeartbeatSucceeded",a("serverHeartbeatSucceeded")),n.s.coreTopology.on("serverHeartbeatFailed",a("serverHeartbeatFailed")),n.s.coreTopology.on("serverOpening",a("serverOpening")),n.s.coreTopology.on("serverClosed",a("serverClosed")),n.s.coreTopology.on("topologyOpening",a("topologyOpening")),n.s.coreTopology.on("topologyClosed",a("topologyClosed")),n.s.coreTopology.on("topologyDescriptionChanged",a("topologyDescriptionChanged")),n.s.coreTopology.on("commandStarted",a("commandStarted")),n.s.coreTopology.on("commandSucceeded",a("commandSucceeded")),n.s.coreTopology.on("commandFailed",a("commandFailed")),n.s.coreTopology.once("timeout",i("timeout")),n.s.coreTopology.once("error",i("error")),n.s.coreTopology.once("close",i("close")),n.s.coreTopology.once("connect",u),n.s.coreTopology.on("joined",a("joined")),n.s.coreTopology.on("left",a("left")),n.s.coreTopology.on("reconnect",o),n.s.coreTopology.connect(t)}};Object.defineProperty(em.prototype,"haInterval",{enumerable:!0,get:function(){return this.s.coreTopology.s.haInterval}});_R.exports=em});var WO=_((Axe,vR)=>{"use strict";var Wce=Hl(),zce=vi(),Hce=ie().MongoError,Kce=so().TopologyBase,Gce=so().Store,Qce=ie().ReplSet,Yce=N().MAX_JS_INT,wR=N().translateOptions,Jce=N().filterOptions,Xce=N().mergeOptions,Zce=["ha","haInterval","replicaSet","rs_name","secondaryAcceptableLatencyMS","connectWithNoPrimary","poolSize","ssl","checkServerIdentity","sslValidate","sslCA","sslCert","ciphers","ecdhCurve","sslCRL","sslKey","sslPass","socketOptions","bufferMaxEntries","store","auto_reconnect","autoReconnect","emitError","keepAlive","keepAliveInitialDelay","noDelay","connectTimeoutMS","socketTimeoutMS","strategy","debug","family","loggerLevel","logger","reconnectTries","appname","domainsEnabled","servername","promoteLongs","promoteValues","promoteBuffers","bsonRegExp","maxStalenessSeconds","promiseLibrary","minSize","monitorCommands"],tm=class extends Kce{constructor(t,r){super(),r=r||{};var n=this;r=Jce(r,Zce);for(var i=0;i<t.length;i++)if(!(t[i]instanceof Wce))throw Hce.create({message:"all seed list instances must be of the Server type",driver:!0});var s={force:!1,bufferMaxEntries:typeof r.bufferMaxEntries=="number"?r.bufferMaxEntries:Yce},o=r.store||new Gce(n,s),a=t.map(function(h){return{host:h.host,port:h.port}}),u=Xce({},{disconnectHandler:o,cursorFactory:zce,reconnect:!1,emitError:typeof r.emitError=="boolean"?r.emitError:!0,size:typeof r.poolSize=="number"?r.poolSize:5,monitorCommands:typeof r.monitorCommands=="boolean"?r.monitorCommands:!1});u=wR(u,r);var c=r.socketOptions&&Object.keys(r.socketOptions).length>0?r.socketOptions:r;u=wR(u,c);var f=new Qce(a,u);f.on("reconnect",function(){n.emit("reconnect"),o.execute()}),this.s={coreTopology:f,sCapabilities:null,tag:r.tag,storeOptions:s,clonedOptions:u,store:o,options:r,sessionPool:null,sessions:new Set,promiseLibrary:r.promiseLibrary||Promise},u.debug&&Object.defineProperty(this,"replset",{enumerable:!0,get:function(){return f}})}connect(t,r){var n=this;typeof t=="function"&&(r=t,t={}),t==null&&(t={}),typeof r!="function"&&(r=null),t=Object.assign({},this.s.clonedOptions,t),n.s.options=t,n.s.storeOptions.bufferMaxEntries=typeof t.bufferMaxEntries=="number"?t.bufferMaxEntries:-1;var i=function(h){return function(d){h!=="error"&&n.emit(h,d)}},s=["timeout","error","close","serverOpening","serverDescriptionChanged","serverHeartbeatStarted","serverHeartbeatSucceeded","serverHeartbeatFailed","serverClosed","topologyOpening","topologyClosed","topologyDescriptionChanged","commandStarted","commandSucceeded","commandFailed","joined","left","ping","ha"];s.forEach(function(h){n.s.coreTopology.removeAllListeners(h)});var o=function(h){return function(d,p){n.emit(h,d,p)}},a=function(h){return function(d,p){n.emit(h,d,p.lastIsMaster(),p)}},u=function(h,d){n.emit("ha",h,d),h==="start"?n.emit("ha_connect",h,d):h==="end"&&n.emit("ha_ismaster",h,d)};n.s.coreTopology.on("joined",a("joined")),n.s.coreTopology.on("left",o("left")),n.s.coreTopology.on("ping",o("ping")),n.s.coreTopology.on("ha",u),n.s.coreTopology.on("serverDescriptionChanged",o("serverDescriptionChanged")),n.s.coreTopology.on("serverHeartbeatStarted",o("serverHeartbeatStarted")),n.s.coreTopology.on("serverHeartbeatSucceeded",o("serverHeartbeatSucceeded")),n.s.coreTopology.on("serverHeartbeatFailed",o("serverHeartbeatFailed")),n.s.coreTopology.on("serverOpening",o("serverOpening")),n.s.coreTopology.on("serverClosed",o("serverClosed")),n.s.coreTopology.on("topologyOpening",o("topologyOpening")),n.s.coreTopology.on("topologyClosed",o("topologyClosed")),n.s.coreTopology.on("topologyDescriptionChanged",o("topologyDescriptionChanged")),n.s.coreTopology.on("commandStarted",o("commandStarted")),n.s.coreTopology.on("commandSucceeded",o("commandSucceeded")),n.s.coreTopology.on("commandFailed",o("commandFailed")),n.s.coreTopology.on("fullsetup",function(){n.emit("fullsetup",n,n)}),n.s.coreTopology.on("all",function(){n.emit("all",null,n)});var c=function(){n.s.coreTopology.once("timeout",i("timeout")),n.s.coreTopology.once("error",i("error")),n.s.coreTopology.once("close",i("close")),n.emit("open",null,n);try{r(null,n)}catch(h){process.nextTick(function(){throw h})}},f=function(){return function(h){["timeout","error","close"].forEach(function(d){n.s.coreTopology.removeListener(d,f)}),n.s.coreTopology.removeListener("connect",f),n.s.coreTopology.destroy();try{r(h)}catch(d){n.s.coreTopology.isConnected()||process.nextTick(function(){throw d})}}};n.s.coreTopology.once("timeout",f("timeout")),n.s.coreTopology.once("error",f("error")),n.s.coreTopology.once("close",f("close")),n.s.coreTopology.once("connect",c),n.s.coreTopology.connect(t)}close(t,r){["timeout","error","close","joined","left"].forEach(n=>this.removeAllListeners(n)),super.close(t,r)}};Object.defineProperty(tm.prototype,"haInterval",{enumerable:!0,get:function(){return this.s.coreTopology.s.haInterval}});vR.exports=tm});var ER=_((xxe,bR)=>{"use strict";var ele=ie().ReadPreference,zO=require("url"),tle=require("util").format,rle=ie().Logger,SR=require("dns"),nle=Lo(),ile=require("querystring"),rm=se().MongoParseError;bR.exports=function(e,t,r){typeof t=="function"&&(r=t,t={}),t=t||{};let n;try{n=zO.parse(e,!0)}catch{return r(new Error("URL malformed, cannot be parsed"))}if(n.protocol!=="mongodb:"&&n.protocol!=="mongodb+srv:")return r(new Error("Invalid schema, expected `mongodb` or `mongodb+srv`"));if(n.protocol==="mongodb:")return OR(e,t,r);if(n.hostname.split(".").length<3)return r(new Error("URI does not have hostname, domain name and tld"));if(n.domainLength=n.hostname.split(".").length,e.substring(14).split("/")[0].match(","))return r(new Error("Invalid URI, cannot contain multiple hostnames"));if(n.port)return r(new Error("Ports not accepted with `mongodb+srv` URIs"));let s=`_mongodb._tcp.${n.host}`;SR.resolveSrv(s,function(o,a){if(o)return r(o);if(a.length===0)return r(new Error("No addresses found at host"));for(let d=0;d<a.length;d++)if(!sle(a[d].name,n.hostname,n.domainLength))return r(new Error("Server record does not share hostname with parent URI"));let u=n.auth?`mongodb://${n.auth}@`:"mongodb://",f=a.map(function(d,p){return p===0?`${u}${d.name}:${d.port}`:`${d.name}:${d.port}`}).join(",")+"/",h=[];if(n.path){let d=n.path.slice(1);d.indexOf("?")!==-1&&(d=d.slice(0,d.indexOf("?"))),f+=d}(!t.ssl&&!n.search||!t.ssl&&n.search&&!n.search.match("ssl"))&&h.push("ssl=true"),n.search&&h.push(n.search.replace("?","")),SR.resolveTxt(n.host,function(d,p){if(d&&d.code!=="ENODATA"&&d.code!=="ENOTFOUND")return r(d);if(d&&d.code==="ENODATA"&&(p=null),p){if(p.length>1)return r(new rm("Multiple text records not allowed"));p=p[0].join("");let m=ile.parse(p),y=Object.keys(m);if(Object.keys(y).some(g=>g.toLowerCase()==="loadbalanced"))return r(new rm("Load balancer mode requires driver version 4+"));if(y.some(g=>g!=="authSource"&&g!=="replicaSet"))return r(new rm("Text record must only set `authSource` or `replicaSet`"));y.length>0&&h.push(p)}h.length&&(f+=`?${h.join("&")}`),OR(f,t,r)})})};function sle(e,t){let r=/^.*?\./,n=`.${e.replace(r,"")}`,i=`.${t.replace(r,"")}`;return!!n.endsWith(i)}function OR(e,t,r){let n,i;try{n=ole(e,t)}catch(s){i=s}return i?r(i,null):r(null,n)}function ole(e,t){let r="",n="",i="",s="admin",o=zO.parse(e,!0);if((o.hostname==null||o.hostname==="")&&e.indexOf(".sock")===-1)throw new Error("No hostname or hostnames provided in connection string");if(o.port==="0")throw new Error("Invalid port (zero) with hostname");if(!isNaN(parseInt(o.port,10))&&parseInt(o.port,10)>65535)throw new Error("Invalid port (larger than 65535) with hostname");if(o.path&&o.path.length>0&&o.path[0]!=="/"&&e.indexOf(".sock")===-1)throw new Error("Missing delimiting slash between hosts and options");if(o.query)for(let x in o.query){if(x.indexOf("::")!==-1)throw new Error("Double colon in host identifier");if(o.query[x]==="")throw new Error("Query parameter "+x+" is an incomplete value pair")}if(o.auth){let x=o.auth.split(":");if(e.indexOf(o.auth)!==-1&&x.length>2)throw new Error("Username with password containing an unescaped colon");if(e.indexOf(o.auth)!==-1&&o.auth.indexOf("@")!==-1)throw new Error("Username containing an unescaped at-sign")}let u=e.split("?").shift().split(","),c=[];for(let x=0;x<u.length;x++){let z=u[x];z.indexOf("mongodb")!==-1?z.indexOf("@")!==-1?c.push(z.split("@").pop()):c.push(z.substr(10)):z.indexOf("/")!==-1?c.push(z.split("/").shift()):z.indexOf("/")===-1&&c.push(z.trim())}for(let x=0;x<c.length;x++){let z=zO.parse(tle("mongodb://%s",c[x].trim()));if(!(z.path&&z.path.indexOf(".sock")!==-1)&&z.path&&z.path.indexOf(":")!==-1)throw z.path.split("/").length>1&&z.path.indexOf("::")===-1?new Error("Slash in host identifier"):new Error("Double colon in host identifier")}if(e.indexOf("?")!==-1?(i=e.substr(e.indexOf("?")+1),r=e.substring(10,e.indexOf("?"))):r=e.substring(10),r.indexOf("@")!==-1&&(n=r.split("@")[0],r=r.split("@")[1]),r.split("/").length>2)throw new Error("Unsupported host '"+r.split("?")[0]+"', hosts must be URL encoded and contain at most one unencoded slash");if(r.indexOf(".sock")!==-1){if(r.indexOf(".sock/")!==-1){if(s=r.split(".sock/")[1],s.indexOf("/")!==-1)throw s.split("/").length===2&&s.split("/")[1].length===0?new Error("Illegal trailing backslash after database name"):new Error("More than 1 database name in URL");r=r.split("/",r.indexOf(".sock")+5)}}else if(r.indexOf("/")!==-1){if(r.split("/").length>2)throw r.split("/")[2].length===0?new Error("Illegal trailing backslash after database name"):new Error("More than 1 database name in URL");s=r.split("/")[1],r=r.split("/")[0]}r=decodeURIComponent(r);let f={},h=n||"",d=h.split(":",2),p=decodeURIComponent(d[0]);if(d[0]!==encodeURIComponent(p))throw new Error("Username contains an illegal unescaped character");if(d[0]=p,d[1]){let x=decodeURIComponent(d[1]);if(d[1]!==encodeURIComponent(x))throw new Error("Password contains an illegal unescaped character");d[1]=x}d.length===2&&(f.auth={user:d[0],password:d[1]}),t&&t.auth!=null&&(f.auth=t.auth);let m,y,g,w,S={socketOptions:{}},v={read_preference_tags:[]},E={socketOptions:{}},A={socketOptions:{}};if(f.server_options=S,f.db_options=v,f.rs_options=E,f.mongos_options=A,e.match(/\.sock/)){let x=e.substring(e.indexOf("mongodb://")+10,e.lastIndexOf(".sock")+5);x.indexOf("@")!==-1&&(x=x.split("@")[1]),x=decodeURIComponent(x),g=[{domain_socket:x}]}else{m=r;let x={};g=m.split(",").map(function(z){let k,P,Z;if(Z=/\[([^\]]+)\](?::(.+))?/.exec(z))k=Z[1],P=parseInt(Z[2],10)||27017;else{let F=z.split(":",2);k=F[0]||"localhost",P=F[1]!=null?parseInt(F[1],10):27017,k.indexOf("?")!==-1&&(k=k.split(/\?/)[0])}return x[k+"_"+P]?null:(x[k+"_"+P]=1,{host:k,port:P})}).filter(function(z){return z!=null})}if(f.dbName=s||"admin",y=(i||"").split(/[&;]/),y.some(x=>x.toLowerCase()==="loadbalanced"))throw new rm("Load balancer mode requires driver version 4+");if(y.forEach(function(x){if(!!x){var z=x.split("="),k=z[0],P=z[1];switch(k){case"slaveOk":case"slave_ok":S.slave_ok=P==="true",v.slaveOk=P==="true";break;case"maxPoolSize":case"poolSize":S.poolSize=parseInt(P,10),E.poolSize=parseInt(P,10);break;case"appname":f.appname=decodeURIComponent(P);break;case"autoReconnect":case"auto_reconnect":S.auto_reconnect=P==="true";break;case"ssl":if(P==="prefer"){S.ssl=P,E.ssl=P,A.ssl=P;break}S.ssl=P==="true",E.ssl=P==="true",A.ssl=P==="true";break;case"sslValidate":S.sslValidate=P==="true",E.sslValidate=P==="true",A.sslValidate=P==="true";break;case"replicaSet":case"rs_name":E.rs_name=P;break;case"reconnectWait":E.reconnectWait=parseInt(P,10);break;case"retries":E.retries=parseInt(P,10);break;case"readSecondary":case"read_secondary":E.read_secondary=P==="true";break;case"fsync":v.fsync=P==="true";break;case"journal":v.j=P==="true";break;case"safe":v.safe=P==="true";break;case"nativeParser":case"native_parser":v.native_parser=P==="true";break;case"readConcernLevel":v.readConcern=new nle(P);break;case"connectTimeoutMS":S.socketOptions.connectTimeoutMS=parseInt(P,10),E.socketOptions.connectTimeoutMS=parseInt(P,10),A.socketOptions.connectTimeoutMS=parseInt(P,10);break;case"socketTimeoutMS":S.socketOptions.socketTimeoutMS=parseInt(P,10),E.socketOptions.socketTimeoutMS=parseInt(P,10),A.socketOptions.socketTimeoutMS=parseInt(P,10);break;case"w":v.w=parseInt(P,10),isNaN(v.w)&&(v.w=P);break;case"authSource":v.authSource=P;break;case"gssapiServiceName":v.gssapiServiceName=P;break;case"authMechanism":if(P==="GSSAPI")if(f.auth==null){let Z=decodeURIComponent(h);if(Z.indexOf("@")===-1)throw new Error("GSSAPI requires a provided principal");f.auth={user:Z,password:null}}else f.auth.user=decodeURIComponent(f.auth.user);else P==="MONGODB-X509"&&(f.auth={user:decodeURIComponent(h)});if(P!=="GSSAPI"&&P!=="MONGODB-X509"&&P!=="MONGODB-CR"&&P!=="DEFAULT"&&P!=="SCRAM-SHA-1"&&P!=="SCRAM-SHA-256"&&P!=="PLAIN")throw new Error("Only DEFAULT, GSSAPI, PLAIN, MONGODB-X509, or SCRAM-SHA-1 is supported by authMechanism");v.authMechanism=P;break;case"authMechanismProperties":{let Z=P.split(","),F={};Z.forEach(function(b){let q=b.split(":");F[q[0]]=q[1]}),v.authMechanismProperties=F,typeof F.SERVICE_NAME=="string"&&(v.gssapiServiceName=F.SERVICE_NAME),typeof F.SERVICE_REALM=="string"&&(v.gssapiServiceRealm=F.SERVICE_REALM),typeof F.CANONICALIZE_HOST_NAME=="string"&&(v.gssapiCanonicalizeHostName=F.CANONICALIZE_HOST_NAME==="true")}break;case"wtimeoutMS":v.wtimeout=parseInt(P,10);break;case"readPreference":if(!ele.isValid(P))throw new Error("readPreference must be either primary/primaryPreferred/secondary/secondaryPreferred/nearest");v.readPreference=P;break;case"maxStalenessSeconds":v.maxStalenessSeconds=parseInt(P,10);break;case"readPreferenceTags":{P=decodeURIComponent(P);let Z={};if(P==null||P===""){v.read_preference_tags.push(Z);break}let F=P.split(/,/);for(let b=0;b<F.length;b++){let q=F[b].trim().split(/:/);Z[q[0]]=q[1]}v.read_preference_tags.push(Z)}break;case"compressors":{w=S.compression||{};let Z=P.split(",");if(!Z.every(function(F){return F==="snappy"||F==="zlib"}))throw new Error("Compressors must be at least one of snappy or zlib");w.compressors=Z,S.compression=w}break;case"zlibCompressionLevel":{w=S.compression||{};let Z=parseInt(P,10);if(Z<-1||Z>9)throw new Error("zlibCompressionLevel must be an integer between -1 and 9");w.zlibCompressionLevel=Z,S.compression=w}break;case"retryWrites":v.retryWrites=P==="true";break;case"minSize":v.minSize=parseInt(P,10);break;default:rle("URL Parser").warn(`${k} is not supported as a connection string option`);break}}}),v.read_preference_tags.length===0&&(v.read_preference_tags=null),(v.w===-1||v.w===0)&&(v.journal===!0||v.fsync===!0||v.safe===!0))throw new Error("w set to -1 or 0 cannot be combined with safe/w/journal/fsync");return v.readPreference||(v.readPreference="primary"),v=Object.assign(v,t),f.servers=g,f}});var HO=_((qxe,TR)=>{"use strict";var ale=Ru(),Fr=Yt().retrieveBSON(),CR=se().MongoError,nm;try{nm=require("mongodb-client-encryption")}catch{throw new CR("Auto-encryption requested, but the module is not installed. Please add `mongodb-client-encryption` as a dependency of your project")}if(nm===void 0||typeof nm.extension!="function")throw new CR("loaded version of `mongodb-client-encryption` does not have property `extension`. Please make sure you are loading the correct version of `mongodb-client-encryption`");var ule=nm.extension(fs()).AutoEncrypter,ls=Symbol("internalClient"),Kl=class{constructor(t,r){this.bypassAutoEncryption=!!r.autoEncryption.bypassAutoEncryption,this.needsConnecting=!1,r.maxPoolSize===0&&r.autoEncryption.keyVaultClient==null?r.autoEncryption.keyVaultClient=t:r.autoEncryption.keyVaultClient==null&&(r.autoEncryption.keyVaultClient=this.getInternalClient(t)),this.bypassAutoEncryption?r.autoEncryption.metadataClient=void 0:r.maxPoolSize===0?r.autoEncryption.metadataClient=t:r.autoEncryption.metadataClient=this.getInternalClient(t),r.autoEncryption.bson=Kl.makeBSON(r),this.autoEncrypter=new ule(t,r.autoEncryption)}getInternalClient(t){if(!this[ls]){let r={};for(let i of Object.keys(t.s.options))["autoEncryption","minPoolSize","servers","caseTranslate","dbName"].indexOf(i)===-1&&(r[i]=t.s.options[i]);r.minPoolSize=0;let n=["commandStarted","commandSucceeded","commandFailed","serverOpening","serverClosed","serverDescriptionChanged","serverHeartbeatStarted","serverHeartbeatSucceeded","serverHeartbeatFailed","topologyOpening","topologyClosed","topologyDescriptionChanged","joined","left","ping","ha","connectionPoolCreated","connectionPoolClosed","connectionCreated","connectionReady","connectionClosed","connectionCheckOutStarted","connectionCheckOutFailed","connectionCheckedOut","connectionCheckedIn","connectionPoolCleared"];this[ls]=new ale(t.s.url,r);for(let i of n)for(let s of t.listeners(i))this[ls].on(i,s);t.on("newListener",(i,s)=>{this[ls].on(i,s)}),this.needsConnecting=!0}return this[ls]}connectInternalClient(t){return this.needsConnecting?(this.needsConnecting=!1,this[ls].connect(t)):t()}close(t,r,n){this.autoEncrypter.teardown(i=>{if(this[ls]&&t!==this[ls])return this[ls].close(r,n);n(i)})}static makeBSON(t){return(t||{}).bson||new Fr([Fr.Binary,Fr.Code,Fr.DBRef,Fr.Decimal128,Fr.Double,Fr.Int32,Fr.Long,Fr.Map,Fr.MaxKey,Fr.MinKey,Fr.ObjectId,Fr.BSONRegExp,Fr.Symbol,Fr.Timestamp])}};TR.exports={Encrypter:Kl}});var r0=_((Mxe,DR)=>{"use strict";var cle=require("util").deprecate,lle=ie().Logger,fle=ie().MongoCredentials,JO=ie().MongoError,xR=VO(),qR=UO(),hle=ie().parseConnectionString,dle=Lo(),XO=ie().ReadPreference,MR=WO(),GO=Hl(),ple=ie().Sessions.ServerSessionPool,mle=N().emitDeprecationWarning,QO=N().emitWarningOnce,yle=require("fs"),NR=Wi(),gle=vl().CMAP_EVENT_NAMES,KO;function _le(){return KO||(KO=Ru()),KO}var wle=cle(ER(),"current URL string parser is deprecated, and will be removed in a future version. To use the new parser, pass option { useNewUrlParser: true } to MongoClient.connect."),vle={DEFAULT:"default",PLAIN:"plain",GSSAPI:"gssapi","MONGODB-CR":"mongocr","MONGODB-X509":"x509","MONGODB-AWS":"mongodb-aws","SCRAM-SHA-1":"scram-sha-1","SCRAM-SHA-256":"scram-sha-256"},$R=["timeout","close","serverOpening","serverDescriptionChanged","serverHeartbeatStarted","serverHeartbeatSucceeded","serverHeartbeatFailed","serverClosed","topologyOpening","topologyClosed","topologyDescriptionChanged","commandStarted","commandSucceeded","commandFailed","joined","left","ping","ha","all","fullsetup","open"],Sle=new Set(["DEFAULT","PLAIN","GSSAPI","MONGODB-CR","MONGODB-X509","MONGODB-AWS","SCRAM-SHA-1","SCRAM-SHA-256"]),YO=["poolSize","ssl","sslValidate","sslCA","sslCert","sslKey","sslPass","sslCRL","autoReconnect","noDelay","keepAlive","keepAliveInitialDelay","connectTimeoutMS","family","socketTimeoutMS","reconnectTries","reconnectInterval","ha","haInterval","replicaSet","secondaryAcceptableLatencyMS","acceptableLatencyMS","connectWithNoPrimary","authSource","w","wtimeout","j","writeConcern","forceServerObjectId","serializeFunctions","ignoreUndefined","raw","bufferMaxEntries","readPreference","pkFactory","promiseLibrary","readConcern","maxStalenessSeconds","loggerLevel","logger","promoteValues","promoteBuffers","promoteLongs","bsonRegExp","domainsEnabled","checkServerIdentity","validateOptions","appname","auth","user","password","authMechanism","compression","fsync","readPreferenceTags","numberOfRetries","auto_reconnect","minSize","monitorCommands","serverApi","retryWrites","retryReads","useNewUrlParser","useUnifiedTopology","serverSelectionTimeoutMS","useRecoveryToken","autoEncryption","driverInfo","tls","tlsInsecure","tlsinsecure","tlsAllowInvalidCertificates","tlsAllowInvalidHostnames","tlsCAFile","tlsCertificateFile","tlsCertificateKeyFile","tlsCertificateKeyFilePassword","minHeartbeatFrequencyMS","heartbeatFrequencyMS","directConnection","appName","maxPoolSize","minPoolSize","maxIdleTimeMS","waitQueueTimeoutMS"],Ole=["native_parser"],AR=["server","replset","replSet","mongos","db"];function ble(e){let t=YO.concat(AR);for(let r in e)if(Ole.indexOf(r)===-1){if(t.indexOf(r)===-1){if(e.validateOptions)return new JO(`option ${r} is not supported`);QO(`the options [${r}] is not supported`)}AR.indexOf(r)!==-1&&QO(`the server/replset/mongos/db options are deprecated, all their options are supported at the top level of the options object [${YO}]`)}}var Ele=YO.reduce((e,t)=>(e[t.toLowerCase()]=t,e),{});function ZO(e,t){t.on("authenticated",hs(e,"authenticated")),t.on("error",hs(e,"error")),t.on("timeout",hs(e,"timeout")),t.on("close",hs(e,"close")),t.on("parseError",hs(e,"parseError")),t.once("open",hs(e,"open")),t.once("fullsetup",hs(e,"fullsetup")),t.once("all",hs(e,"all")),t.on("reconnect",hs(e,"reconnect"))}function e0(e,t){e.topology=t,t instanceof qR||(t.s.sessionPool=new ple(t.s.coreTopology))}function Cle(e){$R.forEach(t=>e.removeAllListeners(t))}function Tle(e,t){let r=_le(),n=[];return e instanceof r&&$R.forEach(i=>{t.on(i,(s,o)=>{i==="open"?n.push({event:i,object1:e}):n.push({event:i,object1:s,object2:o})})}),n}function Ale(e){e.tls!=null&&["sslCA","sslKey","sslCert"].forEach(t=>{e[t]&&(e[t]=yle.readFileSync(e[t]))})}function xle(e,t,r,n){if(r=Object.assign({},r),n==null)throw new Error("no callback function provided");let i=!1,s=lle("MongoClient",r);if(t instanceof GO||t instanceof MR||t instanceof xR)return qle(e,t,r,c);let o=r.useNewUrlParser!==!1,a=o?hle:wle,u=o?Rle:Ple;a(t,r,(f,h)=>{if(f)return n(f);let d=u(h),p=PR(d,r);if(p.socketTimeoutMS==null&&(p.socketTimeoutMS=0),p.connectTimeoutMS==null&&(p.connectTimeoutMS=1e4),p.retryWrites==null&&(p.retryWrites=!0),p.useRecoveryToken==null&&(p.useRecoveryToken=!0),p.readPreference==null&&(p.readPreference="primary"),p.db_options&&p.db_options.auth&&delete p.db_options.auth,Ale(p),e.s.options=p,e.s.readPreference=XO.fromOptions(p),e.s.writeConcern=NR.fromOptions(p),d.servers.length===0)return n(new Error("connection string must contain at least one seed host"));if(p.auth&&!p.credentials)try{i=!0,p.credentials=IR(e,p.auth.user,p.auth.password,p)}catch(m){return n(m)}return p.useUnifiedTopology?im(e,"unified",p,c):(QO("Current Server Discovery and Monitoring engine is deprecated, and will be removed in a future version. To use the new Server Discover and Monitoring engine, pass option { useUnifiedTopology: true } to the MongoClient constructor."),p.replicaSet||p.rs_name?im(e,"replicaset",p,c):d.servers.length>1?im(e,"mongos",p,c):Mle(e,p,c))});function c(f,h){let d="seed list contains no mongos proxies, replicaset connections requires the parameter replicaSet to be supplied in the URI or options object, mongodb://server:port/db?replicaSet=name";if(f&&f.message==="no mongos proxies found in seed list")return s.isWarn()&&s.warn(d),n(new JO(d));i&&e.emit("authenticated",null,!0),n(f,h)}}function qle(e,t,r,n){e0(e,t),ZO(e,t),t0(e,t);let i=Object.assign({},r);if((typeof r.readPreference=="string"||typeof r.read_preference=="string")&&(i.readPreference=new XO(r.readPreference||r.read_preference)),(i.user||i.password||i.authMechanism)&&!i.credentials)try{i.credentials=IR(e,i.user,i.password,i)}catch(o){return n(o,t)}return t.connect(i,n)}function hs(e,t){let r=new Set(["all","fullsetup","open","reconnect"]);return(n,i)=>{if(r.has(t))return e.emit(t,e);e.emit(t,n,i)}}function Mle(e,t,r){t.promiseLibrary=e.s.promiseLibrary;let i=RR(t)[0],s=Tle(e,i);i.connect(t,(o,a)=>{if(o)return i.close(!0),r(o);Cle(i),t0(e,i),ZO(e,i);let u=a.lastIsMaster();if(e0(e,a),u&&u.msg==="isdbgrid")return a.close(),im(e,"mongos",t,r);Ile(e,s),r(o,a)})}var Nle=new Set(["reconnect","reconnectFailed","attemptReconnect","joined","left","ping","ha","all","fullsetup","open"]);function $le(e){e.on("newListener",t=>{Nle.has(t)&&mle(`The \`${t}\` event is no longer supported by the unified topology, please read more by visiting http://bit.ly/2D8WfT6`,"DeprecationWarning")})}function im(e,t,r,n){r.promiseLibrary=e.s.promiseLibrary;let i={};t==="unified"&&(i.createServers=!1);let s=RR(r,i);if(r.autoEncryption!=null){let a=HO().Encrypter;r.encrypter=new a(e,r),r.autoEncrypter=r.encrypter.autoEncrypter}let o;if(t==="mongos"?o=new xR(s,r):t==="replicaset"?o=new MR(s,r):t==="unified"&&(o=new qR(r.servers,r),$le(e)),ZO(e,o),t0(e,o),e0(e,o),r.autoEncrypter){r.autoEncrypter.init(a=>{if(a){n(a);return}o.connect(r,u=>{if(u){o.close(!0),n(u);return}r.encrypter.connectInternalClient(c=>{if(c)return n(c);n(void 0,o)})})});return}o.connect(r,a=>{if(a)return o.close(!0),n(a);n(void 0,o)})}function PR(e,t){let r=["mongos","server","db","replset","db_options","server_options","rs_options","mongos_options"],n=["readconcern","compression","autoencryption"],i=["w","wtimeout","j","journal","fsync","writeconcern"];for(let o in t)i.indexOf(o.toLowerCase())===-1&&(n.indexOf(o.toLowerCase())!==-1?e[o]=t[o]:r.indexOf(o.toLowerCase())!==-1?e=sm(e,t[o],!1):t[o]&&typeof t[o]=="object"&&!Buffer.isBuffer(t[o])&&!Array.isArray(t[o])?e=sm(e,t[o],!0):e[o]=t[o]);let s=NR.fromOptions(t);return s&&(e.writeConcern=Object.assign({},e.writeConcern,s)),e}function IR(e,t,r,n){n=Object.assign({},n);let i=n.authSource||n.authdb||n.dbName,s=n.authMechanism||"DEFAULT",o=s.toUpperCase(),a=n.authMechanismProperties;if(!Sle.has(o))throw JO.create({message:`authentication mechanism ${s} not supported', options.authMechanism`,driver:!0});return new fle({mechanism:vle[o],mechanismProperties:a,source:i,username:t,password:r})}function Ple(e){return sm(PR({},e),e,!1)}function sm(e,t,r){for(let n in t)t[n]&&typeof t[n]=="object"&&r?e=sm(e,t[n],r):e[n]=t[n];return e}function t0(e,t){["commandStarted","commandSucceeded","commandFailed","serverOpening","serverClosed","serverDescriptionChanged","serverHeartbeatStarted","serverHeartbeatSucceeded","serverHeartbeatFailed","topologyOpening","topologyClosed","topologyDescriptionChanged","joined","left","ping","ha"].concat(gle).forEach(n=>{t.on(n,(i,s)=>{e.emit(n,i,s)})})}function Ile(e,t){for(let r=0;r<t.length;r++)e.emit(t[r].event,t[r].object1,t[r].object2)}function Rle(e){let t=Object.assign({servers:e.hosts},e.options);for(let s in t){let o=Ele[s];o&&(t[o]=t[s])}let r=e.auth&&e.auth.username,n=e.options&&e.options.authMechanism;(r||n)&&(t.auth=Object.assign({},e.auth),t.auth.db&&(t.authSource=t.authSource||t.auth.db),t.auth.username&&(t.auth.user=t.auth.username)),e.defaultDatabase&&(t.dbName=e.defaultDatabase),t.maxPoolSize&&(t.poolSize=t.maxPoolSize),t.readConcernLevel&&(t.readConcern=new dle(t.readConcernLevel)),t.wTimeoutMS&&(t.wtimeout=t.wTimeoutMS,t.wTimeoutMS=void 0),e.srvHost&&(t.srvHost=e.srvHost);let i=["w","wtimeout","j","journal","fsync"];for(let s of i)t[s]!==void 0&&(t.writeConcern===void 0&&(t.writeConcern={}),t.writeConcern[s]=t[s],t[s]=void 0);return t}function RR(e,t){if(t=Object.assign({},{createServers:!0},t),(typeof e.readPreference=="string"||typeof e.read_preference=="string")&&(e.readPreference=new XO(e.readPreference||e.read_preference)),e.readPreference&&(e.readPreferenceTags||e.read_preference_tags)&&(e.readPreference.tags=e.readPreferenceTags||e.read_preference_tags),e.maxStalenessSeconds&&(e.readPreference.maxStalenessSeconds=e.maxStalenessSeconds),e.socketTimeoutMS==null&&(e.socketTimeoutMS=0),e.connectTimeoutMS==null&&(e.connectTimeoutMS=1e4),!!t.createServers)return e.servers.map(r=>r.domain_socket?new GO(r.domain_socket,27017,e):new GO(r.host,r.port,e))}DR.exports={validOptions:ble,connect:xle}});var Ru=_((Nxe,FR)=>{"use strict";var Dle=zp(),jle=Ul(),BR=require("events").EventEmitter,Ble=require("util").inherits,om=ie().MongoError,n0=ie().ValidServerApiVersions,LR=require("util").deprecate,Lle=Wi(),kle=N().MongoDBNamespace,jR=ir(),kR=N().maybePromise,Fle=UO(),Ule=r0().connect,Vle=r0().validOptions;function cr(e,t){if(t=t||{},!(this instanceof cr))return new cr(e,t);if(BR.call(this),t.autoEncryption&&HO(),t.serverApi){let r=typeof t.serverApi=="string"?{version:t.serverApi}:t.serverApi,n=r&&r.version;if(!n)throw new om(`Invalid \`serverApi\` property; must specify a version from the following enum: ["${n0.join('", "')}"]`);if(!n0.some(i=>i===n))throw new om(`Invalid server API version=${n}; must be in the following enum: ["${n0.join('", "')}"]`);t.serverApi=r}this.s={url:e,options:t,promiseLibrary:t&&t.promiseLibrary||Promise,dbCache:new Map,sessions:new Set,writeConcern:Lle.fromOptions(t),readPreference:jR.fromOptions(t)||jR.primary,namespace:new kle("admin")}}Ble(cr,BR);Object.defineProperty(cr.prototype,"writeConcern",{enumerable:!0,get:function(){return this.s.writeConcern}});Object.defineProperty(cr.prototype,"readPreference",{enumerable:!0,get:function(){return this.s.readPreference}});cr.prototype.connect=function(e){if(typeof e=="string")throw new TypeError("`connect` only accepts a callback");let t=this;return kR(this,e,r=>{let n=Vle(t.s.options);if(n)return r(n);Ule(t,t.s.url,t.s.options,i=>{if(i)return r(i);r(null,t)})})};cr.prototype.logout=LR(function(e,t){typeof e=="function"&&(t=e,e={}),typeof t=="function"&&t(null,!0)},"Multiple authentication is prohibited on a connected client, please only authenticate once per MongoClient");cr.prototype.close=function(e,t){typeof e=="function"&&(t=e,e=!1);let r=this;return kR(this,t,n=>{let i=s=>{if(r.emit("close",r),!(r.topology instanceof Fle))for(let o of r.s.dbCache)o[1].emit("close",r);r.removeAllListeners("close"),n(s)};if(r.topology==null){i();return}r.topology.close(e,s=>{let o=r.topology.s.options.encrypter;if(o)return o.close(r,e,a=>{i(s||a)});i(s)})})};cr.prototype.db=function(e,t){t=t||{},e||(e=this.s.options.dbName);let r=Object.assign({},this.s.options,t);if(this.s.dbCache.has(e)&&r.returnNonCachedInstance!==!0)return this.s.dbCache.get(e);if(r.promiseLibrary=this.s.promiseLibrary,!this.topology)throw new om("MongoClient must be connected before calling MongoClient.prototype.db");let n=new jle(e,this.topology,r);return this.s.dbCache.set(e,n),n};cr.prototype.isConnected=LR(function(e){return e=e||{},this.topology?this.topology.isConnected(e):!1},"isConnected is deprecated and will be removed in the next major version");cr.connect=function(e,t,r){let n=Array.prototype.slice.call(arguments,1);return r=typeof n[n.length-1]=="function"?n.pop():void 0,t=n.length?n.shift():null,t=t||{},new cr(e,t).connect(r)};cr.prototype.startSession=function(e){if(e=Object.assign({explicit:!0},e),!this.topology)throw new om("Must connect to a server before calling this method");return this.topology.startSession(e,this.s.options)};cr.prototype.withSession=function(e,t){typeof e=="function"&&(t=e,e=void 0);let r=this.startSession(e),n=(i,s,o)=>{if(n=()=>{throw new ReferenceError("cleanupHandler was called too many times")},o=Object.assign({throw:!0},o),r.endSession(),i){if(o.throw)throw i;return Promise.reject(i)}};try{let i=t(r);return Promise.resolve(i).then(s=>n(null,s)).catch(s=>n(s,null,{throw:!0}))}catch(i){return n(i,null,{throw:!1})}};cr.prototype.watch=function(e,t){return e=e||[],t=t||{},Array.isArray(e)||(t=e,e=[]),new Dle(this,e,t)};cr.prototype.getLogger=function(){return this.s.options.logger};FR.exports=cr});var i0=_(($xe,UR)=>{"use strict";var am=ie().BSON.Binary,Wle=ie().BSON.ObjectID,um=jt().Buffer,sn=function(e,t,r){if(!(this instanceof sn))return new sn(e,t);this.file=e;var n=t??{};if(this.writeConcern=r||{w:1},this.objectId=n._id==null?new Wle:n._id,this.chunkNumber=n.n==null?0:n.n,this.data=new am,typeof n.data=="string"){var i=um.alloc(n.data.length);i.write(n.data,0,n.data.length,"binary"),this.data=new am(i)}else if(Array.isArray(n.data)){i=um.alloc(n.data.length);var s=n.data.join("");i.write(s,0,s.length,"binary"),this.data=new am(i)}else if(n.data&&n.data._bsontype==="Binary")this.data=n.data;else if(!um.isBuffer(n.data)&&n.data!=null)throw Error("Illegal chunk format");this.internalPosition=0};sn.prototype.write=function(e,t){return this.data.write(e,this.internalPosition,e.length,"binary"),this.internalPosition=this.data.length(),t!=null?t(null,this):this};sn.prototype.read=function(e){if(e=e==null||e===0?this.length():e,this.length()-this.internalPosition+1>=e){var t=this.data.read(this.internalPosition,e);return this.internalPosition=this.internalPosition+e,t}else return""};sn.prototype.readSlice=function(e){if(this.length()-this.internalPosition>=e){var t=null;return this.data.buffer!=null?t=this.data.buffer.slice(this.internalPosition,this.internalPosition+e):(t=um.alloc(e),e=this.data.readInto(t,this.internalPosition)),this.internalPosition=this.internalPosition+e,t}else return null};sn.prototype.eof=function(){return this.internalPosition===this.length()};sn.prototype.getc=function(){return this.read(1)};sn.prototype.rewind=function(){this.internalPosition=0,this.data=new am};sn.prototype.save=function(e,t){var r=this;typeof e=="function"&&(t=e,e={}),r.file.chunkCollection(function(n,i){if(n)return t(n);var s={upsert:!0};for(var o in e)s[o]=e[o];for(o in r.writeConcern)s[o]=r.writeConcern[o];r.data.length()>0?r.buildMongoObject(function(a){var u={forceServerObjectId:!0};for(var c in r.writeConcern)u[c]=r.writeConcern[c];i.replaceOne({_id:r.objectId},a,s,function(f){t(f,r)})}):t(null,r)})};sn.prototype.buildMongoObject=function(e){var t={files_id:this.file.fileId,n:this.chunkNumber,data:this.data};this.objectId!=null&&(t._id=this.objectId),e(t)};sn.prototype.length=function(){return this.data.length()};Object.defineProperty(sn.prototype,"position",{enumerable:!0,get:function(){return this.internalPosition},set:function(e){this.internalPosition=e}});sn.DEFAULT_CHUNK_SIZE=1024*255;UR.exports=sn});var GR=_((Pxe,KR)=>{"use strict";var wn=i0(),o0=ie().BSON.ObjectID,a0=ie().ReadPreference,fm=jt().Buffer,cm=require("fs"),u0=require("util").format,zle=require("util"),ds=ie().MongoError,Hle=zle.inherits,HR=require("stream").Duplex,Kle=N().shallowClone,Er=N().executeLegacyOperation,Gle=require("util").deprecate,Qle=0,Gl=1,Yle=Gle(()=>{},"GridStore is deprecated, and will be removed in a future version. Please use GridFSBucket instead"),qe=function e(t,r,n,i,s){if(Yle(),!(this instanceof e))return new e(t,r,n,i,s);this.db=t,typeof s>"u"&&(s={}),typeof i>"u"?(i=n,n=void 0):typeof i=="object"&&(s=i,i=n,n=void 0),r&&r._bsontype==="ObjectID"?(this.referenceBy=Gl,this.fileId=r,this.filename=n):typeof n>"u"?(this.referenceBy=Qle,this.filename=r,i.indexOf("w")!=null&&(this.fileId=new o0)):(this.referenceBy=Gl,this.fileId=r,this.filename=n),this.mode=i??"r",this.options=s||{},this.isOpen=!1,this.root=this.options.root==null?e.DEFAULT_ROOT_COLLECTION:this.options.root,this.position=0,this.readPreference=this.options.readPreference||t.options.readPreference||a0.primary,this.writeConcern=c0(t,this.options),this.internalChunkSize=this.options.chunkSize==null?wn.DEFAULT_CHUNK_SIZE:this.options.chunkSize;var o=this.options.promiseLibrary||Promise;this.promiseLibrary=o,Object.defineProperty(this,"chunkSize",{enumerable:!0,get:function(){return this.internalChunkSize},set:function(a){this.mode[0]==="w"&&this.position===0&&this.uploadDate==null?this.internalChunkSize=a:this.internalChunkSize=this.internalChunkSize}}),Object.defineProperty(this,"md5",{enumerable:!0,get:function(){return this.internalMd5}}),Object.defineProperty(this,"chunkNumber",{enumerable:!0,get:function(){return this.currentChunk&&this.currentChunk.chunkNumber?this.currentChunk.chunkNumber:null}})};qe.prototype.open=function(e,t){if(typeof e=="function"&&(t=e,e={}),e=e||{},this.mode!=="w"&&this.mode!=="w+"&&this.mode!=="r")throw ds.create({message:"Illegal mode "+this.mode,driver:!0});return Er(this.db.s.topology,Jle,[this,e,t],{skipSessions:!0})};var Jle=function(e,t,r){var n=c0(e.db,e.options);if(e.mode==="w"||e.mode==="w+"){var i=e.collection();i.ensureIndex([["filename",1]],n,function(){var s=e.chunkCollection(),o=Kle(n);o.unique=!0,s.ensureIndex([["files_id",1],["n",1]],o,function(){VR(e,n,function(a,u){if(a)return r(a);e.isOpen=!0,r(a,u)})})})}else VR(e,n,function(s,o){if(s)return r(s);e.isOpen=!0,r(s,o)})};qe.prototype.eof=function(){return this.position===this.length};qe.prototype.getc=function(e,t){return typeof e=="function"&&(t=e,e={}),e=e||{},Er(this.db.s.topology,Xle,[this,e,t],{skipSessions:!0})};var Xle=function(e,t,r){e.eof()?r(null,null):e.currentChunk.eof()?ju(e,e.currentChunk.chunkNumber+1,function(n,i){e.currentChunk=i,e.position=e.position+1,r(n,e.currentChunk.getc())}):(e.position=e.position+1,r(null,e.currentChunk.getc()))};qe.prototype.puts=function(e,t,r){typeof t=="function"&&(r=t,t={}),t=t||{};var n=e.match(/\n$/)==null?e+`
`:e;return Er(this.db.s.topology,this.write.bind(this),[n,t,r],{skipSessions:!0})};qe.prototype.stream=function(){return new ps(this)};qe.prototype.write=function(t,r,n,i){return typeof n=="function"&&(i=n,n={}),n=n||{},Er(this.db.s.topology,ffe,[this,t,r,n,i],{skipSessions:!0})};qe.prototype.destroy=function(){!this.writable||(this.readable=!1,this.writable&&(this.writable=!1,this._q.length=0,this.emit("close")))};qe.prototype.writeFile=function(e,t,r){return typeof t=="function"&&(r=t,t={}),t=t||{},Er(this.db.s.topology,Zle,[this,e,t,r],{skipSessions:!0})};var Zle=function(e,t,r,n){if(typeof t=="string"){cm.open(t,"r",function(i,s){if(i)return n(i);e.writeFile(s,n)});return}e.open(function(i,s){if(i)return n(i,s);cm.fstat(t,function(o,a){if(o)return n(o,s);var u=0,c=0,f=function(){var h=fm.alloc(s.chunkSize);cm.read(t,h,0,h.length,u,function(d,p,m){if(d)return n(d,s);u=u+p;var y=new wn(s,{n:c++},s.writeConcern);y.write(m.slice(0,p),function(g,w){if(g)return n(g,s);w.save({},function(S){if(S)return n(S,s);if(s.position=s.position+p,s.currentChunk=w,u>=a.size)cm.close(t,function(v){if(v)return n(v);s.close(function(E){return n(E||null,s)})});else return process.nextTick(f)})})})};process.nextTick(f)})})};qe.prototype.close=function(e,t){return typeof e=="function"&&(t=e,e={}),e=e||{},Er(this.db.s.topology,efe,[this,e,t],{skipSessions:!0})};var efe=function(e,t,r){e.mode[0]==="w"?(t=Object.assign({},e.writeConcern,t),e.currentChunk!=null&&e.currentChunk.position>0?e.currentChunk.save({},function(n){if(n&&typeof r=="function")return r(n);e.collection(function(i,s){if(i&&typeof r=="function")return r(i);e.uploadDate!=null?s0(e,function(o,a){if(o){if(typeof r=="function")return r(o);throw o}s.save(a,t,function(u){typeof r=="function"&&r(u,a)})}):(e.uploadDate=new Date,s0(e,function(o,a){if(o){if(typeof r=="function")return r(o);throw o}s.save(a,t,function(u){typeof r=="function"&&r(u,a)})}))})}):e.collection(function(n,i){if(n&&typeof r=="function")return r(n);e.uploadDate=new Date,s0(e,function(s,o){if(s){if(typeof r=="function")return r(s);throw s}i.save(o,t,function(a){typeof r=="function"&&r(a,o)})})})):e.mode[0]==="r"?typeof r=="function"&&r(null,null):typeof r=="function"&&r(ds.create({message:u0("Illegal mode %s",e.mode),driver:!0}))};qe.prototype.chunkCollection=function(e){return typeof e=="function"?this.db.collection(this.root+".chunks",e):this.db.collection(this.root+".chunks")};qe.prototype.unlink=function(e,t){return typeof e=="function"&&(t=e,e={}),e=e||{},Er(this.db.s.topology,tfe,[this,e,t],{skipSessions:!0})};var tfe=function(e,t,r){Ql(e,function(n){if(n!==null)return n.message="at deleteChunks: "+n.message,r(n);e.collection(function(i,s){if(i!==null)return i.message="at collection: "+i.message,r(i);s.remove({_id:e.fileId},e.writeConcern,function(o){r(o,e)})})})};qe.prototype.collection=function(e){return typeof e=="function"&&this.db.collection(this.root+".files",e),this.db.collection(this.root+".files")};qe.prototype.readlines=function(e,t,r){var n=Array.prototype.slice.call(arguments,0);return r=typeof n[n.length-1]=="function"?n.pop():void 0,e=n.length?n.shift():`
`,e=e||`
`,t=n.length?n.shift():{},Er(this.db.s.topology,rfe,[this,e,t,r],{skipSessions:!0})};var rfe=function(e,t,r,n){e.read(function(i,s){if(i)return n(i);var o=s.toString().split(t);o=o.length>0?o.splice(0,o.length-1):[];for(var a=0;a<o.length;a++)o[a]=o[a]+t;n(null,o)})};qe.prototype.rewind=function(e,t){return typeof e=="function"&&(t=e,e={}),e=e||{},Er(this.db.s.topology,nfe,[this,e,t],{skipSessions:!0})};var nfe=function(e,t,r){e.currentChunk.chunkNumber!==0?e.mode[0]==="w"?Ql(e,function(n){if(n)return r(n);e.currentChunk=new wn(e,{n:0},e.writeConcern),e.position=0,r(null,e)}):e.currentChunk(0,function(n,i){if(n)return r(n);e.currentChunk=i,e.currentChunk.rewind(),e.position=0,r(null,e)}):(e.currentChunk.rewind(),e.position=0,r(null,e))};qe.prototype.read=function(e,t,r,n){var i=Array.prototype.slice.call(arguments,0);return n=typeof i[i.length-1]=="function"?i.pop():void 0,e=i.length?i.shift():null,t=i.length?i.shift():null,r=i.length?i.shift():{},Er(this.db.s.topology,ife,[this,e,t,r,n],{skipSessions:!0})};var ife=function(e,t,r,n,i){var s=t??e.length-e.position,o=r??fm.alloc(s);if(o._index=r!=null&&r._index!=null?r._index:0,e.currentChunk.length()-e.currentChunk.position+o._index>=s){var a=e.currentChunk.readSlice(s-o._index);return a.copy(o,o._index),e.position=e.position+o.length,s===0&&o.length===0?i(ds.create({message:"File does not exist",driver:!0}),null):i(null,o)}a=e.currentChunk.readSlice(e.currentChunk.length()-e.currentChunk.position),a.copy(o,o._index),o._index+=a.length,ju(e,e.currentChunk.chunkNumber+1,function(u,c){if(u)return i(u);c.length()>0?(e.currentChunk=c,e.read(t,o,i)):o._index>0?i(null,o):i(ds.create({message:"no chunks found for file, possibly corrupt",driver:!0}),null)})};qe.prototype.tell=function(e){var t=this;return typeof e=="function"?e(null,this.position):new t.promiseLibrary(function(r){r(t.position)})};qe.prototype.seek=function(e,t,r,n){var i=Array.prototype.slice.call(arguments,1);return n=typeof i[i.length-1]=="function"?i.pop():void 0,t=i.length?i.shift():null,r=i.length?i.shift():{},Er(this.db.s.topology,sfe,[this,e,t,r,n],{skipSessions:!0})};var sfe=function(e,t,r,n,i){if(e.mode!=="r")return i(ds.create({message:"seek is only supported for mode r",driver:!0}));var s=r??qe.IO_SEEK_SET,o=t,a=0;s===qe.IO_SEEK_CUR?a=e.position+o:s===qe.IO_SEEK_END?a=e.length+o:a=o;var u=Math.floor(a/e.chunkSize),c=function(){ju(e,u,function(f,h){if(f)return i(f,null);if(h==null)return i(new Error("no chunk found"));e.currentChunk=h,e.position=a,e.currentChunk.position=e.position%e.chunkSize,i(f,e)})};c()},VR=function(e,t,r){var n=e.collection(),i=e.referenceBy===Gl?{_id:e.fileId}:{filename:e.filename};i=e.fileId==null&&e.filename==null?null:i,t.readPreference=e.readPreference,i!=null?n.findOne(i,t,function(o,a){if(o)return s(o);if(a!=null)e.fileId=a._id,e.filename=e.mode==="r"||e.filename===void 0?a.filename:e.filename,e.contentType=a.contentType,e.internalChunkSize=a.chunkSize,e.uploadDate=a.uploadDate,e.aliases=a.aliases,e.length=a.length,e.metadata=a.metadata,e.internalMd5=a.md5;else if(e.mode!=="r")e.fileId=e.fileId==null?new o0:e.fileId,e.contentType=qe.DEFAULT_CONTENT_TYPE,e.internalChunkSize=e.internalChunkSize==null?wn.DEFAULT_CHUNK_SIZE:e.internalChunkSize,e.length=0;else{e.length=0;var u=e.fileId._bsontype==="ObjectID"?e.fileId.toHexString():e.fileId;return s(ds.create({message:u0("file with id %s not opened for writing",e.referenceBy===Gl?u:e.filename),driver:!0}),e)}e.mode==="r"?ju(e,0,t,function(c,f){if(c)return s(c);e.currentChunk=f,e.position=0,r(null,e)}):e.mode==="w"&&a?Ql(e,t,function(c){if(c)return s(c);e.currentChunk=new wn(e,{n:0},e.writeConcern),e.contentType=e.options.content_type==null?e.contentType:e.options.content_type,e.internalChunkSize=e.options.chunk_size==null?e.internalChunkSize:e.options.chunk_size,e.metadata=e.options.metadata==null?e.metadata:e.options.metadata,e.aliases=e.options.aliases==null?e.aliases:e.options.aliases,e.position=0,r(null,e)}):e.mode==="w"?(e.currentChunk=new wn(e,{n:0},e.writeConcern),e.contentType=e.options.content_type==null?e.contentType:e.options.content_type,e.internalChunkSize=e.options.chunk_size==null?e.internalChunkSize:e.options.chunk_size,e.metadata=e.options.metadata==null?e.metadata:e.options.metadata,e.aliases=e.options.aliases==null?e.aliases:e.options.aliases,e.position=0,r(null,e)):e.mode==="w+"&&ju(e,zR(e),t,function(c,f){if(c)return s(c);e.currentChunk=f??new wn(e,{n:0},e.writeConcern),e.currentChunk.position=e.currentChunk.data.length(),e.metadata=e.options.metadata==null?e.metadata:e.options.metadata,e.aliases=e.options.aliases==null?e.aliases:e.options.aliases,e.position=e.length,r(null,e)})}):(e.fileId=e.fileId==null?new o0:e.fileId,e.contentType=qe.DEFAULT_CONTENT_TYPE,e.internalChunkSize=e.internalChunkSize==null?wn.DEFAULT_CHUNK_SIZE:e.internalChunkSize,e.length=0,e.mode==="w"?Ql(e,t,function(o){if(o)return s(o);e.currentChunk=new wn(e,{n:0},e.writeConcern),e.contentType=e.options.content_type==null?e.contentType:e.options.content_type,e.internalChunkSize=e.options.chunk_size==null?e.internalChunkSize:e.options.chunk_size,e.metadata=e.options.metadata==null?e.metadata:e.options.metadata,e.aliases=e.options.aliases==null?e.aliases:e.options.aliases,e.position=0,r(null,e)}):e.mode==="w+"&&ju(e,zR(e),t,function(o,a){if(o)return s(o);e.currentChunk=a??new wn(e,{n:0},e.writeConcern),e.currentChunk.position=e.currentChunk.data.length(),e.metadata=e.options.metadata==null?e.metadata:e.options.metadata,e.aliases=e.options.aliases==null?e.aliases:e.options.aliases,e.position=e.length,r(null,e)}));function s(o){s.err||r(s.err=o)}},WR=function(e,t,r,n){typeof r=="function"&&(n=r,r=null);var i=typeof r=="boolean"?r:!1;if(e.mode!=="w")n(ds.create({message:u0("file with id %s not opened for writing",e.referenceBy===Gl?e.referenceBy:e.filename),driver:!0}),null);else if(e.currentChunk.position+t.length>=e.chunkSize){for(var s=e.currentChunk.chunkNumber,o=e.chunkSize-e.currentChunk.position,a=t.slice(0,o),u=t.slice(o),c=[e.currentChunk.write(a)];u.length>=e.chunkSize;){var f=new wn(e,{n:s+1},e.writeConcern);a=u.slice(0,e.chunkSize),u=u.slice(e.chunkSize),s=s+1,f.write(a),c.push(f)}e.currentChunk=new wn(e,{n:s+1},e.writeConcern),u.length>0&&e.currentChunk.write(u),e.position=e.position+t.length;for(var h=c.length,d=0;d<c.length;d++)c[d].save({},function(p){if(p)return n(p);if(h=h-1,h<=0)return i?e.close(function(m){n(m,e)}):n(null,e)})}else return e.position=e.position+t.length,e.currentChunk.write(t),i?e.close(function(p){n(p,e)}):n(null,e)},s0=function(e,t){var r={_id:e.fileId,filename:e.filename,contentType:e.contentType,length:e.position?e.position:0,chunkSize:e.chunkSize,uploadDate:e.uploadDate,aliases:e.aliases,metadata:e.metadata},n={filemd5:e.fileId,root:e.root};e.db.command(n,function(i,s){if(i)return t(i);r.md5=s.md5,t(null,r)})},ju=function(e,t,r,n){typeof r=="function"&&(n=r,r={}),r=r||e.writeConcern,r.readPreference=e.readPreference,e.chunkCollection().findOne({files_id:e.fileId,n:t},r,function(i,s){if(i)return n(i);var o=s??{};n(null,new wn(e,o,e.writeConcern))})},zR=function(e){return Math.floor((e.length?e.length-1:0)/e.chunkSize)},Ql=function(e,t,r){typeof t=="function"&&(r=t,t={}),t=t||e.writeConcern,e.fileId!=null?e.chunkCollection().remove({files_id:e.fileId},t,function(n){if(n)return r(n,!1);r(null,!0)}):r(null,!0)};qe.DEFAULT_ROOT_COLLECTION="fs";qe.DEFAULT_CONTENT_TYPE="binary/octet-stream";qe.IO_SEEK_SET=0;qe.IO_SEEK_CUR=1;qe.IO_SEEK_END=2;qe.exist=function(e,t,r,n,i){var s=Array.prototype.slice.call(arguments,2);return i=typeof s[s.length-1]=="function"?s.pop():void 0,r=s.length?s.shift():null,n=s.length?s.shift():{},n=n||{},Er(e.s.topology,ofe,[e,t,r,n,i],{skipSessions:!0})};var ofe=function(e,t,r,n,i){var s=n.readPreference||a0.PRIMARY,o=r??qe.DEFAULT_ROOT_COLLECTION;e.collection(o+".files",function(a,u){if(a)return i(a);var c=typeof t=="string"||Object.prototype.toString.call(t)==="[object RegExp]"?{filename:t}:{_id:t};t!=null&&typeof t=="object"&&Object.prototype.toString.call(t)!=="[object RegExp]"&&(c=t),u.findOne(c,{readPreference:s},function(f,h){if(f)return i(f);i(null,h!=null)})})};qe.list=function(e,t,r,n){var i=Array.prototype.slice.call(arguments,1);return n=typeof i[i.length-1]=="function"?i.pop():void 0,t=i.length?i.shift():null,r=i.length?i.shift():{},r=r||{},Er(e.s.topology,afe,[e,t,r,n],{skipSessions:!0})};var afe=function(e,t,r,n){t!=null&&typeof t=="object"&&(r=t,t=null);var i=r.readPreference||a0.primary,s=r.id!=null?r.id:!1,o=t??qe.DEFAULT_ROOT_COLLECTION,a=[];e.collection(o+".files",function(u,c){if(u)return n(u);c.find({},{readPreference:i},function(f,h){if(f)return n(f);h.each(function(d,p){p!=null?a.push(s?p._id:p.filename):n(d,a)})})})};qe.read=function(e,t,r,n,i,s){var o=Array.prototype.slice.call(arguments,2);return s=typeof o[o.length-1]=="function"?o.pop():void 0,r=o.length?o.shift():null,n=o.length?o.shift():null,i=o.length?o.shift():null,i=i||{},Er(e.s.topology,ufe,[e,t,r,n,i,s],{skipSessions:!0})};var ufe=function(e,t,r,n,i,s){new qe(e,t,"r",i).open(function(o,a){if(o)return s(o);if(n&&n>=a.length)return s("offset larger than size of file",null);if(r&&r>a.length)return s("length is larger than the size of the file",null);if(n&&r&&n+r>a.length)return s("offset and length is larger than the size of the file",null);n!=null?a.seek(n,function(u,c){if(u)return s(u);c.read(r,s)}):a.read(r,s)})};qe.readlines=function(e,t,r,n,i){var s=Array.prototype.slice.call(arguments,2);return i=typeof s[s.length-1]=="function"?s.pop():void 0,r=s.length?s.shift():null,n=s.length?s.shift():null,n=n||{},Er(e.s.topology,cfe,[e,t,r,n,i],{skipSessions:!0})};var cfe=function(e,t,r,n,i){var s=r??`
`;new qe(e,t,"r",n).open(function(o,a){if(o)return i(o);a.readlines(s,i)})};qe.unlink=function(e,t,r,n){var i=Array.prototype.slice.call(arguments,2);return n=typeof i[i.length-1]=="function"?i.pop():void 0,r=i.length?i.shift():{},r=r||{},Er(e.s.topology,lfe,[this,e,t,r,n],{skipSessions:!0})};var lfe=function(e,t,r,n,i){var s=c0(t,n);if(r.constructor===Array)for(var o=0,a=0;a<r.length;a++)++o,qe.unlink(t,r[a],n,function(){--o===0&&i(null,e)});else new qe(t,r,"w",n).open(function(u,c){if(u)return i(u);Ql(c,function(f){if(f)return i(f);c.collection(function(h,d){if(h)return i(h);d.remove({_id:c.fileId},s,function(p){i(p,e)})})})})},ffe=function(e,t,r,n,i){return fm.isBuffer(t)?WR(e,t,r,i):WR(e,fm.from(t,"binary"),r,i)},lm=function(e){let t=Object.assign(e,e.writeConcern);var r={};return t.w!=null&&(r.w=t.w),t.journal===!0&&(r.j=t.journal),t.j===!0&&(r.j=t.j),t.fsync===!0&&(r.fsync=t.fsync),t.wtimeout!=null&&(r.wtimeout=t.wtimeout),r},c0=function(e,t){var r={w:1};if(t=t||{},t.writeConcern!=null||t.w!=null||typeof t.j=="boolean"||typeof t.journal=="boolean"||typeof t.fsync=="boolean"?r=lm(t):t.safe!=null&&typeof t.safe=="object"?r=lm(t.safe):typeof t.safe=="boolean"?r={w:t.safe?1:0}:e.options.writeConcern!=null||e.options.w!=null||typeof e.options.j=="boolean"||typeof e.options.journal=="boolean"||typeof e.options.fsync=="boolean"?r=lm(e.options):e.safe&&(e.safe.w!=null||typeof e.safe.j=="boolean"||typeof e.safe.journal=="boolean"||typeof e.safe.fsync=="boolean")?r=lm(e.safe):typeof e.safe=="boolean"&&(r={w:e.safe?1:0}),r.w<1&&(r.journal===!0||r.j===!0||r.fsync===!0))throw ds.create({message:"No acknowledgement using w < 1 cannot be combined with journal:true or fsync:true",driver:!0});return r},ps=function(e){HR.call(this),this.gs=e,this.endCalled=!1,this.totalBytesToRead=this.gs.length-this.gs.position,this.seekPosition=this.gs.position};Hle(ps,HR);ps.prototype._pipe=ps.prototype.pipe;ps.prototype.pipe=function(e){var t=this;return t.gs.isOpen?(t.totalBytesToRead=t.gs.length-t.gs.position,t._pipe.apply(t,[e])):t.gs.open(function(r){if(r)return t.emit("error",r);t.totalBytesToRead=t.gs.length-t.gs.position,t._pipe.apply(t,[e])}),e};ps.prototype._read=function(){var e=this,t=function(){e.gs.read(r,function(n,i){if(n&&!e.endCalled)return e.emit("error",n);if(e.endCalled||i==null)return e.push(null);i.length<=e.totalBytesToRead?(e.totalBytesToRead=e.totalBytesToRead-i.length,e.push(i)):i.length>e.totalBytesToRead&&(e.totalBytesToRead=e.totalBytesToRead-i._index,e.push(i.slice(0,i._index))),e.totalBytesToRead<=0&&(e.endCalled=!0)})},r=e.gs.length<e.gs.chunkSize?e.gs.length-e.seekPosition:e.gs.chunkSize;e.gs.isOpen?t():e.gs.open(function(n){if(e.totalBytesToRead=e.gs.length-e.gs.position,n)return e.emit("error",n);t()})};ps.prototype.destroy=function(){this.pause(),this.endCalled=!0,this.gs.close(),this.emit("end")};ps.prototype.write=function(e){var t=this;return t.endCalled?t.emit("error",ds.create({message:"attempting to write to stream after end called",driver:!0})):t.gs.isOpen?(t.gs.write(e,function(){t.emit("drain")}),!0):(t.gs.open(function(){t.gs.isOpen=!0,t.gs.write(e,function(){process.nextTick(function(){t.emit("drain")})})}),!1)};ps.prototype.end=function(e,t,r){var n=this,i=Array.prototype.slice.call(arguments,0);r=typeof i[i.length-1]=="function"?i.pop():void 0,e=i.length?i.shift():null,t=i.length?i.shift():null,n.endCalled=!0,e&&n.gs.write(e,function(){n.gs.close(function(){typeof r=="function"&&r(),n.emit("end")})}),n.gs.close(function(){typeof r=="function"&&r(),n.emit("end")})};KR.exports=qe});var XR=_((Ixe,JR)=>{"use strict";var QR=require("stream"),hfe=require("util");JR.exports=Bu;function Bu(e,t,r,n,i){this.s={bytesRead:0,chunks:e,cursor:null,expected:0,files:t,filter:n,init:!1,expectedEnd:0,file:null,options:i,readPreference:r},QR.Readable.call(this)}hfe.inherits(Bu,QR.Readable);Bu.prototype._read=function(){var e=this;this.destroyed||mfe(e,function(){dfe(e)})};Bu.prototype.start=function(e){return YR(this),this.s.options.start=e,this};Bu.prototype.end=function(e){return YR(this),this.s.options.end=e,this};Bu.prototype.abort=function(e){var t=this;this.push(null),this.destroyed=!0,this.s.cursor?this.s.cursor.close(function(r){t.emit("close"),e&&e(r)}):(this.s.init||t.emit("close"),e&&e())};function YR(e){if(e.s.init)throw new Error("You cannot change options after the stream has enteredflowing mode!")}function dfe(e){e.destroyed||e.s.cursor.next(function(t,r){if(e.destroyed)return;if(t)return bi(e,t);if(!r){e.push(null),process.nextTick(()=>{e.s.cursor.close(function(d){if(d){bi(e,d);return}e.emit("close")})});return}var n=e.s.file.length-e.s.bytesRead,i=e.s.expected++,s=Math.min(e.s.file.chunkSize,n);if(r.n>i){var o="ChunkIsMissing: Got unexpected n: "+r.n+", expected: "+i;return bi(e,new Error(o))}if(r.n<i)return o="ExtraChunk: Got unexpected n: "+r.n+", expected: "+i,bi(e,new Error(o));var a=Buffer.isBuffer(r.data)?r.data:r.data.buffer;if(a.length!==s)return n<=0?(o="ExtraChunk: Got unexpected n: "+r.n,bi(e,new Error(o))):(o="ChunkIsWrongSize: Got unexpected length: "+a.length+", expected: "+s,bi(e,new Error(o)));if(e.s.bytesRead+=a.length,a.length===0)return e.push(null);var u=null,c=null;e.s.bytesToSkip!=null&&(u=e.s.bytesToSkip,e.s.bytesToSkip=0);let f=i===e.s.expectedEnd-1,h=e.s.options.end-e.s.bytesToSkip;f&&e.s.bytesToTrim!=null?c=e.s.file.chunkSize-e.s.bytesToTrim:e.s.options.end&&h<r.data.length()&&(c=h),(u!=null||c!=null)&&(a=a.slice(u||0,c||a.length)),e.push(a)})}function pfe(e){var t={};e.s.readPreference&&(t.readPreference=e.s.readPreference),e.s.options&&e.s.options.sort&&(t.sort=e.s.options.sort),e.s.options&&e.s.options.skip&&(t.skip=e.s.options.skip),e.s.files.findOne(e.s.filter,t,function(r,n){if(r)return bi(e,r);if(!n){var i=e.s.filter._id?e.s.filter._id.toString():e.s.filter.filename,s="FileNotFound: file "+i+" was not found",o=new Error(s);return o.code="ENOENT",bi(e,o)}if(n.length<=0){e.push(null);return}if(e.destroyed){e.emit("close");return}try{e.s.bytesToSkip=yfe(e,n,e.s.options)}catch(c){return bi(e,c)}var a={files_id:n._id};if(e.s.options&&e.s.options.start!=null){var u=Math.floor(e.s.options.start/n.chunkSize);u>0&&(a.n={$gte:u})}e.s.cursor=e.s.chunks.find(a).sort({n:1}),e.s.readPreference&&e.s.cursor.setReadPreference(e.s.readPreference),e.s.expectedEnd=Math.ceil(n.length/n.chunkSize),e.s.file=n;try{e.s.bytesToTrim=gfe(e,n,e.s.cursor,e.s.options)}catch(c){return bi(e,c)}e.emit("file",n)})}function mfe(e,t){if(e.s.file)return t();e.s.init||(pfe(e),e.s.init=!0),e.once("file",function(){t()})}function yfe(e,t,r){if(r&&r.start!=null){if(r.start>t.length)throw new Error("Stream start ("+r.start+") must not be more than the length of the file ("+t.length+")");if(r.start<0)throw new Error("Stream start ("+r.start+") must not be negative");if(r.end!=null&&r.end<r.start)throw new Error("Stream start ("+r.start+") must not be greater than stream end ("+r.end+")");return e.s.bytesRead=Math.floor(r.start/t.chunkSize)*t.chunkSize,e.s.expected=Math.floor(r.start/t.chunkSize),r.start-e.s.bytesRead}}function gfe(e,t,r,n){if(n&&n.end!=null){if(n.end>t.length)throw new Error("Stream end ("+n.end+") must not be more than the length of the file ("+t.length+")");if(n.start<0)throw new Error("Stream end ("+n.end+") must not be negative");var i=n.start!=null?Math.floor(n.start/t.chunkSize):0;return r.limit(Math.ceil(n.end/t.chunkSize)-i),e.s.expectedEnd=Math.ceil(n.end/t.chunkSize),Math.ceil(n.end/t.chunkSize)*t.chunkSize-n.end}}function bi(e,t){e.emit("error",t)}});var oD=_((Rxe,sD)=>{"use strict";var eD=xo().MONGODB_ERROR_CODES,tD=ie(),_fe=require("crypto"),rD=require("stream"),wfe=require("util"),Yl=jt().Buffer,vfe=N().deprecateOptions,Xl=vfe({name:"GridFSBucketWriteStream",deprecatedOptions:["disableMD5"],optionsIndex:2},function(e,t,r){if(r=r||{},rD.Writable.call(this,r),this.bucket=e,this.chunks=e.s._chunksCollection,this.filename=t,this.files=e.s._filesCollection,this.options=r,this.done=!1,this.id=r.id?r.id:tD.BSON.ObjectId(),this.chunkSizeBytes=this.options.chunkSizeBytes,this.bufToStore=Yl.alloc(this.chunkSizeBytes),this.length=0,this.md5=!r.disableMD5&&_fe.createHash("md5"),this.n=0,this.pos=0,this.state={streamEnd:!1,outstandingRequests:0,errored:!1,aborted:!1,promiseLibrary:this.bucket.s.promiseLibrary},!this.bucket.s.calledOpenUploadStream){this.bucket.s.calledOpenUploadStream=!0;var n=this;Sfe(this,function(){n.bucket.s.checkedIndexes=!0,n.bucket.emit("index")})}});wfe.inherits(Xl,rD.Writable);Xl.prototype.write=function(e,t,r){var n=this;return iD(this,function(){return bfe(n,e,t,r)})};Xl.prototype.abort=function(e){if(this.state.streamEnd){var t=new Error("Cannot abort a stream that has already completed");return typeof e=="function"?e(t):this.state.promiseLibrary.reject(t)}if(this.state.aborted)return t=new Error("Cannot call abort() on a stream twice"),typeof e=="function"?e(t):this.state.promiseLibrary.reject(t);this.state.aborted=!0,this.chunks.deleteMany({files_id:this.id},function(r){typeof e=="function"&&e(r)})};Xl.prototype.end=function(e,t,r){var n=this;if(typeof e=="function"?(r=e,e=null,t=null):typeof t=="function"&&(r=t,t=null),!Jl(this,r)){if(this.state.streamEnd=!0,r&&this.once("finish",function(i){r(null,i)}),!e){iD(this,function(){ZR(n)});return}this.write(e,t,function(){ZR(n)})}};function h0(e,t,r){if(!e.state.errored){if(e.state.errored=!0,r)return r(t);e.emit("error",t)}}function nD(e,t,r){return{_id:tD.BSON.ObjectId(),files_id:e,n:t,data:r}}function l0(e,t){e.chunks.listIndexes().toArray(function(r,n){if(r){if(r.code===eD.NamespaceNotFound){var i={files_id:1,n:1};e.chunks.createIndex(i,{background:!1,unique:!0},function(a){if(a)return t(a);t()});return}return t(r)}var s=!1;if(n.forEach(function(a){if(a.key){var u=Object.keys(a.key);u.length===2&&a.key.files_id===1&&a.key.n===1&&(s=!0)}}),s)t();else{i={files_id:1,n:1};var o=Zl(e);o.background=!1,o.unique=!0,e.chunks.createIndex(i,o,function(a){if(a)return t(a);t()})}})}function f0(e,t){if(e.done)return!0;if(e.state.streamEnd&&e.state.outstandingRequests===0&&!e.state.errored){e.done=!0;var r=Ofe(e.id,e.length,e.chunkSizeBytes,e.md5&&e.md5.digest("hex"),e.filename,e.options.contentType,e.options.aliases,e.options.metadata);return Jl(e,t)?!1:(e.files.insertOne(r,Zl(e),function(n){if(n)return h0(e,n,t);e.emit("finish",r),e.emit("close")}),!0)}return!1}function Sfe(e,t){e.files.findOne({},{_id:1},function(r,n){if(r)return t(r);if(n)return t();e.files.listIndexes().toArray(function(i,s){if(i){if(i.code===eD.NamespaceNotFound){var o={filename:1,uploadDate:1};e.files.createIndex(o,{background:!1},function(c){if(c)return t(c);l0(e,t)});return}return t(i)}var a=!1;if(s.forEach(function(c){var f=Object.keys(c.key);f.length===2&&c.key.filename===1&&c.key.uploadDate===1&&(a=!0)}),a)l0(e,t);else{o={filename:1,uploadDate:1};var u=Zl(e);u.background=!1,e.files.createIndex(o,u,function(c){if(c)return t(c);l0(e,t)})}})})}function Ofe(e,t,r,n,i,s,o,a){var u={_id:e,length:t,chunkSize:r,uploadDate:new Date,filename:i};return n&&(u.md5=n),s&&(u.contentType=s),o&&(u.aliases=o),a&&(u.metadata=a),u}function bfe(e,t,r,n){if(Jl(e,n))return!1;var i=Yl.isBuffer(t)?t:Yl.from(t,r);if(e.length+=i.length,e.pos+i.length<e.chunkSizeBytes)return i.copy(e.bufToStore,e.pos),e.pos+=i.length,n&&n(),!0;for(var s=i.length,o=e.chunkSizeBytes-e.pos,a=Math.min(o,i.length),u=0;s>0;){var c=i.length-s;if(i.copy(e.bufToStore,e.pos,c,c+a),e.pos+=a,o-=a,o===0){e.md5&&e.md5.update(e.bufToStore);var f=nD(e.id,e.n,Yl.from(e.bufToStore));if(++e.state.outstandingRequests,++u,Jl(e,n))return!1;e.chunks.insertOne(f,Zl(e),function(h){if(h)return h0(e,h);--e.state.outstandingRequests,--u,u||(e.emit("drain",f),n&&n(),f0(e))}),o=e.chunkSizeBytes,e.pos=0,++e.n}s-=a,a=Math.min(o,s)}return!1}function Zl(e){var t={};return e.options.writeConcern&&(t.w=e.options.writeConcern.w,t.wtimeout=e.options.writeConcern.wtimeout,t.j=e.options.writeConcern.j),t}function iD(e,t){return e.bucket.s.checkedIndexes?t(!1):(e.bucket.once("index",function(){t(!0)}),!0)}function ZR(e,t){if(e.pos===0)return f0(e,t);++e.state.outstandingRequests;var r=Yl.alloc(e.pos);e.bufToStore.copy(r,0,0,e.pos),e.md5&&e.md5.update(r);var n=nD(e.id,e.n,r);if(Jl(e,t))return!1;e.chunks.insertOne(n,Zl(e),function(i){if(i)return h0(e,i);--e.state.outstandingRequests,f0(e)})}function Jl(e,t){return e.state.aborted?(typeof t=="function"&&t(new Error("this stream has been aborted")),!0):!1}sD.exports=Xl});var hD=_((Dxe,fD)=>{"use strict";var aD=require("events").EventEmitter,uD=XR(),cD=oD(),p0=N().shallowClone,Efe=N().toError,Cfe=require("util"),m0=N().executeLegacyOperation,lD=N().deprecateOptions,d0={bucketName:"fs",chunkSizeBytes:255*1024};fD.exports=Xn;function Xn(e,t){if(aD.apply(this),this.setMaxListeners(0),t&&typeof t=="object"){t=p0(t);for(var r=Object.keys(d0),n=0;n<r.length;++n)t[r[n]]||(t[r[n]]=d0[r[n]])}else t=d0;this.s={db:e,options:t,_chunksCollection:e.collection(t.bucketName+".chunks"),_filesCollection:e.collection(t.bucketName+".files"),checkedIndexes:!1,calledOpenUploadStream:!1,promiseLibrary:e.s.promiseLibrary||Promise}}Cfe.inherits(Xn,aD);Xn.prototype.openUploadStream=lD({name:"GridFSBucket.openUploadStream",deprecatedOptions:["disableMD5"],optionsIndex:1},function(e,t){return t?t=p0(t):t={},t.chunkSizeBytes||(t.chunkSizeBytes=this.s.options.chunkSizeBytes),new cD(this,e,t)});Xn.prototype.openUploadStreamWithId=lD({name:"GridFSBucket.openUploadStreamWithId",deprecatedOptions:["disableMD5"],optionsIndex:2},function(e,t,r){return r?r=p0(r):r={},r.chunkSizeBytes||(r.chunkSizeBytes=this.s.options.chunkSizeBytes),r.id=e,new cD(this,t,r)});Xn.prototype.openDownloadStream=function(e,t){var r={_id:e};return t={start:t&&t.start,end:t&&t.end},new uD(this.s._chunksCollection,this.s._filesCollection,this.s.options.readPreference,r,t)};Xn.prototype.delete=function(e,t){return m0(this.s.db.s.topology,Tfe,[this,e,t],{skipSessions:!0})};function Tfe(e,t,r){e.s._filesCollection.deleteOne({_id:t},function(n,i){if(n)return r(n);e.s._chunksCollection.deleteMany({files_id:t},function(s){if(s)return r(s);if(!i.result.n){var o="FileNotFound: no file with id "+t+" found";return r(new Error(o))}r()})})}Xn.prototype.find=function(e,t){e=e||{},t=t||{};var r=this.s._filesCollection.find(e);return t.batchSize!=null&&r.batchSize(t.batchSize),t.limit!=null&&r.limit(t.limit),t.maxTimeMS!=null&&r.maxTimeMS(t.maxTimeMS),t.noCursorTimeout!=null&&r.addCursorFlag("noCursorTimeout",t.noCursorTimeout),t.skip!=null&&r.skip(t.skip),t.sort!=null&&r.sort(t.sort),r};Xn.prototype.openDownloadStreamByName=function(e,t){var r={uploadDate:-1},n=null;t&&t.revision!=null&&(t.revision>=0?(r={uploadDate:1},n=t.revision):n=-t.revision-1);var i={filename:e};return t={sort:r,skip:n,start:t&&t.start,end:t&&t.end},new uD(this.s._chunksCollection,this.s._filesCollection,this.s.options.readPreference,i,t)};Xn.prototype.rename=function(e,t,r){return m0(this.s.db.s.topology,Afe,[this,e,t,r],{skipSessions:!0})};function Afe(e,t,r,n){var i={_id:t},s={$set:{filename:r}};e.s._filesCollection.updateOne(i,s,function(o,a){if(o)return n(o);if(!a.result.n)return n(Efe("File with id "+t+" not found"));n()})}Xn.prototype.drop=function(e){return m0(this.s.db.s.topology,xfe,[this,e],{skipSessions:!0})};Xn.prototype.getLogger=function(){return this.s.db.s.logger};function xfe(e,t){e.s._filesCollection.drop(function(r){if(r)return t(r);e.s._chunksCollection.drop(function(n){return n?t(n):t()})})}});var fs=_((jxe,dD)=>{"use strict";var lt=ie(),qfe=X$(),_e=Ru().connect;_e.MongoError=lt.MongoError;_e.MongoNetworkError=lt.MongoNetworkError;_e.MongoTimeoutError=lt.MongoTimeoutError;_e.MongoServerSelectionError=lt.MongoServerSelectionError;_e.MongoParseError=lt.MongoParseError;_e.MongoWriteConcernError=lt.MongoWriteConcernError;_e.MongoBulkWriteError=pp().BulkWriteError;_e.BulkWriteError=_e.MongoBulkWriteError;_e.ServerApiVersion=lt.ServerApiVersion;_e.Admin=AO();_e.MongoClient=Ru();_e.Db=Ul();_e.Collection=qu();_e.Server=Hl();_e.ReplSet=WO();_e.Mongos=VO();_e.ReadPreference=lt.ReadPreference;_e.GridStore=GR();_e.Chunk=i0();_e.Logger=lt.Logger;_e.AggregationCursor=yp();_e.CommandCursor=_p();_e.Cursor=vi();_e.GridFSBucket=hD();_e.CoreServer=lt.Server;_e.CoreConnection=lt.Connection;_e.Binary=lt.BSON.Binary;_e.Code=lt.BSON.Code;_e.Map=lt.BSON.Map;_e.DBRef=lt.BSON.DBRef;_e.Double=lt.BSON.Double;_e.Int32=lt.BSON.Int32;_e.Long=lt.BSON.Long;_e.MinKey=lt.BSON.MinKey;_e.MaxKey=lt.BSON.MaxKey;_e.ObjectID=lt.BSON.ObjectID;_e.ObjectId=lt.BSON.ObjectID;_e.Symbol=lt.BSON.Symbol;_e.Timestamp=lt.BSON.Timestamp;_e.BSONRegExp=lt.BSON.BSONRegExp;_e.Decimal128=lt.BSON.Decimal128;_e.connect=_e;_e.instrument=function(e,t){typeof e=="function"&&(t=e,e={});let r=new qfe;return r.instrument(_e.MongoClient,t),r};dD.exports=_e});var yD=_((pD,mD)=>{"use strict";var Mfe=fs().Binary;mD.exports=pD=Mfe});var ef=_((OD,bD)=>{"use strict";var Ei=bD.exports=OD=Object.create(null),gD="disconnected",_D="connected",wD="connecting",vD="disconnecting",SD="uninitialized";Ei[0]=gD;Ei[1]=_D;Ei[2]=wD;Ei[3]=vD;Ei[99]=SD;Ei[gD]=0;Ei[_D]=1;Ei[wD]=2;Ei[vD]=3;Ei[SD]=99});var Cr=_((Bxe,ED)=>{"use strict";var Nfe=process.nextTick.bind(process);ED.exports=function(t){return Nfe(t)}});var AD=_((Lxe,TD)=>{"use strict";var $fe=require("events").EventEmitter,Pfe=ef(),CD=Cr();function ot(e,t,r){r===void 0&&(r={}),r.capped===void 0&&(r.capped={}),typeof r.capped=="number"&&(r.capped={size:r.capped}),this.opts=r,this.name=e,this.collectionName=e,this.conn=t,this.queue=[],this.buffer=!0,this.emitter=new $fe,Pfe.connected===this.conn.readyState&&this.onOpen()}ot.prototype.name;ot.prototype.collectionName;ot.prototype.conn;ot.prototype.onOpen=function(){this.buffer=!1,CD(()=>this.doQueue())};ot.prototype.onClose=function(e){this._shouldBufferCommands()&&!e&&(this.buffer=!0)};ot.prototype.addQueue=function(e,t){return this.queue.push([e,t]),this};ot.prototype.removeQueue=function(e,t){let r=this.queue.findIndex(n=>n[0]===e&&n[1]===t);return r===-1?!1:(this.queue.splice(r,1),!0)};ot.prototype.doQueue=function(){for(let t of this.queue)typeof t[0]=="function"?t[0].apply(this,t[1]):this[t[0]].apply(this,t[1]);this.queue=[];let e=this;return CD(function(){e.emitter.emit("queue")}),this};ot.prototype.ensureIndex=function(){throw new Error("Collection#ensureIndex unimplemented by driver")};ot.prototype.createIndex=function(){throw new Error("Collection#createIndex unimplemented by driver")};ot.prototype.findAndModify=function(){throw new Error("Collection#findAndModify unimplemented by driver")};ot.prototype.findOneAndUpdate=function(){throw new Error("Collection#findOneAndUpdate unimplemented by driver")};ot.prototype.findOneAndDelete=function(){throw new Error("Collection#findOneAndDelete unimplemented by driver")};ot.prototype.findOneAndReplace=function(){throw new Error("Collection#findOneAndReplace unimplemented by driver")};ot.prototype.findOne=function(){throw new Error("Collection#findOne unimplemented by driver")};ot.prototype.find=function(){throw new Error("Collection#find unimplemented by driver")};ot.prototype.insert=function(){throw new Error("Collection#insert unimplemented by driver")};ot.prototype.insertOne=function(){throw new Error("Collection#insertOne unimplemented by driver")};ot.prototype.insertMany=function(){throw new Error("Collection#insertMany unimplemented by driver")};ot.prototype.save=function(){throw new Error("Collection#save unimplemented by driver")};ot.prototype.update=function(){throw new Error("Collection#update unimplemented by driver")};ot.prototype.getIndexes=function(){throw new Error("Collection#getIndexes unimplemented by driver")};ot.prototype.mapReduce=function(){throw new Error("Collection#mapReduce unimplemented by driver")};ot.prototype.watch=function(){throw new Error("Collection#watch unimplemented by driver")};ot.prototype._shouldBufferCommands=function(){let t=this.opts;return t.bufferCommands!=null?t.bufferCommands:t&&t.schemaUserProvidedOptions!=null&&t.schemaUserProvidedOptions.bufferCommands!=null?t.schemaUserProvidedOptions.bufferCommands:this.conn._shouldBufferCommands()};ot.prototype._getBufferTimeoutMS=function(){let t=this.conn,r=this.opts;return r.bufferTimeoutMS!=null?r.bufferTimeoutMS:r&&r.schemaUserProvidedOptions!=null&&r.schemaUserProvidedOptions.bufferTimeoutMS!=null?r.schemaUserProvidedOptions.bufferTimeoutMS:t.config.bufferTimeoutMS!=null?t.config.bufferTimeoutMS:t.base!=null&&t.base.get("bufferTimeoutMS")!=null?t.base.get("bufferTimeoutMS"):1e4};TD.exports=ot});var on=_((kxe,xD)=>{"use strict";var hm=class extends Error{};Object.defineProperty(hm.prototype,"name",{value:"MongooseError"});xD.exports=hm});var y0=_((qD,MD)=>{"use strict";var Ife=fs().ObjectId;MD.exports=qD=Ife});var je=_((Fxe,ND)=>{"use strict";ND.exports=function(t,r,n){let i,s=!1;if(typeof r=="string"){if(r.indexOf(".")===-1){let u=g0(t,r);return u??n}i=r.split(".")}else if(s=!0,i=r,i.length===1){let u=g0(t,i[0]);return u??n}let o=r,a=t;for(let u of i){if(a==null)return n;if(!s&&a[o]!=null)return a[o];a=g0(a,u),s||(o=o.substr(u.length+1))}return a??n};function g0(e,t){return e==null?e:e instanceof Map?e.get(t):e[t]}});var Ur=_((Uxe,$D)=>{"use strict";$D.exports=function(t){if(t!=null&&typeof t.constructor=="function")return t.constructor.name}});var tf=_((Vxe,PD)=>{PD.exports=function(e,t,r){var n=[],i=e.length;if(i===0)return n;var s=t<0?Math.max(0,t+i):t||0;for(r!==void 0&&(i=r<0?r+i:r);i-- >s;)n[i-s]=e[i];return n}});var _0=_((ID,RD)=>{var Rfe=Object.prototype.toString;function Dfe(e){return typeof e=="object"&&Rfe.call(e)=="[object RegExp]"}RD.exports=ID=function(e){if(!Dfe(e))throw new TypeError("Not a RegExp");let t=[];e.global&&t.push("g"),e.multiline&&t.push("m"),e.ignoreCase&&t.push("i"),e.dotAll&&t.push("s"),e.unicode&&t.push("u"),e.sticky&&t.push("y");let r=new RegExp(e.source,t.join(""));return typeof e.lastIndex=="number"&&(r.lastIndex=e.lastIndex),r}});var ua=_((Wxe,DD)=>{"use strict";DD.exports=xn().get().Decimal128});var pe=_(Jt=>{"use strict";Jt.arrayAtomicsSymbol=Symbol("mongoose#Array#_atomics");Jt.arrayParentSymbol=Symbol("mongoose#Array#_parent");Jt.arrayPathSymbol=Symbol("mongoose#Array#_path");Jt.arraySchemaSymbol=Symbol("mongoose#Array#_schema");Jt.documentArrayParent=Symbol("mongoose:documentArrayParent");Jt.documentIsSelected=Symbol("mongoose#Document#isSelected");Jt.documentIsModified=Symbol("mongoose#Document#isModified");Jt.documentModifiedPaths=Symbol("mongoose#Document#modifiedPaths");Jt.documentSchemaSymbol=Symbol("mongoose#Document#schema");Jt.getSymbol=Symbol("mongoose#Document#get");Jt.modelSymbol=Symbol("mongoose#Model");Jt.objectIdSymbol=Symbol("mongoose#ObjectId");Jt.populateModelSymbol=Symbol("mongoose.PopulateOptions#Model");Jt.schemaTypeSymbol=Symbol("mongoose#schemaType");Jt.sessionNewDocuments=Symbol("mongoose:ClientSession#newDocuments");Jt.scopeSymbol=Symbol("mongoose#Document#scope");Jt.validatorErrorSymbol=Symbol("mongoose:validatorError")});var Zn=_((Hxe,jD)=>{"use strict";var w0=xn().get().ObjectId,jfe=pe().objectIdSymbol;Object.defineProperty(w0.prototype,"_id",{enumerable:!1,configurable:!0,get:function(){return this}});w0.prototype[jfe]=!0;jD.exports=w0});var dm=_((Kxe,BD)=>{"use strict";BD.exports=new Set(["__proto__","constructor","prototype"])});var rf=_((Gxe,LD)=>{"use strict";LD.exports=function(e){return e==null?!1:e.$__!=null||e.isMongooseArray||e.isMongooseBuffer||e.$isMongooseMap}});var v0=_((Qxe,kD)=>{"use strict";kD.exports=function(e){return e.name?e.name:(e.toString().trim().match(/^function\s*([^\s(]+)/)||[])[1]}});var S0=_((Yxe,FD)=>{"use strict";var Bfe=je();function Lfe(e,t){return Bfe(e,"_bsontype",void 0)===t}FD.exports=Lfe});var ca=_((Jxe,UD)=>{"use strict";UD.exports=function(e){return Buffer.isBuffer(e)?!0:Object.prototype.toString.call(e)==="[object Object]"}});var O0=_((Xxe,VD)=>{var Lu=1e3,ku=Lu*60,Fu=ku*60,la=Fu*24,kfe=la*7,Ffe=la*365.25;VD.exports=function(e,t){t=t||{};var r=typeof e;if(r==="string"&&e.length>0)return Ufe(e);if(r==="number"&&isFinite(e))return t.long?Wfe(e):Vfe(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))};function Ufe(e){if(e=String(e),!(e.length>100)){var t=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e);if(!!t){var r=parseFloat(t[1]),n=(t[2]||"ms").toLowerCase();switch(n){case"years":case"year":case"yrs":case"yr":case"y":return r*Ffe;case"weeks":case"week":case"w":return r*kfe;case"days":case"day":case"d":return r*la;case"hours":case"hour":case"hrs":case"hr":case"h":return r*Fu;case"minutes":case"minute":case"mins":case"min":case"m":return r*ku;case"seconds":case"second":case"secs":case"sec":case"s":return r*Lu;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return r;default:return}}}}function Vfe(e){var t=Math.abs(e);return t>=la?Math.round(e/la)+"d":t>=Fu?Math.round(e/Fu)+"h":t>=ku?Math.round(e/ku)+"m":t>=Lu?Math.round(e/Lu)+"s":e+"ms"}function Wfe(e){var t=Math.abs(e);return t>=la?pm(e,t,la,"day"):t>=Fu?pm(e,t,Fu,"hour"):t>=ku?pm(e,t,ku,"minute"):t>=Lu?pm(e,t,Lu,"second"):e+" ms"}function pm(e,t,r,n){var i=t>=r*1.5;return Math.round(e/r)+" "+n+(i?"s":"")}});var zD=_((Zxe,WD)=>{"use strict";WD.exports=function(t){let r=[],n="",i="DEFAULT";for(let s=0;s<t.length;++s)i==="IN_SQUARE_BRACKETS"&&!/\d/.test(t[s])&&t[s]!=="]"&&(i="DEFAULT",n=r[r.length-1]+"["+n,r.splice(r.length-1,1)),t[s]==="["?(i!=="IMMEDIATELY_AFTER_SQUARE_BRACKETS"&&(r.push(n),n=""),i="IN_SQUARE_BRACKETS"):t[s]==="]"?i==="IN_SQUARE_BRACKETS"?(i="IMMEDIATELY_AFTER_SQUARE_BRACKETS",r.push(n),n=""):(i="DEFAULT",n+=t[s]):t[s]==="."?(i!=="IMMEDIATELY_AFTER_SQUARE_BRACKETS"&&(r.push(n),n=""),i="DEFAULT"):n+=t[s];return i!=="IMMEDIATELY_AFTER_SQUARE_BRACKETS"&&r.push(n),r}});var QD=_(oo=>{var mm=zD(),HD=["__proto__","constructor","prototype"];oo.get=function(e,t,r,n){var i;typeof r=="function"&&(r.length<2?(n=r,r=void 0):(i=r,r=void 0)),n||(n=GD);var s=typeof e=="string"?mm(e):e;if(!Array.isArray(s))throw new TypeError("Invalid `path`. Must be either string or array");for(var o=t,a,u=0;u<s.length;++u){if(a=s[u],typeof s[u]!="string"&&typeof s[u]!="number")throw new TypeError("Each segment of path to `get()` must be a string or number, got "+typeof s[u]);if(Array.isArray(o)&&!/^\d+$/.test(a)){var c=s.slice(u);return[].concat(o).map(function(h){return h?oo.get(c,h,r||i,n):n(void 0)})}if(i)o=i(o,a);else{var f=r&&o[r]?o[r]:o;o=f instanceof Map?f.get(a):f[a]}if(!o)return n(o)}return n(o)};oo.has=function(e,t){var r=typeof e=="string"?mm(e):e;if(!Array.isArray(r))throw new TypeError("Invalid `path`. Must be either string or array");for(var n=r.length,i=t,s=0;s<n;++s){if(typeof r[s]!="string"&&typeof r[s]!="number")throw new TypeError("Each segment of path to `has()` must be a string or number, got "+typeof r[s]);if(i==null||typeof i!="object"||!(r[s]in i))return!1;i=i[r[s]]}return!0};oo.unset=function(e,t){var r=typeof e=="string"?mm(e):e;if(!Array.isArray(r))throw new TypeError("Invalid `path`. Must be either string or array");for(var n=r.length,i=t,s=0;s<n;++s){if(i==null||typeof i!="object"||!(r[s]in i))return!1;if(typeof r[s]!="string"&&typeof r[s]!="number")throw new TypeError("Each segment of path to `unset()` must be a string or number, got "+typeof r[s]);if(HD.indexOf(r[s])!==-1)return!1;if(s===n-1)return delete i[r[s]],!0;i=i instanceof Map?i.get(r[s]):i[r[s]]}return!0};oo.set=function(e,t,r,n,i,s){var o;typeof n=="function"&&(n.length<2?(i=n,n=void 0):(o=n,n=void 0)),i||(i=GD);var a=typeof e=="string"?mm(e):e;if(!Array.isArray(a))throw new TypeError("Invalid `path`. Must be either string or array");if(r!=null){for(var u=0;u<a.length;++u){if(typeof a[u]!="string"&&typeof a[u]!="number")throw new TypeError("Each segment of path to `set()` must be a string or number, got "+typeof a[u]);if(HD.indexOf(a[u])!==-1)return}for(var c=s||/\$/.test(e)&&s!==!1,f=r,h,u=0,d=a.length-1;u<d;++u){if(h=a[u],h=="$"){if(u==d-1)break;continue}if(Array.isArray(f)&&!/^\d+$/.test(h)){var p=a.slice(u);if(!c&&Array.isArray(t))for(var m=0;m<f.length&&m<t.length;++m)oo.set(p,t[m],f[m],n||o,i,c);else for(var m=0;m<f.length;++m)oo.set(p,t,f[m],n||o,i,c);return}if(o)f=o(f,h);else{var y=n&&f[n]?f[n]:f;f=y instanceof Map?y.get(h):y[h]}if(!f)return}if(h=a[d],n&&f[n]&&(f=f[n]),Array.isArray(f)&&!/^\d+$/.test(h))if(!c&&Array.isArray(t))KD(f,t,h,o,n,i);else for(var m=0;m<f.length;++m){var g=f[m];g&&(o?o(g,h,i(t)):(g[n]&&(g=g[n]),g[h]=i(t)))}else o?o(f,h,i(t)):f instanceof Map?f.set(h,i(t)):f[h]=i(t)}};function KD(e,t,r,n,i,s){for(var o,a=0;a<e.length&&a<t.length;++a)o=e[a],Array.isArray(o)&&Array.isArray(t[a])?KD(o,t[a],r,n,i,s):o&&(n?n(o,r,s(t[a])):(o[i]&&(o=o[i]),o[r]=s(t[a])))}function GD(e){return e}});var ao=_((YD,JD)=>{"use strict";JD.exports=YD=QD()});var E0=_((b0,ZD)=>{var ym=require("buffer"),Ci=ym.Buffer;function XD(e,t){for(var r in e)t[r]=e[r]}Ci.from&&Ci.alloc&&Ci.allocUnsafe&&Ci.allocUnsafeSlow?ZD.exports=ym:(XD(ym,b0),b0.Buffer=fa);function fa(e,t,r){return Ci(e,t,r)}fa.prototype=Object.create(Ci.prototype);XD(Ci,fa);fa.from=function(e,t,r){if(typeof e=="number")throw new TypeError("Argument must not be a number");return Ci(e,t,r)};fa.alloc=function(e,t,r){if(typeof e!="number")throw new TypeError("Argument must be a number");var n=Ci(e);return t!==void 0?typeof r=="string"?n.fill(t,r):n.fill(t):n.fill(0),n};fa.allocUnsafe=function(e){if(typeof e!="number")throw new TypeError("Argument must be a number");return Ci(e)};fa.allocUnsafeSlow=function(e){if(typeof e!="number")throw new TypeError("Argument must be a number");return ym.SlowBuffer(e)}});var tj=_((tqe,ej)=>{"use strict";var zfe=ms(),C0=class{constructor(t){if(this._docs={},this._childDocs=[],t!=null&&(t=zfe(t),Object.assign(this,t),typeof t.subPopulate=="object"&&(this.populate=t.subPopulate),t.perDocumentLimit!=null&&t.limit!=null))throw new Error("Can not use `limit` and `perDocumentLimit` at the same time. Path: `"+t.path+"`.")}};ej.exports=C0});var A0=_(ft=>{"use strict";var Hfe=jt().Buffer,Kfe=_0(),T0=["__proto__","constructor","prototype"],gm=ft.clone=function e(t,r){if(t==null)return t;if(Array.isArray(t))return ft.cloneArray(t,r);if(t.constructor){if(/ObjectI[dD]$/.test(t.constructor.name))return typeof t.clone=="function"?t.clone():new t.constructor(t.id);if(t.constructor.name==="ReadPreference")return new t.constructor(t.mode,e(t.tags,r));if(t._bsontype=="Binary"&&t.buffer&&t.value)return typeof t.clone=="function"?t.clone():new t.constructor(t.value(!0),t.sub_type);if(t.constructor.name==="Date"||t.constructor.name==="Function")return new t.constructor(+t);if(t.constructor.name==="RegExp")return Kfe(t);if(t.constructor.name==="Buffer")return ft.cloneBuffer(t)}if(Qfe(t))return ft.cloneObject(t,r);if(t.valueOf)return t.valueOf()};ft.cloneObject=function(t,r){var n=r&&r.minimize,i={},s,o;for(let a of Object.keys(t))T0.indexOf(a)===-1&&(o=gm(t[a],r),(!n||typeof o<"u")&&(s||(s=!0),i[a]=o));return n?s&&i:i};ft.cloneArray=function(t,r){for(var n=[],i=0,s=t.length;i<s;i++)n.push(gm(t[i],r));return n};ft.tick=function(t){if(typeof t=="function")return function(){var r=arguments;Jfe(function(){t.apply(this,r)})}};ft.merge=function e(t,r){for(var n=Object.keys(r),i=n.length,s;i--;)s=n[i],T0.indexOf(s)===-1&&(typeof t[s]>"u"?t[s]=r[s]:ft.isObject(r[s])?e(t[s],r[s]):t[s]=r[s])};ft.mergeClone=function e(t,r){for(var n=Object.keys(r),i=n.length,s;i--;)s=n[i],T0.indexOf(s)===-1&&(typeof t[s]>"u"?t[s]=gm(r[s]):ft.isObject(r[s])?e(t[s],r[s]):t[s]=gm(r[s]))};ft.readPref=function(t){switch(t){case"p":t="primary";break;case"pp":t="primaryPreferred";break;case"s":t="secondary";break;case"sp":t="secondaryPreferred";break;case"n":t="nearest";break}return t};ft.readConcern=function(t){if(typeof t=="string"){switch(t){case"l":t="local";break;case"a":t="available";break;case"m":t="majority";break;case"lz":t="linearizable";break;case"s":t="snapshot";break}t={level:t}}return t};var Gfe=Object.prototype.toString;ft.toString=function(e){return Gfe.call(e)};var Qfe=ft.isObject=function(e){return ft.toString(e)=="[object Object]"};ft.isArray=function(e){return Array.isArray(e)||typeof e=="object"&&ft.toString(e)=="[object Array]"};ft.keys=Object.keys;ft.create=typeof Object.create=="function"?Object.create:Yfe;function Yfe(e){if(arguments.length>1)throw new Error("Adding properties is not supported");function t(){}return t.prototype=e,new t}ft.inherits=function(e,t){e.prototype=ft.create(t.prototype),e.prototype.constructor=e};var Jfe=ft.soon=typeof setImmediate=="function"?setImmediate:process.nextTick;ft.cloneBuffer=function(e){var t=Hfe.alloc(e.length);return e.copy(t,0,0,e.length),t};ft.isArgumentsObject=function(e){return Object.prototype.toString.call(e)==="[object Arguments]"}});var nj=_((nqe,rj)=>{var nf=1e3,sf=nf*60,of=sf*60,af=of*24,Xfe=af*365.25;rj.exports=function(e,t){t=t||{};var r=typeof e;if(r==="string"&&e.length>0)return Zfe(e);if(r==="number"&&isNaN(e)===!1)return t.long?the(e):ehe(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))};function Zfe(e){if(e=String(e),!(e.length>100)){var t=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(e);if(!!t){var r=parseFloat(t[1]),n=(t[2]||"ms").toLowerCase();switch(n){case"years":case"year":case"yrs":case"yr":case"y":return r*Xfe;case"days":case"day":case"d":return r*af;case"hours":case"hour":case"hrs":case"hr":case"h":return r*of;case"minutes":case"minute":case"mins":case"min":case"m":return r*sf;case"seconds":case"second":case"secs":case"sec":case"s":return r*nf;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return r;default:return}}}}function ehe(e){return e>=af?Math.round(e/af)+"d":e>=of?Math.round(e/of)+"h":e>=sf?Math.round(e/sf)+"m":e>=nf?Math.round(e/nf)+"s":e+"ms"}function the(e){return _m(e,af,"day")||_m(e,of,"hour")||_m(e,sf,"minute")||_m(e,nf,"second")||e+" ms"}function _m(e,t,r){if(!(e<t))return e<t*1.5?Math.floor(e/t)+" "+r:Math.ceil(e/t)+" "+r+"s"}});var q0=_((Re,ij)=>{Re=ij.exports=x0.debug=x0.default=x0;Re.coerce=ahe;Re.disable=she;Re.enable=ihe;Re.enabled=ohe;Re.humanize=nj();Re.instances=[];Re.names=[];Re.skips=[];Re.formatters={};function rhe(e){var t=0,r;for(r in e)t=(t<<5)-t+e.charCodeAt(r),t|=0;return Re.colors[Math.abs(t)%Re.colors.length]}function x0(e){var t;function r(){if(!!r.enabled){var n=r,i=+new Date,s=i-(t||i);n.diff=s,n.prev=t,n.curr=i,t=i;for(var o=new Array(arguments.length),a=0;a<o.length;a++)o[a]=arguments[a];o[0]=Re.coerce(o[0]),typeof o[0]!="string"&&o.unshift("%O");var u=0;o[0]=o[0].replace(/%([a-zA-Z%])/g,function(f,h){if(f==="%%")return f;u++;var d=Re.formatters[h];if(typeof d=="function"){var p=o[u];f=d.call(n,p),o.splice(u,1),u--}return f}),Re.formatArgs.call(n,o);var c=r.log||Re.log||console.log.bind(console);c.apply(n,o)}}return r.namespace=e,r.enabled=Re.enabled(e),r.useColors=Re.useColors(),r.color=rhe(e),r.destroy=nhe,typeof Re.init=="function"&&Re.init(r),Re.instances.push(r),r}function nhe(){var e=Re.instances.indexOf(this);return e!==-1?(Re.instances.splice(e,1),!0):!1}function ihe(e){Re.save(e),Re.names=[],Re.skips=[];var t,r=(typeof e=="string"?e:"").split(/[\s,]+/),n=r.length;for(t=0;t<n;t++)!r[t]||(e=r[t].replace(/\*/g,".*?"),e[0]==="-"?Re.skips.push(new RegExp("^"+e.substr(1)+"$")):Re.names.push(new RegExp("^"+e+"$")));for(t=0;t<Re.instances.length;t++){var i=Re.instances[t];i.enabled=Re.enabled(i.namespace)}}function she(){Re.enable("")}function ohe(e){if(e[e.length-1]==="*")return!0;var t,r;for(t=0,r=Re.skips.length;t<r;t++)if(Re.skips[t].test(e))return!1;for(t=0,r=Re.names.length;t<r;t++)if(Re.names[t].test(e))return!0;return!1}function ahe(e){return e instanceof Error?e.stack||e.message:e}});var aj=_((Vr,oj)=>{Vr=oj.exports=q0();Vr.log=lhe;Vr.formatArgs=che;Vr.save=fhe;Vr.load=sj;Vr.useColors=uhe;Vr.storage=typeof chrome<"u"&&typeof chrome.storage<"u"?chrome.storage.local:hhe();Vr.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function uhe(){return typeof window<"u"&&window.process&&window.process.type==="renderer"?!0:typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}Vr.formatters.j=function(e){try{return JSON.stringify(e)}catch(t){return"[UnexpectedJSONParseError]: "+t.message}};function che(e){var t=this.useColors;if(e[0]=(t?"%c":"")+this.namespace+(t?" %c":" ")+e[0]+(t?"%c ":" ")+"+"+Vr.humanize(this.diff),!!t){var r="color: "+this.color;e.splice(1,0,r,"color: inherit");var n=0,i=0;e[0].replace(/%[a-zA-Z%]/g,function(s){s!=="%%"&&(n++,s==="%c"&&(i=n))}),e.splice(i,0,r)}}function lhe(){return typeof console=="object"&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}function fhe(e){try{e==null?Vr.storage.removeItem("debug"):Vr.storage.debug=e}catch{}}function sj(){var e;try{e=Vr.storage.debug}catch{}return!e&&typeof process<"u"&&"env"in process&&(e=process.env.DEBUG),e}Vr.enable(sj());function hhe(){try{return window.localStorage}catch{}}});var cj=_((iqe,uj)=>{"use strict";uj.exports=(e,t=process.argv)=>{let r=e.startsWith("-")?"":e.length===1?"-":"--",n=t.indexOf(r+e),i=t.indexOf("--");return n!==-1&&(i===-1||n<i)}});var hj=_((sqe,fj)=>{"use strict";var dhe=require("os"),lj=require("tty"),Bn=cj(),{env:Xt}=process,wm;Bn("no-color")||Bn("no-colors")||Bn("color=false")||Bn("color=never")?wm=0:(Bn("color")||Bn("colors")||Bn("color=true")||Bn("color=always"))&&(wm=1);function phe(){if("FORCE_COLOR"in Xt)return Xt.FORCE_COLOR==="true"?1:Xt.FORCE_COLOR==="false"?0:Xt.FORCE_COLOR.length===0?1:Math.min(Number.parseInt(Xt.FORCE_COLOR,10),3)}function mhe(e){return e===0?!1:{level:e,hasBasic:!0,has256:e>=2,has16m:e>=3}}function yhe(e,{streamIsTTY:t,sniffFlags:r=!0}={}){let n=phe();n!==void 0&&(wm=n);let i=r?wm:n;if(i===0)return 0;if(r){if(Bn("color=16m")||Bn("color=full")||Bn("color=truecolor"))return 3;if(Bn("color=256"))return 2}if(e&&!t&&i===void 0)return 0;let s=i||0;if(Xt.TERM==="dumb")return s;if(process.platform==="win32"){let o=dhe.release().split(".");return Number(o[0])>=10&&Number(o[2])>=10586?Number(o[2])>=14931?3:2:1}if("CI"in Xt)return["TRAVIS","CIRCLECI","APPVEYOR","GITLAB_CI","GITHUB_ACTIONS","BUILDKITE","DRONE"].some(o=>o in Xt)||Xt.CI_NAME==="codeship"?1:s;if("TEAMCITY_VERSION"in Xt)return/^(9\.(0*[1-9]\d*)\.|\d{2,}\.)/.test(Xt.TEAMCITY_VERSION)?1:0;if(Xt.COLORTERM==="truecolor")return 3;if("TERM_PROGRAM"in Xt){let o=Number.parseInt((Xt.TERM_PROGRAM_VERSION||"").split(".")[0],10);switch(Xt.TERM_PROGRAM){case"iTerm.app":return o>=3?3:2;case"Apple_Terminal":return 2}}return/-256(color)?$/i.test(Xt.TERM)?2:/^screen|^xterm|^vt100|^vt220|^rxvt|color|ansi|cygwin|linux/i.test(Xt.TERM)||"COLORTERM"in Xt?1:s}function M0(e,t={}){let r=yhe(e,{streamIsTTY:e&&e.isTTY,...t});return mhe(r)}fj.exports={supportsColor:M0,stdout:M0({isTTY:lj.isatty(1)}),stderr:M0({isTTY:lj.isatty(2)})}});var mj=_((Kt,pj)=>{var ghe=require("tty"),vm=require("util");Kt=pj.exports=q0();Kt.init=bhe;Kt.log=She;Kt.formatArgs=whe;Kt.save=Ohe;Kt.load=dj;Kt.useColors=_he;Kt.colors=[6,2,3,4,5,1];try{N0=hj(),N0&&N0.level>=2&&(Kt.colors=[20,21,26,27,32,33,38,39,40,41,42,43,44,45,56,57,62,63,68,69,74,75,76,77,78,79,80,81,92,93,98,99,112,113,128,129,134,135,148,149,160,161,162,163,164,165,166,167,168,169,170,171,172,173,178,179,184,185,196,197,198,199,200,201,202,203,204,205,206,207,208,209,214,215,220,221])}catch{}var N0;Kt.inspectOpts=Object.keys(process.env).filter(function(e){return/^debug_/i.test(e)}).reduce(function(e,t){var r=t.substring(6).toLowerCase().replace(/_([a-z])/g,function(i,s){return s.toUpperCase()}),n=process.env[t];return/^(yes|on|true|enabled)$/i.test(n)?n=!0:/^(no|off|false|disabled)$/i.test(n)?n=!1:n==="null"?n=null:n=Number(n),e[r]=n,e},{});function _he(){return"colors"in Kt.inspectOpts?Boolean(Kt.inspectOpts.colors):ghe.isatty(process.stderr.fd)}Kt.formatters.o=function(e){return this.inspectOpts.colors=this.useColors,vm.inspect(e,this.inspectOpts).split(`
`).map(function(t){return t.trim()}).join(" ")};Kt.formatters.O=function(e){return this.inspectOpts.colors=this.useColors,vm.inspect(e,this.inspectOpts)};function whe(e){var t=this.namespace,r=this.useColors;if(r){var n=this.color,i="\x1B[3"+(n<8?n:"8;5;"+n),s="  "+i+";1m"+t+" \x1B[0m";e[0]=s+e[0].split(`
`).join(`
`+s),e.push(i+"m+"+Kt.humanize(this.diff)+"\x1B[0m")}else e[0]=vhe()+t+" "+e[0]}function vhe(){return Kt.inspectOpts.hideDate?"":new Date().toISOString()+" "}function She(){return process.stderr.write(vm.format.apply(vm,arguments)+`
`)}function Ohe(e){e==null?delete process.env.DEBUG:process.env.DEBUG=e}function dj(){return process.env.DEBUG}function bhe(e){e.inspectOpts={};for(var t=Object.keys(Kt.inspectOpts),r=0;r<t.length;r++)e.inspectOpts[t[r]]=Kt.inspectOpts[t[r]]}Kt.enable(dj())});var yj=_((oqe,$0)=>{typeof process>"u"||process.type==="renderer"?$0.exports=aj():$0.exports=mj()});var _j=_(gj=>{"use strict";var Qe=gj;Qe.distinct=function(e){if(e._fields&&Object.keys(e._fields).length>0)return"field selection and slice";var t=Object.keys(Qe.distinct),r;return t.every(function(n){return e.options[n]?(r=n,!1):!0}),r};Qe.distinct.select=Qe.distinct.slice=Qe.distinct.sort=Qe.distinct.limit=Qe.distinct.skip=Qe.distinct.batchSize=Qe.distinct.comment=Qe.distinct.maxScan=Qe.distinct.snapshot=Qe.distinct.hint=Qe.distinct.tailable=!0;Qe.findOneAndUpdate=Qe.findOneAndRemove=function(e){var t=Object.keys(Qe.findOneAndUpdate),r;return t.every(function(n){return e.options[n]?(r=n,!1):!0}),r};Qe.findOneAndUpdate.limit=Qe.findOneAndUpdate.skip=Qe.findOneAndUpdate.batchSize=Qe.findOneAndUpdate.maxScan=Qe.findOneAndUpdate.snapshot=Qe.findOneAndUpdate.hint=Qe.findOneAndUpdate.tailable=Qe.findOneAndUpdate.comment=!0;Qe.count=function(e){if(e._fields&&Object.keys(e._fields).length>0)return"field selection and slice";var t=Object.keys(Qe.count),r;return t.every(function(n){return e.options[n]?(r=n,!1):!0}),r};Qe.count.slice=Qe.count.batchSize=Qe.count.comment=Qe.count.maxScan=Qe.count.snapshot=Qe.count.tailable=!0});var P0=_((ei,wj)=>{"use strict";ei.isNode=typeof process<"u"&&typeof wj=="object"&&typeof global=="object"&&typeof Buffer=="function"&&process.argv;ei.isMongo=!ei.isNode&&typeof printjson=="function"&&typeof ObjectId=="function"&&typeof rs=="function"&&typeof sh=="function";ei.isBrowser=!ei.isNode&&!ei.isMongo&&typeof window<"u";ei.type=ei.isNode?"node":ei.isMongo?"mongo":ei.isBrowser?"browser":"unknown"});var uf=_((Sj,Oj)=>{"use strict";var R0=["find","findOne","update","updateMany","updateOne","replaceOne","remove","count","distinct","findAndModify","aggregate","findStream","deleteOne","deleteMany"];function D0(){}for(Sm=0,vj=R0.length;Sm<vj;++Sm)I0=R0[Sm],D0.prototype[I0]=Ehe(I0);var I0,Sm,vj;Oj.exports=Sj=D0;D0.methods=R0;function Ehe(e){return function(){throw new Error("collection."+e+" not implemented")}}});var Cj=_((bj,Ej)=>{"use strict";var Che=uf(),The=A0();function Tr(e){this.collection=e,this.collectionName=e.collectionName}The.inherits(Tr,Che);Tr.prototype.find=function(e,t,r){this.collection.find(e,t,function(n,i){if(n)return r(n);try{i.toArray(r)}catch(s){r(s)}})};Tr.prototype.findOne=function(e,t,r){this.collection.findOne(e,t,r)};Tr.prototype.count=function(e,t,r){this.collection.count(e,t,r)};Tr.prototype.distinct=function(e,t,r,n){this.collection.distinct(e,t,r,n)};Tr.prototype.update=function(e,t,r,n){this.collection.update(e,t,r,n)};Tr.prototype.updateMany=function(e,t,r,n){this.collection.updateMany(e,t,r,n)};Tr.prototype.updateOne=function(e,t,r,n){this.collection.updateOne(e,t,r,n)};Tr.prototype.replaceOne=function(e,t,r,n){this.collection.replaceOne(e,t,r,n)};Tr.prototype.deleteOne=function(e,t,r){this.collection.deleteOne(e,t,r)};Tr.prototype.deleteMany=function(e,t,r){this.collection.deleteMany(e,t,r)};Tr.prototype.remove=function(e,t,r){this.collection.remove(e,t,r)};Tr.prototype.findAndModify=function(e,t,r,n){var i=Array.isArray(r.sort)?r.sort:[];this.collection.findAndModify(e,i,t,r,n)};Tr.prototype.findStream=function(e,t,r){return this.collection.find(e,t).stream(r)};Tr.prototype.findCursor=function(e,t){return this.collection.find(e,t)};Ej.exports=bj=Tr});var Aj=_((uqe,Tj)=>{"use strict";var j0=P0();if(j0.type=="unknown")throw new Error("Unknown environment");Tj.exports=j0.isNode?Cj():j0.isMongo?uf():uf()});var ha=_((cqe,k0)=>{var B0=function(){"use strict";return this===void 0}();B0?k0.exports={freeze:Object.freeze,defineProperty:Object.defineProperty,getDescriptor:Object.getOwnPropertyDescriptor,keys:Object.keys,names:Object.getOwnPropertyNames,getPrototypeOf:Object.getPrototypeOf,isArray:Array.isArray,isES5:B0,propertyIsWritable:function(e,t){var r=Object.getOwnPropertyDescriptor(e,t);return!!(!r||r.writable||r.set)}}:(xj={}.hasOwnProperty,qj={}.toString,Mj={}.constructor.prototype,L0=function(e){var t=[];for(var r in e)xj.call(e,r)&&t.push(r);return t},Nj=function(e,t){return{value:e[t]}},$j=function(e,t,r){return e[t]=r.value,e},Pj=function(e){return e},Ij=function(e){try{return Object(e).constructor.prototype}catch{return Mj}},Rj=function(e){try{return qj.call(e)==="[object Array]"}catch{return!1}},k0.exports={isArray:Rj,keys:L0,names:L0,defineProperty:$j,getDescriptor:Nj,freeze:Pj,getPrototypeOf:Ij,isES5:B0,propertyIsWritable:function(){return!0}});var xj,qj,Mj,L0,Nj,$j,Pj,Ij,Rj});var at=_((exports,module)=>{"use strict";var es5=ha(),canEvaluate=typeof navigator>"u",errorObj={e:{}},tryCatchTarget,globalObject=typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:exports!==void 0?exports:null;function tryCatcher(){try{var e=tryCatchTarget;return tryCatchTarget=null,e.apply(this,arguments)}catch(t){return errorObj.e=t,errorObj}}function tryCatch(e){return tryCatchTarget=e,tryCatcher}var inherits=function(e,t){var r={}.hasOwnProperty;function n(){this.constructor=e,this.constructor$=t;for(var i in t.prototype)r.call(t.prototype,i)&&i.charAt(i.length-1)!=="$"&&(this[i+"$"]=t.prototype[i])}return n.prototype=t.prototype,e.prototype=new n,e.prototype};function isPrimitive(e){return e==null||e===!0||e===!1||typeof e=="string"||typeof e=="number"}function isObject(e){return typeof e=="function"||typeof e=="object"&&e!==null}function maybeWrapAsError(e){return isPrimitive(e)?new Error(safeToString(e)):e}function withAppended(e,t){var r=e.length,n=new Array(r+1),i;for(i=0;i<r;++i)n[i]=e[i];return n[i]=t,n}function getDataPropertyOrDefault(e,t,r){if(es5.isES5){var n=Object.getOwnPropertyDescriptor(e,t);if(n!=null)return n.get==null&&n.set==null?n.value:r}else return{}.hasOwnProperty.call(e,t)?e[t]:void 0}function notEnumerableProp(e,t,r){if(isPrimitive(e))return e;var n={value:r,configurable:!0,enumerable:!1,writable:!0};return es5.defineProperty(e,t,n),e}function thrower(e){throw e}var inheritedDataKeys=function(){var e=[Array.prototype,Object.prototype,Function.prototype],t=function(i){for(var s=0;s<e.length;++s)if(e[s]===i)return!0;return!1};if(es5.isES5){var r=Object.getOwnPropertyNames;return function(i){for(var s=[],o=Object.create(null);i!=null&&!t(i);){var a;try{a=r(i)}catch{return s}for(var u=0;u<a.length;++u){var c=a[u];if(!o[c]){o[c]=!0;var f=Object.getOwnPropertyDescriptor(i,c);f!=null&&f.get==null&&f.set==null&&s.push(c)}}i=es5.getPrototypeOf(i)}return s}}else{var n={}.hasOwnProperty;return function(i){if(t(i))return[];var s=[];e:for(var o in i)if(n.call(i,o))s.push(o);else{for(var a=0;a<e.length;++a)if(n.call(e[a],o))continue e;s.push(o)}return s}}}(),thisAssignmentPattern=/this\s*\.\s*\S+\s*=/;function isClass(e){try{if(typeof e=="function"){var t=es5.names(e.prototype),r=es5.isES5&&t.length>1,n=t.length>0&&!(t.length===1&&t[0]==="constructor"),i=thisAssignmentPattern.test(e+"")&&es5.names(e).length>0;if(r||n||i)return!0}return!1}catch{return!1}}function toFastProperties(obj){function FakeConstructor(){}FakeConstructor.prototype=obj;for(var l=8;l--;)new FakeConstructor;return obj}var rident=/^[a-z$_][a-z$_0-9]*$/i;function isIdentifier(e){return rident.test(e)}function filledRange(e,t,r){for(var n=new Array(e),i=0;i<e;++i)n[i]=t+i+r;return n}function safeToString(e){try{return e+""}catch{return"[no string representation]"}}function isError(e){return e instanceof Error||e!==null&&typeof e=="object"&&typeof e.message=="string"&&typeof e.name=="string"}function markAsOriginatingFromRejection(e){try{notEnumerableProp(e,"isOperational",!0)}catch{}}function originatesFromRejection(e){return e==null?!1:e instanceof Error.__BluebirdErrorTypes__.OperationalError||e.isOperational===!0}function canAttachTrace(e){return isError(e)&&es5.propertyIsWritable(e,"stack")}var ensureErrorObject=function(){return"stack"in new Error?function(e){return canAttachTrace(e)?e:new Error(safeToString(e))}:function(e){if(canAttachTrace(e))return e;try{throw new Error(safeToString(e))}catch(t){return t}}}();function classString(e){return{}.toString.call(e)}function copyDescriptors(e,t,r){for(var n=es5.names(e),i=0;i<n.length;++i){var s=n[i];if(r(s))try{es5.defineProperty(t,s,es5.getDescriptor(e,s))}catch{}}}var asArray=function(e){return es5.isArray(e)?e:null};typeof Symbol<"u"&&Symbol.iterator&&(ArrayFrom=typeof Array.from=="function"?function(e){return Array.from(e)}:function(e){for(var t=[],r=e[Symbol.iterator](),n;!(n=r.next()).done;)t.push(n.value);return t},asArray=function(e){return es5.isArray(e)?e:e!=null&&typeof e[Symbol.iterator]=="function"?ArrayFrom(e):null});var ArrayFrom,isNode=typeof process<"u"&&classString(process).toLowerCase()==="[object process]",hasEnvVariables=typeof process<"u"&&typeof process.env<"u";function env(e){return hasEnvVariables?process.env[e]:void 0}function getNativePromise(){if(typeof Promise=="function")try{var e=new Promise(function(){});if({}.toString.call(e)==="[object Promise]")return Promise}catch{}}function domainBind(e,t){return e.bind(t)}var ret={isClass,isIdentifier,inheritedDataKeys,getDataPropertyOrDefault,thrower,isArray:es5.isArray,asArray,notEnumerableProp,isPrimitive,isObject,isError,canEvaluate,errorObj,tryCatch,inherits,withAppended,maybeWrapAsError,toFastProperties,filledRange,toString:safeToString,canAttachTrace,ensureErrorObject,originatesFromRejection,markAsOriginatingFromRejection,classString,copyDescriptors,hasDevTools:typeof chrome<"u"&&chrome&&typeof chrome.loadTimes=="function",isNode,hasEnvVariables,env,global:globalObject,getNativePromise,domainBind};ret.isRecentNode=ret.isNode&&function(){var e=process.versions.node.split(".").map(Number);return e[0]===0&&e[1]>10||e[0]>0}();ret.isNode&&ret.toFastProperties(process);try{throw new Error}catch(e){ret.lastLineError=e}module.exports=ret});var kj=_((lqe,Lj)=>{"use strict";var U0=at(),da,Ahe=function(){throw new Error(`No async scheduler available

    See http://goo.gl/MqrFmX
`)},F0=U0.getNativePromise();U0.isNode&&typeof MutationObserver>"u"?(Dj=global.setImmediate,jj=process.nextTick,da=U0.isRecentNode?function(e){Dj.call(global,e)}:function(e){jj.call(process,e)}):typeof F0=="function"&&typeof F0.resolve=="function"?(Bj=F0.resolve(),da=function(e){Bj.then(e)}):typeof MutationObserver<"u"&&!(typeof window<"u"&&window.navigator&&(window.navigator.standalone||window.cordova))?da=function(){var e=document.createElement("div"),t={attributes:!0},r=!1,n=document.createElement("div"),i=new MutationObserver(function(){e.classList.toggle("foo"),r=!1});i.observe(n,t);var s=function(){r||(r=!0,n.classList.toggle("foo"))};return function(a){var u=new MutationObserver(function(){u.disconnect(),a()});u.observe(e,t),s()}}():typeof setImmediate<"u"?da=function(e){setImmediate(e)}:typeof setTimeout<"u"?da=function(e){setTimeout(e,0)}:da=Ahe;var Dj,jj,Bj;Lj.exports=da});var Uj=_((fqe,Fj)=>{"use strict";function xhe(e,t,r,n,i){for(var s=0;s<i;++s)r[s+n]=e[s+t],e[s+t]=void 0}function uo(e){this._capacity=e,this._length=0,this._front=0}uo.prototype._willBeOverCapacity=function(e){return this._capacity<e};uo.prototype._pushOne=function(e){var t=this.length();this._checkCapacity(t+1);var r=this._front+t&this._capacity-1;this[r]=e,this._length=t+1};uo.prototype.push=function(e,t,r){var n=this.length()+3;if(this._willBeOverCapacity(n)){this._pushOne(e),this._pushOne(t),this._pushOne(r);return}var i=this._front+n-3;this._checkCapacity(n);var s=this._capacity-1;this[i+0&s]=e,this[i+1&s]=t,this[i+2&s]=r,this._length=n};uo.prototype.shift=function(){var e=this._front,t=this[e];return this[e]=void 0,this._front=e+1&this._capacity-1,this._length--,t};uo.prototype.length=function(){return this._length};uo.prototype._checkCapacity=function(e){this._capacity<e&&this._resizeTo(this._capacity<<1)};uo.prototype._resizeTo=function(e){var t=this._capacity;this._capacity=e;var r=this._front,n=this._length,i=r+n&t-1;xhe(this,0,this,t,i)};Fj.exports=uo});var Qj=_((hqe,V0)=>{"use strict";var Kj;try{throw new Error}catch(e){Kj=e}var qhe=kj(),Vj=Uj(),Gj=at();function Zt(){this._customScheduler=!1,this._isTickUsed=!1,this._lateQueue=new Vj(16),this._normalQueue=new Vj(16),this._haveDrainedQueues=!1,this._trampolineEnabled=!0;var e=this;this.drainQueues=function(){e._drainQueues()},this._schedule=qhe}Zt.prototype.setScheduler=function(e){var t=this._schedule;return this._schedule=e,this._customScheduler=!0,t};Zt.prototype.hasCustomScheduler=function(){return this._customScheduler};Zt.prototype.enableTrampoline=function(){this._trampolineEnabled=!0};Zt.prototype.disableTrampolineIfNecessary=function(){Gj.hasDevTools&&(this._trampolineEnabled=!1)};Zt.prototype.haveItemsQueued=function(){return this._isTickUsed||this._haveDrainedQueues};Zt.prototype.fatalError=function(e,t){t?(process.stderr.write("Fatal "+(e instanceof Error?e.stack:e)+`
`),process.exit(2)):this.throwLater(e)};Zt.prototype.throwLater=function(e,t){if(arguments.length===1&&(t=e,e=function(){throw t}),typeof setTimeout<"u")setTimeout(function(){e(t)},0);else try{this._schedule(function(){e(t)})}catch{throw new Error(`No async scheduler available

    See http://goo.gl/MqrFmX
`)}};function Wj(e,t,r){this._lateQueue.push(e,t,r),this._queueTick()}function zj(e,t,r){this._normalQueue.push(e,t,r),this._queueTick()}function Hj(e){this._normalQueue._pushOne(e),this._queueTick()}Gj.hasDevTools?(Zt.prototype.invokeLater=function(e,t,r){this._trampolineEnabled?Wj.call(this,e,t,r):this._schedule(function(){setTimeout(function(){e.call(t,r)},100)})},Zt.prototype.invoke=function(e,t,r){this._trampolineEnabled?zj.call(this,e,t,r):this._schedule(function(){e.call(t,r)})},Zt.prototype.settlePromises=function(e){this._trampolineEnabled?Hj.call(this,e):this._schedule(function(){e._settlePromises()})}):(Zt.prototype.invokeLater=Wj,Zt.prototype.invoke=zj,Zt.prototype.settlePromises=Hj);Zt.prototype._drainQueue=function(e){for(;e.length()>0;){var t=e.shift();if(typeof t!="function"){t._settlePromises();continue}var r=e.shift(),n=e.shift();t.call(r,n)}};Zt.prototype._drainQueues=function(){this._drainQueue(this._normalQueue),this._reset(),this._haveDrainedQueues=!0,this._drainQueue(this._lateQueue)};Zt.prototype._queueTick=function(){this._isTickUsed||(this._isTickUsed=!0,this._schedule(this.drainQueues))};Zt.prototype._reset=function(){this._isTickUsed=!1};V0.exports=Zt;V0.exports.firstLineError=Kj});var ys=_((dqe,Xj)=>{"use strict";var H0=ha(),Mhe=H0.freeze,Yj=at(),Jj=Yj.inherits,Vu=Yj.notEnumerableProp;function Wu(e,t){function r(n){if(!(this instanceof r))return new r(n);Vu(this,"message",typeof n=="string"?n:t),Vu(this,"name",e),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):Error.call(this)}return Jj(r,Error),r}var W0,z0,Nhe=Wu("Warning","warning"),$he=Wu("CancellationError","cancellation error"),Phe=Wu("TimeoutError","timeout error"),lf=Wu("AggregateError","aggregate error");try{W0=TypeError,z0=RangeError}catch{W0=Wu("TypeError","type error"),z0=Wu("RangeError","range error")}var Om="join pop push shift unshift slice filter forEach some every map indexOf lastIndexOf reduce reduceRight sort reverse".split(" ");for(Uu=0;Uu<Om.length;++Uu)typeof Array.prototype[Om[Uu]]=="function"&&(lf.prototype[Om[Uu]]=Array.prototype[Om[Uu]]);var Uu;H0.defineProperty(lf.prototype,"length",{value:0,configurable:!1,writable:!0,enumerable:!0});lf.prototype.isOperational=!0;var bm=0;lf.prototype.toString=function(){var e=Array(bm*4+1).join(" "),t=`
`+e+`AggregateError of:
`;bm++,e=Array(bm*4+1).join(" ");for(var r=0;r<this.length;++r){for(var n=this[r]===this?"[Circular AggregateError]":this[r]+"",i=n.split(`
`),s=0;s<i.length;++s)i[s]=e+i[s];n=i.join(`
`),t+=n+`
`}return bm--,t};function cf(e){if(!(this instanceof cf))return new cf(e);Vu(this,"name","OperationalError"),Vu(this,"message",e),this.cause=e,this.isOperational=!0,e instanceof Error?(Vu(this,"message",e.message),Vu(this,"stack",e.stack)):Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)}Jj(cf,Error);var pa=Error.__BluebirdErrorTypes__;pa||(pa=Mhe({CancellationError:$he,TimeoutError:Phe,OperationalError:cf,RejectionError:cf,AggregateError:lf}),H0.defineProperty(Error,"__BluebirdErrorTypes__",{value:pa,writable:!1,enumerable:!1,configurable:!1}));Xj.exports={Error,TypeError:W0,RangeError:z0,CancellationError:pa.CancellationError,OperationalError:pa.OperationalError,TimeoutError:pa.TimeoutError,AggregateError:pa.AggregateError,Warning:Nhe}});var eB=_((pqe,Zj)=>{"use strict";Zj.exports=function(e,t){var r=at(),n=r.errorObj,i=r.isObject;function s(h,d){if(i(h)){if(h instanceof e)return h;var p=a(h);if(p===n){d&&d._pushContext();var m=e.reject(p.e);return d&&d._popContext(),m}else if(typeof p=="function"){if(c(h)){var m=new e(t);return h._then(m._fulfill,m._reject,void 0,m,null),m}return f(h,p,d)}}return h}function o(h){return h.then}function a(h){try{return o(h)}catch(d){return n.e=d,n}}var u={}.hasOwnProperty;function c(h){try{return u.call(h,"_promise0")}catch{return!1}}function f(h,d,p){var m=new e(t),y=m;p&&p._pushContext(),m._captureStackTrace(),p&&p._popContext();var g=!0,w=r.tryCatch(d).call(h,S,v);g=!1,m&&w===n&&(m._rejectCallback(w.e,!0,!0),m=null);function S(E){!m||(m._resolveCallback(E),m=null)}function v(E){!m||(m._rejectCallback(E,g,!0),m=null)}return y}return s}});var rB=_((mqe,tB)=>{"use strict";tB.exports=function(e,t,r,n,i){var s=at(),o=s.isArray;function a(c){switch(c){case-2:return[];case-3:return{};case-6:return new Map}}function u(c){var f=this._promise=new e(t);c instanceof e&&f._propagateFrom(c,3),f._setOnCancel(this),this._values=c,this._length=0,this._totalResolved=0,this._init(void 0,-2)}return s.inherits(u,i),u.prototype.length=function(){return this._length},u.prototype.promise=function(){return this._promise},u.prototype._init=function c(f,h){var d=r(this._values,this._promise);if(d instanceof e){d=d._target();var p=d._bitField;if(this._values=d,(p&50397184)===0)return this._promise._setAsyncGuaranteed(),d._then(c,this._reject,void 0,this,h);if((p&33554432)!==0)d=d._value();else return(p&16777216)!==0?this._reject(d._reason()):this._cancel()}if(d=s.asArray(d),d===null){var m=n("expecting an array or an iterable object but got "+s.classString(d)).reason();this._promise._rejectCallback(m,!1);return}if(d.length===0){h===-5?this._resolveEmptyArray():this._resolve(a(h));return}this._iterate(d)},u.prototype._iterate=function(c){var f=this.getActualLength(c.length);this._length=f,this._values=this.shouldCopyValues()?new Array(f):this._values;for(var h=this._promise,d=!1,p=null,m=0;m<f;++m){var y=r(c[m],h);y instanceof e?(y=y._target(),p=y._bitField):p=null,d?p!==null&&y.suppressUnhandledRejections():p!==null?(p&50397184)===0?(y._proxy(this,m),this._values[m]=y):(p&33554432)!==0?d=this._promiseFulfilled(y._value(),m):(p&16777216)!==0?d=this._promiseRejected(y._reason(),m):d=this._promiseCancelled(m):d=this._promiseFulfilled(y,m)}d||h._setAsyncGuaranteed()},u.prototype._isResolved=function(){return this._values===null},u.prototype._resolve=function(c){this._values=null,this._promise._fulfill(c)},u.prototype._cancel=function(){this._isResolved()||!this._promise._isCancellable()||(this._values=null,this._promise._cancel())},u.prototype._reject=function(c){this._values=null,this._promise._rejectCallback(c,!1)},u.prototype._promiseFulfilled=function(c,f){this._values[f]=c;var h=++this._totalResolved;return h>=this._length?(this._resolve(this._values),!0):!1},u.prototype._promiseCancelled=function(){return this._cancel(),!0},u.prototype._promiseRejected=function(c){return this._totalResolved++,this._reject(c),!0},u.prototype._resultCancelled=function(){if(!this._isResolved()){var c=this._values;if(this._cancel(),c instanceof e)c.cancel();else for(var f=0;f<c.length;++f)c[f]instanceof e&&c[f].cancel()}},u.prototype.shouldCopyValues=function(){return!0},u.prototype.getActualLength=function(c){return c},u}});var iB=_((yqe,nB)=>{"use strict";nB.exports=function(e){var t=!1,r=[];e.prototype._promiseCreated=function(){},e.prototype._pushContext=function(){},e.prototype._popContext=function(){return null},e._peekContext=e.prototype._peekContext=function(){};function n(){this._trace=new n.CapturedTrace(s())}n.prototype._pushContext=function(){this._trace!==void 0&&(this._trace._promiseCreated=null,r.push(this._trace))},n.prototype._popContext=function(){if(this._trace!==void 0){var o=r.pop(),a=o._promiseCreated;return o._promiseCreated=null,a}return null};function i(){if(t)return new n}function s(){var o=r.length-1;if(o>=0)return r[o]}return n.CapturedTrace=null,n.create=i,n.deactivateLongStackTraces=function(){},n.activateLongStackTraces=function(){var o=e.prototype._pushContext,a=e.prototype._popContext,u=e._peekContext,c=e.prototype._peekContext,f=e.prototype._promiseCreated;n.deactivateLongStackTraces=function(){e.prototype._pushContext=o,e.prototype._popContext=a,e._peekContext=u,e.prototype._peekContext=c,e.prototype._promiseCreated=f,t=!1},t=!0,e.prototype._pushContext=n.prototype._pushContext,e.prototype._popContext=n.prototype._popContext,e._peekContext=e.prototype._peekContext=s,e.prototype._promiseCreated=function(){var h=this._peekContext();h&&h._promiseCreated==null&&(h._promiseCreated=this)}},n}});var oB=_((gqe,sB)=>{"use strict";sB.exports=function(e,t){var r=e._getDomain,n=e._async,i=ys().Warning,s=at(),o=s.canAttachTrace,a,u,c=/[\\\/]bluebird[\\\/]js[\\\/](release|debug|instrumented)/,f=/\((?:timers\.js):\d+:\d+\)/,h=/[\/<\(](.+?):(\d+):(\d+)\)?\s*$/,d=null,p=null,m=!1,y,g=!!(s.env("BLUEBIRD_DEBUG")!=0&&(s.env("BLUEBIRD_DEBUG")||s.env("NODE_ENV")==="development")),w=!!(s.env("BLUEBIRD_WARNINGS")!=0&&(g||s.env("BLUEBIRD_WARNINGS"))),S=!!(s.env("BLUEBIRD_LONG_STACK_TRACES")!=0&&(g||s.env("BLUEBIRD_LONG_STACK_TRACES"))),v=s.env("BLUEBIRD_W_FORGOTTEN_RETURN")!=0&&(w||!!s.env("BLUEBIRD_W_FORGOTTEN_RETURN"));e.prototype.suppressUnhandledRejections=function(){var M=this._target();M._bitField=M._bitField&-1048577|524288},e.prototype._ensurePossibleRejectionHandled=function(){if((this._bitField&524288)===0){this._setRejectionIsUnhandled();var M=this;setTimeout(function(){M._notifyUnhandledRejection()},1)}},e.prototype._notifyUnhandledRejectionIsHandled=function(){Di("rejectionHandled",a,void 0,this)},e.prototype._setReturnedNonUndefined=function(){this._bitField=this._bitField|268435456},e.prototype._returnedNonUndefined=function(){return(this._bitField&268435456)!==0},e.prototype._notifyUnhandledRejection=function(){if(this._isRejectionUnhandled()){var M=this._settledValue();this._setUnhandledRejectionIsNotified(),Di("unhandledRejection",u,M,this)}},e.prototype._setUnhandledRejectionIsNotified=function(){this._bitField=this._bitField|262144},e.prototype._unsetUnhandledRejectionIsNotified=function(){this._bitField=this._bitField&-262145},e.prototype._isUnhandledRejectionNotified=function(){return(this._bitField&262144)>0},e.prototype._setRejectionIsUnhandled=function(){this._bitField=this._bitField|1048576},e.prototype._unsetRejectionIsUnhandled=function(){this._bitField=this._bitField&-1048577,this._isUnhandledRejectionNotified()&&(this._unsetUnhandledRejectionIsNotified(),this._notifyUnhandledRejectionIsHandled())},e.prototype._isRejectionUnhandled=function(){return(this._bitField&1048576)>0},e.prototype._warn=function(M,D,J){return _t(M,D,J||this)},e.onPossiblyUnhandledRejection=function(M){var D=r();u=typeof M=="function"?D===null?M:s.domainBind(D,M):void 0},e.onUnhandledRejectionHandled=function(M){var D=r();a=typeof M=="function"?D===null?M:s.domainBind(D,M):void 0};var E=function(){};e.longStackTraces=function(){if(n.haveItemsQueued()&&!vt.longStackTraces)throw new Error(`cannot enable long stack traces after promises have been created

    See http://goo.gl/MqrFmX
`);if(!vt.longStackTraces&&xs()){var M=e.prototype._captureStackTrace,D=e.prototype._attachExtraTrace;vt.longStackTraces=!0,E=function(){if(n.haveItemsQueued()&&!vt.longStackTraces)throw new Error(`cannot enable long stack traces after promises have been created

    See http://goo.gl/MqrFmX
`);e.prototype._captureStackTrace=M,e.prototype._attachExtraTrace=D,t.deactivateLongStackTraces(),n.enableTrampoline(),vt.longStackTraces=!1},e.prototype._captureStackTrace=ee,e.prototype._attachExtraTrace=X,t.activateLongStackTraces(),n.disableTrampolineIfNecessary()}},e.hasLongStackTraces=function(){return vt.longStackTraces&&xs()};var A=function(){try{if(typeof CustomEvent=="function"){var M=new CustomEvent("CustomEvent");return s.global.dispatchEvent(M),function(D,J){var te=new CustomEvent(D.toLowerCase(),{detail:J,cancelable:!0});return!s.global.dispatchEvent(te)}}else if(typeof Event=="function"){var M=new Event("CustomEvent");return s.global.dispatchEvent(M),function(J,te){var de=new Event(J.toLowerCase(),{cancelable:!0});return de.detail=te,!s.global.dispatchEvent(de)}}else{var M=document.createEvent("CustomEvent");return M.initCustomEvent("testingtheevent",!1,!0,{}),s.global.dispatchEvent(M),function(J,te){var de=document.createEvent("CustomEvent");return de.initCustomEvent(J.toLowerCase(),!1,!0,te),!s.global.dispatchEvent(de)}}}catch{}return function(){return!1}}(),x=function(){return s.isNode?function(){return process.emit.apply(process,arguments)}:s.global?function(M){var D="on"+M.toLowerCase(),J=s.global[D];return J?(J.apply(s.global,[].slice.call(arguments,1)),!0):!1}:function(){return!1}}();function z(M,D){return{promise:D}}var k={promiseCreated:z,promiseFulfilled:z,promiseRejected:z,promiseResolved:z,promiseCancelled:z,promiseChained:function(M,D,J){return{promise:D,child:J}},warning:function(M,D){return{warning:D}},unhandledRejection:function(M,D,J){return{reason:D,promise:J}},rejectionHandled:z},P=function(M){var D=!1;try{D=x.apply(null,arguments)}catch(te){n.throwLater(te),D=!0}var J=!1;try{J=A(M,k[M].apply(null,arguments))}catch(te){n.throwLater(te),J=!0}return J||D};e.config=function(M){if(M=Object(M),"longStackTraces"in M&&(M.longStackTraces?e.longStackTraces():!M.longStackTraces&&e.hasLongStackTraces()&&E()),"warnings"in M){var D=M.warnings;vt.warnings=!!D,v=vt.warnings,s.isObject(D)&&"wForgottenReturn"in D&&(v=!!D.wForgottenReturn)}if("cancellation"in M&&M.cancellation&&!vt.cancellation){if(n.haveItemsQueued())throw new Error("cannot enable cancellation after promises are in use");e.prototype._clearCancellationData=K,e.prototype._propagateFrom=C,e.prototype._onCancel=q,e.prototype._setOnCancel=I,e.prototype._attachCancellationCallback=b,e.prototype._execute=F,j=C,vt.cancellation=!0}return"monitoring"in M&&(M.monitoring&&!vt.monitoring?(vt.monitoring=!0,e.prototype._fireEvent=P):!M.monitoring&&vt.monitoring&&(vt.monitoring=!1,e.prototype._fireEvent=Z)),e};function Z(){return!1}e.prototype._fireEvent=Z,e.prototype._execute=function(M,D,J){try{M(D,J)}catch(te){return te}},e.prototype._onCancel=function(){},e.prototype._setOnCancel=function(M){},e.prototype._attachCancellationCallback=function(M){},e.prototype._captureStackTrace=function(){},e.prototype._attachExtraTrace=function(){},e.prototype._clearCancellationData=function(){},e.prototype._propagateFrom=function(M,D){};function F(M,D,J){var te=this;try{M(D,J,function(de){if(typeof de!="function")throw new TypeError("onCancel must be a function, got: "+s.toString(de));te._attachCancellationCallback(de)})}catch(de){return de}}function b(M){if(!this._isCancellable())return this;var D=this._onCancel();D!==void 0?s.isArray(D)?D.push(M):this._setOnCancel([D,M]):this._setOnCancel(M)}function q(){return this._onCancelField}function I(M){this._onCancelField=M}function K(){this._cancellationParent=void 0,this._onCancelField=void 0}function C(M,D){if((D&1)!==0){this._cancellationParent=M;var J=M._branchesRemainingToCancel;J===void 0&&(J=0),M._branchesRemainingToCancel=J+1}(D&2)!==0&&M._isBound()&&this._setBoundTo(M._boundTo)}function R(M,D){(D&2)!==0&&M._isBound()&&this._setBoundTo(M._boundTo)}var j=R;function H(){var M=this._boundTo;return M!==void 0&&M instanceof e?M.isFulfilled()?M.value():void 0:M}function ee(){this._trace=new Tn(this._peekContext())}function X(M,D){if(o(M)){var J=this._trace;if(J!==void 0&&D&&(J=J._parent),J!==void 0)J.attachExtraTrace(M);else if(!M.__stackCleaned__){var te=dt(M);s.notEnumerableProp(M,"stack",te.message+`
`+te.stack.join(`
`)),s.notEnumerableProp(M,"__stackCleaned__",!0)}}}function Se(M,D,J,te,de){if(M===void 0&&D!==null&&v){if(de!==void 0&&de._returnedNonUndefined()||(te._bitField&65535)===0)return;J&&(J=J+" ");var pt="",tt="";if(D._trace){for(var O=D._trace.stack.split(`
`),T=et(O),$=T.length-1;$>=0;--$){var U=T[$];if(!f.test(U)){var re=U.match(h);re&&(pt="at "+re[1]+":"+re[2]+":"+re[3]+" ");break}}if(T.length>0){for(var ke=T[0],$=0;$<O.length;++$)if(O[$]===ke){$>0&&(tt=`
`+O[$-1]);break}}}var Fe="a promise was created in a "+J+"handler "+pt+"but was not returned from it, see http://goo.gl/rRqMUw"+tt;te._warn(Fe,!0,D)}}function Me(M,D){var J=M+" is deprecated and will be removed in a future version.";return D&&(J+=" Use "+D+" instead."),_t(J)}function _t(M,D,J){if(!!vt.warnings){var te=new i(M),de;if(D)J._attachExtraTrace(te);else if(vt.longStackTraces&&(de=e._peekContext()))de.attachExtraTrace(te);else{var pt=dt(te);te.stack=pt.message+`
`+pt.stack.join(`
`)}P("warning",te)||ci(te,"",!0)}}function Ge(M,D){for(var J=0;J<D.length-1;++J)D[J].push("From previous event:"),D[J]=D[J].join(`
`);return J<D.length&&(D[J]=D[J].join(`
`)),M+`
`+D.join(`
`)}function le(M){for(var D=0;D<M.length;++D)(M[D].length===0||D+1<M.length&&M[D][0]===M[D+1][0])&&(M.splice(D,1),D--)}function ve(M){for(var D=M[0],J=1;J<M.length;++J){for(var te=M[J],de=D.length-1,pt=D[de],tt=-1,O=te.length-1;O>=0;--O)if(te[O]===pt){tt=O;break}for(var O=tt;O>=0;--O){var T=te[O];if(D[de]===T)D.pop(),de--;else break}D=te}}function et(M){for(var D=[],J=0;J<M.length;++J){var te=M[J],de=te==="    (No stack trace)"||d.test(te),pt=de&&Bi(te);de&&!pt&&(m&&te.charAt(0)!==" "&&(te="    "+te),D.push(te))}return D}function wt(M){for(var D=M.stack.replace(/\s+$/g,"").split(`
`),J=0;J<D.length;++J){var te=D[J];if(te==="    (No stack trace)"||d.test(te))break}return J>0&&M.name!="SyntaxError"&&(D=D.slice(J)),D}function dt(M){var D=M.stack,J=M.toString();return D=typeof D=="string"&&D.length>0?wt(M):["    (No stack trace)"],{message:J,stack:M.name=="SyntaxError"?D:et(D)}}function ci(M,D,J){if(typeof console<"u"){var te;if(s.isObject(M)){var de=M.stack;te=D+p(de,M)}else te=D+String(M);typeof y=="function"?y(te,J):(typeof console.log=="function"||typeof console.log=="object")&&console.log(te)}}function Di(M,D,J,te){var de=!1;try{typeof D=="function"&&(de=!0,M==="rejectionHandled"?D(te):D(J,te))}catch(pt){n.throwLater(pt)}M==="unhandledRejection"?!P(M,J,te)&&!de&&ci(J,"Unhandled rejection "):P(M,te)}function ji(M){var D;if(typeof M=="function")D="[function "+(M.name||"anonymous")+"]";else{D=M&&typeof M.toString=="function"?M.toString():s.toString(M);var J=/\[object [a-zA-Z0-9$_]+\]/;if(J.test(D))try{var te=JSON.stringify(M);D=te}catch{}D.length===0&&(D="(empty array)")}return"(<"+As(D)+">, no stack trace)"}function As(M){var D=41;return M.length<D?M:M.substr(0,D-3)+"..."}function xs(){return typeof ki=="function"}var Bi=function(){return!1},To=/[\/<\(]([^:\/]+):(\d+):(?:\d+)\)?\s*$/;function Li(M){var D=M.match(To);if(D)return{fileName:D[1],line:parseInt(D[2],10)}}function ja(M,D){if(!!xs()){for(var J=M.stack.split(`
`),te=D.stack.split(`
`),de=-1,pt=-1,tt,O,T=0;T<J.length;++T){var $=Li(J[T]);if($){tt=$.fileName,de=$.line;break}}for(var T=0;T<te.length;++T){var $=Li(te[T]);if($){O=$.fileName,pt=$.line;break}}de<0||pt<0||!tt||!O||tt!==O||de>=pt||(Bi=function(U){if(c.test(U))return!0;var re=Li(U);return!!(re&&re.fileName===tt&&de<=re.line&&re.line<=pt)})}}function Tn(M){this._parent=M,this._promisesCreated=0;var D=this._length=1+(M===void 0?0:M._length);ki(this,Tn),D>32&&this.uncycle()}s.inherits(Tn,Error),t.CapturedTrace=Tn,Tn.prototype.uncycle=function(){var M=this._length;if(!(M<2)){for(var D=[],J={},te=0,de=this;de!==void 0;++te)D.push(de),de=de._parent;M=this._length=te;for(var te=M-1;te>=0;--te){var pt=D[te].stack;J[pt]===void 0&&(J[pt]=te)}for(var te=0;te<M;++te){var tt=D[te].stack,O=J[tt];if(O!==void 0&&O!==te){O>0&&(D[O-1]._parent=void 0,D[O-1]._length=1),D[te]._parent=void 0,D[te]._length=1;var T=te>0?D[te-1]:this;O<M-1?(T._parent=D[O+1],T._parent.uncycle(),T._length=T._parent._length+1):(T._parent=void 0,T._length=1);for(var $=T._length+1,U=te-2;U>=0;--U)D[U]._length=$,$++;return}}}},Tn.prototype.attachExtraTrace=function(M){if(!M.__stackCleaned__){this.uncycle();for(var D=dt(M),J=D.message,te=[D.stack],de=this;de!==void 0;)te.push(et(de.stack.split(`
`))),de=de._parent;ve(te),le(te),s.notEnumerableProp(M,"stack",Ge(J,te)),s.notEnumerableProp(M,"__stackCleaned__",!0)}};var ki=function(){var D=/^\s*at\s*/,J=function(tt,O){return typeof tt=="string"?tt:O.name!==void 0&&O.message!==void 0?O.toString():ji(O)};if(typeof Error.stackTraceLimit=="number"&&typeof Error.captureStackTrace=="function"){Error.stackTraceLimit+=6,d=D,p=J;var te=Error.captureStackTrace;return Bi=function(tt){return c.test(tt)},function(tt,O){Error.stackTraceLimit+=6,te(tt,O),Error.stackTraceLimit-=6}}var de=new Error;if(typeof de.stack=="string"&&de.stack.split(`
`)[0].indexOf("stackDetection@")>=0)return d=/@/,p=J,m=!0,function(O){O.stack=new Error().stack};var pt;try{throw new Error}catch(tt){pt="stack"in tt}return!("stack"in de)&&pt&&typeof Error.stackTraceLimit=="number"?(d=D,p=J,function(O){Error.stackTraceLimit+=6;try{throw new Error}catch(T){O.stack=T.stack}Error.stackTraceLimit-=6}):(p=function(tt,O){return typeof tt=="string"?tt:(typeof O=="object"||typeof O=="function")&&O.name!==void 0&&O.message!==void 0?O.toString():ji(O)},null)}([]);typeof console<"u"&&typeof console.warn<"u"&&(y=function(M){console.warn(M)},s.isNode&&process.stderr.isTTY?y=function(M,D){var J=D?"\x1B[33m":"\x1B[31m";console.warn(J+M+`\x1B[0m
`)}:!s.isNode&&typeof new Error().stack=="string"&&(y=function(M,D){console.warn("%c"+M,D?"color: darkorange":"color: red")}));var vt={warnings:w,longStackTraces:!1,cancellation:!1,monitoring:!1};return S&&e.longStackTraces(),{longStackTraces:function(){return vt.longStackTraces},warnings:function(){return vt.warnings},cancellation:function(){return vt.cancellation},monitoring:function(){return vt.monitoring},propagateFromFunction:function(){return j},boundValueFunction:function(){return H},checkForgottenReturns:Se,setBounds:ja,warn:_t,deprecated:Me,CapturedTrace:Tn,fireDomEvent:A,fireGlobalEvent:x}}});var K0=_((_qe,aB)=>{"use strict";aB.exports=function(e){var t=at(),r=ha().keys,n=t.tryCatch,i=t.errorObj;function s(o,a,u){return function(c){var f=u._boundValue();e:for(var h=0;h<o.length;++h){var d=o[h];if(d===Error||d!=null&&d.prototype instanceof Error){if(c instanceof d)return n(a).call(f,c)}else if(typeof d=="function"){var p=n(d).call(f,c);if(p===i)return p;if(p)return n(a).call(f,c)}else if(t.isObject(c)){for(var m=r(d),y=0;y<m.length;++y){var g=m[y];if(d[g]!=c[g])continue e}return n(a).call(f,c)}}return e}}return s}});var cB=_((wqe,uB)=>{"use strict";uB.exports=function(e,t,r){var n=at(),i=e.CancellationError,s=n.errorObj,o=K0()(r);function a(p,m,y){this.promise=p,this.type=m,this.handler=y,this.called=!1,this.cancelPromise=null}a.prototype.isFinallyHandler=function(){return this.type===0};function u(p){this.finallyHandler=p}u.prototype._resultCancelled=function(){c(this.finallyHandler)};function c(p,m){return p.cancelPromise!=null?(arguments.length>1?p.cancelPromise._reject(m):p.cancelPromise._cancel(),p.cancelPromise=null,!0):!1}function f(){return d.call(this,this.promise._target()._settledValue())}function h(p){if(!c(this,p))return s.e=p,s}function d(p){var m=this.promise,y=this.handler;if(!this.called){this.called=!0;var g=this.isFinallyHandler()?y.call(m._boundValue()):y.call(m._boundValue(),p);if(g===r)return g;if(g!==void 0){m._setReturnedNonUndefined();var w=t(g,m);if(w instanceof e){if(this.cancelPromise!=null)if(w._isCancelled()){var S=new i("late cancellation observer");return m._attachExtraTrace(S),s.e=S,s}else w.isPending()&&w._attachCancellationCallback(new u(this));return w._then(f,h,void 0,this,void 0)}}}return m.isRejected()?(c(this),s.e=p,s):(c(this),p)}return e.prototype._passThrough=function(p,m,y,g){return typeof p!="function"?this.then():this._then(y,g,void 0,new a(this,m,p),void 0)},e.prototype.lastly=e.prototype.finally=function(p){return this._passThrough(p,0,d,d)},e.prototype.tap=function(p){return this._passThrough(p,1,d)},e.prototype.tapCatch=function(p){var m=arguments.length;if(m===1)return this._passThrough(p,1,void 0,d);var y=new Array(m-1),g=0,w;for(w=0;w<m-1;++w){var S=arguments[w];if(n.isObject(S))y[g++]=S;else return e.reject(new TypeError("tapCatch statement predicate: expecting an object but got "+n.classString(S)))}y.length=g;var v=arguments[w];return this._passThrough(o(y,v,this),1,void 0,d)},a}});var G0=_((vqe,hB)=>{"use strict";var lB=at(),Ihe=lB.maybeWrapAsError,Rhe=ys(),Dhe=Rhe.OperationalError,fB=ha();function jhe(e){return e instanceof Error&&fB.getPrototypeOf(e)===Error.prototype}var Bhe=/^(?:name|message|stack|cause)$/;function Lhe(e){var t;if(jhe(e)){t=new Dhe(e),t.name=e.name,t.message=e.message,t.stack=e.stack;for(var r=fB.keys(e),n=0;n<r.length;++n){var i=r[n];Bhe.test(i)||(t[i]=e[i])}return t}return lB.markAsOriginatingFromRejection(e),e}function khe(e,t){return function(r,n){if(e!==null){if(r){var i=Lhe(Ihe(r));e._attachExtraTrace(i),e._reject(i)}else if(!t)e._fulfill(n);else{for(var s=arguments.length,o=new Array(Math.max(s-1,0)),a=1;a<s;++a)o[a-1]=arguments[a];e._fulfill(o)}e=null}}}hB.exports=khe});var pB=_((Sqe,dB)=>{"use strict";dB.exports=function(e,t,r,n,i){var s=at(),o=s.tryCatch;e.method=function(a){if(typeof a!="function")throw new e.TypeError("expecting a function but got "+s.classString(a));return function(){var u=new e(t);u._captureStackTrace(),u._pushContext();var c=o(a).apply(this,arguments),f=u._popContext();return i.checkForgottenReturns(c,f,"Promise.method",u),u._resolveFromSyncValue(c),u}},e.attempt=e.try=function(a){if(typeof a!="function")return n("expecting a function but got "+s.classString(a));var u=new e(t);u._captureStackTrace(),u._pushContext();var c;if(arguments.length>1){i.deprecated("calling Promise.try with more than 1 argument");var f=arguments[1],h=arguments[2];c=s.isArray(f)?o(a).apply(h,f):o(a).call(h,f)}else c=o(a)();var d=u._popContext();return i.checkForgottenReturns(c,d,"Promise.try",u),u._resolveFromSyncValue(c),u},e.prototype._resolveFromSyncValue=function(a){a===s.errorObj?this._rejectCallback(a.e,!1):this._resolveCallback(a,!0)}}});var yB=_((Oqe,mB)=>{"use strict";mB.exports=function(e,t,r,n){var i=!1,s=function(c,f){this._reject(f)},o=function(c,f){f.promiseRejectionQueued=!0,f.bindingPromise._then(s,s,null,this,c)},a=function(c,f){(this._bitField&50397184)===0&&this._resolveCallback(f.target)},u=function(c,f){f.promiseRejectionQueued||this._reject(c)};e.prototype.bind=function(c){i||(i=!0,e.prototype._propagateFrom=n.propagateFromFunction(),e.prototype._boundValue=n.boundValueFunction());var f=r(c),h=new e(t);h._propagateFrom(this,1);var d=this._target();if(h._setBoundTo(f),f instanceof e){var p={promiseRejectionQueued:!1,promise:h,target:d,bindingPromise:f};d._then(t,o,void 0,h,p),f._then(a,u,void 0,h,p),h._setOnCancel(f)}else h._resolveCallback(d);return h},e.prototype._setBoundTo=function(c){c!==void 0?(this._bitField=this._bitField|2097152,this._boundTo=c):this._bitField=this._bitField&-2097153},e.prototype._isBound=function(){return(this._bitField&2097152)===2097152},e.bind=function(c,f){return e.resolve(f).bind(c)}}});var _B=_((bqe,gB)=>{"use strict";gB.exports=function(e,t,r,n){var i=at(),s=i.tryCatch,o=i.errorObj,a=e._async;e.prototype.break=e.prototype.cancel=function(){if(!n.cancellation())return this._warn("cancellation is disabled");for(var u=this,c=u;u._isCancellable();){if(!u._cancelBy(c)){c._isFollowing()?c._followee().cancel():c._cancelBranched();break}var f=u._cancellationParent;if(f==null||!f._isCancellable()){u._isFollowing()?u._followee().cancel():u._cancelBranched();break}else u._isFollowing()&&u._followee().cancel(),u._setWillBeCancelled(),c=u,u=f}},e.prototype._branchHasCancelled=function(){this._branchesRemainingToCancel--},e.prototype._enoughBranchesHaveCancelled=function(){return this._branchesRemainingToCancel===void 0||this._branchesRemainingToCancel<=0},e.prototype._cancelBy=function(u){return u===this?(this._branchesRemainingToCancel=0,this._invokeOnCancel(),!0):(this._branchHasCancelled(),this._enoughBranchesHaveCancelled()?(this._invokeOnCancel(),!0):!1)},e.prototype._cancelBranched=function(){this._enoughBranchesHaveCancelled()&&this._cancel()},e.prototype._cancel=function(){!this._isCancellable()||(this._setCancelled(),a.invoke(this._cancelPromises,this,void 0))},e.prototype._cancelPromises=function(){this._length()>0&&this._settlePromises()},e.prototype._unsetOnCancel=function(){this._onCancelField=void 0},e.prototype._isCancellable=function(){return this.isPending()&&!this._isCancelled()},e.prototype.isCancellable=function(){return this.isPending()&&!this.isCancelled()},e.prototype._doInvokeOnCancel=function(u,c){if(i.isArray(u))for(var f=0;f<u.length;++f)this._doInvokeOnCancel(u[f],c);else if(u!==void 0)if(typeof u=="function"){if(!c){var h=s(u).call(this._boundValue());h===o&&(this._attachExtraTrace(h.e),a.throwLater(h.e))}}else u._resultCancelled(this)},e.prototype._invokeOnCancel=function(){var u=this._onCancel();this._unsetOnCancel(),a.invoke(this._doInvokeOnCancel,this,u)},e.prototype._invokeInternalOnCancel=function(){this._isCancellable()&&(this._doInvokeOnCancel(this._onCancel(),!0),this._unsetOnCancel())},e.prototype._resultCancelled=function(){this.cancel()}}});var vB=_((Eqe,wB)=>{"use strict";wB.exports=function(e){function t(){return this.value}function r(){throw this.reason}e.prototype.return=e.prototype.thenReturn=function(n){return n instanceof e&&n.suppressUnhandledRejections(),this._then(t,void 0,void 0,{value:n},void 0)},e.prototype.throw=e.prototype.thenThrow=function(n){return this._then(r,void 0,void 0,{reason:n},void 0)},e.prototype.catchThrow=function(n){if(arguments.length<=1)return this._then(void 0,r,void 0,{reason:n},void 0);var i=arguments[1],s=function(){throw i};return this.caught(n,s)},e.prototype.catchReturn=function(n){if(arguments.length<=1)return n instanceof e&&n.suppressUnhandledRejections(),this._then(void 0,t,void 0,{value:n},void 0);var i=arguments[1];i instanceof e&&i.suppressUnhandledRejections();var s=function(){return i};return this.caught(n,s)}}});var OB=_((Cqe,SB)=>{"use strict";SB.exports=function(e){function t(u){u!==void 0?(u=u._target(),this._bitField=u._bitField,this._settledValueField=u._isFateSealed()?u._settledValue():void 0):(this._bitField=0,this._settledValueField=void 0)}t.prototype._settledValue=function(){return this._settledValueField};var r=t.prototype.value=function(){if(!this.isFulfilled())throw new TypeError(`cannot get fulfillment value of a non-fulfilled promise

    See http://goo.gl/MqrFmX
`);return this._settledValue()},n=t.prototype.error=t.prototype.reason=function(){if(!this.isRejected())throw new TypeError(`cannot get rejection reason of a non-rejected promise

    See http://goo.gl/MqrFmX
`);return this._settledValue()},i=t.prototype.isFulfilled=function(){return(this._bitField&33554432)!==0},s=t.prototype.isRejected=function(){return(this._bitField&16777216)!==0},o=t.prototype.isPending=function(){return(this._bitField&50397184)===0},a=t.prototype.isResolved=function(){return(this._bitField&50331648)!==0};t.prototype.isCancelled=function(){return(this._bitField&8454144)!==0},e.prototype.__isCancelled=function(){return(this._bitField&65536)===65536},e.prototype._isCancelled=function(){return this._target().__isCancelled()},e.prototype.isCancelled=function(){return(this._target()._bitField&8454144)!==0},e.prototype.isPending=function(){return o.call(this._target())},e.prototype.isRejected=function(){return s.call(this._target())},e.prototype.isFulfilled=function(){return i.call(this._target())},e.prototype.isResolved=function(){return a.call(this._target())},e.prototype.value=function(){return r.call(this._target())},e.prototype.reason=function(){var u=this._target();return u._unsetRejectionIsUnhandled(),n.call(u)},e.prototype._value=function(){return this._settledValue()},e.prototype._reason=function(){return this._unsetRejectionIsUnhandled(),this._settledValue()},e.PromiseInspection=t}});var EB=_((Tqe,bB)=>{"use strict";bB.exports=function(e,t,r,n,i,s){var o=at(),a=o.canEvaluate,u=o.tryCatch,c=o.errorObj,f;if(a){for(var h=function(S){return new Function("value","holder",`                             
            'use strict';                                                    
            holder.pIndex = value;                                           
            holder.checkFulfillment(this);                                   
            `.replace(/Index/g,S))},d=function(S){return new Function("promise","holder",`                           
            'use strict';                                                    
            holder.pIndex = promise;                                         
            `.replace(/Index/g,S))},p=function(S){for(var v=new Array(S),E=0;E<v.length;++E)v[E]="this.p"+(E+1);var A=v.join(" = ")+" = null;",x=`var promise;
`+v.map(function(Z){return`                                                         
                promise = `+Z+`;                                      
                if (promise instanceof Promise) {                            
                    promise.cancel();                                        
                }                                                            
            `}).join(`
`),z=v.join(", "),k="Holder$"+S,P=`return function(tryCatch, errorObj, Promise, async) {    
            'use strict';                                                    
            function [TheName](fn) {                                         
                [TheProperties]                                              
                this.fn = fn;                                                
                this.asyncNeeded = true;                                     
                this.now = 0;                                                
            }                                                                
                                                                             
            [TheName].prototype._callFunction = function(promise) {          
                promise._pushContext();                                      
                var ret = tryCatch(this.fn)([ThePassedArguments]);           
                promise._popContext();                                       
                if (ret === errorObj) {                                      
                    promise._rejectCallback(ret.e, false);                   
                } else {                                                     
                    promise._resolveCallback(ret);                           
                }                                                            
            };                                                               
                                                                             
            [TheName].prototype.checkFulfillment = function(promise) {       
                var now = ++this.now;                                        
                if (now === [TheTotal]) {                                    
                    if (this.asyncNeeded) {                                  
                        async.invoke(this._callFunction, this, promise);     
                    } else {                                                 
                        this._callFunction(promise);                         
                    }                                                        
                                                                             
                }                                                            
            };                                                               
                                                                             
            [TheName].prototype._resultCancelled = function() {              
                [CancellationCode]                                           
            };                                                               
                                                                             
            return [TheName];                                                
        }(tryCatch, errorObj, Promise, async);                               
        `;return P=P.replace(/\[TheName\]/g,k).replace(/\[TheTotal\]/g,S).replace(/\[ThePassedArguments\]/g,z).replace(/\[TheProperties\]/g,A).replace(/\[CancellationCode\]/g,x),new Function("tryCatch","errorObj","Promise","async",P)(u,c,e,i)},m=[],y=[],g=[],w=0;w<8;++w)m.push(p(w+1)),y.push(h(w+1)),g.push(d(w+1));f=function(S){this._reject(S)}}e.join=function(){var S=arguments.length-1,v;if(S>0&&typeof arguments[S]=="function"&&(v=arguments[S],S<=8&&a)){var I=new e(n);I._captureStackTrace();for(var E=m[S-1],A=new E(v),x=y,z=0;z<S;++z){var k=r(arguments[z],I);if(k instanceof e){k=k._target();var P=k._bitField;(P&50397184)===0?(k._then(x[z],f,void 0,I,A),g[z](k,A),A.asyncNeeded=!1):(P&33554432)!==0?x[z].call(I,k._value(),A):(P&16777216)!==0?I._reject(k._reason()):I._cancel()}else x[z].call(I,k,A)}if(!I._isFateSealed()){if(A.asyncNeeded){var Z=s();Z!==null&&(A.fn=o.domainBind(Z,A.fn))}I._setAsyncGuaranteed(),I._setOnCancel(A)}return I}for(var F=arguments.length,b=new Array(F),q=0;q<F;++q)b[q]=arguments[q];v&&b.pop();var I=new t(b).promise();return v!==void 0?I.spread(v):I}}});var TB=_((Aqe,CB)=>{"use strict";CB.exports=function(e,t,r,n,i,s){var o=e._getDomain,a=at(),u=a.tryCatch,c=a.errorObj,f=e._async;function h(p,m,y,g){this.constructor$(p),this._promise._captureStackTrace();var w=o();this._callback=w===null?m:a.domainBind(w,m),this._preservedValues=g===i?new Array(this.length()):null,this._limit=y,this._inFlight=0,this._queue=[],f.invoke(this._asyncInit,this,void 0)}a.inherits(h,t),h.prototype._asyncInit=function(){this._init$(void 0,-2)},h.prototype._init=function(){},h.prototype._promiseFulfilled=function(p,m){var y=this._values,g=this.length(),w=this._preservedValues,S=this._limit;if(m<0){if(m=m*-1-1,y[m]=p,S>=1&&(this._inFlight--,this._drainQueue(),this._isResolved()))return!0}else{if(S>=1&&this._inFlight>=S)return y[m]=p,this._queue.push(m),!1;w!==null&&(w[m]=p);var v=this._promise,E=this._callback,A=v._boundValue();v._pushContext();var x=u(E).call(A,p,m,g),z=v._popContext();if(s.checkForgottenReturns(x,z,w!==null?"Promise.filter":"Promise.map",v),x===c)return this._reject(x.e),!0;var k=n(x,this._promise);if(k instanceof e){k=k._target();var P=k._bitField;if((P&50397184)===0)return S>=1&&this._inFlight++,y[m]=k,k._proxy(this,(m+1)*-1),!1;if((P&33554432)!==0)x=k._value();else return(P&16777216)!==0?(this._reject(k._reason()),!0):(this._cancel(),!0)}y[m]=x}var Z=++this._totalResolved;return Z>=g?(w!==null?this._filter(y,w):this._resolve(y),!0):!1},h.prototype._drainQueue=function(){for(var p=this._queue,m=this._limit,y=this._values;p.length>0&&this._inFlight<m;){if(this._isResolved())return;var g=p.pop();this._promiseFulfilled(y[g],g)}},h.prototype._filter=function(p,m){for(var y=m.length,g=new Array(y),w=0,S=0;S<y;++S)p[S]&&(g[w++]=m[S]);g.length=w,this._resolve(g)},h.prototype.preservedValues=function(){return this._preservedValues};function d(p,m,y,g){if(typeof m!="function")return r("expecting a function but got "+a.classString(m));var w=0;if(y!==void 0)if(typeof y=="object"&&y!==null){if(typeof y.concurrency!="number")return e.reject(new TypeError("'concurrency' must be a number but it is "+a.classString(y.concurrency)));w=y.concurrency}else return e.reject(new TypeError("options argument must be an object but it is "+a.classString(y)));return w=typeof w=="number"&&isFinite(w)&&w>=1?w:0,new h(p,m,w,g).promise()}e.prototype.map=function(p,m){return d(this,p,m,null)},e.map=function(p,m,y,g){return d(p,m,y,g)}}});var xB=_((xqe,AB)=>{"use strict";var Q0=Object.create;Q0&&(Y0=Q0(null),J0=Q0(null),Y0[" size"]=J0[" size"]=0);var Y0,J0;AB.exports=function(e){var t=at(),r=t.canEvaluate,n=t.isIdentifier,i,s,o=function(p){return new Function("ensureMethod",`                                    
        return function(obj) {                                               
            'use strict'                                                     
            var len = this.length;                                           
            ensureMethod(obj, 'methodName');                                 
            switch(len) {                                                    
                case 1: return obj.methodName(this[0]);                      
                case 2: return obj.methodName(this[0], this[1]);             
                case 3: return obj.methodName(this[0], this[1], this[2]);    
                case 0: return obj.methodName();                             
                default:                                                     
                    return obj.methodName.apply(obj, this);                  
            }                                                                
        };                                                                   
        `.replace(/methodName/g,p))(c)},a=function(p){return new Function("obj",`                                             
        'use strict';                                                        
        return obj.propertyName;                                             
        `.replace("propertyName",p))},u=function(p,m,y){var g=y[p];if(typeof g!="function"){if(!n(p))return null;if(g=m(p),y[p]=g,y[" size"]++,y[" size"]>512){for(var w=Object.keys(y),S=0;S<256;++S)delete y[w[S]];y[" size"]=w.length-256}}return g};i=function(p){return u(p,o,Y0)},s=function(p){return u(p,a,J0)};function c(p,m){var y;if(p!=null&&(y=p[m]),typeof y!="function"){var g="Object "+t.classString(p)+" has no method '"+t.toString(m)+"'";throw new e.TypeError(g)}return y}function f(p){var m=this.pop(),y=c(p,m);return y.apply(p,this)}e.prototype.call=function(p){for(var m=arguments.length,y=new Array(Math.max(m-1,0)),g=1;g<m;++g)y[g-1]=arguments[g];if(r){var w=i(p);if(w!==null)return this._then(w,void 0,void 0,y,void 0)}return y.push(p),this._then(f,void 0,void 0,y,void 0)};function h(p){return p[this]}function d(p){var m=+this;return m<0&&(m=Math.max(0,m+p.length)),p[m]}e.prototype.get=function(p){var m=typeof p=="number",y;if(m)y=d;else if(r){var g=s(p);y=g!==null?g:h}else y=h;return this._then(y,void 0,void 0,p,void 0)}}});var MB=_((qqe,qB)=>{"use strict";qB.exports=function(e,t,r,n,i,s){var o=at(),a=ys().TypeError,u=at().inherits,c=o.errorObj,f=o.tryCatch,h={};function d(v){setTimeout(function(){throw v},0)}function p(v){var E=r(v);return E!==v&&typeof v._isDisposable=="function"&&typeof v._getDisposer=="function"&&v._isDisposable()&&E._setDisposable(v._getDisposer()),E}function m(v,E){var A=0,x=v.length,z=new e(i);function k(){if(A>=x)return z._fulfill();var P=p(v[A++]);if(P instanceof e&&P._isDisposable()){try{P=r(P._getDisposer().tryDispose(E),v.promise)}catch(Z){return d(Z)}if(P instanceof e)return P._then(k,d,null,null,null)}k()}return k(),z}function y(v,E,A){this._data=v,this._promise=E,this._context=A}y.prototype.data=function(){return this._data},y.prototype.promise=function(){return this._promise},y.prototype.resource=function(){return this.promise().isFulfilled()?this.promise().value():h},y.prototype.tryDispose=function(v){var E=this.resource(),A=this._context;A!==void 0&&A._pushContext();var x=E!==h?this.doDispose(E,v):null;return A!==void 0&&A._popContext(),this._promise._unsetDisposable(),this._data=null,x},y.isDisposer=function(v){return v!=null&&typeof v.resource=="function"&&typeof v.tryDispose=="function"};function g(v,E,A){this.constructor$(v,E,A)}u(g,y),g.prototype.doDispose=function(v,E){var A=this.data();return A.call(v,v,E)};function w(v){return y.isDisposer(v)?(this.resources[this.index]._setDisposable(v),v.promise()):v}function S(v){this.length=v,this.promise=null,this[v-1]=null}S.prototype._resultCancelled=function(){for(var v=this.length,E=0;E<v;++E){var A=this[E];A instanceof e&&A.cancel()}},e.using=function(){var v=arguments.length;if(v<2)return t("you must pass at least 2 arguments to Promise.using");var E=arguments[v-1];if(typeof E!="function")return t("expecting a function but got "+o.classString(E));var A,x=!0;v===2&&Array.isArray(arguments[0])?(A=arguments[0],v=A.length,x=!1):(A=arguments,v--);for(var z=new S(v),k=0;k<v;++k){var P=A[k];if(y.isDisposer(P)){var Z=P;P=P.promise(),P._setDisposable(Z)}else{var F=r(P);F instanceof e&&(P=F._then(w,null,null,{resources:z,index:k},void 0))}z[k]=P}for(var b=new Array(z.length),k=0;k<b.length;++k)b[k]=e.resolve(z[k]).reflect();var q=e.all(b).then(function(K){for(var C=0;C<K.length;++C){var R=K[C];if(R.isRejected())return c.e=R.error(),c;if(!R.isFulfilled()){q.cancel();return}K[C]=R.value()}I._pushContext(),E=f(E);var j=x?E.apply(void 0,K):E(K),H=I._popContext();return s.checkForgottenReturns(j,H,"Promise.using",I),j}),I=q.lastly(function(){var K=new e.PromiseInspection(q);return m(z,K)});return z.promise=I,I._setOnCancel(z),I},e.prototype._setDisposable=function(v){this._bitField=this._bitField|131072,this._disposer=v},e.prototype._isDisposable=function(){return(this._bitField&131072)>0},e.prototype._getDisposer=function(){return this._disposer},e.prototype._unsetDisposable=function(){this._bitField=this._bitField&-131073,this._disposer=void 0},e.prototype.disposer=function(v){if(typeof v=="function")return new g(v,this,n());throw new a}}});var $B=_((Mqe,NB)=>{"use strict";NB.exports=function(e,t,r){var n=at(),i=e.TimeoutError;function s(h){this.handle=h}s.prototype._resultCancelled=function(){clearTimeout(this.handle)};var o=function(h){return a(+this).thenReturn(h)},a=e.delay=function(h,d){var p,m;return d!==void 0?(p=e.resolve(d)._then(o,null,null,h,void 0),r.cancellation()&&d instanceof e&&p._setOnCancel(d)):(p=new e(t),m=setTimeout(function(){p._fulfill()},+h),r.cancellation()&&p._setOnCancel(new s(m)),p._captureStackTrace()),p._setAsyncGuaranteed(),p};e.prototype.delay=function(h){return a(h,this)};var u=function(h,d,p){var m;typeof d!="string"?d instanceof Error?m=d:m=new i("operation timed out"):m=new i(d),n.markAsOriginatingFromRejection(m),h._attachExtraTrace(m),h._reject(m),p!=null&&p.cancel()};function c(h){return clearTimeout(this.handle),h}function f(h){throw clearTimeout(this.handle),h}e.prototype.timeout=function(h,d){h=+h;var p,m,y=new s(setTimeout(function(){p.isPending()&&u(p,d,m)},h));return r.cancellation()?(m=this.then(),p=m._then(c,f,void 0,y,void 0),p._setOnCancel(y)):p=this._then(c,f,void 0,y,void 0),p}}});var IB=_((Nqe,PB)=>{"use strict";PB.exports=function(e,t,r,n,i,s){var o=ys(),a=o.TypeError,u=at(),c=u.errorObj,f=u.tryCatch,h=[];function d(m,y,g){for(var w=0;w<y.length;++w){g._pushContext();var S=f(y[w])(m);if(g._popContext(),S===c){g._pushContext();var v=e.reject(c.e);return g._popContext(),v}var E=n(S,g);if(E instanceof e)return E}return null}function p(m,y,g,w){if(s.cancellation()){var S=new e(r),v=this._finallyPromise=new e(r);this._promise=S.lastly(function(){return v}),S._captureStackTrace(),S._setOnCancel(this)}else{var E=this._promise=new e(r);E._captureStackTrace()}this._stack=w,this._generatorFunction=m,this._receiver=y,this._generator=void 0,this._yieldHandlers=typeof g=="function"?[g].concat(h):h,this._yieldedPromise=null,this._cancellationPhase=!1}u.inherits(p,i),p.prototype._isResolved=function(){return this._promise===null},p.prototype._cleanup=function(){this._promise=this._generator=null,s.cancellation()&&this._finallyPromise!==null&&(this._finallyPromise._fulfill(),this._finallyPromise=null)},p.prototype._promiseCancelled=function(){if(!this._isResolved()){var m=typeof this._generator.return<"u",y;if(m)this._promise._pushContext(),y=f(this._generator.return).call(this._generator,void 0),this._promise._popContext();else{var g=new e.CancellationError("generator .return() sentinel");e.coroutine.returnSentinel=g,this._promise._attachExtraTrace(g),this._promise._pushContext(),y=f(this._generator.throw).call(this._generator,g),this._promise._popContext()}this._cancellationPhase=!0,this._yieldedPromise=null,this._continue(y)}},p.prototype._promiseFulfilled=function(m){this._yieldedPromise=null,this._promise._pushContext();var y=f(this._generator.next).call(this._generator,m);this._promise._popContext(),this._continue(y)},p.prototype._promiseRejected=function(m){this._yieldedPromise=null,this._promise._attachExtraTrace(m),this._promise._pushContext();var y=f(this._generator.throw).call(this._generator,m);this._promise._popContext(),this._continue(y)},p.prototype._resultCancelled=function(){if(this._yieldedPromise instanceof e){var m=this._yieldedPromise;this._yieldedPromise=null,m.cancel()}},p.prototype.promise=function(){return this._promise},p.prototype._run=function(){this._generator=this._generatorFunction.call(this._receiver),this._receiver=this._generatorFunction=void 0,this._promiseFulfilled(void 0)},p.prototype._continue=function(m){var y=this._promise;if(m===c)return this._cleanup(),this._cancellationPhase?y.cancel():y._rejectCallback(m.e,!1);var g=m.value;if(m.done===!0)return this._cleanup(),this._cancellationPhase?y.cancel():y._resolveCallback(g);var w=n(g,this._promise);if(!(w instanceof e)&&(w=d(w,this._yieldHandlers,this._promise),w===null)){this._promiseRejected(new a(`A value %s was yielded that could not be treated as a promise

    See http://goo.gl/MqrFmX

`.replace("%s",String(g))+`From coroutine:
`+this._stack.split(`
`).slice(1,-7).join(`
`)));return}w=w._target();var S=w._bitField;(S&50397184)===0?(this._yieldedPromise=w,w._proxy(this,null)):(S&33554432)!==0?e._async.invoke(this._promiseFulfilled,this,w._value()):(S&16777216)!==0?e._async.invoke(this._promiseRejected,this,w._reason()):this._promiseCancelled()},e.coroutine=function(m,y){if(typeof m!="function")throw new a(`generatorFunction must be a function

    See http://goo.gl/MqrFmX
`);var g=Object(y).yieldHandler,w=p,S=new Error().stack;return function(){var v=m.apply(this,arguments),E=new w(void 0,void 0,g,S),A=E.promise();return E._generator=v,E._promiseFulfilled(void 0),A}},e.coroutine.addYieldHandler=function(m){if(typeof m!="function")throw new a("expecting a function but got "+u.classString(m));h.push(m)},e.spawn=function(m){if(s.deprecated("Promise.spawn()","Promise.coroutine()"),typeof m!="function")return t(`generatorFunction must be a function

    See http://goo.gl/MqrFmX
`);var y=new p(m,this),g=y.promise();return y._run(e.spawn),g}}});var DB=_(($qe,RB)=>{"use strict";RB.exports=function(e){var t=at(),r=e._async,n=t.tryCatch,i=t.errorObj;function s(u,c){var f=this;if(!t.isArray(u))return o.call(f,u,c);var h=n(c).apply(f._boundValue(),[null].concat(u));h===i&&r.throwLater(h.e)}function o(u,c){var f=this,h=f._boundValue(),d=u===void 0?n(c).call(h,null):n(c).call(h,null,u);d===i&&r.throwLater(d.e)}function a(u,c){var f=this;if(!u){var h=new Error(u+"");h.cause=u,u=h}var d=n(c).call(f._boundValue(),u);d===i&&r.throwLater(d.e)}e.prototype.asCallback=e.prototype.nodeify=function(u,c){if(typeof u=="function"){var f=o;c!==void 0&&Object(c).spread&&(f=s),this._then(f,a,void 0,this,u)}return this}}});var BB=_((Pqe,jB)=>{"use strict";jB.exports=function(e,t){var r={},n=at(),i=G0(),s=n.withAppended,o=n.maybeWrapAsError,a=n.canEvaluate,u=ys().TypeError,c="Async",f={__isPromisified__:!0},h=["arity","length","name","arguments","caller","callee","prototype","__isPromisified__"],d=new RegExp("^(?:"+h.join("|")+")$"),p=function(q){return n.isIdentifier(q)&&q.charAt(0)!=="_"&&q!=="constructor"};function m(q){return!d.test(q)}function y(q){try{return q.__isPromisified__===!0}catch{return!1}}function g(q,I,K){var C=n.getDataPropertyOrDefault(q,I+K,f);return C?y(C):!1}function w(q,I,K){for(var C=0;C<q.length;C+=2){var R=q[C];if(K.test(R)){for(var j=R.replace(K,""),H=0;H<q.length;H+=2)if(q[H]===j)throw new u(`Cannot promisify an API that has normal methods with '%s'-suffix

    See http://goo.gl/MqrFmX
`.replace("%s",I))}}}function S(q,I,K,C){for(var R=n.inheritedDataKeys(q),j=[],H=0;H<R.length;++H){var ee=R[H],X=q[ee],Se=C===p?!0:p(ee,X,q);typeof X=="function"&&!y(X)&&!g(q,ee,I)&&C(ee,X,q,Se)&&j.push(ee,X)}return w(j,I,K),j}var v=function(q){return q.replace(/([$])/,"\\$")},E,A=function(q){for(var I=[q],K=Math.max(0,q-1-3),C=q-1;C>=K;--C)I.push(C);for(var C=q+1;C<=3;++C)I.push(C);return I},x=function(q){return n.filledRange(q,"_arg","")},z=function(q){return n.filledRange(Math.max(q,3),"_arg","")},k=function(q){return typeof q.length=="number"?Math.max(Math.min(q.length,1024),0):0};E=function(q,I,K,C,R,j){var H=Math.max(0,k(C)-1),ee=A(H),X=typeof q=="string"||I===r;function Se(le){var ve=x(le).join(", "),et=le>0?", ":"",wt;return X?wt=`ret = callback.call(this, {{args}}, nodeback); break;
`:wt=I===void 0?`ret = callback({{args}}, nodeback); break;
`:`ret = callback.call(receiver, {{args}}, nodeback); break;
`,wt.replace("{{args}}",ve).replace(", ",et)}function Me(){for(var le="",ve=0;ve<ee.length;++ve)le+="case "+ee[ve]+":"+Se(ee[ve]);return le+=`                                                             
        default:                                                             
            var args = new Array(len + 1);                                   
            var i = 0;                                                       
            for (var i = 0; i < len; ++i) {                                  
               args[i] = arguments[i];                                       
            }                                                                
            args[i] = nodeback;                                              
            [CodeForCall]                                                    
            break;                                                           
        `.replace("[CodeForCall]",X?`ret = callback.apply(this, args);
`:`ret = callback.apply(receiver, args);
`),le}var _t=typeof q=="string"?"this != null ? this['"+q+"'] : fn":"fn",Ge=`'use strict';                                                
        var ret = function (Parameters) {                                    
            'use strict';                                                    
            var len = arguments.length;                                      
            var promise = new Promise(INTERNAL);                             
            promise._captureStackTrace();                                    
            var nodeback = nodebackForPromise(promise, `+j+`);   
            var ret;                                                         
            var callback = tryCatch([GetFunctionCode]);                      
            switch(len) {                                                    
                [CodeForSwitchCase]                                          
            }                                                                
            if (ret === errorObj) {                                          
                promise._rejectCallback(maybeWrapAsError(ret.e), true, true);
            }                                                                
            if (!promise._isFateSealed()) promise._setAsyncGuaranteed();     
            return promise;                                                  
        };                                                                   
        notEnumerableProp(ret, '__isPromisified__', true);                   
        return ret;                                                          
    `.replace("[CodeForSwitchCase]",Me()).replace("[GetFunctionCode]",_t);return Ge=Ge.replace("Parameters",z(H)),new Function("Promise","fn","receiver","withAppended","maybeWrapAsError","nodebackForPromise","tryCatch","errorObj","notEnumerableProp","INTERNAL",Ge)(e,C,I,s,o,i,n.tryCatch,n.errorObj,n.notEnumerableProp,t)};function P(q,I,K,C,R,j){var H=function(){return this}(),ee=q;typeof ee=="string"&&(q=C);function X(){var Se=I;I===r&&(Se=this);var Me=new e(t);Me._captureStackTrace();var _t=typeof ee=="string"&&this!==H?this[ee]:q,Ge=i(Me,j);try{_t.apply(Se,s(arguments,Ge))}catch(le){Me._rejectCallback(o(le),!0,!0)}return Me._isFateSealed()||Me._setAsyncGuaranteed(),Me}return n.notEnumerableProp(X,"__isPromisified__",!0),X}var Z=a?E:P;function F(q,I,K,C,R){for(var j=new RegExp(v(I)+"$"),H=S(q,I,j,K),ee=0,X=H.length;ee<X;ee+=2){var Se=H[ee],Me=H[ee+1],_t=Se+I;if(C===Z)q[_t]=Z(Se,r,Se,Me,I,R);else{var Ge=C(Me,function(){return Z(Se,r,Se,Me,I,R)});n.notEnumerableProp(Ge,"__isPromisified__",!0),q[_t]=Ge}}return n.toFastProperties(q),q}function b(q,I,K){return Z(q,I,void 0,q,null,K)}e.promisify=function(q,I){if(typeof q!="function")throw new u("expecting a function but got "+n.classString(q));if(y(q))return q;I=Object(I);var K=I.context===void 0?r:I.context,C=!!I.multiArgs,R=b(q,K,C);return n.copyDescriptors(q,R,m),R},e.promisifyAll=function(q,I){if(typeof q!="function"&&typeof q!="object")throw new u(`the target of promisifyAll must be an object or a function

    See http://goo.gl/MqrFmX
`);I=Object(I);var K=!!I.multiArgs,C=I.suffix;typeof C!="string"&&(C=c);var R=I.filter;typeof R!="function"&&(R=p);var j=I.promisifier;if(typeof j!="function"&&(j=Z),!n.isIdentifier(C))throw new RangeError(`suffix must be a valid identifier

    See http://goo.gl/MqrFmX
`);for(var H=n.inheritedDataKeys(q),ee=0;ee<H.length;++ee){var X=q[H[ee]];H[ee]!=="constructor"&&n.isClass(X)&&(F(X.prototype,C,R,j,K),F(X,C,R,j,K))}return F(q,C,R,j,K)}}});var kB=_((Iqe,LB)=>{"use strict";LB.exports=function(e,t,r,n){var i=at(),s=i.isObject,o=ha(),a;typeof Map=="function"&&(a=Map);var u=function(){var d=0,p=0;function m(y,g){this[d]=y,this[d+p]=g,d++}return function(g){p=g.size,d=0;var w=new Array(g.size*2);return g.forEach(m,w),w}}(),c=function(d){for(var p=new a,m=d.length/2|0,y=0;y<m;++y){var g=d[m+y],w=d[y];p.set(g,w)}return p};function f(d){var p=!1,m;if(a!==void 0&&d instanceof a)m=u(d),p=!0;else{var y=o.keys(d),g=y.length;m=new Array(g*2);for(var w=0;w<g;++w){var S=y[w];m[w]=d[S],m[w+g]=S}}this.constructor$(m),this._isMap=p,this._init$(void 0,p?-6:-3)}i.inherits(f,t),f.prototype._init=function(){},f.prototype._promiseFulfilled=function(d,p){this._values[p]=d;var m=++this._totalResolved;if(m>=this._length){var y;if(this._isMap)y=c(this._values);else{y={};for(var g=this.length(),w=0,S=this.length();w<S;++w)y[this._values[w+g]]=this._values[w]}return this._resolve(y),!0}return!1},f.prototype.shouldCopyValues=function(){return!1},f.prototype.getActualLength=function(d){return d>>1};function h(d){var p,m=r(d);if(s(m))m instanceof e?p=m._then(e.props,void 0,void 0,void 0,void 0):p=new f(m).promise();else return n(`cannot await properties of a non-object

    See http://goo.gl/MqrFmX
`);return m instanceof e&&p._propagateFrom(m,2),p}e.prototype.props=function(){return h(this)},e.props=function(d){return h(d)}}});var UB=_((Rqe,FB)=>{"use strict";FB.exports=function(e,t,r,n){var i=at(),s=function(a){return a.then(function(u){return o(u,a)})};function o(a,u){var c=r(a);if(c instanceof e)return s(c);if(a=i.asArray(a),a===null)return n("expecting an array or an iterable object but got "+i.classString(a));var f=new e(t);u!==void 0&&f._propagateFrom(u,3);for(var h=f._fulfill,d=f._reject,p=0,m=a.length;p<m;++p){var y=a[p];y===void 0&&!(p in a)||e.cast(y)._then(h,d,void 0,f,null)}return f}e.race=function(a){return o(a,void 0)},e.prototype.race=function(){return o(this,void 0)}}});var WB=_((Dqe,VB)=>{"use strict";VB.exports=function(e,t,r,n,i,s){var o=e._getDomain,a=at(),u=a.tryCatch;function c(m,y,g,w){this.constructor$(m);var S=o();this._fn=S===null?y:a.domainBind(S,y),g!==void 0&&(g=e.resolve(g),g._attachCancellationCallback(this)),this._initialValue=g,this._currentCancellable=null,w===i?this._eachValues=Array(this._length):w===0?this._eachValues=null:this._eachValues=void 0,this._promise._captureStackTrace(),this._init$(void 0,-5)}a.inherits(c,t),c.prototype._gotAccum=function(m){this._eachValues!==void 0&&this._eachValues!==null&&m!==i&&this._eachValues.push(m)},c.prototype._eachComplete=function(m){return this._eachValues!==null&&this._eachValues.push(m),this._eachValues},c.prototype._init=function(){},c.prototype._resolveEmptyArray=function(){this._resolve(this._eachValues!==void 0?this._eachValues:this._initialValue)},c.prototype.shouldCopyValues=function(){return!1},c.prototype._resolve=function(m){this._promise._resolveCallback(m),this._values=null},c.prototype._resultCancelled=function(m){if(m===this._initialValue)return this._cancel();this._isResolved()||(this._resultCancelled$(),this._currentCancellable instanceof e&&this._currentCancellable.cancel(),this._initialValue instanceof e&&this._initialValue.cancel())},c.prototype._iterate=function(m){this._values=m;var y,g,w=m.length;if(this._initialValue!==void 0?(y=this._initialValue,g=0):(y=e.resolve(m[0]),g=1),this._currentCancellable=y,!y.isRejected())for(;g<w;++g){var S={accum:null,value:m[g],index:g,length:w,array:this};y=y._then(d,void 0,void 0,S,void 0)}this._eachValues!==void 0&&(y=y._then(this._eachComplete,void 0,void 0,this,void 0)),y._then(f,f,void 0,y,this)},e.prototype.reduce=function(m,y){return h(this,m,y,null)},e.reduce=function(m,y,g,w){return h(m,y,g,w)};function f(m,y){this.isFulfilled()?y._resolve(m):y._reject(m)}function h(m,y,g,w){if(typeof y!="function")return r("expecting a function but got "+a.classString(y));var S=new c(m,y,g,w);return S.promise()}function d(m){this.accum=m,this.array._gotAccum(m);var y=n(this.value,this.array._promise);return y instanceof e?(this.array._currentCancellable=y,y._then(p,void 0,void 0,this,void 0)):p.call(this,y)}function p(m){var y=this.array,g=y._promise,w=u(y._fn);g._pushContext();var S;y._eachValues!==void 0?S=w.call(g._boundValue(),m,this.index,this.length):S=w.call(g._boundValue(),this.accum,m,this.index,this.length),S instanceof e&&(y._currentCancellable=S);var v=g._popContext();return s.checkForgottenReturns(S,v,y._eachValues!==void 0?"Promise.each":"Promise.reduce",g),S}}});var HB=_((jqe,zB)=>{"use strict";zB.exports=function(e,t,r){var n=e.PromiseInspection,i=at();function s(o){this.constructor$(o)}i.inherits(s,t),s.prototype._promiseResolved=function(o,a){this._values[o]=a;var u=++this._totalResolved;return u>=this._length?(this._resolve(this._values),!0):!1},s.prototype._promiseFulfilled=function(o,a){var u=new n;return u._bitField=33554432,u._settledValueField=o,this._promiseResolved(a,u)},s.prototype._promiseRejected=function(o,a){var u=new n;return u._bitField=16777216,u._settledValueField=o,this._promiseResolved(a,u)},e.settle=function(o){return r.deprecated(".settle()",".reflect()"),new s(o).promise()},e.prototype.settle=function(){return e.settle(this)}}});var GB=_((Bqe,KB)=>{"use strict";KB.exports=function(e,t,r){var n=at(),i=ys().RangeError,s=ys().AggregateError,o=n.isArray,a={};function u(f){this.constructor$(f),this._howMany=0,this._unwrap=!1,this._initialized=!1}n.inherits(u,t),u.prototype._init=function(){if(!!this._initialized){if(this._howMany===0){this._resolve([]);return}this._init$(void 0,-5);var f=o(this._values);!this._isResolved()&&f&&this._howMany>this._canPossiblyFulfill()&&this._reject(this._getRangeError(this.length()))}},u.prototype.init=function(){this._initialized=!0,this._init()},u.prototype.setUnwrap=function(){this._unwrap=!0},u.prototype.howMany=function(){return this._howMany},u.prototype.setHowMany=function(f){this._howMany=f},u.prototype._promiseFulfilled=function(f){return this._addFulfilled(f),this._fulfilled()===this.howMany()?(this._values.length=this.howMany(),this.howMany()===1&&this._unwrap?this._resolve(this._values[0]):this._resolve(this._values),!0):!1},u.prototype._promiseRejected=function(f){return this._addRejected(f),this._checkOutcome()},u.prototype._promiseCancelled=function(){return this._values instanceof e||this._values==null?this._cancel():(this._addRejected(a),this._checkOutcome())},u.prototype._checkOutcome=function(){if(this.howMany()>this._canPossiblyFulfill()){for(var f=new s,h=this.length();h<this._values.length;++h)this._values[h]!==a&&f.push(this._values[h]);return f.length>0?this._reject(f):this._cancel(),!0}return!1},u.prototype._fulfilled=function(){return this._totalResolved},u.prototype._rejected=function(){return this._values.length-this.length()},u.prototype._addRejected=function(f){this._values.push(f)},u.prototype._addFulfilled=function(f){this._values[this._totalResolved++]=f},u.prototype._canPossiblyFulfill=function(){return this.length()-this._rejected()},u.prototype._getRangeError=function(f){var h="Input array must contain at least "+this._howMany+" items but contains only "+f+" items";return new i(h)},u.prototype._resolveEmptyArray=function(){this._reject(this._getRangeError(0))};function c(f,h){if((h|0)!==h||h<0)return r(`expecting a positive integer

    See http://goo.gl/MqrFmX
`);var d=new u(f),p=d.promise();return d.setHowMany(h),d.init(),p}e.some=function(f,h){return c(f,h)},e.prototype.some=function(f){return c(this,f)},e._SomePromiseArray=u}});var YB=_((Lqe,QB)=>{"use strict";QB.exports=function(e,t){var r=e.map;e.prototype.filter=function(n,i){return r(this,n,i,t)},e.filter=function(n,i,s){return r(n,i,s,t)}}});var XB=_((kqe,JB)=>{"use strict";JB.exports=function(e,t){var r=e.reduce,n=e.all;function i(){return n(this)}function s(o,a){return r(o,a,t,t)}e.prototype.each=function(o){return r(this,o,t,0)._then(i,void 0,void 0,this,void 0)},e.prototype.mapSeries=function(o){return r(this,o,t,t)},e.each=function(o,a){return r(o,a,t,0)._then(i,void 0,void 0,o,void 0)},e.mapSeries=s}});var eL=_((Fqe,ZB)=>{"use strict";ZB.exports=function(e){var t=e._SomePromiseArray;function r(n){var i=new t(n),s=i.promise();return i.setHowMany(1),i.setUnwrap(),i.init(),s}e.any=function(n){return r(n)},e.prototype.any=function(){return r(this)}}});var tL=_((Uqe,X0)=>{"use strict";X0.exports=function(){var e=function(){return new h(`circular promise resolution chain

    See http://goo.gl/MqrFmX
`)},t=function(){return new b.PromiseInspection(this._target())},r=function(C){return b.reject(new h(C))};function n(){}var i={},s=at(),o;s.isNode?o=function(){var C=process.domain;return C===void 0&&(C=null),C}:o=function(){return null},s.notEnumerableProp(b,"_getDomain",o);var a=ha(),u=Qj(),c=new u;a.defineProperty(b,"_async",{value:c});var f=ys(),h=b.TypeError=f.TypeError;b.RangeError=f.RangeError;var d=b.CancellationError=f.CancellationError;b.TimeoutError=f.TimeoutError,b.OperationalError=f.OperationalError,b.RejectionError=f.OperationalError,b.AggregateError=f.AggregateError;var p=function(){},m={},y={},g=eB()(b,p),w=rB()(b,p,g,r,n),S=iB()(b),v=S.create,E=oB()(b,S),A=E.CapturedTrace,x=cB()(b,g,y),z=K0()(y),k=G0(),P=s.errorObj,Z=s.tryCatch;function F(C,R){if(C==null||C.constructor!==b)throw new h(`the promise constructor cannot be invoked directly

    See http://goo.gl/MqrFmX
`);if(typeof R!="function")throw new h("expecting a function but got "+s.classString(R))}function b(C){C!==p&&F(this,C),this._bitField=0,this._fulfillmentHandler0=void 0,this._rejectionHandler0=void 0,this._promise0=void 0,this._receiver0=void 0,this._resolveFromExecutor(C),this._promiseCreated(),this._fireEvent("promiseCreated",this)}b.prototype.toString=function(){return"[object Promise]"},b.prototype.caught=b.prototype.catch=function(C){var R=arguments.length;if(R>1){var j=new Array(R-1),H=0,ee;for(ee=0;ee<R-1;++ee){var X=arguments[ee];if(s.isObject(X))j[H++]=X;else return r("Catch statement predicate: expecting an object but got "+s.classString(X))}return j.length=H,C=arguments[ee],this.then(void 0,z(j,C,this))}return this.then(void 0,C)},b.prototype.reflect=function(){return this._then(t,t,void 0,this,void 0)},b.prototype.then=function(C,R){if(E.warnings()&&arguments.length>0&&typeof C!="function"&&typeof R!="function"){var j=".then() only accepts functions but was passed: "+s.classString(C);arguments.length>1&&(j+=", "+s.classString(R)),this._warn(j)}return this._then(C,R,void 0,void 0,void 0)},b.prototype.done=function(C,R){var j=this._then(C,R,void 0,void 0,void 0);j._setIsFinal()},b.prototype.spread=function(C){return typeof C!="function"?r("expecting a function but got "+s.classString(C)):this.all()._then(C,void 0,void 0,m,void 0)},b.prototype.toJSON=function(){var C={isFulfilled:!1,isRejected:!1,fulfillmentValue:void 0,rejectionReason:void 0};return this.isFulfilled()?(C.fulfillmentValue=this.value(),C.isFulfilled=!0):this.isRejected()&&(C.rejectionReason=this.reason(),C.isRejected=!0),C},b.prototype.all=function(){return arguments.length>0&&this._warn(".all() was passed arguments but it does not take any"),new w(this).promise()},b.prototype.error=function(C){return this.caught(s.originatesFromRejection,C)},b.getNewLibraryCopy=X0.exports,b.is=function(C){return C instanceof b},b.fromNode=b.fromCallback=function(C){var R=new b(p);R._captureStackTrace();var j=arguments.length>1?!!Object(arguments[1]).multiArgs:!1,H=Z(C)(k(R,j));return H===P&&R._rejectCallback(H.e,!0),R._isFateSealed()||R._setAsyncGuaranteed(),R},b.all=function(C){return new w(C).promise()},b.cast=function(C){var R=g(C);return R instanceof b||(R=new b(p),R._captureStackTrace(),R._setFulfilled(),R._rejectionHandler0=C),R},b.resolve=b.fulfilled=b.cast,b.reject=b.rejected=function(C){var R=new b(p);return R._captureStackTrace(),R._rejectCallback(C,!0),R},b.setScheduler=function(C){if(typeof C!="function")throw new h("expecting a function but got "+s.classString(C));return c.setScheduler(C)},b.prototype._then=function(C,R,j,H,ee){var X=ee!==void 0,Se=X?ee:new b(p),Me=this._target(),_t=Me._bitField;X||(Se._propagateFrom(this,3),Se._captureStackTrace(),H===void 0&&(this._bitField&2097152)!==0&&((_t&50397184)!==0?H=this._boundValue():H=Me===this?void 0:this._boundTo),this._fireEvent("promiseChained",this,Se));var Ge=o();if((_t&50397184)!==0){var le,ve,et=Me._settlePromiseCtx;(_t&33554432)!==0?(ve=Me._rejectionHandler0,le=C):(_t&16777216)!==0?(ve=Me._fulfillmentHandler0,le=R,Me._unsetRejectionIsUnhandled()):(et=Me._settlePromiseLateCancellationObserver,ve=new d("late cancellation observer"),Me._attachExtraTrace(ve),le=R),c.invoke(et,Me,{handler:Ge===null?le:typeof le=="function"&&s.domainBind(Ge,le),promise:Se,receiver:H,value:ve})}else Me._addCallbacks(C,R,Se,H,Ge);return Se},b.prototype._length=function(){return this._bitField&65535},b.prototype._isFateSealed=function(){return(this._bitField&117506048)!==0},b.prototype._isFollowing=function(){return(this._bitField&67108864)===67108864},b.prototype._setLength=function(C){this._bitField=this._bitField&-65536|C&65535},b.prototype._setFulfilled=function(){this._bitField=this._bitField|33554432,this._fireEvent("promiseFulfilled",this)},b.prototype._setRejected=function(){this._bitField=this._bitField|16777216,this._fireEvent("promiseRejected",this)},b.prototype._setFollowing=function(){this._bitField=this._bitField|67108864,this._fireEvent("promiseResolved",this)},b.prototype._setIsFinal=function(){this._bitField=this._bitField|4194304},b.prototype._isFinal=function(){return(this._bitField&4194304)>0},b.prototype._unsetCancelled=function(){this._bitField=this._bitField&-65537},b.prototype._setCancelled=function(){this._bitField=this._bitField|65536,this._fireEvent("promiseCancelled",this)},b.prototype._setWillBeCancelled=function(){this._bitField=this._bitField|8388608},b.prototype._setAsyncGuaranteed=function(){c.hasCustomScheduler()||(this._bitField=this._bitField|134217728)},b.prototype._receiverAt=function(C){var R=C===0?this._receiver0:this[C*4-4+3];if(R!==i)return R===void 0&&this._isBound()?this._boundValue():R},b.prototype._promiseAt=function(C){return this[C*4-4+2]},b.prototype._fulfillmentHandlerAt=function(C){return this[C*4-4+0]},b.prototype._rejectionHandlerAt=function(C){return this[C*4-4+1]},b.prototype._boundValue=function(){},b.prototype._migrateCallback0=function(C){var R=C._bitField,j=C._fulfillmentHandler0,H=C._rejectionHandler0,ee=C._promise0,X=C._receiverAt(0);X===void 0&&(X=i),this._addCallbacks(j,H,ee,X,null)},b.prototype._migrateCallbackAt=function(C,R){var j=C._fulfillmentHandlerAt(R),H=C._rejectionHandlerAt(R),ee=C._promiseAt(R),X=C._receiverAt(R);X===void 0&&(X=i),this._addCallbacks(j,H,ee,X,null)},b.prototype._addCallbacks=function(C,R,j,H,ee){var X=this._length();if(X>=65535-4&&(X=0,this._setLength(0)),X===0)this._promise0=j,this._receiver0=H,typeof C=="function"&&(this._fulfillmentHandler0=ee===null?C:s.domainBind(ee,C)),typeof R=="function"&&(this._rejectionHandler0=ee===null?R:s.domainBind(ee,R));else{var Se=X*4-4;this[Se+2]=j,this[Se+3]=H,typeof C=="function"&&(this[Se+0]=ee===null?C:s.domainBind(ee,C)),typeof R=="function"&&(this[Se+1]=ee===null?R:s.domainBind(ee,R))}return this._setLength(X+1),X},b.prototype._proxy=function(C,R){this._addCallbacks(void 0,void 0,R,C,null)},b.prototype._resolveCallback=function(C,R){if((this._bitField&117506048)===0){if(C===this)return this._rejectCallback(e(),!1);var j=g(C,this);if(!(j instanceof b))return this._fulfill(C);R&&this._propagateFrom(j,2);var H=j._target();if(H===this){this._reject(e());return}var ee=H._bitField;if((ee&50397184)===0){var X=this._length();X>0&&H._migrateCallback0(this);for(var Se=1;Se<X;++Se)H._migrateCallbackAt(this,Se);this._setFollowing(),this._setLength(0),this._setFollowee(H)}else if((ee&33554432)!==0)this._fulfill(H._value());else if((ee&16777216)!==0)this._reject(H._reason());else{var Me=new d("late cancellation observer");H._attachExtraTrace(Me),this._reject(Me)}}},b.prototype._rejectCallback=function(C,R,j){var H=s.ensureErrorObject(C),ee=H===C;if(!ee&&!j&&E.warnings()){var X="a promise was rejected with a non-error: "+s.classString(C);this._warn(X,!0)}this._attachExtraTrace(H,R?ee:!1),this._reject(C)},b.prototype._resolveFromExecutor=function(C){if(C!==p){var R=this;this._captureStackTrace(),this._pushContext();var j=!0,H=this._execute(C,function(ee){R._resolveCallback(ee)},function(ee){R._rejectCallback(ee,j)});j=!1,this._popContext(),H!==void 0&&R._rejectCallback(H,!0)}},b.prototype._settlePromiseFromHandler=function(C,R,j,H){var ee=H._bitField;if((ee&65536)===0){H._pushContext();var X;R===m?!j||typeof j.length!="number"?(X=P,X.e=new h("cannot .spread() a non-array: "+s.classString(j))):X=Z(C).apply(this._boundValue(),j):X=Z(C).call(R,j);var Se=H._popContext();ee=H._bitField,(ee&65536)===0&&(X===y?H._reject(j):X===P?H._rejectCallback(X.e,!1):(E.checkForgottenReturns(X,Se,"",H,this),H._resolveCallback(X)))}},b.prototype._target=function(){for(var C=this;C._isFollowing();)C=C._followee();return C},b.prototype._followee=function(){return this._rejectionHandler0},b.prototype._setFollowee=function(C){this._rejectionHandler0=C},b.prototype._settlePromise=function(C,R,j,H){var ee=C instanceof b,X=this._bitField,Se=(X&134217728)!==0;(X&65536)!==0?(ee&&C._invokeInternalOnCancel(),j instanceof x&&j.isFinallyHandler()?(j.cancelPromise=C,Z(R).call(j,H)===P&&C._reject(P.e)):R===t?C._fulfill(t.call(j)):j instanceof n?j._promiseCancelled(C):ee||C instanceof w?C._cancel():j.cancel()):typeof R=="function"?ee?(Se&&C._setAsyncGuaranteed(),this._settlePromiseFromHandler(R,j,H,C)):R.call(j,H,C):j instanceof n?j._isResolved()||((X&33554432)!==0?j._promiseFulfilled(H,C):j._promiseRejected(H,C)):ee&&(Se&&C._setAsyncGuaranteed(),(X&33554432)!==0?C._fulfill(H):C._reject(H))},b.prototype._settlePromiseLateCancellationObserver=function(C){var R=C.handler,j=C.promise,H=C.receiver,ee=C.value;typeof R=="function"?j instanceof b?this._settlePromiseFromHandler(R,H,ee,j):R.call(H,ee,j):j instanceof b&&j._reject(ee)},b.prototype._settlePromiseCtx=function(C){this._settlePromise(C.promise,C.handler,C.receiver,C.value)},b.prototype._settlePromise0=function(C,R,j){var H=this._promise0,ee=this._receiverAt(0);this._promise0=void 0,this._receiver0=void 0,this._settlePromise(H,C,ee,R)},b.prototype._clearCallbackDataAtIndex=function(C){var R=C*4-4;this[R+2]=this[R+3]=this[R+0]=this[R+1]=void 0},b.prototype._fulfill=function(C){var R=this._bitField;if(!((R&117506048)>>>16)){if(C===this){var j=e();return this._attachExtraTrace(j),this._reject(j)}this._setFulfilled(),this._rejectionHandler0=C,(R&65535)>0&&((R&134217728)!==0?this._settlePromises():c.settlePromises(this))}},b.prototype._reject=function(C){var R=this._bitField;if(!((R&117506048)>>>16)){if(this._setRejected(),this._fulfillmentHandler0=C,this._isFinal())return c.fatalError(C,s.isNode);(R&65535)>0?c.settlePromises(this):this._ensurePossibleRejectionHandled()}},b.prototype._fulfillPromises=function(C,R){for(var j=1;j<C;j++){var H=this._fulfillmentHandlerAt(j),ee=this._promiseAt(j),X=this._receiverAt(j);this._clearCallbackDataAtIndex(j),this._settlePromise(ee,H,X,R)}},b.prototype._rejectPromises=function(C,R){for(var j=1;j<C;j++){var H=this._rejectionHandlerAt(j),ee=this._promiseAt(j),X=this._receiverAt(j);this._clearCallbackDataAtIndex(j),this._settlePromise(ee,H,X,R)}},b.prototype._settlePromises=function(){var C=this._bitField,R=C&65535;if(R>0){if((C&16842752)!==0){var j=this._fulfillmentHandler0;this._settlePromise0(this._rejectionHandler0,j,C),this._rejectPromises(R,j)}else{var H=this._rejectionHandler0;this._settlePromise0(this._fulfillmentHandler0,H,C),this._fulfillPromises(R,H)}this._setLength(0)}this._clearCancellationData()},b.prototype._settledValue=function(){var C=this._bitField;if((C&33554432)!==0)return this._rejectionHandler0;if((C&16777216)!==0)return this._fulfillmentHandler0};function q(C){this.promise._resolveCallback(C)}function I(C){this.promise._rejectCallback(C,!1)}b.defer=b.pending=function(){E.deprecated("Promise.defer","new Promise");var C=new b(p);return{promise:C,resolve:q,reject:I}},s.notEnumerableProp(b,"_makeSelfResolutionError",e),pB()(b,p,g,r,E),yB()(b,p,g,E),_B()(b,w,r,E),vB()(b),OB()(b),EB()(b,w,g,p,c,o),b.Promise=b,b.version="3.5.1",TB()(b,w,r,g,p,E),xB()(b),MB()(b,r,g,v,p,E),$B()(b,p,E),IB()(b,r,p,g,n,E),DB()(b),BB()(b,p),kB()(b,w,g,r),UB()(b,p,g,r),WB()(b,w,r,g,p,E),HB()(b,w,E),GB()(b,w,r),YB()(b,p),XB()(b,p),eL()(b),s.toFastProperties(b),s.toFastProperties(b.prototype);function K(C){var R=new b(p);R._fulfillmentHandler0=C,R._rejectionHandler0=C,R._promise0=C,R._receiver0=C}return K({a:1}),K({b:2}),K({c:3}),K(1),K(function(){}),K(void 0),K(!1),K(new b(p)),E.setBounds(u.firstLineError,s.lastLineError),b}});var iL=_((Vqe,nL)=>{"use strict";var rL;typeof Promise<"u"&&(rL=Promise);function Fhe(){try{Promise===Em&&(Promise=rL)}catch{}return Em}var Em=tL()();Em.noConflict=Fhe;nL.exports=Em});var Tm=_((aL,uL)=>{"use strict";var zu=tf(),oL=require("assert"),Uhe=require("util"),ge=A0(),ti=yj()("mquery");function W(e,t){if(!(this instanceof W))return new W(e,t);var r=this.constructor.prototype;this.op=r.op||void 0,this.options=Object.assign({},r.options),this._conditions=r._conditions?ge.clone(r._conditions):{},this._fields=r._fields?ge.clone(r._fields):void 0,this._update=r._update?ge.clone(r._update):void 0,this._path=r._path||void 0,this._distinct=r._distinct||void 0,this._collection=r._collection||void 0,this._traceFunction=r._traceFunction||void 0,t&&this.setOptions(t),e&&(e.find&&e.remove&&e.update?this.collection(e):this.find(e))}var ma="$geoWithin";Object.defineProperty(W,"use$geoWithin",{get:function(){return ma=="$geoWithin"},set:function(e){e===!0?ma="$geoWithin":ma="$within"}});W.prototype.toConstructor=function(){function t(n,i){if(!(this instanceof t))return new t(n,i);W.call(this,n,i)}ge.inherits(t,W);var r=t.prototype;return r.options={},r.setOptions(this.options),r.op=this.op,r._conditions=ge.clone(this._conditions),r._fields=ge.clone(this._fields),r._update=ge.clone(this._update),r._path=this._path,r._distinct=this._distinct,r._collection=this._collection,r._traceFunction=this._traceFunction,t};W.prototype.setOptions=function(e){if(!(e&&ge.isObject(e)))return this;for(var t=ge.keys(e),r,n=0;n<t.length;++n)if(r=t[n],typeof this[r]=="function"){var i=ge.isArray(e[r])?e[r]:[e[r]];this[r].apply(this,i)}else this.options[r]=e[r];return this};W.prototype.collection=function(t){return this._collection=new W.Collection(t),this};W.prototype.collation=function(e){return this.options.collation=e,this};W.prototype.$where=function(e){return this._conditions.$where=e,this};W.prototype.where=function(){if(!arguments.length)return this;this.op||(this.op="find");var e=typeof arguments[0];if(e=="string")return this._path=arguments[0],arguments.length===2&&(this._conditions[this._path]=arguments[1]),this;if(e=="object"&&!Array.isArray(arguments[0]))return this.merge(arguments[0]);throw new TypeError("path must be a string or object")};W.prototype.equals=function(t){this._ensurePath("equals");var r=this._path;return this._conditions[r]=t,this};W.prototype.eq=function(t){this._ensurePath("eq");var r=this._path;return this._conditions[r]=t,this};W.prototype.or=function(t){var r=this._conditions.$or||(this._conditions.$or=[]);return ge.isArray(t)||(t=[t]),r.push.apply(r,t),this};W.prototype.nor=function(t){var r=this._conditions.$nor||(this._conditions.$nor=[]);return ge.isArray(t)||(t=[t]),r.push.apply(r,t),this};W.prototype.and=function(t){var r=this._conditions.$and||(this._conditions.$and=[]);return Array.isArray(t)||(t=[t]),r.push.apply(r,t),this};"gt gte lt lte ne in nin all regex size maxDistance minDistance".split(" ").forEach(function(e){W.prototype[e]=function(){var t,r;arguments.length===1?(this._ensurePath(e),r=arguments[0],t=this._path):(r=arguments[1],t=arguments[0]);var n=this._conditions[t]===null||typeof this._conditions[t]=="object"?this._conditions[t]:this._conditions[t]={};return n["$"+e]=r,this}});W.prototype.mod=function(){var e,t;arguments.length===1?(this._ensurePath("mod"),e=arguments[0],t=this._path):arguments.length===2&&!ge.isArray(arguments[1])?(this._ensurePath("mod"),e=zu(arguments),t=this._path):arguments.length===3?(e=zu(arguments,1),t=arguments[0]):(e=arguments[1],t=arguments[0]);var r=this._conditions[t]||(this._conditions[t]={});return r.$mod=e,this};W.prototype.exists=function(){var e,t;arguments.length===0?(this._ensurePath("exists"),e=this._path,t=!0):arguments.length===1?typeof arguments[0]=="boolean"?(this._ensurePath("exists"),e=this._path,t=arguments[0]):(e=arguments[0],t=!0):arguments.length===2&&(e=arguments[0],t=arguments[1]);var r=this._conditions[e]||(this._conditions[e]={});return r.$exists=t,this};W.prototype.elemMatch=function(){if(arguments[0]==null)throw new TypeError("Invalid argument");var e,t,r;if(typeof arguments[0]=="function")this._ensurePath("elemMatch"),t=this._path,e=arguments[0];else if(ge.isObject(arguments[0]))this._ensurePath("elemMatch"),t=this._path,r=arguments[0];else if(typeof arguments[1]=="function")t=arguments[0],e=arguments[1];else if(arguments[1]&&ge.isObject(arguments[1]))t=arguments[0],r=arguments[1];else throw new TypeError("Invalid argument");e&&(r=new W,e(r),r=r._conditions);var n=this._conditions[t]||(this._conditions[t]={});return n.$elemMatch=r,this};W.prototype.within=function(){if(this._ensurePath("within"),this._geoComparison=ma,arguments.length===0)return this;if(arguments.length===2)return this.box.apply(this,arguments);if(2<arguments.length)return this.polygon.apply(this,arguments);var t=arguments[0];if(!t)throw new TypeError("Invalid argument");if(t.center)return this.circle(t);if(t.box)return this.box.apply(this,t.box);if(t.polygon)return this.polygon.apply(this,t.polygon);if(t.type&&t.coordinates)return this.geometry(t);throw new TypeError("Invalid argument")};W.prototype.box=function(){var e,t;if(arguments.length===3)e=arguments[0],t=[arguments[1],arguments[2]];else if(arguments.length===2)this._ensurePath("box"),e=this._path,t=[arguments[0],arguments[1]];else throw new TypeError("Invalid argument");var r=this._conditions[e]||(this._conditions[e]={});return r[this._geoComparison||ma]={$box:t},this};W.prototype.polygon=function(){var e,t;typeof arguments[0]=="string"?(t=arguments[0],e=zu(arguments,1)):(this._ensurePath("polygon"),t=this._path,e=zu(arguments));var r=this._conditions[t]||(this._conditions[t]={});return r[this._geoComparison||ma]={$polygon:e},this};W.prototype.circle=function(){var e,t;if(arguments.length===1)this._ensurePath("circle"),e=this._path,t=arguments[0];else if(arguments.length===2)e=arguments[0],t=arguments[1];else throw new TypeError("Invalid argument");if(!("radius"in t&&t.center))throw new Error("center and radius are required");var r=this._conditions[e]||(this._conditions[e]={}),n=t.spherical?"$centerSphere":"$center",i=this._geoComparison||ma;return r[i]={},r[i][n]=[t.center,t.radius],"unique"in t&&(r[i].$uniqueDocs=!!t.unique),this};W.prototype.near=function(){var t,r;if(this._geoComparison="$near",arguments.length===0)return this;if(arguments.length===1)this._ensurePath("near"),t=this._path,r=arguments[0];else if(arguments.length===2)t=arguments[0],r=arguments[1];else throw new TypeError("Invalid argument");if(!r.center)throw new Error("center is required");var n=this._conditions[t]||(this._conditions[t]={}),i=r.spherical?"$nearSphere":"$near";if(Array.isArray(r.center)){n[i]=r.center;var s="maxDistance"in r?r.maxDistance:null;s!=null&&(n.$maxDistance=s),r.minDistance!=null&&(n.$minDistance=r.minDistance)}else{if(r.center.type!="Point"||!Array.isArray(r.center.coordinates))throw new Error(Uhe.format("Invalid GeoJSON specified for %s",i));n[i]={$geometry:r.center},"maxDistance"in r&&(n[i].$maxDistance=r.maxDistance),"minDistance"in r&&(n[i].$minDistance=r.minDistance)}return this};W.prototype.intersects=function(){if(this._ensurePath("intersects"),this._geoComparison="$geoIntersects",arguments.length===0)return this;var t=arguments[0];if(t!=null&&t.type&&t.coordinates)return this.geometry(t);throw new TypeError("Invalid argument")};W.prototype.geometry=function(){if(!(this._geoComparison=="$within"||this._geoComparison=="$geoWithin"||this._geoComparison=="$near"||this._geoComparison=="$geoIntersects"))throw new Error("geometry() must come after `within()`, `intersects()`, or `near()");var t,r;if(arguments.length===1)this._ensurePath("geometry"),r=this._path,t=arguments[0];else throw new TypeError("Invalid argument");if(!(t.type&&Array.isArray(t.coordinates)))throw new TypeError("Invalid argument");var n=this._conditions[r]||(this._conditions[r]={});return n[this._geoComparison]={$geometry:t},this};W.prototype.select=function(){var t=arguments[0];if(!t)return this;if(arguments.length!==1)throw new Error("Invalid select: select only takes 1 argument");this._validate("select");var r=this._fields||(this._fields={}),n=typeof t,i,s;if((n=="string"||ge.isArgumentsObject(t))&&typeof t.length=="number"||Array.isArray(t)){for(n=="string"&&(t=t.split(/\s+/)),i=0,s=t.length;i<s;++i){var o=t[i];if(!!o){var a=o[0]=="-"?0:1;a===0&&(o=o.substring(1)),r[o]=a}}return this}if(ge.isObject(t)){var u=ge.keys(t);for(i=0;i<u.length;++i)r[u[i]]=t[u[i]];return this}throw new TypeError("Invalid select() argument. Must be string or object.")};W.prototype.slice=function(){if(arguments.length===0)return this;this._validate("slice");var e,t;if(arguments.length===1){var r=arguments[0];if(typeof r=="object"&&!Array.isArray(r)){for(var n=Object.keys(r),i=n.length,s=0;s<i;++s)this.slice(n[s],r[n[s]]);return this}this._ensurePath("slice"),e=this._path,t=arguments[0]}else arguments.length===2?typeof arguments[0]=="number"?(this._ensurePath("slice"),e=this._path,t=zu(arguments)):(e=arguments[0],t=arguments[1]):arguments.length===3&&(e=arguments[0],t=zu(arguments,1));var o=this._fields||(this._fields={});return o[e]={$slice:t},this};W.prototype.sort=function(e){if(!e)return this;var t,r,n;this._validate("sort");var i=typeof e;if(Array.isArray(e)){for(r=e.length,t=0;t<e.length;++t){if(!Array.isArray(e[t]))throw new Error("Invalid sort() argument, must be array of arrays");Vhe(this.options,e[t][0],e[t][1])}return this}if(arguments.length===1&&i=="string"){for(e=e.split(/\s+/),r=e.length,t=0;t<r;++t)if(n=e[t],!!n){var s=n[0]=="-"?-1:1;s===-1&&(n=n.substring(1)),sL(this.options,n,s)}return this}if(ge.isObject(e)){var o=ge.keys(e);for(t=0;t<o.length;++t)n=o[t],sL(this.options,n,e[n]);return this}if(typeof Map<"u"&&e instanceof Map)return Whe(this.options,e),this;throw new TypeError("Invalid sort() argument. Must be a string, object, or array.")};var Z0={1:1,"-1":-1,asc:1,ascending:1,desc:-1,descending:-1};function sL(e,t,r){if(Array.isArray(e.sort))throw new TypeError("Can't mix sort syntaxes. Use either array or object:\n- `.sort([['field', 1], ['test', -1]])`\n- `.sort({ field: 1, test: -1 })`");var n;if(r&&r.$meta){n=e.sort||(e.sort={}),n[t]={$meta:r.$meta};return}n=e.sort||(e.sort={});var i=String(r||1).toLowerCase();if(i=Z0[i],!i)throw new TypeError("Invalid sort value: { "+t+": "+r+" }");n[t]=i}function Vhe(e,t,r){if(e.sort=e.sort||[],!Array.isArray(e.sort))throw new TypeError("Can't mix sort syntaxes. Use either array or object:\n- `.sort([['field', 1], ['test', -1]])`\n- `.sort({ field: 1, test: -1 })`");var n=String(r||1).toLowerCase();if(n=Z0[n],!n)throw new TypeError("Invalid sort value: [ "+t+", "+r+" ]");e.sort.push([t,n])}function Whe(e,t){if(e.sort=e.sort||new Map,!(e.sort instanceof Map))throw new TypeError("Can't mix sort syntaxes. Use either array or object or map consistently");t.forEach(function(r,n){var i=String(r||1).toLowerCase();if(i=Z0[i],!i)throw new TypeError("Invalid sort value: < "+n+": "+r+" >");e.sort.set(n,i)})}["limit","skip","maxScan","batchSize","comment"].forEach(function(e){W.prototype[e]=function(t){return this._validate(e),this.options[e]=t,this}});W.prototype.maxTime=W.prototype.maxTimeMS=function(e){return this._validate("maxTime"),this.options.maxTimeMS=e,this};W.prototype.snapshot=function(){return this._validate("snapshot"),this.options.snapshot=arguments.length?!!arguments[0]:!0,this};W.prototype.hint=function(){if(arguments.length===0)return this;this._validate("hint");var e=arguments[0];if(ge.isObject(e)){var t=this.options.hint||(this.options.hint={});for(var r in e)t[r]=e[r];return this}if(typeof e=="string")return this.options.hint=e,this;throw new TypeError("Invalid hint. "+e)};W.prototype.j=function(t){return this.options.j=t,this};W.prototype.slaveOk=function(e){return this.options.slaveOk=arguments.length?!!e:!0,this};W.prototype.read=W.prototype.setReadPreference=function(e){return arguments.length>1&&!W.prototype.read.deprecationWarningIssued&&(console.error("Deprecation warning: 'tags' argument is not supported anymore in Query.read() method. Please use mongodb.ReadPreference object instead."),W.prototype.read.deprecationWarningIssued=!0),this.options.readPreference=ge.readPref(e),this};W.prototype.readConcern=W.prototype.r=function(e){return this.options.readConcern=ge.readConcern(e),this};W.prototype.tailable=function(){return this._validate("tailable"),this.options.tailable=arguments.length?!!arguments[0]:!0,this};W.prototype.writeConcern=W.prototype.w=function(t){return typeof t=="object"?(typeof t.j<"u"&&(this.options.j=t.j),typeof t.w<"u"&&(this.options.w=t.w),typeof t.wtimeout<"u"&&(this.options.wtimeout=t.wtimeout)):this.options.w=t==="m"?"majority":t,this};W.prototype.wtimeout=W.prototype.wTimeout=function(t){return this.options.wtimeout=t,this};W.prototype.merge=function(e){if(!e)return this;if(!W.canMerge(e))throw new TypeError("Invalid argument. Expected instanceof mquery or plain object");return e instanceof W?(e._conditions&&ge.merge(this._conditions,e._conditions),e._fields&&(this._fields||(this._fields={}),ge.merge(this._fields,e._fields)),e.options&&(this.options||(this.options={}),ge.merge(this.options,e.options)),e._update&&(this._update||(this._update={}),ge.mergeClone(this._update,e._update)),e._distinct&&(this._distinct=e._distinct),this):(ge.merge(this._conditions,e),this)};W.prototype.find=function(e,t){if(this.op="find",typeof e=="function"?(t=e,e=void 0):W.canMerge(e)&&this.merge(e),!t)return this;var r=this._conditions,n=this._optionsForExec();return this.$useProjection?n.projection=this._fieldsForExec():n.fields=this._fieldsForExec(),ti("find",this._collection.collectionName,r,n),t=this._wrapCallback("find",t,{conditions:r,options:n}),this._collection.find(r,n,ge.tick(t)),this};W.prototype.cursor=function(t){if(this.op){if(this.op!=="find")throw new TypeError(".cursor only support .find method")}else this.find(t);var r=this._conditions,n=this._optionsForExec();return this.$useProjection?n.projection=this._fieldsForExec():n.fields=this._fieldsForExec(),ti("findCursor",this._collection.collectionName,r,n),this._collection.findCursor(r,n)};W.prototype.findOne=function(e,t){if(this.op="findOne",typeof e=="function"?(t=e,e=void 0):W.canMerge(e)&&this.merge(e),!t)return this;var r=this._conditions,n=this._optionsForExec();return this.$useProjection?n.projection=this._fieldsForExec():n.fields=this._fieldsForExec(),ti("findOne",this._collection.collectionName,r,n),t=this._wrapCallback("findOne",t,{conditions:r,options:n}),this._collection.findOne(r,n,ge.tick(t)),this};W.prototype.count=function(e,t){if(this.op="count",this._validate(),typeof e=="function"?(t=e,e=void 0):W.canMerge(e)&&this.merge(e),!t)return this;var r=this._conditions,n=this._optionsForExec();return ti("count",this._collection.collectionName,r,n),t=this._wrapCallback("count",t,{conditions:r,options:n}),this._collection.count(r,n,ge.tick(t)),this};W.prototype.distinct=function(e,t,r){if(this.op="distinct",this._validate(),!r){switch(typeof t){case"function":r=t,typeof e=="string"&&(t=e,e=void 0);break;case"undefined":case"string":break;default:throw new TypeError("Invalid `field` argument. Must be string or function")}switch(typeof e){case"function":r=e,e=t=void 0;break;case"string":t=e,e=void 0;break}}if(typeof t=="string"&&(this._distinct=t),W.canMerge(e)&&this.merge(e),!r)return this;if(!this._distinct)throw new Error("No value for `distinct` has been declared");var n=this._conditions,i=this._optionsForExec();return ti("distinct",this._collection.collectionName,n,i),r=this._wrapCallback("distinct",r,{conditions:n,options:i}),this._collection.distinct(this._distinct,n,i,ge.tick(r)),this};W.prototype.update=function(t,r,n,i){var s;switch(arguments.length){case 3:typeof n=="function"&&(i=n,n=void 0);break;case 2:typeof r=="function"&&(i=r,r=t,t=void 0);break;case 1:switch(typeof t){case"function":i=t,t=n=r=void 0;break;case"boolean":s=t,t=void 0;break;default:r=t,t=n=void 0;break}}return Cm(this,"update",t,r,n,s,i)};W.prototype.updateMany=function(t,r,n,i){var s;switch(arguments.length){case 3:typeof n=="function"&&(i=n,n=void 0);break;case 2:typeof r=="function"&&(i=r,r=t,t=void 0);break;case 1:switch(typeof t){case"function":i=t,t=n=r=void 0;break;case"boolean":s=t,t=void 0;break;default:r=t,t=n=void 0;break}}return Cm(this,"updateMany",t,r,n,s,i)};W.prototype.updateOne=function(t,r,n,i){var s;switch(arguments.length){case 3:typeof n=="function"&&(i=n,n=void 0);break;case 2:typeof r=="function"&&(i=r,r=t,t=void 0);break;case 1:switch(typeof t){case"function":i=t,t=n=r=void 0;break;case"boolean":s=t,t=void 0;break;default:r=t,t=n=void 0;break}}return Cm(this,"updateOne",t,r,n,s,i)};W.prototype.replaceOne=function(t,r,n,i){var s;switch(arguments.length){case 3:typeof n=="function"&&(i=n,n=void 0);break;case 2:typeof r=="function"&&(i=r,r=t,t=void 0);break;case 1:switch(typeof t){case"function":i=t,t=n=r=void 0;break;case"boolean":s=t,t=void 0;break;default:r=t,t=n=void 0;break}}return this.setOptions({overwrite:!0}),Cm(this,"replaceOne",t,r,n,s,i)};function Cm(e,t,r,n,i,s,o){return e.op=t,W.canMerge(r)&&e.merge(r),n&&e._mergeUpdate(n),ge.isObject(i)&&e.setOptions(i),s||o?!e._update||!e.options.overwrite&&ge.keys(e._update).length===0?(o&&ge.soon(o.bind(null,null,0)),e):(i=e._optionsForExec(),o||(i.safe=!1),r=e._conditions,n=e._updateForExec(),ti("update",e._collection.collectionName,r,n,i),o=e._wrapCallback(t,o,{conditions:r,doc:n,options:i}),e._collection[t](r,n,i,ge.tick(o)),e):e}W.prototype.remove=function(e,t){this.op="remove";var r;if(typeof e=="function"?(t=e,e=void 0):W.canMerge(e)?this.merge(e):e===!0&&(r=e,e=void 0),!(r||t))return this;var n=this._optionsForExec();t||(n.safe=!1);var i=this._conditions;return ti("remove",this._collection.collectionName,i,n),t=this._wrapCallback("remove",t,{conditions:i,options:n}),this._collection.remove(i,n,ge.tick(t)),this};W.prototype.deleteOne=function(e,t){this.op="deleteOne";var r;if(typeof e=="function"?(t=e,e=void 0):W.canMerge(e)?this.merge(e):e===!0&&(r=e,e=void 0),!(r||t))return this;var n=this._optionsForExec();t||(n.safe=!1),delete n.justOne;var i=this._conditions;return ti("deleteOne",this._collection.collectionName,i,n),t=this._wrapCallback("deleteOne",t,{conditions:i,options:n}),this._collection.deleteOne(i,n,ge.tick(t)),this};W.prototype.deleteMany=function(e,t){this.op="deleteMany";var r;if(typeof e=="function"?(t=e,e=void 0):W.canMerge(e)?this.merge(e):e===!0&&(r=e,e=void 0),!(r||t))return this;var n=this._optionsForExec();t||(n.safe=!1),delete n.justOne;var i=this._conditions;return ti("deleteOne",this._collection.collectionName,i,n),t=this._wrapCallback("deleteOne",t,{conditions:i,options:n}),this._collection.deleteMany(i,n,ge.tick(t)),this};W.prototype.findOneAndUpdate=function(e,t,r,n){switch(this.op="findOneAndUpdate",this._validate(),arguments.length){case 3:typeof r=="function"&&(n=r,r={});break;case 2:typeof t=="function"&&(n=t,t=e,e=void 0),r=void 0;break;case 1:typeof e=="function"?(n=e,e=r=t=void 0):(t=e,e=r=void 0)}return W.canMerge(e)&&this.merge(e),t&&this._mergeUpdate(t),r&&this.setOptions(r),n?this._findAndModify("update",n):this};W.prototype.findOneAndRemove=W.prototype.findOneAndDelete=function(e,t,r){return this.op="findOneAndRemove",this._validate(),typeof t=="function"?(r=t,t=void 0):typeof e=="function"&&(r=e,e=void 0),W.canMerge(e)&&this.merge(e),t&&this.setOptions(t),r?this._findAndModify("remove",r):this};W.prototype._findAndModify=function(e,t){oL.equal("function",typeof t);var r=this._optionsForExec(),n,i;if(e=="remove")r.remove=!0;else if("new"in r||(r.new=!0),"upsert"in r||(r.upsert=!1),i=this._updateForExec(),!i)if(r.upsert)i={$set:{}};else return this.findOne(t);n=this._fieldsForExec(),n!=null&&(this.$useProjection?r.projection=this._fieldsForExec():r.fields=this._fieldsForExec());var s=this._conditions;return ti("findAndModify",this._collection.collectionName,s,i,r),t=this._wrapCallback("findAndModify",t,{conditions:s,doc:i,options:r}),this._collection.findAndModify(s,i,r,ge.tick(t)),this};W.prototype._wrapCallback=function(e,t,r){var n=this._traceFunction||W.traceFunction;if(n){r.collectionName=this._collection.collectionName;var i=n&&n.call(null,e,r,this),s=new Date().getTime();return function(a,u){if(i){var c=new Date().getTime()-s;i.call(null,a,u,c)}t&&t.apply(null,arguments)}}return t};W.prototype.setTraceFunction=function(e){return this._traceFunction=e,this};W.prototype.exec=function(t,r){switch(typeof t){case"function":r=t,t=null;break;case"string":this.op=t;break}oL.ok(this.op,"Missing query type: (find, update, etc)"),(this.op=="update"||this.op=="remove")&&(r||(r=!0));var n=this;if(typeof r=="function")this[this.op](r);else return new W.Promise(function(i,s){n[n.op](function(o,a){o?s(o):i(a),i=s=null})})};W.prototype.thunk=function(){var e=this;return function(t){e.exec(t)}};W.prototype.then=function(e,t){var r=this,n=new W.Promise(function(i,s){r.exec(function(o,a){o?s(o):i(a),i=s=null})});return n.then(e,t)};W.prototype.stream=function(e){if(this.op!="find")throw new Error("stream() is only available for find");var t=this._conditions,r=this._optionsForExec();return this.$useProjection?r.projection=this._fieldsForExec():r.fields=this._fieldsForExec(),ti("stream",this._collection.collectionName,t,r,e),this._collection.findStream(t,r,e)};W.prototype.selected=function(){return!!(this._fields&&Object.keys(this._fields).length>0)};W.prototype.selectedInclusively=function(){if(!this._fields)return!1;var t=Object.keys(this._fields);if(t.length===0)return!1;for(var r=0;r<t.length;++r){var n=t[r];if(this._fields[n]===0||this._fields[n]&&typeof this._fields[n]=="object"&&this._fields[n].$meta)return!1}return!0};W.prototype.selectedExclusively=function(){if(!this._fields)return!1;var t=Object.keys(this._fields);if(t.length===0)return!1;for(var r=0;r<t.length;++r){var n=t[r];if(this._fields[n]===0)return!0}return!1};W.prototype._mergeUpdate=function(e){this._update||(this._update={}),e instanceof W?e._update&&ge.mergeClone(this._update,e._update):ge.mergeClone(this._update,e)};W.prototype._optionsForExec=function(){var e=ge.clone(this.options);return e};W.prototype._fieldsForExec=function(){return ge.clone(this._fields)};W.prototype._updateForExec=function(){for(var e=ge.clone(this._update),t=ge.keys(e),r=t.length,n={};r--;){var i=t[r];if(this.options.overwrite){n[i]=e[i];continue}i[0]!=="$"?(n.$set||(e.$set?n.$set=e.$set:n.$set={}),n.$set[i]=e[i],t.splice(r,1),~t.indexOf("$set")||t.push("$set")):i==="$set"&&n.$set||(n[i]=e[i])}return this._compiledUpdate=n,n};W.prototype._ensurePath=function(e){if(!this._path){var t=e+"() must be used after where() when called with these arguments";throw new Error(t)}};W.permissions=_j();W._isPermitted=function(e,t){var r=W.permissions[t];return r?r[e]!==!0:!0};W.prototype._validate=function(e){var t,r;if(e===void 0){if(r=W.permissions[this.op],typeof r!="function")return!0;t=r(this)}else W._isPermitted(e,this.op)||(t=e);if(t)throw new Error(t+" cannot be used with "+this.op)};W.canMerge=function(e){return e instanceof W||ge.isObject(e)};W.setGlobalTraceFunction=function(e){W.traceFunction=e};W.utils=ge;W.env=P0();W.Collection=Aj();W.BaseCollection=uf();W.Promise=iL();uL.exports=aL=W});var ff=_((Wqe,cL)=>{"use strict";var zhe=require("assert"),Hhe=Tm(),Hu={_promise:null};Hu.get=function(){return Hu._promise};Hu.set=function(e){zhe.ok(typeof e=="function",`mongoose.Promise must be a function, got ${e}`),Hu._promise=e,Hhe.Promise=e};Hu.set(global.Promise);cL.exports=Hu});var an=_((zqe,lL)=>{"use strict";var Khe=ff(),Ghe=Cr(),Am=Symbol("mongoose:emitted");lL.exports=function(t,r,n,i){return typeof t=="function"?r(function(s){if(s!=null){n!=null&&n.listeners!=null&&n.listeners("error").length>0&&!s[Am]&&(s[Am]=!0,n.emit("error",s));try{t(s)}catch(o){return Ghe(()=>{throw o})}return}t.apply(this,arguments)}):(i=i||Khe.get(),new i((s,o)=>{r(function(a,u){if(a!=null)return n!=null&&n.listeners!=null&&n.listeners("error").length>0&&!a[Am]&&(a[Am]=!0,n.emit("error",a)),o(a);if(arguments.length>2)return s(Array.prototype.slice.call(arguments,1));s(u)})}))}});var eb=_((Hqe,fL)=>{"use strict";fL.exports=function(t,r,n){let i=Object.keys(r.tree),s={};for(let o of i)n&&(t.paths[o]||t.nested[o]||t.singleNestedPaths[o])||(s[o]=r.tree[o]);t.add(s),t.callQueue=t.callQueue.concat(r.callQueue),t.method(r.methods),t.static(r.statics);for(let o in r.query)t.query[o]=r.query[o];for(let o in r.virtuals)t.virtuals[o]=r.virtuals[o].clone();t.s.hooks.merge(r.s.hooks,!1)}});var mL=_((dL,pL)=>{"use strict";var hL=Ne();var gs=pL.exports=dL=function(){};gs.ctor=function(){let e=hL.args(arguments),t=function(){gs.apply(this,arguments),this.paths={},this.states={},this.stateNames=e;let r=e.length,n;for(;r--;)n=e[r],this.states[n]={}};return t.prototype=new gs,e.forEach(function(r){t.prototype[r]=function(n){this._changeState(n,r)}}),t};gs.prototype._changeState=function(t,r){let n=this.states[this.paths[t]];n&&delete n[t],this.paths[t]=r,this.states[r][t]=!0};gs.prototype.clear=function(t){let r=Object.keys(this.states[t]),n=r.length,i;for(;n--;)i=r[n],delete this.states[t][i],delete this.paths[i]};gs.prototype.some=function(){let t=this,r=arguments.length?arguments:this.stateNames;return Array.prototype.some.call(r,function(n){return Object.keys(t.states[n]).length})};gs.prototype._iter=function(t){return function(){let r=arguments.length,n=hL.args(arguments,0,r-1),i=arguments[r-1];n.length||(n=this.stateNames);let s=this;return n.reduce(function(a,u){return a.concat(Object.keys(s.states[u]))},[])[t](function(a,u,c){return i(a,u,c)})}};gs.prototype.forEach=function(){return this.forEach=this._iter("forEach"),this.forEach.apply(this,arguments)};gs.prototype.map=function(){return this.map=this._iter("map"),this.map.apply(this,arguments)}});var _L=_((yL,gL)=>{"use strict";var Qhe=mL(),Yhe=Qhe.ctor("require","modify","init","default","ignore");gL.exports=yL=Jhe;function Jhe(){this.strictMode=void 0,this.selected=void 0,this.shardval=void 0,this.saveError=void 0,this.validationError=void 0,this.adhocPaths=void 0,this.removing=void 0,this.inserting=void 0,this.saving=void 0,this.version=void 0,this.getters={},this._id=void 0,this.populate=void 0,this.populated=void 0,this.wasPopulated=!1,this.scope=void 0,this.activePaths=new Yhe,this.pathsToScopes={},this.cachedRequired={},this.session=null,this.$setCalled=new Set,this.ownerDocument=void 0,this.fullPath=void 0}});var SL=_((wL,vL)=>{"use strict";var Ar=vL.exports=wL={};Ar.DocumentNotFoundError=null;Ar.general={};Ar.general.default="Validator failed for path `{PATH}` with value `{VALUE}`";Ar.general.required="Path `{PATH}` is required.";Ar.Number={};Ar.Number.min="Path `{PATH}` ({VALUE}) is less than minimum allowed value ({MIN}).";Ar.Number.max="Path `{PATH}` ({VALUE}) is more than maximum allowed value ({MAX}).";Ar.Number.enum="`{VALUE}` is not a valid enum value for path `{PATH}`.";Ar.Date={};Ar.Date.min="Path `{PATH}` ({VALUE}) is before minimum allowed value ({MIN}).";Ar.Date.max="Path `{PATH}` ({VALUE}) is after maximum allowed value ({MAX}).";Ar.String={};Ar.String.enum="`{VALUE}` is not a valid enum value for path `{PATH}`.";Ar.String.match="Path `{PATH}` is invalid ({VALUE}).";Ar.String.minlength="Path `{PATH}` (`{VALUE}`) is shorter than the minimum allowed length ({MINLENGTH}).";Ar.String.maxlength="Path `{PATH}` (`{VALUE}`) is longer than the maximum allowed length ({MAXLENGTH})."});var qm=_((Kqe,bL)=>{"use strict";var OL=Ft(),Xhe=require("util"),xm=class extends OL{constructor(t,r,n,i){let s,o=OL.messages;o.DocumentNotFoundError!=null?s=typeof o.DocumentNotFoundError=="function"?o.DocumentNotFoundError(t,r):o.DocumentNotFoundError:s='No document found for query "'+Xhe.inspect(t)+'" on model "'+r+'"',super(s),this.result=i,this.numAffected=n,this.filter=t,this.query=t}};Object.defineProperty(xm.prototype,"name",{value:"DocumentNotFoundError"});bL.exports=xm});var vn=_((Gqe,AL)=>{"use strict";var Zhe=on(),ede=je(),tde=require("util"),Mm=class extends Zhe{constructor(t,r,n,i,s){if(arguments.length>0){let o=EL(r),a=CL(r),u=TL(s),c=tb(null,t,o,n,u,a);super(c),this.init(t,r,n,i,s)}else super(tb())}toJSON(){return{stringValue:this.stringValue,valueType:this.valueType,kind:this.kind,value:this.value,path:this.path,reason:this.reason,name:this.name,message:this.message}}init(t,r,n,i,s){this.stringValue=EL(r),this.messageFormat=TL(s),this.kind=t,this.value=r,this.path=n,this.reason=i,this.valueType=CL(r)}copy(t){this.messageFormat=t.messageFormat,this.stringValue=t.stringValue,this.kind=t.kind,this.value=t.value,this.path=t.path,this.reason=t.reason,this.message=t.message,this.valueType=t.valueType}setModel(t){this.model=t,this.message=tb(t,this.kind,this.stringValue,this.path,this.messageFormat,this.valueType)}};Object.defineProperty(Mm.prototype,"name",{value:"CastError"});function EL(e){let t=tde.inspect(e);return t=t.replace(/^'|'$/g,'"'),t.startsWith('"')||(t='"'+t+'"'),t}function CL(e){if(e==null)return""+e;let t=typeof e;return t!=="object"||typeof e.constructor!="function"?t:e.constructor.name}function TL(e){let t=ede(e,"options.cast",null);if(typeof t=="string")return t}function tb(e,t,r,n,i,s){if(i!=null){let o=i.replace("{KIND}",t).replace("{VALUE}",r).replace("{PATH}",n);return e!=null&&(o=o.replace("{MODEL}",e.modelName)),o}else{let o=s?" (type "+s+")":"",a="Cast to "+t+" failed for value "+r+o+' at path "'+n+'"';return e!=null&&(a+=' for model "'+e.modelName+'"'),a}}AL.exports=Mm});var co=_((Qqe,ML)=>{"use strict";var rde=on(),nde=Ur(),xL=require("util"),ya=class extends rde{constructor(t){let r;nde(t)==="model"?r=t.constructor.modelName+" validation failed":r="Validation failed",super(r),this.errors={},this._message=r,t&&(t.errors=this.errors)}toString(){return this.name+": "+qL(this)}inspect(){return Object.assign(new Error(this.message),this)}addError(t,r){this.errors[t]=r,this.message=this._message+": "+qL(this)}};if(xL.inspect.custom){ya.prototype[xL.inspect.custom]=ya.prototype.inspect}Object.defineProperty(ya.prototype,"toJSON",{enumerable:!1,writable:!1,configurable:!0,value:function(){return Object.assign({},this,{name:this.name,message:this.message})}});Object.defineProperty(ya.prototype,"name",{value:"ValidationError"});function qL(e){let t=Object.keys(e.errors||{}),r=t.length,n=[],i;for(let s=0;s<r;++s)i=t[s],e!==e.errors[i]&&n.push(i+": "+e.errors[i].message);return n.join(", ")}ML.exports=ya});var rb=_((Yqe,PL)=>{"use strict";var NL=Ft(),Ku=class extends NL{constructor(t){let r=t.message;r||(r=NL.messages.general.default);let n=$L(r,t);super(n),t=Object.assign({},t,{message:n}),this.properties=t,this.kind=t.type,this.path=t.path,this.value=t.value,this.reason=t.reason}toString(){return this.message}toJSON(){return Object.assign({name:this.name,message:this.message},this)}};Object.defineProperty(Ku.prototype,"name",{value:"ValidatorError"});Object.defineProperty(Ku.prototype,"properties",{enumerable:!1,writable:!0,value:null});Ku.prototype.formatMessage=$L;function $L(e,t){if(typeof e=="function")return e(t);let r=Object.keys(t);for(let n of r)n!=="message"&&(e=e.replace("{"+n.toUpperCase()+"}",t[n]));return e}PL.exports=Ku});var nb=_((Jqe,IL)=>{"use strict";var ide=Ft(),Nm=class extends ide{constructor(t,r,n){let i=n.join(", ");super('No matching document found for id "'+t._id+'" version '+r+' modifiedPaths "'+i+'"'),this.version=r,this.modifiedPaths=n}};Object.defineProperty(Nm.prototype,"name",{value:"VersionError"});IL.exports=Nm});var ib=_((Xqe,RL)=>{"use strict";var sde=Ft(),$m=class extends sde{constructor(t){let r="Can't save() the same doc multiple times in parallel. Document: ";super(r+t._id)}};Object.defineProperty($m.prototype,"name",{value:"ParallelSaveError"});RL.exports=$m});var sb=_((Zqe,DL)=>{"use strict";var ode=Ft(),Pm=class extends ode{constructor(t){super("Cannot overwrite `"+t+"` model once compiled.")}};Object.defineProperty(Pm.prototype,"name",{value:"OverwriteModelError"});DL.exports=Pm});var BL=_((eMe,jL)=>{"use strict";var ade=Ft(),Im=class extends ade{constructor(t){let r=`Schema hasn't been registered for model "`+t+`".
Use mongoose.model(name, schema)`;super(r)}};Object.defineProperty(Im.prototype,"name",{value:"MissingSchemaError"});jL.exports=Im});var ob=_((tMe,LL)=>{"use strict";var ude=Ft(),Rm=class extends ude{constructor(t){let r="For your own good, using `document.save()` to update an array which was selected using an $elemMatch projection OR populated using skip, limit, query conditions, or exclusion of the _id field when the operation results in a $pop or $set of the entire array is not supported. The following path(s) would have been modified unsafely:\n  "+t.join(`
  `)+`
Use Model.update() to update these arrays instead.`;super(r)}};Object.defineProperty(Rm.prototype,"name",{value:"DivergentArrayError"});LL.exports=Rm});var ga=_((rMe,kL)=>{"use strict";var cde=Ft(),Dm=class extends cde{constructor(t,r,n){r=r||"Field `"+t+"` is not in schema and strict mode is set to throw.",super(r),this.isImmutableError=!!n,this.path=t}};Object.defineProperty(Dm.prototype,"name",{value:"StrictModeError"});kL.exports=Dm});var Ft=_((FL,UL)=>{"use strict";var un=on();UL.exports=FL=un;un.messages=SL();un.Messages=un.messages;un.DocumentNotFoundError=qm();un.CastError=vn();un.ValidationError=co();un.ValidatorError=rb();un.VersionError=nb();un.ParallelSaveError=ib();un.OverwriteModelError=sb();un.MissingSchemaError=BL();un.DivergentArrayError=ob();un.StrictModeError=ga()});var Ln=_((nMe,VL)=>{"use strict";VL.exports=Object.freeze({enumerable:!0,configurable:!0,writable:!0,value:void 0})});var On=_((iMe,WL)=>{"use strict";var lde=ms(),xr=class{constructor(t){if(t==null)return this;Object.assign(this,lde(t))}},Sn=Ln();Object.defineProperty(xr.prototype,"type",Sn);Object.defineProperty(xr.prototype,"validate",Sn);Object.defineProperty(xr.prototype,"cast",Sn);Object.defineProperty(xr.prototype,"required",Sn);Object.defineProperty(xr.prototype,"default",Sn);Object.defineProperty(xr.prototype,"ref",Sn);Object.defineProperty(xr.prototype,"select",Sn);Object.defineProperty(xr.prototype,"index",Sn);Object.defineProperty(xr.prototype,"unique",Sn);Object.defineProperty(xr.prototype,"immutable",Sn);Object.defineProperty(xr.prototype,"sparse",Sn);Object.defineProperty(xr.prototype,"text",Sn);Object.defineProperty(xr.prototype,"transform",Sn);WL.exports=xr});var jm=_((sMe,Gu)=>{"use strict";var fde=vn();Gu.exports=function(t,r){if(Gu.exports.convertToTrue.has(t))return!0;if(Gu.exports.convertToFalse.has(t))return!1;if(t==null)return t;throw new fde("boolean",t,r)};Gu.exports.convertToTrue=new Set([!0,"true",1,"1","yes"]);Gu.exports.convertToFalse=new Set([!1,"false",0,"0","no"])});var Bm=_((oMe,zL)=>{"use strict";var hde=jm();zL.exports=function(e){let t=this!=null?this.path:null;return hde(e,t)}});var ab=_((aMe,HL)=>{"use strict";HL.exports=function(e){if(Array.isArray(e)){if(!e.every(t=>typeof t=="number"||typeof t=="string"))throw new Error("$type array values must be strings or numbers");return e}if(typeof e!="number"&&typeof e!="string")throw new Error("$type parameter must be number, string, or array of numbers and strings");return e}});var GL=_((uMe,KL)=>{"use strict";var dde=ga();KL.exports=function(e){e.$immutable?(e.$immutableSetter=pde(e.path,e.options.immutable),e.set(e.$immutableSetter)):e.$immutableSetter&&(e.setters=e.setters.filter(t=>t!==e.$immutableSetter),delete e.$immutableSetter)};function pde(e,t){return function(n){if(this==null||this.$__==null||this.isNew||!(typeof t=="function"?t.call(this,this):t))return n;let s=this.$__getValue(e);if(this.$__.strictMode==="throw"&&n!==s)throw new dde(e,"Path `"+e+"` is immutable and strict mode is set to throw.",!0);return s}}});var Wr=_((Lm,tk)=>{"use strict";var hf=Ft(),XL=On(),mde=Bm(),yde=ab(),gde=je(),ub=GL(),QL=Cr(),_de=pe().schemaTypeSymbol,wde=require("util"),kn=Ne(),ZL=pe().validatorErrorSymbol,vde=pe().documentIsModified,Sde=pe().populateModelSymbol,ek=hf.CastError,cb=hf.ValidatorError;function De(e,t,r){this[_de]=!0,this.path=e,this.instance=r,this.validators=[],this.getters=this.constructor.hasOwnProperty("getters")?this.constructor.getters.slice():[],this.setters=[],this.splitPath(),t=t||{};let n=this.constructor.defaultOptions||{},i=Object.keys(n);for(let a of i)n.hasOwnProperty(a)&&!t.hasOwnProperty(a)&&(t[a]=n[a]);t.select==null&&delete t.select;let s=this.OptionsConstructor||XL;this.options=new s(t),this._index=null,kn.hasUserDefinedProperty(this.options,"immutable")&&(this.$immutable=this.options.immutable,ub(this));let o=Object.keys(this.options);for(let a of o){if(a==="cast"){this.castFunction(this.options[a]);continue}if(kn.hasUserDefinedProperty(this.options,a)&&typeof this[a]=="function"){if(a==="index"&&this._index){if(t.index===!1){let f=this._index;if(typeof f=="object"&&f!=null){if(f.unique)throw new Error('Path "'+this.path+'" may not have `index` set to false and `unique` set to true');if(f.sparse)throw new Error('Path "'+this.path+'" may not have `index` set to false and `sparse` set to true')}this._index=!1}continue}let u=t[a];if(a==="default"){this.default(u);continue}let c=Array.isArray(u)?u:[u];this[a].apply(this,c)}}Object.defineProperty(this,"$$context",{enumerable:!1,configurable:!1,writable:!0,value:null})}De.prototype.OptionsConstructor=XL;De.prototype.splitPath=function(){if(this._presplitPath!=null)return this._presplitPath;if(this.path!=null)return this._presplitPath=this.path.indexOf(".")===-1?[this.path]:this.path.split("."),this._presplitPath};De.cast=function(t){return arguments.length===0?this._cast:(t===!1&&(t=r=>r),this._cast=t,this._cast)};De.prototype.castFunction=function(t){return arguments.length===0?this._castFunction:(t===!1&&(t=this.constructor._defaultCaster||(r=>r)),this._castFunction=t,this._castFunction)};De.prototype.cast=function(){throw new Error("Base SchemaType class does not implement a `cast()` function")};De.set=function(t,r){this.hasOwnProperty("defaultOptions")||(this.defaultOptions=Object.assign({},this.defaultOptions)),this.defaultOptions[t]=r};De.get=function(e){this.getters=this.hasOwnProperty("getters")?this.getters:[],this.getters.push(e)};De.prototype.default=function(e){if(arguments.length===1){if(e===void 0){this.defaultValue=void 0;return}if(e!=null&&e.instanceOfSchema)throw new hf("Cannot set default value of path `"+this.path+"` to a mongoose Schema instance.");return this.defaultValue=e,this.defaultValue}else arguments.length>1&&(this.defaultValue=kn.args(arguments));return this.defaultValue};De.prototype.index=function(e){return this._index=e,kn.expires(this._index),this};De.prototype.unique=function(e){if(this._index===!1){if(!e)return;throw new Error('Path "'+this.path+'" may not have `index` set to false and `unique` set to true')}return this._index==null||this._index===!0?this._index={}:typeof this._index=="string"&&(this._index={type:this._index}),this._index.unique=e,this};De.prototype.text=function(e){if(this._index===!1){if(!e)return;throw new Error('Path "'+this.path+'" may not have `index` set to false and `text` set to true')}return this._index===null||this._index===void 0||typeof this._index=="boolean"?this._index={}:typeof this._index=="string"&&(this._index={type:this._index}),this._index.text=e,this};De.prototype.sparse=function(e){if(this._index===!1){if(!e)return;throw new Error('Path "'+this.path+'" may not have `index` set to false and `sparse` set to true')}return this._index==null||typeof this._index=="boolean"?this._index={}:typeof this._index=="string"&&(this._index={type:this._index}),this._index.sparse=e,this};De.prototype.immutable=function(e){return this.$immutable=e,ub(this),this};De.prototype.transform=function(e){return this.options.transform=e,this};De.prototype.set=function(e){if(typeof e!="function")throw new TypeError("A setter must be a function.");return this.setters.push(e),this};De.prototype.get=function(e){if(typeof e!="function")throw new TypeError("A getter must be a function.");return this.getters.push(e),this};De.prototype.validate=function(e,t,r){if(typeof e=="function"||e&&kn.getFunctionName(e.constructor)==="RegExp"){let o;return typeof t=="function"?(o={validator:e,message:t},o.type=r||"user defined"):t instanceof Object&&!r?(o=kn.clone(t),o.message||(o.message=o.msg),o.validator=e,o.type=o.type||"user defined"):(t==null&&(t=hf.messages.general.default),r||(r="user defined"),o={message:t,type:r,validator:e}),o.isAsync&&Ode(),this.validators.push(o),this}let n,i,s;for(n=0,i=arguments.length;n<i;n++){if(s=arguments[n],!kn.isPOJO(s)){let o="Invalid validator. Received ("+typeof s+") "+s+". See http://mongoosejs.com/docs/api.html#schematype_SchemaType-validate";throw new Error(o)}this.validate(s.validator,s)}return this};var Ode=wde.deprecate(function(){},"Mongoose: the `isAsync` option for custom validators is deprecated. Make your async validators return a promise instead: https://mongoosejs.com/docs/validation.html#async-custom-validators");De.prototype.required=function(e,t){let r={};if(arguments.length>0&&e==null)return this.validators=this.validators.filter(function(s){return s.validator!==this.requiredValidator},this),this.isRequired=!1,delete this.originalRequiredValue,this;if(typeof e=="object"&&(r=e,t=r.message||t,e=e.isRequired),e===!1)return this.validators=this.validators.filter(function(s){return s.validator!==this.requiredValidator},this),this.isRequired=!1,delete this.originalRequiredValue,this;let n=this;this.isRequired=!0,this.requiredValidator=function(s){let o=gde(this,"$__.cachedRequired");if(o!=null&&!this.$__isSelected(n.path)&&!this[vde](n.path))return!0;if(o!=null&&n.path in o){let a=o[n.path]?n.checkRequired(s,this):!0;return delete o[n.path],a}else if(typeof e=="function")return e.apply(this)?n.checkRequired(s,this):!0;return n.checkRequired(s,this)},this.originalRequiredValue=e,typeof e=="string"&&(t=e,e=void 0);let i=t||hf.messages.general.required;return this.validators.unshift(Object.assign({},r,{validator:this.requiredValidator,message:i,type:"required"})),this};De.prototype.ref=function(e){return this.options.ref=e,this};De.prototype.getDefault=function(e,t){let r=typeof this.defaultValue=="function"?this.defaultValue.call(e):this.defaultValue;if(r!=null){typeof r=="object"&&(!this.options||!this.options.shared)&&(r=kn.clone(r));let n=this.applySetters(r,e,t);return n&&n.$isSingleNested&&(n.$__parent=e),n}return r};De.prototype._applySetters=function(e,t,r){let n=e;if(r)return n;let i=this.setters;for(let s=i.length-1;s>=0;s--)n=i[s].call(t,n,this);return n};De.prototype._castNullish=function(t){return t};De.prototype.applySetters=function(e,t,r,n,i){let s=this._applySetters(e,t,r,n,i);return s==null?this._castNullish(s):(s=this.cast(s,t,r,n,i),s)};De.prototype.applyGetters=function(e,t){let r=e,n=this.getters,i=n.length;if(i===0)return r;for(let s=0;s<i;++s)r=n[s].call(t,r,this);return r};De.prototype.select=function(t){return this.selected=!!t,this};De.prototype.doValidate=function(e,t,r,n){let i=!1,s=this.path,o=this.validators.filter(f=>f!=null&&typeof f=="object"),a=o.length;if(!a)return t(null);let u=this;o.forEach(function(f){if(i)return;let h=f.validator,d,p=kn.clone(f);if(p.path=n&&n.path?n.path:s,p.value=e,h instanceof RegExp){c(h.test(e),p);return}if(typeof h=="function"){if(e===void 0&&h!==u.requiredValidator){c(!0,p);return}if(p.isAsync){bde(h,r,e,p,c);return}try{p.propsParameter?d=h.call(r,e,p):d=h.call(r,e)}catch(m){d=!1,p.reason=m,m.message&&(p.message=m.message)}d!=null&&typeof d.then=="function"?d.then(function(m){c(m,p)},function(m){p.reason=m,p.message=m.message,d=!1,c(d,p)}):c(d,p)}});function c(f,h){if(!i)if(f===void 0||f)--a<=0&&QL(function(){t(null)});else{let d=h.ErrorConstructor||cb;i=new d(h),i[ZL]=!0,QL(function(){t(i)})}}};function bde(e,t,r,n,i){let s=!1,o=e.call(t,r,function(a,u){s||(s=!0,u&&(n.message=u),i(a,n))});typeof o=="boolean"?(s=!0,i(o,n)):o&&typeof o.then=="function"&&o.then(function(a){s||(s=!0,i(a,n))},function(a){s||(s=!0,n.reason=a,n.message=a.message,i(!1,n))})}De.prototype.doValidateSync=function(e,t,r){let n=this.path;if(!this.validators.length)return null;let s=this.validators;if(e===void 0)if(this.validators.length>0&&this.validators[0].type==="required")s=[this.validators[0]];else return null;let o=null;return s.forEach(function(u){if(o||u==null||typeof u!="object")return;let c=u.validator,f=kn.clone(u);f.path=r&&r.path?r.path:n,f.value=e;let h;if(!c.isAsync){if(c instanceof RegExp){a(c.test(e),f);return}if(typeof c=="function"){try{f.propsParameter?h=c.call(t,e,f):h=c.call(t,e)}catch(d){h=!1,f.reason=d}h!=null&&typeof h.then=="function"||a(h,f)}}}),o;function a(u,c){if(!o&&u!==void 0&&!u){let f=c.ErrorConstructor||cb;o=new f(c),o[ZL]=!0}}};De._isRef=function(e,t,r,n){let i=n&&e.options&&(e.options.ref||e.options.refPath);if(!i&&r&&r.$__!=null){let s=r.$__fullPath(e.path);i=(r.ownerDocument?r.ownerDocument():r).populated(s)||r.populated(e.path)}return i?t==null||!Buffer.isBuffer(t)&&t._bsontype!=="Binary"&&kn.isObject(t)?!0:n:!1};De.prototype._castRef=function(t,r,n){if(t==null)return t;if(t.$__!=null)return t.$__.wasPopulated=!0,t;if(Buffer.isBuffer(t)||!kn.isObject(t)){if(n)return t;throw new ek(this.instance,t,this.path,null,this)}let i=r.$__fullPath(this.path),o=(r.ownerDocument?r.ownerDocument():r).populated(i,!0),a=t;return(!r.$__.populated||!r.$__.populated[i]||!r.$__.populated[i].options||!r.$__.populated[i].options.options||!r.$__.populated[i].options.options.lean)&&(a=new o.options[Sde](t),a.$__.wasPopulated=!0),a};function YL(e){return this.castForQuery(e)}function Ede(e){let t=this;return Array.isArray(e)?e.map(function(r){return t.castForQuery(r)}):[this.castForQuery(e)]}function JL(e){let t=this;return Array.isArray(e)?e.map(function(r){return Array.isArray(r)&&r.length===0?r:t.castForQuery(r)}):[this.castForQuery(e)]}De.prototype.$conditionalHandlers={$all:Ede,$eq:YL,$in:JL,$ne:YL,$nin:JL,$exists:mde,$type:yde};De.prototype.castForQueryWrapper=function(e){if(this.$$context=e.context,"$conditional"in e){let r=this.castForQuery(e.$conditional,e.val);return this.$$context=null,r}if(e.$skipQueryCastForUpdate||e.$applySetters){let r=this._castForQuery(e.val);return this.$$context=null,r}let t=this.castForQuery(e.val);return this.$$context=null,t};De.prototype.castForQuery=function(e,t){let r;if(arguments.length===2){if(r=this.$conditionalHandlers[e],!r)throw new Error("Can't use "+e);return r.call(this,t)}return t=e,this._castForQuery(t)};De.prototype._castForQuery=function(e){return this.applySetters(e,this.$$context)};De.checkRequired=function(e){return arguments.length>0&&(this._checkRequired=e),this._checkRequired};De.prototype.checkRequired=function(e){return e!=null};De.prototype.clone=function(){let e=Object.assign({},this.options),t=new this.constructor(this.path,e,this.instance);return t.validators=this.validators.slice(),this.requiredValidator!==void 0&&(t.requiredValidator=this.requiredValidator),this.defaultValue!==void 0&&(t.defaultValue=this.defaultValue),this.$immutable!==void 0&&this.options.immutable===void 0&&(t.$immutable=this.$immutable,ub(t)),this._index!==void 0&&(t._index=this._index),this.selected!==void 0&&(t.selected=this.selected),this.isRequired!==void 0&&(t.isRequired=this.isRequired),this.originalRequiredValue!==void 0&&(t.originalRequiredValue=this.originalRequiredValue),t.getters=this.getters.slice(),t.setters=this.setters.slice(),t};tk.exports=Lm=De;Lm.CastError=ek;Lm.ValidatorError=cb});var _a=_(lb=>{"use strict";lb.schemaMixedSymbol=Symbol.for("mongoose:schema_mixed");lb.builtInMiddleware=Symbol.for("mongoose:built-in-middleware")});var wa=_((lMe,rk)=>{"use strict";var km=Wr(),Cde=_a(),Tde=ca(),Ade=Ne();function Ti(e,t){if(t&&t.default){let r=t.default;Array.isArray(r)&&r.length===0?t.default=Array:!t.shared&&Tde(r)&&Object.keys(r).length===0&&(t.default=function(){return{}})}km.call(this,e,t,"Mixed"),this[Cde.schemaMixedSymbol]=!0}Ti.schemaName="Mixed";Ti.defaultOptions={};Ti.prototype=Object.create(km.prototype);Ti.prototype.constructor=Ti;Ti.get=km.get;Ti.set=km.set;Ti.prototype.cast=function(e){return e instanceof Error?Ade.errorToPOJO(e):e};Ti.prototype.castForQuery=function(e,t){return arguments.length===2?t:e};rk.exports=Ti});var fb=_((fMe,nk)=>{"use strict";var xde=Ft(),Fm=class extends xde{constructor(t,r){let n=Array.isArray(r)?"array":"primitive value";super("Tried to set nested object field `"+t+`\` to ${n} \``+r+"` and strict mode is set to throw."),this.path=t}};Object.defineProperty(Fm.prototype,"name",{value:"ObjectExpectedError"});nk.exports=Fm});var hb=_((hMe,ik)=>{"use strict";var qde=Ft(),Um=class extends qde{constructor(t,r,n){super('Parameter "'+r+'" to '+n+"() must be an object, got "+t.toString())}};Object.defineProperty(Um.prototype,"name",{value:"ObjectParameterError"});ik.exports=Um});var ok=_((dMe,sk)=>{"use strict";var Mde=on(),Vm=class extends Mde{constructor(t){let r="Can't validate() the same doc multiple times in parallel. Document: ";super(r+t._id)}};Object.defineProperty(Vm.prototype,"name",{value:"ParallelValidateError"});sk.exports=Vm});var pb=_((pMe,uk)=>{"use strict";function zr(){this._pres=new Map,this._posts=new Map}zr.prototype.execPre=function(e,t,r,n){arguments.length===3&&(n=r,r=[]);var i=lo(this._pres,e,[]),s=i.length,o=i.numAsync||0,a=0,u=o,c=!1,f=r;if(!s)return process.nextTick(function(){n(null)});var h=function(){if(!(a>=s)){var p=i[a];if(p.isAsync){var m=[df(d),df(function(w){if(w)return c?void 0:(c=!0,n(w));if(--u===0&&a>=s)return n(null)})];Wm(p.fn,t,m,m[0])}else if(p.fn.length>0){for(var m=[df(d)],y=arguments.length>=2?arguments:[null].concat(f),g=1;g<y.length;++g)m.push(y[g]);Wm(p.fn,t,m,m[0])}else{let w=null;try{w=p.fn.call(t)}catch(S){if(S!=null)return n(S)}if(db(w))w.then(()=>d(),S=>d(S));else{if(++a>=s)return u>0?void 0:process.nextTick(function(){n(null)});h()}}}};h.apply(null,[null].concat(r));function d(p){if(p)return c?void 0:(c=!0,n(p));if(++a>=s)return u>0?void 0:n(null);h.apply(t,arguments)}};zr.prototype.execPreSync=function(e,t,r){for(var n=lo(this._pres,e,[]),i=n.length,s=0;s<i;++s)n[s].fn.apply(t,r||[])};zr.prototype.execPost=function(e,t,r,n,i){arguments.length<5&&(i=n,n=null);var s=lo(this._posts,e,[]),o=s.length,a=0,u=null;if(n&&n.error&&(u=n.error),!o)return process.nextTick(function(){i.apply(null,[u].concat(r))});var c=function(){for(var f=s[a].fn,h=0,d=r.length,p=[],m=0;m<d;++m)h+=r[m]&&r[m]._kareemIgnore?0:1,(!r[m]||!r[m]._kareemIgnore)&&p.push(r[m]);if(u)if(f.length===h+2){var y=df(function(g){if(g&&(u=g),++a>=o)return i.call(null,u);c()});Wm(f,t,[u].concat(p).concat([y]),y)}else{if(++a>=o)return i.call(null,u);c()}else{let g=df(function(w){if(w)return u=w,c();if(++a>=o)return i.apply(null,[null].concat(r));c()});if(f.length===h+2)return++a>=o?i.apply(null,[null].concat(r)):c();if(f.length===h+1)Wm(f,t,p.concat([g]),g);else{let w,S;try{S=f.apply(t,p)}catch(v){w=v,u=v}if(db(S))return S.then(()=>g(),v=>g(v));if(++a>=o)return i.apply(null,[w].concat(r));c(w)}}};c()};zr.prototype.execPostSync=function(e,t,r){let n=lo(this._posts,e,[]),i=n.length;for(let s=0;s<i;++s)n[s].fn.apply(t,r||[])};zr.prototype.createWrapperSync=function(e,t){var r=this;return function(){r.execPreSync(e,this,arguments);var i=t.apply(this,arguments);return r.execPostSync(e,this,[i]),i}};function ak(e,t,r,n,i,s,o){if(s.useErrorHandlers){var a={error:t};return e.execPost(r,n,i,a,function(u){return typeof o=="function"&&o(u)})}else return typeof o=="function"?o(t):void 0}zr.prototype.wrap=function(e,t,r,n,i){let s=n.length>0?n[n.length-1]:null,o=typeof s=="function"?n.slice(0,n.length-1):n,a=this;i=i||{};let u=i.checkForPromise;this.execPre(e,r,n,function(c){if(c){let y=i.numCallbackParams||0,g=i.contextParameter?[r]:[];for(var f=g.length;f<y;++f)g.push(null);return ak(a,c,e,r,g,i,s)}let h=typeof s=="function"?n.length-1:n.length,d=t.length,p=t.apply(r,n.slice(0,h).concat(m));if(u){if(p!=null&&typeof p.then=="function")return p.then(y=>m(null,y),y=>m(y));if(d<h+1)return m(null,p)}function m(){let y=arguments,g=Array.prototype.slice.call(arguments,1);if(i.nullResultByDefault&&g.length===0&&g.push(null),arguments[0])return ak(a,arguments[0],e,r,g,i,s);a.execPost(e,r,g,function(){return arguments[0]?typeof s=="function"?s(arguments[0]):void 0:typeof s=="function"?s.apply(r,arguments):void 0})}})};zr.prototype.filter=function(e){let t=this.clone(),r=Array.from(t._pres.keys());for(let i of r){let s=this._pres.get(i).map(o=>Object.assign({},o,{name:i})).filter(e);if(s.length===0){t._pres.delete(i);continue}s.numAsync=s.filter(o=>o.isAsync).length,t._pres.set(i,s)}let n=Array.from(t._posts.keys());for(let i of n){let s=this._posts.get(i).map(o=>Object.assign({},o,{name:i})).filter(e);if(s.length===0){t._posts.delete(i);continue}t._posts.set(i,s)}return t};zr.prototype.hasHooks=function(e){return this._pres.has(e)||this._posts.has(e)};zr.prototype.createWrapper=function(e,t,r,n){var i=this;return this.hasHooks(e)?function(){var s=r||this,o=Array.prototype.slice.call(arguments);i.wrap(e,t,s,o,n)}:function(){process.nextTick(()=>t.apply(this,arguments))}};zr.prototype.pre=function(e,t,r,n,i){let s={};typeof t=="object"&&t!=null?(s=t,t=s.isAsync):typeof arguments[1]!="boolean"&&(n=r,r=t,t=!1);let o=lo(this._pres,e,[]);if(this._pres.set(e,o),t&&(o.numAsync=o.numAsync||0,++o.numAsync),typeof r!="function")throw new Error('pre() requires a function, got "'+typeof r+'"');return i?o.unshift(Object.assign({},s,{fn:r,isAsync:t})):o.push(Object.assign({},s,{fn:r,isAsync:t})),this};zr.prototype.post=function(e,t,r,n){let i=lo(this._posts,e,[]);if(typeof t=="function"&&(n=!!r,r=t,t={}),typeof r!="function")throw new Error('post() requires a function, got "'+typeof r+'"');return n?i.unshift(Object.assign({},t,{fn:r})):i.push(Object.assign({},t,{fn:r})),this._posts.set(e,i),this};zr.prototype.clone=function(){let e=new zr;for(let t of this._pres.keys()){let r=this._pres.get(t).slice();r.numAsync=this._pres.get(t).numAsync,e._pres.set(t,r)}for(let t of this._posts.keys())e._posts.set(t,this._posts.get(t).slice());return e};zr.prototype.merge=function(e,t){t=arguments.length===1?!0:t;var r=t?this.clone():this;for(let n of e._pres.keys()){let i=lo(r._pres,n,[]),s=e._pres.get(n).filter(a=>i.map(u=>u.fn).indexOf(a.fn)===-1),o=i.concat(s);o.numAsync=i.numAsync||0,o.numAsync+=s.filter(a=>a.isAsync).length,r._pres.set(n,o)}for(let n of e._posts.keys()){let i=lo(r._posts,n,[]),s=e._posts.get(n).filter(o=>i.indexOf(o)===-1);r._posts.set(n,i.concat(s))}return r};function lo(e,t,r){return e.has(t)?e.get(t):r}function Wm(e,t,r,n){let i;try{i=e.apply(t,r)}catch(s){return n(s)}db(i)&&i.then(()=>n(),s=>n(s))}function db(e){return e!=null&&typeof e.then=="function"}function df(e){var t=!1,r=this;return function(){if(!t)return t=!0,process.nextTick(()=>e.apply(r,arguments))}}uk.exports=zr});var lk=_((mMe,ck)=>{"use strict";var ri=Ln(),cn=class{constructor(t){Object.assign(this,t),t!=null&&t.options!=null&&(this.options=Object.assign({},t.options))}};Object.defineProperty(cn.prototype,"ref",ri);Object.defineProperty(cn.prototype,"refPath",ri);Object.defineProperty(cn.prototype,"localField",ri);Object.defineProperty(cn.prototype,"foreignField",ri);Object.defineProperty(cn.prototype,"justOne",ri);Object.defineProperty(cn.prototype,"count",ri);Object.defineProperty(cn.prototype,"match",ri);Object.defineProperty(cn.prototype,"options",ri);Object.defineProperty(cn.prototype,"skip",ri);Object.defineProperty(cn.prototype,"limit",ri);Object.defineProperty(cn.prototype,"perDocumentLimit",ri);ck.exports=cn});var zm=_((yMe,fk)=>{"use strict";var Nde=Ne();function fo(e,t){this.path=t,this.getters=[],this.setters=[],this.options=Object.assign({},e)}fo.prototype._applyDefaultGetters=function(){if(this.getters.length>0||this.setters.length>0)return;let e=this.path,t="$"+e;this.getters.push(function(){return this[t]}),this.setters.push(function(r){this[t]=r})};fo.prototype.clone=function(){let e=new fo(this.options,this.path);return e.getters=[].concat(this.getters),e.setters=[].concat(this.setters),e};fo.prototype.get=function(e){return this.getters.push(e),this};fo.prototype.set=function(e){return this.setters.push(e),this};fo.prototype.applyGetters=function(e,t){Nde.hasUserDefinedProperty(this.options,["ref","refPath"])&&t.$$populatedVirtuals&&t.$$populatedVirtuals.hasOwnProperty(this.path)&&(e=t.$$populatedVirtuals[this.path]);let r=e;for(let n=this.getters.length-1;n>=0;n--)r=this.getters[n].call(t,r,this,t);return r};fo.prototype.applySetters=function(e,t){let r=e;for(let n=this.setters.length-1;n>=0;n--)r=this.setters[n].call(t,r,this,t);return r};fk.exports=fo});var mb=_((gMe,hk)=>{"use strict";hk.exports=function(t){let r={_id:{auto:!0}};r._id[t.options.typeKey]="ObjectId",t.add(r)}});var pk=_((_Me,dk)=>{"use strict";var yb=je(),$de=ca();dk.exports=function(t){let r=[],n=new WeakMap,i=t.constructor.indexTypes,s=new Map;return o(t),r;function o(u,c,f){if(n.has(u))return;n.set(u,!0),c=c||"";let h=Object.keys(u.paths);for(let d of h){let p=u.paths[d];if(f!=null&&f.paths[d])continue;if(p.$isMongooseDocumentArray||p.$isSingleNested){if(yb(p,"options.excludeIndexes")!==!0&&yb(p,"schemaOptions.excludeIndexes")!==!0&&yb(p,"schema.options.excludeIndexes")!==!0&&o(p.schema,c+d+"."),p.schema.discriminators!=null){let y=p.schema.discriminators,g=Object.keys(y);for(let w of g)o(y[w],c+d+".",p.schema)}if(p.$isMongooseDocumentArray)continue}let m=p._index||p.caster&&p.caster._index;if(m!==!1&&m!==null&&m!==void 0){let y={},g=$de(m),w=g?m:{},S=typeof m=="string"?m:g?m.type:!1;if(S&&i.indexOf(S)!==-1)y[c+d]=S;else if(w.text)y[c+d]="text",delete w.text;else{let E=Number(m)===-1;y[c+d]=E?-1:1}delete w.type,"background"in w||(w.background=!0),u.options.autoIndex!=null&&(w._autoIndex=u.options.autoIndex);let v=w&&w.name;typeof v=="string"?s.has(v)?Object.assign(s.get(v),y):(r.push([y,w]),s.set(v,y)):(r.push([y,w]),s.set(v,y))}}n.delete(u),c?a(u,c):(u._indexes.forEach(function(d){"background"in d[1]||(d[1].background=!0)}),r=r.concat(u._indexes))}function a(u,c){let f=u._indexes,h=f.length;for(let d=0;d<h;++d){let p=f[d][0],m=f[d][1],y=Object.keys(p),g=y.length,w={};for(let v=0;v<g;++v){let E=y[v];w[c+E]=p[E]}let S=Object.assign({},m);if(m!=null&&m.partialFilterExpression!=null){S.partialFilterExpression={};let v=m.partialFilterExpression;for(let E of Object.keys(v))S.partialFilterExpression[c+E]=v[E]}r.push([w,S])}}}});var pf=_((wMe,mk)=>{"use strict";mk.exports=function(t){return t.replace(/\.\$(\[[^\]]*\])?(?=\.)/g,".0").replace(/\.\$(\[[^\]]*\])?$/g,".0")}});var gb=_((vMe,yk)=>{"use strict";yk.exports=Pde;function Pde(e,t){return e==null?null:typeof e=="boolean"?t:typeof e[t]=="boolean"?e[t]?t:null:t in e?e[t]:t}});var vb=_((SMe,gk)=>{"use strict";var Ide=pf(),_s=gb();gk.exports=wb;function wb(e,t,r){if(t==null)return;if(Object.keys(t).some(a=>a.startsWith("$"))){if(t.$push&&o(t.$push),t.$addToSet&&o(t.$addToSet),t.$set!=null){let a=Object.keys(t.$set);for(let u of a)_b(r,u,t.$set,e)}if(t.$setOnInsert!=null){let a=Object.keys(t.$setOnInsert);for(let u of a)_b(r,u,t.$setOnInsert,e)}}let s=Object.keys(t).filter(a=>!a.startsWith("$"));for(let a of s)_b(r,a,t,e);function o(a){for(let u of Object.keys(a)){let c=r.path(u.replace(/\.\$\./i,".").replace(/.\$$/,""));if(a[u]&&c&&c.$isMongooseDocumentArray&&c.schema.options.timestamps){let f=c.schema.options.timestamps,h=_s(f,"createdAt"),d=_s(f,"updatedAt");a[u].$each?a[u].$each.forEach(function(p){d!=null&&(p[d]=e),h!=null&&(p[h]=e)}):(d!=null&&(a[u][d]=e),h!=null&&(a[u][h]=e))}}}}function Rde(e,t,r){let n=t.schema.options.timestamps;if(!n)return;let i=e.length,s=_s(n,"createdAt"),o=_s(n,"updatedAt");for(let a=0;a<i;++a)o!=null&&(e[a][o]=r),s!=null&&(e[a][s]=r),wb(r,e[a],t.schema)}function Dde(e,t,r){let n=t.schema.options.timestamps;if(!n)return;let i=_s(n,"createdAt"),s=_s(n,"updatedAt");s!=null&&(e[s]=r),i!=null&&(e[i]=r),wb(r,e,t.schema)}function _b(e,t,r,n){let i=Ide(t),s=e.path(i);if(!s)return;let o=[],a=i.split(".");for(let u=a.length-1;u>0;--u){let c=e.path(a.slice(0,u).join("."));c!=null&&(c.$isMongooseDocumentArray||c.$isSingleNested)&&o.push({parentPath:t.split(".").slice(0,u).join("."),parentSchemaType:c})}if(Array.isArray(r[t])&&s.$isMongooseDocumentArray)Rde(r[t],s,n);else if(r[t]&&s.$isSingleNested)Dde(r[t],s,n);else if(o.length>0)for(let u of o){let c=u.parentPath,f=u.parentSchemaType,h=f.schema.options.timestamps,d=_s(h,"updatedAt");if(!(!h||d==null)){if(f.$isSingleNested)r[c+"."+d]=n;else if(f.$isMongooseDocumentArray){let p=t.substr(c.length+1);if(/^\d+$/.test(p)){r[c+"."+p][d]=n;continue}let m=p.indexOf(".");p=m!==-1?p.substr(0,m):p,r[c+"."+p+"."+d]=n}}}else if(s.schema!=null&&s.schema!=e&&r[t]){let u=s.schema.options.timestamps,c=_s(u,"createdAt"),f=_s(u,"updatedAt");if(!u)return;f!=null&&(r[t][f]=n),c!=null&&(r[t][c]=n)}}});var Sb=_((OMe,wk)=>{"use strict";var _k=je();wk.exports=jde;function jde(e,t,r,n,i){let s=n,o=s,a=_k(i,"overwrite",!1),u=_k(i,"timestamps",!0);if(!u||s==null)return n;let c=u!=null&&u.createdAt===!1,f=u!=null&&u.updatedAt===!1;if(a)return n&&n.$set&&(n=n.$set,s.$set={},o=s.$set),!f&&r&&!n[r]&&(o[r]=e),!c&&t&&!n[t]&&(o[t]=e),s;if(n=n||{},Array.isArray(s))return s.push({$set:{updatedAt:e}}),s;if(s.$set=s.$set||{},!f&&r&&(!n.$currentDate||!n.$currentDate[r])){let h=!1;if(r.indexOf(".")!==-1){let d=r.split(".");for(let p=1;p<d.length;++p){let m=d.slice(-p).join("."),y=d.slice(0,-p).join(".");if(n[y]!=null){n[y][m]=e,h=!0;break}else if(n.$set&&n.$set[y]){n.$set[y][m]=e,h=!0;break}}}h||(s.$set[r]=e),s.hasOwnProperty(r)&&delete s[r]}if(!c&&t){n[t]&&delete n[t],n.$set&&n.$set[t]&&delete n.$set[t];let h=!1;if(t.indexOf(".")!==-1){let d=t.split(".");for(let p=1;p<d.length;++p){let m=d.slice(-p).join("."),y=d.slice(0,-p).join(".");if(n[y]!=null){n[y][m]=e,h=!0;break}else if(n.$set&&n.$set[y]){n.$set[y][m]=e,h=!0;break}}}h||(s.$setOnInsert=s.$setOnInsert||{},s.$setOnInsert[t]=e)}return Object.keys(s.$set).length===0&&delete s.$set,s}});var Ok=_((bMe,Sk)=>{"use strict";var Bde=vb(),Lde=Sb(),kde=je(),vk=gb(),Fde=_a();Sk.exports=function(t,r){let n=t.childSchemas.find(i);function i(h){return!!h.schema.options.timestamps}if(!r&&!n)return;let s=vk(r,"createdAt"),o=vk(r,"updatedAt"),a=r!=null&&r.hasOwnProperty("currentTime")?r.currentTime:null,u={};t.$timestamps={createdAt:s,updatedAt:o},o&&!t.paths[o]&&(u[o]=Date),s&&!t.paths[s]&&(u[s]=Date),t.add(u),t.pre("save",function(h){let d=kde(this,"$__.saveOptions.timestamps");if(d===!1)return h();let p=d!=null&&d.updatedAt===!1,m=d!=null&&d.createdAt===!1,y=a!=null?a():(this.ownerDocument?this.ownerDocument():this).constructor.base.now(),g=this._id&&this._id.auto;if(!m&&this.isNew&&s&&!this.get(s)&&this.$__isSelected(s)&&this.$set(s,g?this._id.getTimestamp():y),!p&&o&&(this.isNew||this.isModified())){let w=y;this.isNew&&(s!=null?w=this.$__getValue(s):g&&(w=this._id.getTimestamp())),this.$set(o,w)}h()}),t.methods.initializeTimestamps=function(){let h=a!=null?a():this.constructor.base.now();return s&&!this.get(s)&&this.$set(s,h),o&&!this.get(o)&&this.$set(o,h),this},f[Fde.builtInMiddleware]=!0;let c={query:!0,model:!1};t.pre("findOneAndReplace",c,f),t.pre("findOneAndUpdate",c,f),t.pre("replaceOne",c,f),t.pre("update",c,f),t.pre("updateOne",c,f),t.pre("updateMany",c,f);function f(h){let d=a!=null?a():this.model.base.now();this.op==="findOneAndReplace"&&this.getUpdate()==null&&this.setUpdate({}),Lde(d,s,o,this.getUpdate(),this.options,this.schema),Bde(d,this.getUpdate(),this.model.schema),h()}}});var Ek=_((EMe,bk)=>{"use strict";var Ude=on(),Vde=require("util");bk.exports=Wde;function Wde(e,t){if(typeof e!="string"&&typeof e!="function")throw new Ude('Invalid ref at path "'+t+'". Got '+Vde.inspect(e,{depth:0}))}});var Hm=_((CMe,Ck)=>{"use strict";Ck.exports=Ob;Ob.middlewareFunctions=["count","countDocuments","deleteMany","deleteOne","distinct","estimatedDocumentCount","find","findOne","findOneAndDelete","findOneAndRemove","findOneAndReplace","findOneAndUpdate","remove","replaceOne","update","updateMany","updateOne","validate"];function Ob(e,t){let r={useErrorHandlers:!0,numCallbackParams:1,nullResultByDefault:!0},n=t.hooks.filter(i=>{let s=zde(i);return i.name==="updateOne"?s.query==null||!!s.query:i.name==="deleteOne"?!!s.query||Object.keys(s).length===0:i.name==="validate"||i.name==="remove"?!!s.query:i.query!=null||i.document!=null?!!i.query:!0});e.prototype._execUpdate=n.createWrapper("update",e.prototype._execUpdate,null,r),e.prototype.__distinct=n.createWrapper("distinct",e.prototype.__distinct,null,r),e.prototype.validate=n.createWrapper("validate",e.prototype.validate,null,r),Ob.middlewareFunctions.filter(i=>i!=="update"&&i!=="distinct"&&i!=="validate").forEach(i=>{e.prototype[`_${i}`]=n.createWrapper(i,e.prototype[`_${i}`],null,r)})}function zde(e){let t={};return e.hasOwnProperty("query")&&(t.query=e.query),e.hasOwnProperty("document")&&(t.document=e.document),t}});var Gm=_((TMe,Tk)=>{"use strict";var Hde=_a(),Kde=an();Tk.exports=Km;Km.middlewareFunctions=["deleteOne","save","validate","remove","updateOne","init"];function Km(e,t,r){r=r||{};let n={useErrorHandlers:!0,numCallbackParams:1,nullResultByDefault:!0,contextParameter:!0},i=r.decorateDoc?e:e.prototype;e.$appliedHooks=!0;for(let u of Object.keys(t.paths)){let c=t.paths[u],f=null;if(c.$isSingleNested)f=c.caster;else if(c.$isMongooseDocumentArray)f=c.Constructor;else continue;if(!f.$appliedHooks&&(Km(f,c.schema,r),f.discriminators!=null)){let h=Object.keys(f.discriminators);for(let d of h)Km(f.discriminators[d],f.discriminators[d].schema,r)}}let s=t.s.hooks.filter(u=>u.name==="updateOne"||u.name==="deleteOne"?!!u.document:u.name==="remove"||u.name==="init"?u.document==null||!!u.document:u.query!=null||u.document!=null?u.document!==!1:!0).filter(u=>t.methods[u.name]?!u.fn[Hde.builtInMiddleware]:!0);e._middleware=s,i.$__originalValidate=i.$__originalValidate||i.$__validate;for(let u of["save","validate","remove","deleteOne"]){let c=u==="validate"?"$__originalValidate":`$__${u}`,f=s.createWrapper(u,i[c],null,n);i[`$__${u}`]=f}i.$__init=s.createWrapperSync("init",i.$__init,null,n);let o=Object.keys(t.methods),a=Object.assign({},n,{checkForPromise:!0});for(let u of o){if(!s.hasHooks(u))continue;let c=i[u];i[u]=function(){let f=Array.prototype.slice.call(arguments),h=f.slice(-1).pop(),d=typeof h=="function"?f.slice(0,f.length-1):f;return Kde(h,p=>this[`$__${u}`].apply(this,d.concat([p])),e.events)},i[`$__${u}`]=s.createWrapper(u,c,null,a)}}});var xk=_((AMe,Ak)=>{"use strict";var Gde=On(),bn=class extends Gde{},Ai=Ln();Object.defineProperty(bn.prototype,"enum",Ai);Object.defineProperty(bn.prototype,"match",Ai);Object.defineProperty(bn.prototype,"lowercase",Ai);Object.defineProperty(bn.prototype,"trim",Ai);Object.defineProperty(bn.prototype,"uppercase",Ai);Object.defineProperty(bn.prototype,"minLength",Ai);Object.defineProperty(bn.prototype,"minlength",Ai);Object.defineProperty(bn.prototype,"maxLength",Ai);Object.defineProperty(bn.prototype,"maxlength",Ai);Object.defineProperty(bn.prototype,"populate",Ai);Ak.exports=bn});var bb=_((xMe,qk)=>{"use strict";var Qde=vn();qk.exports=function(t,r){if(t==null)return t;if(t._id&&typeof t._id=="string")return t._id;if(t.toString&&t.toString!==Object.prototype.toString&&!Array.isArray(t))return t.toString();throw new Qde("string",t,r)}});var Nk=_((qMe,Mk)=>{"use strict";var ws=Wr(),mf=Ft(),Yde=xk(),Jde=bb(),Eb=Ne(),Xde=ws.CastError;function Xe(e,t){this.enumValues=[],this.regExp=null,ws.call(this,e,t,"String")}Xe.schemaName="String";Xe.defaultOptions={};Xe.prototype=Object.create(ws.prototype);Xe.prototype.constructor=Xe;Object.defineProperty(Xe.prototype,"OptionsConstructor",{configurable:!1,enumerable:!1,writable:!1,value:Yde});Xe._cast=Jde;Xe.cast=function(t){return arguments.length===0?this._cast:(t===!1&&(t=this._defaultCaster),this._cast=t,this._cast)};Xe._defaultCaster=e=>{if(e!=null&&typeof e!="string")throw new Error;return e};Xe.get=ws.get;Xe.set=ws.set;Xe._checkRequired=e=>(e instanceof String||typeof e=="string")&&e.length;Xe.checkRequired=ws.checkRequired;Xe.prototype.enum=function(){if(this.enumValidator&&(this.validators=this.validators.filter(function(n){return n.validator!==this.enumValidator},this),this.enumValidator=!1),arguments[0]===void 0||arguments[0]===!1)return this;let e,t;Eb.isObject(arguments[0])?Array.isArray(arguments[0].values)?(e=arguments[0].values,t=arguments[0].message):(e=Eb.object.vals(arguments[0]),t=mf.messages.String.enum):(e=arguments,t=mf.messages.String.enum);for(let n of e)n!==void 0&&this.enumValues.push(this.cast(n));let r=this.enumValues;return this.enumValidator=function(n){return n===void 0||~r.indexOf(n)},this.validators.push({validator:this.enumValidator,message:t,type:"enum",enumValues:r}),this};Xe.prototype.lowercase=function(e){return arguments.length>0&&!e?this:this.set(function(t,r){return typeof t!="string"&&(t=r.cast(t)),t&&t.toLowerCase()})};Xe.prototype.uppercase=function(e){return arguments.length>0&&!e?this:this.set(function(t,r){return typeof t!="string"&&(t=r.cast(t)),t&&t.toUpperCase()})};Xe.prototype.trim=function(e){return arguments.length>0&&!e?this:this.set(function(t,r){return typeof t!="string"&&(t=r.cast(t)),t&&t.trim()})};Xe.prototype.minlength=function(e,t){if(this.minlengthValidator&&(this.validators=this.validators.filter(function(r){return r.validator!==this.minlengthValidator},this)),e!=null){let r=t||mf.messages.String.minlength;r=r.replace(/{MINLENGTH}/,e),this.validators.push({validator:this.minlengthValidator=function(n){return n===null||n.length>=e},message:r,type:"minlength",minlength:e})}return this};Xe.prototype.minLength=Xe.prototype.minlength;Xe.prototype.maxlength=function(e,t){if(this.maxlengthValidator&&(this.validators=this.validators.filter(function(r){return r.validator!==this.maxlengthValidator},this)),e!=null){let r=t||mf.messages.String.maxlength;r=r.replace(/{MAXLENGTH}/,e),this.validators.push({validator:this.maxlengthValidator=function(n){return n===null||n.length<=e},message:r,type:"maxlength",maxlength:e})}return this};Xe.prototype.maxLength=Xe.prototype.maxlength;Xe.prototype.match=function(t,r){let n=r||mf.messages.String.match,i=function(s){return t?(t.lastIndex=0,s!=null&&s!==""?t.test(s):!0):!1};return this.validators.push({validator:i,message:n,type:"regexp",regexp:t}),this};Xe.prototype.checkRequired=function(t,r){return ws._isRef(this,t,r,!0)?!!t:(typeof this.constructor.checkRequired=="function"?this.constructor.checkRequired():Xe.checkRequired())(t)};Xe.prototype.cast=function(e,t,r){if(ws._isRef(this,e,t,r))return typeof e=="string"?e:this._castRef(e,t,r);let n;typeof this._castFunction=="function"?n=this._castFunction:typeof this.constructor.cast=="function"?n=this.constructor.cast():n=Xe.cast();try{return n(e)}catch{throw new Xde("string",e,this.path,null,this)}};function Qu(e){return this.castForQuery(e)}function Zde(e){let t=this;return Array.isArray(e)?e.map(function(r){return t.castForQuery(r)}):[this.castForQuery(e)]}var epe=Eb.options(ws.prototype.$conditionalHandlers,{$all:Zde,$gt:Qu,$gte:Qu,$lt:Qu,$lte:Qu,$options:String,$regex:Qu,$not:Qu});Object.defineProperty(Xe.prototype,"$conditionalHandlers",{configurable:!1,enumerable:!1,writable:!1,value:Object.freeze(epe)});Xe.prototype.castForQuery=function(e,t){let r;if(arguments.length===2){if(r=this.$conditionalHandlers[e],!r)throw new Error("Can't use "+e+" with String.");return r.call(this,t)}return t=e,Object.prototype.toString.call(t)==="[object RegExp]"?t:this._castForQuery(t)};Mk.exports=Xe});var Pk=_((MMe,$k)=>{"use strict";var tpe=On(),va=class extends tpe{},Qm=Ln();Object.defineProperty(va.prototype,"min",Qm);Object.defineProperty(va.prototype,"max",Qm);Object.defineProperty(va.prototype,"enum",Qm);Object.defineProperty(va.prototype,"populate",Qm);$k.exports=va});var Cb=_((NMe,Rk)=>{"use strict";var Ik=require("assert");Rk.exports=function(t){if(t==null)return t;if(t==="")return null;if((typeof t=="string"||typeof t=="boolean")&&(t=Number(t)),Ik.ok(!isNaN(t)),t instanceof Number)return t.valueOf();if(typeof t=="number")return t;if(!Array.isArray(t)&&typeof t.valueOf=="function")return Number(t.valueOf());if(t.toString&&!Array.isArray(t)&&t.toString()==Number(t))return Number(t);Ik.ok(!1)}});var Tb=_(($Me,jk)=>{"use strict";var rpe=vn();function npe(e){let t=this;return Array.isArray(e)?e.map(function(r){return Dk(t.path,r)}):Buffer.isBuffer(e)?e:Dk(t.path,e)}function Dk(e,t){let r=Number(t);if(isNaN(r))throw new rpe("number",t,e);return r}jk.exports=npe});var xb=_((PMe,Lk)=>{"use strict";var Xm=Ft(),ipe=Pk(),vs=Wr(),spe=Cb(),Ym=Tb(),Ab=Ne(),Bk=vs.CastError;function Et(e,t){vs.call(this,e,t,"Number")}Et.get=vs.get;Et.set=vs.set;Et._cast=spe;Et.cast=function(t){return arguments.length===0?this._cast:(t===!1&&(t=this._defaultCaster),this._cast=t,this._cast)};Et._defaultCaster=e=>{if(typeof e!="number")throw new Error;return e};Et.schemaName="Number";Et.defaultOptions={};Et.prototype=Object.create(vs.prototype);Et.prototype.constructor=Et;Et.prototype.OptionsConstructor=ipe;Et._checkRequired=e=>typeof e=="number"||e instanceof Number;Et.checkRequired=vs.checkRequired;Et.prototype.checkRequired=function(t,r){return vs._isRef(this,t,r,!0)?!!t:(typeof this.constructor.checkRequired=="function"?this.constructor.checkRequired():Et.checkRequired())(t)};Et.prototype.min=function(e,t){if(this.minValidator&&(this.validators=this.validators.filter(function(r){return r.validator!==this.minValidator},this)),e!=null){let r=t||Xm.messages.Number.min;r=r.replace(/{MIN}/,e),this.validators.push({validator:this.minValidator=function(n){return n==null||n>=e},message:r,type:"min",min:e})}return this};Et.prototype.max=function(e,t){if(this.maxValidator&&(this.validators=this.validators.filter(function(r){return r.validator!==this.maxValidator},this)),e!=null){let r=t||Xm.messages.Number.max;r=r.replace(/{MAX}/,e),this.validators.push({validator:this.maxValidator=function(n){return n==null||n<=e},message:r,type:"max",max:e})}return this};Et.prototype.enum=function(e,t){return this.enumValidator&&(this.validators=this.validators.filter(function(r){return r.validator!==this.enumValidator},this)),Array.isArray(e)||(Ab.isObject(e)?e=Ab.object.vals(e):e=Array.prototype.slice.call(arguments),t=Xm.messages.Number.enum),t=t??Xm.messages.Number.enum,this.enumValidator=r=>r==null||e.indexOf(r)!==-1,this.validators.push({validator:this.enumValidator,message:t,type:"enum",enumValues:e}),this};Et.prototype.cast=function(e,t,r){if(vs._isRef(this,e,t,r))return typeof e=="number"?e:this._castRef(e,t,r);let n=e&&typeof e._id<"u"?e._id:e,i;typeof this._castFunction=="function"?i=this._castFunction:typeof this.constructor.cast=="function"?i=this.constructor.cast():i=Et.cast();try{return i(n)}catch(s){throw new Bk("Number",n,this.path,s,this)}};function Jm(e){return this.cast(e)}function ope(e){let t=this;return Array.isArray(e)?e.map(function(r){return t.cast(r)}):[this.cast(e)]}Et.prototype.$conditionalHandlers=Ab.options(vs.prototype.$conditionalHandlers,{$bitsAllClear:Ym,$bitsAnyClear:Ym,$bitsAllSet:Ym,$bitsAnySet:Ym,$gt:Jm,$gte:Jm,$lt:Jm,$lte:Jm,$mod:ope});Et.prototype.castForQuery=function(e,t){let r;if(arguments.length===2){if(r=this.$conditionalHandlers[e],!r)throw new Bk("number",t,this.path,null,this);return r.call(this,t)}return t=this._castForQuery(e),t};Lk.exports=Et});var Fk=_((IMe,kk)=>{"use strict";var ape=vn(),gf=Wr(),yf=jm(),upe=Ne();function Pt(e,t){gf.call(this,e,t,"Boolean")}Pt.schemaName="Boolean";Pt.defaultOptions={};Pt.prototype=Object.create(gf.prototype);Pt.prototype.constructor=Pt;Pt._cast=yf;Pt.set=gf.set;Pt.cast=function(t){return arguments.length===0?this._cast:(t===!1&&(t=this._defaultCaster),this._cast=t,this._cast)};Pt._defaultCaster=e=>{if(e!=null&&typeof e!="boolean")throw new Error;return e};Pt._checkRequired=e=>e===!0||e===!1;Pt.checkRequired=gf.checkRequired;Pt.prototype.checkRequired=function(e){return this.constructor._checkRequired(e)};Object.defineProperty(Pt,"convertToTrue",{get:()=>yf.convertToTrue,set:e=>{yf.convertToTrue=e}});Object.defineProperty(Pt,"convertToFalse",{get:()=>yf.convertToFalse,set:e=>{yf.convertToFalse=e}});Pt.prototype.cast=function(e){let t;typeof this._castFunction=="function"?t=this._castFunction:typeof this.constructor.cast=="function"?t=this.constructor.cast():t=Pt.cast();try{return t(e)}catch(r){throw new ape("Boolean",e,this.path,r,this)}};Pt.$conditionalHandlers=upe.options(gf.prototype.$conditionalHandlers,{});Pt.prototype.castForQuery=function(e,t){let r;return arguments.length===2?(r=Pt.$conditionalHandlers[e],r?r.call(this,t):this._castForQuery(t)):this._castForQuery(e)};Pt.prototype._castNullish=function(t){if(typeof t>"u"&&this.$$context!=null&&this.$$context._mongooseOptions!=null&&this.$$context._mongooseOptions.omitUndefined)return t;let r=typeof this.constructor.cast=="function"?this.constructor.cast():Pt.cast();return r==null?t:r.convertToFalse instanceof Set&&r.convertToFalse.has(t)?!1:r.convertToTrue instanceof Set&&r.convertToTrue.has(t)?!0:t};kk.exports=Pt});var Wk=_((RMe,Vk)=>{"use strict";var cpe=On(),_f=class extends cpe{},Uk=Ln();Object.defineProperty(_f.prototype,"enum",Uk);Object.defineProperty(_f.prototype,"of",Uk);Vk.exports=_f});var Hk=_((DMe,zk)=>{"use strict";zk.exports=qb;function qb(e){if(!Array.isArray(e))return{min:0,max:0,containsNonArrayItem:!0};if(e.length===0)return{min:1,max:1,containsNonArrayItem:!1};if(e.length===1&&!Array.isArray(e[0]))return{min:1,max:1,containsNonArrayItem:!1};let t=qb(e[0]);for(let r=1;r<e.length;++r){let n=qb(e[r]);n.min<t.min&&(t.min=n.min),n.max>t.max&&(t.max=n.max),t.containsNonArrayItem=t.containsNonArrayItem||n.containsNonArrayItem}return t.min=t.min+1,t.max=t.max+1,t}});var Yk=_((jMe,Qk)=>{"use strict";var lpe=vn(),Kk=jm(),Gk=bb();Qk.exports=function(e,t){if(e==null||typeof e!="object")throw new lpe("$text",e,t);return e.$search!=null&&(e.$search=Gk(e.$search,t+".$search")),e.$language!=null&&(e.$language=Gk(e.$language,t+".$language")),e.$caseSensitive!=null&&(e.$caseSensitive=Kk(e.$caseSensitive,t+".$castSensitive")),e.$diacriticSensitive!=null&&(e.$diacriticSensitive=Kk(e.$diacriticSensitive,t+".$diacriticSensitive")),e}});var Mb=_((BMe,Xk)=>{"use strict";var Jk=Zn();Xk.exports=function(t,r){return typeof t=="string"&&typeof r=="string"||typeof t=="number"&&typeof r=="number"?t===r:t instanceof Jk&&r instanceof Jk?t.toString()===r.toString():!1}});var eF=_((LMe,Zk)=>{"use strict";var fpe=Mb();Zk.exports=function(t,r){if(t==null||t.discriminators==null)return null;for(let n of Object.keys(t.discriminators)){let i=t.discriminators[n];if(i.discriminatorMapping!=null&&fpe(i.discriminatorMapping.value,r))return i}return null}});var Zm=_((kMe,tF)=>{"use strict";var hpe=new Set(["$ref","$id","$db"]);tF.exports=function(t){return t.startsWith("$")&&!hpe.has(t)}});var Yu=_((FMe,iF)=>{"use strict";var rF=vn(),Nb=ga(),dpe=wf(),ppe=Yk(),$b=je(),mpe=Ur(),ype=eF(),nF=Zm(),gpe=require("util"),Ib=ca(),Pb=rf(),_pe=["Polygon","MultiPolygon"];iF.exports=function e(t,r,n,i){if(Array.isArray(r))throw new Error("Query filter must be an object, got an array ",gpe.inspect(r));if(r==null)return r;r.hasOwnProperty("_bsontype")&&r._bsontype!=="ObjectID"&&delete r._bsontype,t!=null&&t.discriminators!=null&&r[t.options.discriminatorKey]!=null&&(t=ype(t,r[t.options.discriminatorKey])||t);let s=Object.keys(r),o=s.length,a,u,c,f,h,d,p;for(n=n||{};o--;)if(h=s[o],p=r[h],h==="$or"||h==="$nor"||h==="$and"){if(!Array.isArray(p))throw new rF("Array",p,h);for(let m=0;m<p.length;++m){if(p[m]==null||typeof p[m]!="object")throw new rF("Object",p[m],h+"."+m);p[m]=e(t,p[m],n,i)}}else if(h==="$where"){if(d=typeof p,d!=="string"&&d!=="function")throw new Error("Must have a string or function for $where");d==="function"&&(r[h]=p.toString());continue}else if(h==="$elemMatch")p=e(t,p,n,i);else if(h==="$text")p=ppe(p,h);else{if(!t)continue;if(c=t.path(h),!c){let m=h.split("."),y=m.length;for(;y--;){let g=m.slice(0,y).join("."),w=m.slice(y).join("."),S=t.path(g),v=$b(S,"schema.options.discriminatorKey");if(S!=null&&$b(S,"schema.discriminators")!=null&&v!=null&&w!==v){let E=$b(r,g+"."+v);E!=null&&(c=S.schema.discriminators[E].path(w))}}}if(c){if(p==null)continue;if(mpe(p)==="Object")if(u=Object.keys(p).some(nF),!u)r[h]=c.castForQueryWrapper({val:p,context:i});else{let m=Object.keys(p),y,g=m.length;for(;g--;)if(y=m[g],f=p[y],y==="$not"){if(f&&c&&!c.caster){if(a=Object.keys(f),a.length&&nF(a[0]))for(let w in f)f[w]=c.castForQueryWrapper({$conditional:w,val:f[w],context:i});else p[y]=c.castForQueryWrapper({$conditional:y,val:f,context:i});continue}e(c.caster?c.caster.schema:t,f,n,i)}else p[y]=c.castForQueryWrapper({$conditional:y,val:f,context:i})}else if(Array.isArray(p)&&["Buffer","Array"].indexOf(c.instance)===-1){let m=[],y=p;for(let g of y)m.push(c.castForQueryWrapper({val:g,context:i}));r[h]={$in:m}}else r[h]=c.castForQueryWrapper({val:p,context:i})}else{let m=h.split("."),y=m.length,g,w,S;for(;y--&&(g=m.slice(0,y).join("."),c=t.path(g),!c););if(c){c.caster&&c.caster.schema?(S={},w=m.slice(y).join("."),S[w]=p,r[h]=e(c.caster.schema,S,n,i)[w]):r[h]=p;continue}if(Ib(p)){let v="";if(p.$near?v="$near":p.$nearSphere?v="$nearSphere":p.$within?v="$within":p.$geoIntersects?v="$geoIntersects":p.$geoWithin&&(v="$geoWithin"),v){let E=new dpe.Number("__QueryCasting__"),A=p[v];if(p.$maxDistance!=null&&(p.$maxDistance=E.castForQueryWrapper({val:p.$maxDistance,context:i})),p.$minDistance!=null&&(p.$minDistance=E.castForQueryWrapper({val:p.$minDistance,context:i})),v==="$within"){let x=A.$center||A.$centerSphere||A.$box||A.$polygon;if(!x)throw new Error("Bad $within parameter: "+JSON.stringify(p));A=x}else if(v==="$near"&&typeof A.type=="string"&&Array.isArray(A.coordinates))A=A.coordinates;else if((v==="$near"||v==="$nearSphere"||v==="$geoIntersects")&&A.$geometry&&typeof A.$geometry.type=="string"&&Array.isArray(A.$geometry.coordinates))A.$maxDistance!=null&&(A.$maxDistance=E.castForQueryWrapper({val:A.$maxDistance,context:i})),A.$minDistance!=null&&(A.$minDistance=E.castForQueryWrapper({val:A.$minDistance,context:i})),Pb(A.$geometry)&&(A.$geometry=A.$geometry.toObject({transform:!1,virtuals:!1})),A=A.$geometry.coordinates;else if(v==="$geoWithin")if(A.$geometry){Pb(A.$geometry)&&(A.$geometry=A.$geometry.toObject({virtuals:!1}));let x=A.$geometry.type;if(_pe.indexOf(x)===-1)throw new Error('Invalid geoJSON type for $geoWithin "'+x+'", must be "Polygon" or "MultiPolygon"');A=A.$geometry.coordinates}else A=A.$box||A.$polygon||A.$center||A.$centerSphere,Pb(A)&&(A=A.toObject({virtuals:!1}));Rb(A,E,i);continue}}if(t.nested[h])continue;if(n.upsert&&n.strict)throw n.strict==="throw"?new Nb(h):new Nb(h,'Path "'+h+'" is not in schema, strict mode is `true`, and upsert is `true`.');if(n.strictQuery==="throw")throw new Nb(h,'Path "'+h+`" is not in schema and strictQuery is 'throw'.`);n.strictQuery&&delete r[h]}}return r};function Rb(e,t,r){if(Array.isArray(e))e.forEach(function(n,i){if(Array.isArray(n)||Ib(n))return Rb(n,t,r);e[i]=t.castForQueryWrapper({val:n,context:r})});else{let n=Object.keys(e),i=n.length;for(;i--;){let s=n[i],o=e[s];Array.isArray(o)||Ib(o)?(Rb(o,t,r),e[s]=o):e[s]=t.castForQuery({val:o,context:r})}}}});var vf=_(Db=>{"use strict";var wpe=xb();Db.castToNumber=sF;Db.castArraysOfNumbers=oF;function sF(e){return wpe.cast()(e)}function oF(e,t){e.forEach(function(r,n){Array.isArray(r)?oF(r,t):e[n]=sF.call(t,r)})}});var Lb=_(ey=>{"use strict";var aF=vf().castArraysOfNumbers,Sf=vf().castToNumber;ey.cast$geoIntersects=Ope;ey.cast$near=vpe;ey.cast$within=Spe;function vpe(e){let t=ty();if(Array.isArray(e))return aF(e,this),e;if(Bb(this,e),e&&e.$geometry)return jb(e,this);if(!Array.isArray(e))throw new TypeError("$near must be either an array or an object with a $geometry property");return t.prototype.castForQuery.call(this,e)}function jb(e,t){switch(e.$geometry.type){case"Polygon":case"LineString":case"Point":aF(e.$geometry.coordinates,t);break;default:break}return Bb(t,e),e}function Spe(e){if(Bb(this,e),e.$box||e.$polygon){let t=e.$box?"$box":"$polygon";e[t].forEach(r=>{if(!Array.isArray(r)){let n="Invalid $within $box argument. Expected an array, received "+r;throw new TypeError(n)}r.forEach((n,i)=>{r[i]=Sf.call(this,n)})})}else if(e.$center||e.$centerSphere){let t=e.$center?"$center":"$centerSphere";e[t].forEach((r,n)=>{Array.isArray(r)?r.forEach((i,s)=>{r[s]=Sf.call(this,i)}):e[t][n]=Sf.call(this,r)})}else e.$geometry&&jb(e,this);return e}function Ope(e){if(!!e.$geometry)return jb(e,this),e}function Bb(e,t){t.$maxDistance&&(t.$maxDistance=Sf.call(e,t.$maxDistance)),t.$minDistance&&(t.$minDistance=Sf.call(e,t.$minDistance))}});var xi=_((WMe,uF)=>{"use strict";var bpe=Mb();uF.exports=function(t,r){if(t==null)return null;for(let n of Object.keys(t)){let i=t[n];if(i.schema&&i.schema.discriminatorMapping&&bpe(i.schema.discriminatorMapping.value,r))return i}return null}});var pF=_((hF,dF)=>{"use strict";var cF=Un(),lF=require("events").EventEmitter,fF=Ft(),Epe=Ju(),Cpe=Zn(),Tpe=fF.ValidationError,Ape=Gm(),xpe=ca();function Fn(e,t,r,n,i){if(!(this instanceof Fn))return new Fn(e,t,r,n,i);if(xpe(t)&&!t.instanceOfSchema&&(t=new Epe(t)),t=this.schema||t,!this.schema&&t.options._id&&(e=e||{},e._id===void 0&&(e._id=new Cpe)),!t)throw new fF.MissingSchemaError;this.$__setSchema(t),cF.call(this,e,r,n,i),Ape(this,t,{decorateDoc:!0});for(let s in t.methods)this[s]=t.methods[s];for(let s in t.statics)this[s]=t.statics[s]}Fn.prototype=Object.create(cF.prototype);Fn.prototype.constructor=Fn;Fn.events=new lF;Fn.$emitter=new lF;["on","once","emit","listeners","removeListener","setMaxListeners","removeAllListeners","addListener"].forEach(function(e){Fn[e]=function(){return Fn.$emitter[e].apply(Fn.$emitter,arguments)}});Fn.ValidationError=Tpe;dF.exports=hF=Fn});var Fb=_((zMe,kb)=>{"use strict";var qpe=Un(),Mpe=pF(),mF=!1;kb.exports=function(){return mF?Mpe:qpe};kb.exports.setBrowser=function(e){mF=e}});var Ss=_(yF=>{"use strict";yF.internalToObjectOptions={transform:!1,virtuals:!1,getters:!1,_skipDepopulateTopLevel:!0,depopulate:!0,flattenDecimals:!1,useProjection:!1}});var Xu=_((KMe,wF)=>{"use strict";var ry=Fb()(),gF=require("events").EventEmitter,Npe=co(),$pe=Cr(),Ppe=Ss().internalToObjectOptions,Ipe=je(),Rpe=an(),_F=require("util"),Ut=pe().documentArrayParent,Dpe=pe().validatorErrorSymbol;function ut(e,t,r,n,i){let s={};t!=null&&t.isMongooseDocumentArray?(this.__parentArray=t,this[Ut]=t.$parent()):(this.__parentArray=void 0,this[Ut]=void 0),this.$setIndex(i),this.$isDocumentArrayElement=!0,this[Ut]!=null&&(s.defaults=this[Ut].$__.$options.defaults),ry.call(this,e,n,r,s);let o=this;this.on("isNew",function(a){o.isNew=a}),o.on("save",function(){o.constructor.emit("save",o)})}ut.prototype=Object.create(ry.prototype);ut.prototype.constructor=ut;for(let e in gF.prototype)ut[e]=gF.prototype[e];ut.prototype.toBSON=function(){return this.toObject(Ppe)};ut.prototype.$setIndex=function(e){if(this.__index=e,Ipe(this,"$__.validationError",null)!=null){let t=Object.keys(this.$__.validationError.errors);for(let r of t)this.invalidate(r,this.$__.validationError.errors[r])}};ut.prototype.markModified=function(e){if(this.$__.activePaths.modify(e),!this.__parentArray)return;let t=this.__parentArray.$path()+".0."+e;this.isNew&&this.ownerDocument().$__isSelected(t)?this.__parentArray._markModified():this.__parentArray._markModified(this,e)};ut.prototype.populate=function(){throw new Error('Mongoose does not support calling populate() on nested docs. Instead of `doc.arr[0].populate("path")`, use `doc.populate("arr.0.path")`')};ut.prototype.save=function(e,t){return typeof e=="function"&&(t=e,e={}),e=e||{},e.suppressWarning||console.warn("mongoose: calling `save()` on a subdoc does **not** save the document to MongoDB, it only runs save middleware. Use `subdoc.save({ suppressWarning: true })` to hide this warning if you're sure this behavior is right for your app."),Rpe(t,r=>{this.$__save(r)})};ut.prototype.$__save=function(e){return $pe(()=>e(null,this))};function jpe(e){let t=e.ownerDocument();function r(){t.removeListener("save",r),t.removeListener("remove",r),e.emit("remove",e),e.constructor.emit("remove",e),t=e=null}t.on("save",r),t.on("remove",r)}ut.prototype.$__remove=function(e){if(e!=null)return e(null,this)};ut.prototype.remove=function(e,t){if(typeof e=="function"&&!t&&(t=e,e=void 0),!this.__parentArray||e&&e.noop)return this.$__remove(t),this;let r;if(!this.willRemove){if(r=this._doc._id,!r)throw new Error("For your own good, Mongoose does not know how to remove an EmbeddedDocument that has no _id");this.__parentArray.pull({_id:r}),this.willRemove=!0,jpe(this)}return this.$__remove(t),this};ut.prototype.update=function(){throw new Error("The #update method is not available on EmbeddedDocuments")};ut.prototype.inspect=function(){return this.toObject({transform:!1,virtuals:!1,flattenDecimals:!1})};if(_F.inspect.custom){ut.prototype[_F.inspect.custom]=ut.prototype.inspect}ut.prototype.invalidate=function(e,t,r){if(ry.prototype.invalidate.call(this,e,t,r),!this[Ut]||this.__index==null){if(t[Dpe]||t instanceof Npe)return this.ownerDocument().$__.validationError;throw t}let n=this.__index,s=[this.__parentArray.$path(),n,e].join(".");return this[Ut].invalidate(s,t,r),this.ownerDocument().$__.validationError};ut.prototype.$markValid=function(e){if(!this[Ut])return;let t=this.__index;if(typeof t<"u"){let n=[this.__parentArray.$path(),t,e].join(".");this[Ut].$markValid(n)}};ut.prototype.$ignore=function(e){if(ry.prototype.$ignore.call(this,e),!this[Ut])return;let t=this.__index;if(typeof t<"u"){let n=[this.__parentArray.$path(),t,e].join(".");this[Ut].$ignore(n)}};ut.prototype.$isValid=function(e){return typeof this.__index<"u"&&this[Ut]?!this[Ut].$__.validationError||!this[Ut].$__.validationError.errors[this.$__fullPath(e)]:!0};ut.prototype.ownerDocument=function(){if(this.$__.ownerDocument)return this.$__.ownerDocument;let e=this[Ut];if(!e)return this;for(;e[Ut]||e.$__parent;)e=e[Ut]||e.$__parent;return this.$__.ownerDocument=e,this.$__.ownerDocument};ut.prototype.$__fullPath=function(e){if(!this.$__.fullPath){let t=this;if(!t[Ut])return e;let r=[];for(;t[Ut]||t.$__parent;)t[Ut]?r.unshift(t.__parentArray.$path()):r.unshift(t.$basePath),t=t[Ut]||t.$__parent;this.$__.fullPath=r.join("."),this.$__.ownerDocument||(this.$__.ownerDocument=t)}return e?this.$__.fullPath+"."+e:this.$__.fullPath};ut.prototype.parent=function(){return this[Ut]};ut.prototype.$parent=ut.prototype.parent;ut.prototype.parentArray=function(){return this.__parentArray};wF.exports=ut});var Ub=_((GMe,vF)=>{"use strict";vF.exports=function(t,r,n){n=n||{};let i=n.skipDocArrays,s=0;if(!t)return s;for(let o of Object.keys(t.$__.activePaths.states.modify)){if(i){let a=t.$__schema.path(o);if(a&&a.$isMongooseDocumentArray)continue}o.startsWith(r+".")&&(delete t.$__.activePaths.states.modify[o],++s)}return s}});var Hb=_((QMe,qF)=>{"use strict";var Wb=Un(),Vb=Xu(),SF=on(),OF=Zn(),bF=Ub(),zb=je(),EF=Ss().internalToObjectOptions,Zu=Ne(),CF=require("util"),qr=pe().arrayAtomicsSymbol,er=pe().arrayParentSymbol,ni=pe().arrayPathSymbol,ln=pe().arraySchemaSymbol,xF=pe().populateModelSymbol,TF=Symbol("mongoose#Array#sliced"),Bpe=Array.prototype.push,AF=Symbol("mongoose#MongooseCoreArray#validators");var Of=class extends Array{get isMongooseArray(){return!0}get validators(){return this[AF]}set validators(t){this[AF]=t}$__getAtomics(){let t=[],r=Object.keys(this[qr]||{}),n=r.length,i=Object.assign({},EF,{_isNested:!0});if(n===0)return t[0]=["$set",this.toObject(i)],t;for(;n--;){let s=r[n],o=this[qr][s];Zu.isMongooseObject(o)?o=o.toObject(i):Array.isArray(o)?o=this.toObject.call(o,i):o!=null&&Array.isArray(o.$each)?o.$each=this.toObject.call(o.$each,i):o!=null&&typeof o.valueOf=="function"&&(o=o.valueOf()),s==="$addToSet"&&(o={$each:o}),t.push([s,o])}return t}$atomics(){return this[qr]||{}}$parent(){return this[er]}$path(){return this[ni]}$shift(){if(this._registerAtomic("$pop",-1),this._markModified(),!this._shifted)return this._shifted=!0,[].shift.call(this)}$pop(){if(this._registerAtomic("$pop",1),this._markModified(),!this._popped)return this._popped=!0,[].pop.call(this)}$schema(){return this[ln]}_cast(t){let r=!1,n;return this[er]&&(r=this[er].populated(this[ni],!0)),r&&t!==null&&t!==void 0?(n=r.options[xF],(Buffer.isBuffer(t)||t instanceof OF||!Zu.isObject(t))&&(t={_id:t}),t.$__schema&&t.$__schema.discriminatorMapping&&t.$__schema.discriminatorMapping.key!==void 0||(t=new n(t)),this[ln].caster.applySetters(t,this[er],!0)):this[ln].caster.applySetters(t,this[er],!1)}_mapCast(t,r){return this._cast(t,this.length+r)}_markModified(t){let r=this[er],n;if(r){if(n=this[ni],arguments.length&&(n=n+"."+t),n!=null&&n.endsWith(".$"))return this;r.markModified(n,arguments.length>0?t:r)}return this}_registerAtomic(t,r){if(this[TF])return;if(t==="$set")return this[qr]={$set:r},bF(this[er],this[ni]),this._markModified(),this;this[qr]||(this[qr]={});let n=this[qr];if(t==="$pop"&&!("$pop"in n)){let s=this;this[er].once("save",function(){s._popped=s._shifted=null})}if(this[qr].$set||Object.keys(n).length&&!(t in n))return this[qr]={$set:this},this;let i;if(t==="$pullAll"||t==="$addToSet")n[t]||(n[t]=[]),n[t]=n[t].concat(r);else if(t==="$pullDocs"){let s=n.$pull||(n.$pull={});r[0]instanceof Vb?(i=s.$or||(s.$or=[]),Array.prototype.push.apply(i,r.map(function(o){return o.toObject({transform:!1,virtuals:!1})}))):(i=s._id||(s._id={$in:[]}),i.$in=i.$in.concat(r))}else t==="$push"?(n.$push=n.$push||{$each:[]},r!=null&&Zu.hasUserDefinedProperty(r,"$each")?n.$push=r:n.$push.$each=n.$push.$each.concat(r)):n[t]=r;return this}addToSet(){ny(this,arguments);let t=[].map.call(arguments,this._mapCast,this);t=this[ln].applySetters(t,this[er]);let r=[],n="";return t[0]instanceof Vb?n="doc":t[0]instanceof Date&&(n="date"),t.forEach(function(i){let s,o=+i;switch(n){case"doc":s=this.some(function(a){return a.equals(i)});break;case"date":s=this.some(function(a){return+a===o});break;default:s=~this.indexOf(i)}s||([].push.call(this,i),this._registerAtomic("$addToSet",i),this._markModified(),[].push.call(r,i))},this),r}hasAtomics(){return Zu.isPOJO(this[qr])?Object.keys(this[qr]).length:0}includes(t,r){return this.indexOf(t,r)!==-1}indexOf(t,r){t instanceof OF&&(t=t.toString()),r=r??0;let n=this.length;for(let i=r;i<n;++i)if(t==this[i])return i;return-1}inspect(){return JSON.stringify(this)}nonAtomicPush(){let t=[].map.call(arguments,this._mapCast,this),r=[].push.apply(this,t);return this._registerAtomic("$set",this),this._markModified(),r}pop(){let t=[].pop.call(this);return this._registerAtomic("$set",this),this._markModified(),t}pull(){let t=[].map.call(arguments,this._cast,this),r=this[er].get(this[ni]),n=r.length,i;for(;n--;)i=r[n],i instanceof Wb?t.some(function(o){return i.equals(o)})&&[].splice.call(r,n,1):~r.indexOf.call(t,i)&&[].splice.call(r,n,1);return t[0]instanceof Vb?this._registerAtomic("$pullDocs",t.map(function(s){return s.$__getValue("_id")||s})):this._registerAtomic("$pullAll",t),this._markModified(),bF(this[er],this[ni])>0&&this._registerAtomic("$set",this),this}push(){let t=arguments,r=t,n=t[0]!=null&&Zu.hasUserDefinedProperty(t[0],"$each");if(n&&(r=t[0],t=t[0].$each),this[ln]==null)return Bpe.apply(this,t);ny(this,t);let i=this[er];t=[].map.call(t,this._mapCast,this),t=this[ln].applySetters(t,i,void 0,void 0,{skipDocumentArrayCast:!0});let s,o=this[qr];if(n){if(r.$each=t,zb(o,"$push.$each.length",0)>0&&o.$push.$position!=o.$position)throw new SF("Cannot call `Array#push()` multiple times with different `$position`");r.$position!=null?([].splice.apply(this,[r.$position,0].concat(t)),s=this.length):s=[].push.apply(this,t)}else{if(zb(o,"$push.$each.length",0)>0&&o.$push.$position!=null)throw new SF("Cannot call `Array#push()` multiple times with different `$position`");r=t,s=[].push.apply(this,t)}return this._registerAtomic("$push",r),this._markModified(),s}remove(){return this.pull.apply(this,arguments)}set(t,r){let n=this._cast(r,t);return this[t]=n,this._markModified(t),this}shift(){let t=[].shift.call(this);return this._registerAtomic("$set",this),this._markModified(),t}sort(){let t=[].sort.apply(this,arguments);return this._registerAtomic("$set",this),t}splice(){let t;if(ny(this,Array.prototype.slice.call(arguments,2)),arguments.length){let r;if(this[ln]==null)r=arguments;else{r=[];for(let n=0;n<arguments.length;++n)r[n]=n<2?arguments[n]:this._cast(arguments[n],arguments[0]+(n-2))}t=[].splice.apply(this,r),this._registerAtomic("$set",this)}return t}slice(){let t=super.slice.apply(this,arguments);return t[er]=this[er],t[ln]=this[ln],t[qr]=this[qr],t[ni]=this[ni],t[TF]=!0,t}filter(){let t=super.filter.apply(this,arguments);return t[er]=this[er],t[ln]=this[ln],t[qr]=this[qr],t[ni]=this[ni],t}toBSON(){return this.toObject(EF)}toObject(t){return t&&t.depopulate?(t=Zu.clone(t),t._isNested=!0,[].concat(this).map(function(r){return r instanceof Wb?r.toObject(t):r})):[].concat(this)}unshift(){ny(this,arguments);let t;return this[ln]==null?t=arguments:(t=[].map.call(arguments,this._cast,this),t=this[ln].applySetters(t,this[er])),[].unshift.apply(this,t),this._registerAtomic("$set",this),this._markModified(),this.length}};CF.inspect.custom&&(Of.prototype[CF.inspect.custom]=Of.prototype.inspect);function Lpe(e,t){if(!t)return!1;for(let r of e){if(r==null)return!1;let n=r.constructor;if(!(r instanceof Wb)||n.modelName!==t&&n.baseModelName!==t)return!1}return!0}function ny(e,t){let r=e==null?null:zb(e[ln],"caster.options.ref",null);e.length===0&&t.length>0&&Lpe(t,r)&&e[er].populated(e[ni],[],{[xF]:t[0].constructor})}qF.exports=Of});var Gb=_((NF,$F)=>{"use strict";var bf=Hb(),Kb=pe().arrayAtomicsSymbol,kpe=pe().arrayParentSymbol,Fpe=pe().arrayPathSymbol,Upe=pe().arraySchemaSymbol,MF=Array.prototype.push;function Vpe(e,t,r,n){let i;if(Array.isArray(e)){let s=e.length;if(s===0)i=new bf;else if(s===1)i=new bf(1),i[0]=e[0];else if(s<1e4)i=new bf,MF.apply(i,e);else{i=new bf;for(let o=0;o<s;++o)MF.call(i,e[o])}e[Kb]!=null&&(i[Kb]=e[Kb])}else i=new bf;return i[Fpe]=t,r!=null&&r.$__!=null&&(i[kpe]=r,i[Upe]=n||r.schema.path(t)),i}$F.exports=NF=Vpe});var iy=_((YMe,IF)=>{"use strict";var Qb=xn().get().Binary,Wpe=Ne(),ho=E0().Buffer;function Vn(e,t,r){let n=arguments.length,i;n===0||arguments[0]===null||arguments[0]===void 0?i=0:i=e;let s,o,a;Array.isArray(t)?(o=t[0],a=t[1]):s=t;let u;return typeof i=="number"||i instanceof Number?u=ho.alloc(i):u=ho.from(i,s,r),Wpe.decorate(u,Vn.mixin),u.isMongooseBuffer=!0,u[Vn.pathSymbol]=o,u[PF]=a,u._subtype=0,u}var zpe=Symbol.for("mongoose#Buffer#_path"),PF=Symbol.for("mongoose#Buffer#_parent");Vn.pathSymbol=zpe;Vn.mixin={_subtype:void 0,_markModified:function(){let e=this[PF];return e&&e.markModified(this[Vn.pathSymbol]),this},write:function(){let e=ho.prototype.write.apply(this,arguments);return e>0&&this._markModified(),e},copy:function(e){let t=ho.prototype.copy.apply(this,arguments);return e&&e.isMongooseBuffer&&e._markModified(),t}};"writeUInt8 writeUInt16 writeUInt32 writeInt8 writeInt16 writeInt32 writeFloat writeDouble fill utf8Write binaryWrite asciiWrite set writeUInt16LE writeUInt16BE writeUInt32LE writeUInt32BE writeInt16LE writeInt16BE writeInt32LE writeInt32BE writeFloatLE writeFloatBE writeDoubleLE writeDoubleBE".split(" ").forEach(function(e){!ho.prototype[e]||(Vn.mixin[e]=function(){let t=ho.prototype[e].apply(this,arguments);return this._markModified(),t})});Vn.mixin.toObject=function(e){let t=typeof e=="number"?e:this._subtype||0;return new Qb(ho.from(this),t)};Vn.mixin.toBSON=function(){return new Qb(this,this._subtype||0)};Vn.mixin.equals=function(e){if(!ho.isBuffer(e)||this.length!==e.length)return!1;for(let t=0;t<this.length;++t)if(this[t]!==e[t])return!1;return!0};Vn.mixin.subtype=function(e){if(typeof e!="number")throw new TypeError("Invalid subtype. Expected a number");this._subtype!==e&&this._markModified(),this._subtype=e};Vn.Binary=Qb;IF.exports=Vn});var Yb=_((JMe,RF)=>{"use strict";var sy=xn().get().ObjectId,Hpe=require("assert");RF.exports=function(t){if(t==null||t instanceof sy)return t;if(t._id){if(t._id instanceof sy)return t._id;if(t._id.toString instanceof Function)return new sy(t._id.toString())}if(t.toString instanceof Function)return new sy(t.toString());Hpe.ok(!1)}});var yo=_((XMe,FF)=>{"use strict";var Kpe=Hb(),kF=Un(),Jb=Zn(),Gpe=Yb(),DF=xi(),Qpe=Ss().internalToObjectOptions,jF=require("util"),BF=Ne(),Xb=pe().arrayAtomicsSymbol,po=pe().arrayParentSymbol,mo=pe().arrayPathSymbol,ii=pe().arraySchemaSymbol,LF=pe().documentArrayParent,Ype=Array.prototype.push,Ef=class extends Kpe{get isMongooseDocumentArray(){return!0}toBSON(){return this.toObject(Qpe)}map(){let t=super.map.apply(this,arguments);return t[ii]=null,t[mo]=null,t[po]=null,t}_cast(t,r){if(this[ii]==null)return t;let n=this[ii].casterConstructor;if((n.$isMongooseDocumentArray?t&&t.isMongooseDocumentArray:t instanceof n)||t&&t.constructor&&t.constructor.baseCasterConstructor===n)return t[LF]&&t.__parentArray||(t[LF]=this[po],t.__parentArray=this),t.$setIndex(r),t;if(t==null)return null;if((Buffer.isBuffer(t)||t instanceof Jb||!BF.isObject(t))&&(t={_id:t}),t&&n.discriminators&&n.schema&&n.schema.options&&n.schema.options.discriminatorKey)if(typeof t[n.schema.options.discriminatorKey]=="string"&&n.discriminators[t[n.schema.options.discriminatorKey]])n=n.discriminators[t[n.schema.options.discriminatorKey]];else{let s=DF(n.discriminators,t[n.schema.options.discriminatorKey]);s&&(n=s)}return n.$isMongooseDocumentArray?n.cast(t,this,void 0,void 0,r):new n(t,this,void 0,void 0,r)}id(t){let r,n,i;try{r=Gpe(t).toString()}catch{r=null}for(let s of this)if(!!s&&(i=s.get("_id"),!(i===null||typeof i>"u"))){if(i instanceof kF){if(n||(n=String(t)),n==i._id)return s}else if(!(t instanceof Jb)&&!(i instanceof Jb)){if(t==i||BF.deepEqual(t,i))return s}else if(r==i)return s}return null}toObject(t){return[].concat(this.map(function(r){return r==null?null:typeof r.toObject!="function"?r:r.toObject(t)}))}slice(){let t=super.slice.apply(this,arguments);return t[po]=this[po],t[mo]=this[mo],t}push(){let t=super.push.apply(this,arguments);return oy(this),t}pull(){let t=super.pull.apply(this,arguments);return oy(this),t}shift(){let t=super.shift.apply(this,arguments);return oy(this),t}splice(){let t=super.splice.apply(this,arguments);return oy(this),t}inspect(){return this.toObject()}create(t){let r=this[ii].casterConstructor;if(t&&r.discriminators&&r.schema&&r.schema.options&&r.schema.options.discriminatorKey)if(typeof t[r.schema.options.discriminatorKey]=="string"&&r.discriminators[t[r.schema.options.discriminatorKey]])r=r.discriminators[t[r.schema.options.discriminatorKey]];else{let n=DF(r.discriminators,t[r.schema.options.discriminatorKey]);n&&(r=n)}return new r(t,this)}notify(t){let r=this;return function n(i,s){s=s||r;let o=s.length;for(;o--;)if(s[o]!=null){switch(t){case"save":i=r[o];break;default:break}s[o].isMongooseArray?n(i,s[o]):s[o]&&s[o].emit(t,i)}}}_markModified(t,r){let n=this[po],i;if(n){if(i=this[mo],arguments.length)if(r!=null){let s=t.__index;i=i+"."+s+"."+r}else i=i+"."+t;if(i!=null&&i.endsWith(".$"))return this;n.markModified(i,arguments.length>0?t:n)}return this}};jF.inspect.custom&&(Ef.prototype[jF.inspect.custom]=Ef.prototype.inspect);function oy(e){let t=e[po];if(!t||t.$__.populated==null)return;let r=Object.keys(t.$__.populated).filter(n=>n.startsWith(e[mo]+"."));for(let n of r){let i=n.slice((e[mo]+".").length);!Array.isArray(t.$__.populated[n].value)||(t.$__.populated[n].value=e.map(s=>s.populated(i)))}}function Jpe(e,t,r){let n=new Ef;if(n[Xb]={},n[ii]=void 0,Array.isArray(e)&&(e[mo]===t&&e[po]===r&&(n[Xb]=Object.assign({},e[Xb])),e.forEach(i=>{Ype.call(n,i)})),n[mo]=t,r&&r instanceof kF)for(n[po]=r,n[ii]=r.schema.path(t);n!=null&&n[ii]!=null&&n[ii].$isMongooseArray&&!n[ii].$isMongooseDocumentArray;)n[ii]=n[ii].casterConstructor;return n}FF.exports=Jpe});var Zb=_((ZMe,UF)=>{"use strict";var Xpe=Ne();UF.exports=function(t){return Xpe.isPOJO(t)&&t.$__!=null&&t._doc!=null?t._doc:t}});var tE=_((eNe,zF)=>{"use strict";var Zpe=wa(),eE=Zn(),eme=ms(),tme=Ne().deepEqual,rme=je(),nme=Ur(),ime=Zb(),VF=require("util"),sme=dm(),ome=pe().populateModelSymbol;var si=class extends Map{constructor(t,r,n,i){nme(t)==="Object"&&(t=Object.keys(t).reduce((s,o)=>s.concat([[o,t[o]]]),[])),super(t),this.$__parent=n!=null&&n.$__!=null?n:null,this.$__path=r,this.$__schemaType=i??new Zpe(r),this.$__runDeferred()}$init(t,r){WF(t),super.set(t,r),r!=null&&r.$isSingleNested&&(r.$basePath=this.$__path+"."+t)}$__set(t,r){super.set(t,r)}get(t,r){return t instanceof eE&&(t=t.toString()),r=r||{},r.getters===!1?super.get(t):this.$__schemaType.applyGetters(super.get(t),this.$__parent)}set(t,r){if(t instanceof eE&&(t=t.toString()),WF(t),r=ime(r),this.$__schemaType==null){this.$__deferred=this.$__deferred||[],this.$__deferred.push({key:t,value:r});return}let n=this.$__path+"."+t,i=this.$__parent!=null&&this.$__parent.$__?this.$__parent.populated(n)||this.$__parent.populated(this.$__path):null,s=this.get(t);if(i!=null)r.$__==null&&(r=new i.options[ome](r)),r.$__.wasPopulated=!0;else try{r=this.$__schemaType.applySetters(r,this.$__parent,!1,this.get(t),{path:n})}catch(a){if(this.$__parent!=null&&this.$__parent.$__!=null){this.$__parent.invalidate(n,a);return}throw a}super.set(t,r),r!=null&&r.$isSingleNested&&(r.$basePath=this.$__path+"."+t);let o=this.$__parent;o!=null&&o.$__!=null&&!tme(r,s)&&o.markModified(this.$__path+"."+t)}clear(){super.clear();let t=this.$__parent;t!=null&&t.markModified(this.$__path)}delete(t){t instanceof eE&&(t=t.toString()),this.set(t,void 0),super.delete(t)}toBSON(){return new Map(this)}toObject(t){if(rme(t,"flattenMaps")){let r={},n=this.keys();for(let i of n)r[i]=eme(this.get(i));return r}return new Map(this)}toJSON(){let t={},r=this.keys();for(let n of r)t[n]=this.get(n);return t}inspect(){return new Map(this)}$__runDeferred(){if(!!this.$__deferred){for(let t of this.$__deferred)this.set(t.key,t.value);this.$__deferred=null}}};VF.inspect.custom&&Object.defineProperty(si.prototype,VF.inspect.custom,{enumerable:!1,writable:!1,configurable:!1,value:si.prototype.inspect});Object.defineProperty(si.prototype,"$__set",{enumerable:!1,writable:!0,configurable:!1});Object.defineProperty(si.prototype,"$__parent",{enumerable:!1,writable:!0,configurable:!1});Object.defineProperty(si.prototype,"$__path",{enumerable:!1,writable:!0,configurable:!1});Object.defineProperty(si.prototype,"$__schemaType",{enumerable:!1,writable:!0,configurable:!1});Object.defineProperty(si.prototype,"$isMongooseMap",{enumerable:!1,writable:!1,configurable:!1,value:!0});Object.defineProperty(si.prototype,"$__deferredCalls",{enumerable:!1,writable:!1,configurable:!1,value:!0});function WF(e){let t=typeof e;if(t!=="string")throw new TypeError(`Mongoose maps only support string keys, got ${t}`);if(e.startsWith("$"))throw new Error(`Mongoose maps do not support keys that start with "$", got "${e}"`);if(e.includes("."))throw new Error(`Mongoose maps do not support keys that contain ".", got "${e}"`);if(sme.has(e))throw new Error(`Mongoose maps do not support reserved key name "${e}"`)}zF.exports=si});var rE=_((tNe,KF)=>{"use strict";var go=Un(),ame=Cr(),ume=Ss().internalToObjectOptions,cme=an(),HF=pe().documentArrayParent;KF.exports=tr;function tr(e,t,r,n,i){this.$isSingleNested=!0,i!=null&&i.path!=null&&(this.$basePath=i.path);let s=i!=null&&i.priorDoc,o=null;if(s&&(this._doc=Object.assign({},i.priorDoc._doc),delete this._doc[this.$__schema.options.discriminatorKey],o=Object.keys(i.priorDoc._doc||{}).filter(a=>a!==this.$__schema.options.discriminatorKey)),r!=null&&(i=Object.assign({},i,{isNew:r.isNew,defaults:r.$__.$options.defaults})),go.call(this,e,t,n,i),s){for(let a of o)if(!this.$__.activePaths.states.modify[a]&&!this.$__.activePaths.states.default[a]&&!this.$__.$setCalled.has(a)){let u=this.$__schema.path(a),c=u==null?void 0:u.getDefault(this);c===void 0?delete this._doc[a]:(this._doc[a]=c,this.$__.activePaths.default(a))}delete i.priorDoc,delete this.$__.$options.priorDoc}}tr.prototype=Object.create(go.prototype);tr.prototype.toBSON=function(){return this.toObject(ume)};tr.prototype.save=function(e,t){return typeof e=="function"&&(t=e,e={}),e=e||{},e.suppressWarning||console.warn("mongoose: calling `save()` on a subdoc does **not** save the document to MongoDB, it only runs save middleware. Use `subdoc.save({ suppressWarning: true })` to hide this warning if you're sure this behavior is right for your app."),cme(t,r=>{this.$__save(r)})};tr.prototype.$__save=function(e){return ame(()=>e(null,this))};tr.prototype.$isValid=function(e){return this.$__parent&&this.$basePath?this.$__parent.$isValid([this.$basePath,e].join(".")):go.prototype.$isValid.call(this,e)};tr.prototype.markModified=function(e){if(go.prototype.markModified.call(this,e),this.$__parent&&this.$basePath){if(this.$__parent.isDirectModified(this.$basePath))return;this.$__parent.markModified([this.$basePath,e].join("."),this)}};tr.prototype.isModified=function(e,t){return this.$__parent&&this.$basePath?Array.isArray(e)||typeof e=="string"?(e=Array.isArray(e)?e:e.split(" "),e=e.map(r=>[this.$basePath,r].join(".")),this.$__parent.isModified(e,t)):this.$__parent.isModified(this.$basePath):go.prototype.isModified.call(this,e,t)};tr.prototype.$markValid=function(e){go.prototype.$markValid.call(this,e),this.$__parent&&this.$basePath&&this.$__parent.$markValid([this.$basePath,e].join("."))};tr.prototype.invalidate=function(e,t,r){if(t!==this.ownerDocument().$__.validationError&&go.prototype.invalidate.call(this,e,t,r),this.$__parent&&this.$basePath)this.$__parent.invalidate([this.$basePath,e].join("."),t,r);else if(t.kind==="cast"||t.name==="CastError")throw t;return this.ownerDocument().$__.validationError};tr.prototype.$ignore=function(e){go.prototype.$ignore.call(this,e),this.$__parent&&this.$basePath&&this.$__parent.$ignore([this.$basePath,e].join("."))};tr.prototype.ownerDocument=function(){if(this.$__.ownerDocument)return this.$__.ownerDocument;let e=this.$__parent;if(!e)return this;for(;e.$__parent||e[HF];)e=e.$__parent||e[HF];return this.$__.ownerDocument=e,this.$__.ownerDocument};tr.prototype.parent=function(){return this.$__parent};tr.prototype.$parent=tr.prototype.parent;tr.prototype.$__remove=function(e){return e(null,this)};tr.prototype.remove=function(e,t){typeof e=="function"&&(t=e,e=null),lme(this),(!e||!e.noop)&&this.$__parent.set(this.$basePath,null),typeof t=="function"&&t(null)};tr.prototype.populate=function(){throw new Error('Mongoose does not support calling populate() on nested docs. Instead of `doc.nested.populate("path")`, use `doc.populate("nested.path")`')};function lme(e){let t=e.ownerDocument();function r(){t.removeListener("save",r),t.removeListener("remove",r),e.emit("remove",e),e.constructor.emit("remove",e),t=e=null}t.on("save",r),t.on("remove",r)}});var Cf=_(qi=>{"use strict";qi.Array=Gb();qi.Buffer=iy();qi.Document=qi.Embedded=Xu();qi.DocumentArray=yo();qi.Decimal128=ua();qi.ObjectId=Zn();qi.Map=tE();qi.Subdocument=rE()});var ty=_((nNe,YF)=>{"use strict";var fme=Bm(),hme=ab(),GF=on(),dme=Wk(),oi=Wr(),uy=oi.CastError,cy=wa(),pme=Hk(),ly=Yu(),nE=je(),mme=Zm(),fy=require("util"),Sa=Ne(),yme=vf().castToNumber,iE=Lb(),gme=xi(),Tf,ay,QF=Symbol("mongoose#isNestedArray"),_me=Object.freeze({});function ht(e,t,r,n){ay||(ay=Cf().Embedded);let i="type";if(n&&n.typeKey&&(i=n.typeKey),this.schemaOptions=n,t){let a={};Sa.isPOJO(t)&&(t[i]?(a=Sa.clone(t),delete a[i],t=t[i]):t=cy),r!=null&&r.ref!=null&&a.ref==null&&(a.ref=r.ref),t===Object&&(t=cy);let u=typeof t=="string"?t:Sa.getFunctionName(t),c=wf(),f=c.hasOwnProperty(u)?c[u]:t;if(this.casterConstructor=f,this.casterConstructor instanceof ht&&(this.casterConstructor[QF]=!0),typeof f=="function"&&!f.$isArraySubdocument&&!f.$isSchemaMap){let h=this.caster instanceof ay?null:e;this.caster=new f(h,a)}else this.caster=f,this.caster instanceof ay||(this.caster.path=e);this.$embeddedSchemaType=this.caster}this.$isMongooseArray=!0,oi.call(this,e,r,"Array");let s,o;if(this.defaultValue!=null&&(s=this.defaultValue,o=typeof s=="function"),!("defaultValue"in this)||this.defaultValue!==void 0){let a=function(){let u=[];return o?u=s.call(this):s!=null&&(u=u.concat(s)),u};a.$runBeforeSetters=!o,this.default(a)}}ht.schemaName="Array";ht.options={castNonArrays:!0};ht.defaultOptions={};ht.set=oi.set;ht.prototype=Object.create(oi.prototype);ht.prototype.constructor=ht;ht.prototype.OptionsConstructor=dme;ht._checkRequired=oi.prototype.checkRequired;ht.checkRequired=oi.checkRequired;ht.prototype.checkRequired=function(t,r){return oi._isRef(this,t,r,!0)?!!t:(typeof this.constructor.checkRequired=="function"?this.constructor.checkRequired():ht.checkRequired())(t)};ht.prototype.enum=function(){let e=this;for(;;){let r=nE(e,"caster.instance");if(r==="Array"){e=e.caster;continue}if(r!=="String"&&r!=="Number")throw new Error("`enum` can only be set on an array of strings or numbers , not "+r);break}let t=arguments;return!Array.isArray(arguments)&&Sa.isObject(arguments)&&(t=Sa.object.vals(t)),e.caster.enum.apply(e.caster,t),this};ht.prototype.applyGetters=function(e,t){if(t!=null&&t.$__!=null&&t.populated(this.path))return e;let r=oi.prototype.applyGetters.call(this,e,t);if(Array.isArray(r)){let n=r.length;for(let i=0;i<n;++i)r[i]=this.caster.applyGetters(r[i],t)}return r};ht.prototype._applySetters=function(e,t,r,n){if(this.casterConstructor.$isMongooseArray&&ht.options.castNonArrays&&!this[QF]){let i=0,s=this;for(;s!=null&&s.$isMongooseArray&&!s.$isMongooseDocumentArray;)++i,s=s.casterConstructor;if(e!=null&&e.length>0){let o=pme(e);if(o.min===o.max&&o.max<i&&o.containsNonArrayItem)for(let a=o.max;a<i;++a)e=[e]}}return oi.prototype._applySetters.call(this,e,t,r,n)};ht.prototype.cast=function(e,t,r,n,i){Tf||(Tf=Cf().Array);let s,o;if(Array.isArray(e)){let a=e.length;if(!a&&t){let h=t.schema.indexedPaths(),d=this.path;for(s=0,o=h.length;s<o;++s){let m=h[s][0][d];if(m==="2dsphere"||m==="2d")return}let p=this.path.endsWith(".coordinates")?this.path.substr(0,this.path.lastIndexOf(".")):null;if(p!=null){for(s=0,o=h.length;s<o;++s)if(h[s][0][p]==="2dsphere")return}}if(i=i||_me,e=Tf(e,i.path||this._arrayPath||this.path,t,this),r&&t!=null&&t.$__!=null&&t.populated(this.path))return e;let u=this.caster,c=u.$isMongooseArray,f=u.instance==="Number";if(u&&this.casterConstructor!==cy)try{for(s=0;s<a;s++){if(f&&e[s]===void 0)throw new GF("Mongoose number arrays disallow storing undefined");let h={};c&&(i.arrayPath!=null||u._arrayParentPath!=null)&&(h.arrayPathIndex=s),e[s]=u.applySetters(e[s],t,r,void 0,h)}}catch(h){throw new uy("["+h.kind+"]",fy.inspect(e),this.path+"."+s,h,this)}return e}if(r||ht.options.castNonArrays)return!!t&&!!r&&t.markModified(this.path),this.cast([e],t,r);throw new uy("Array",fy.inspect(e),this.path,null,this)};ht.prototype._castForPopulate=function(t,r){if(Tf||(Tf=Cf().Array),Array.isArray(t)){let n,i=t.length,s=this.caster;if(s&&this.casterConstructor!==cy)try{for(n=0;n<i;n++){let o={};s.$isMongooseArray&&s._arrayParentPath!=null&&(o.arrayPathIndex=n),t[n]=s.cast(t[n],r,!1,void 0,o)}}catch(o){throw new uy("["+o.kind+"]",fy.inspect(t),this.path+"."+n,o,this)}return t}throw new uy("Array",fy.inspect(t),this.path,null,this)};ht.prototype.discriminator=function(e,t){let r=this;for(;r.$isMongooseArray&&!r.$isMongooseDocumentArray;)if(r=r.casterConstructor,r==null||typeof r=="function")throw new GF("You can only add an embedded discriminator on a document array, "+this.path+" is a plain array");return r.discriminator(e,t)};ht.prototype.clone=function(){let e=Object.assign({},this.options),t=new this.constructor(this.path,this.caster,e,this.schemaOptions);return t.validators=this.validators.slice(),this.requiredValidator!==void 0&&(t.requiredValidator=this.requiredValidator),t};ht.prototype.castForQuery=function(e,t){let r,n;if(arguments.length===2){if(r=this.$conditionalHandlers[e],!r)throw new Error("Can't use "+e+" with Array.");n=r.call(this,t)}else{n=e;let i=this.casterConstructor;if(n&&i.discriminators&&i.schema&&i.schema.options&&i.schema.options.discriminatorKey)if(typeof n[i.schema.options.discriminatorKey]=="string"&&i.discriminators[n[i.schema.options.discriminatorKey]])i=i.discriminators[n[i.schema.options.discriminatorKey]];else{let u=gme(i.discriminators,n[i.schema.options.discriminatorKey]);u&&(i=u)}let s=this.casterConstructor.prototype,o=s&&(s.castForQuery||s.cast);!o&&i.castForQuery&&(o=i.castForQuery);let a=this.caster;Array.isArray(n)?(this.setters.reverse().forEach(u=>{n=u.call(this,n,this)}),n=n.map(function(u){return Sa.isObject(u)&&u.$elemMatch?u:o?(u=o.call(a,u),u):(u!=null&&(u=new i(u)),u)})):o?n=o.call(a,n):n!=null&&(n=new i(n))}return n};function wme(e){return Array.isArray(e)||(e=[e]),e=e.map(function(t){if(Sa.isObject(t)){let r={};return r[this.path]=t,ly(this.casterConstructor.schema,r)[this.path]}return t},this),this.castForQuery(e)}function vme(e){let t=Object.keys(e),r=t.length;for(let s=0;s<r;++s){let o=t[s],a=e[o];mme(o)&&a!=null&&(e[o]=this.castForQuery(o,a))}let n=nE(this,"casterConstructor.schema.options.discriminatorKey"),i=nE(this,"casterConstructor.schema.discriminators",{});return n!=null&&e[n]!=null&&i[e[n]]!=null?ly(i[e[n]],e):ly(this.casterConstructor.schema,e)}var gt=ht.prototype.$conditionalHandlers={};gt.$all=wme;gt.$options=String;gt.$elemMatch=vme;gt.$geoIntersects=iE.cast$geoIntersects;gt.$or=sE("$or");gt.$and=sE("$and");gt.$nor=sE("$nor");function sE(e){return function(r){if(!Array.isArray(r))throw new TypeError("conditional "+e+" requires an array");let n=[];for(let i of r)n.push(ly(this.casterConstructor.schema,i));return n}}gt.$near=gt.$nearSphere=iE.cast$near;gt.$within=gt.$geoWithin=iE.cast$within;gt.$size=gt.$minDistance=gt.$maxDistance=yme;gt.$exists=fme;gt.$type=hme;gt.$eq=gt.$gt=gt.$gte=gt.$lt=gt.$lte=gt.$ne=gt.$regex=ht.prototype.castForQuery;gt.$nin=oi.prototype.$conditionalHandlers.$nin;gt.$in=oi.prototype.$conditionalHandlers.$in;YF.exports=ht});var ZF=_((iNe,XF)=>{"use strict";var Sme=On(),Af=class extends Sme{},JF=Ln();Object.defineProperty(Af.prototype,"excludeIndexes",JF);Object.defineProperty(Af.prototype,"_id",JF);XF.exports=Af});var dy=_(aE=>{"use strict";var Ome=pe().documentSchemaSymbol,oE=je(),bme=Ss().internalToObjectOptions,e2=Ne(),ec,Eme=pe().getSymbol,hy=pe().scopeSymbol;aE.compile=t2;aE.defineKey=r2;function t2(e,t,r,n){ec=ec||Un();let i=Object.keys(e),s=i.length,o,a;for(let u=0;u<s;++u){a=i[u],o=e[a];let f=e2.isPOJO(o)&&Object.keys(o).length&&(!o[n.typeKey]||n.typeKey==="type"&&o.type.type)?o:null;r2(a,f,t,r,i,n)}}function r2(e,t,r,n,i,s){ec=ec||Un();let o=(n?n+".":"")+e;n=n||"",t?Object.defineProperty(r,e,{enumerable:!0,configurable:!0,get:function(){let a=this;if(this.$__.getters||(this.$__.getters={}),!this.$__.getters[o]){let u=Object.create(ec.prototype,Cme(this));n||(u.$__[hy]=this),u.$__.nestedPath=o,Object.defineProperty(u,"schema",{enumerable:!1,configurable:!0,writable:!1,value:r.schema}),Object.defineProperty(u,"$__schema",{enumerable:!1,configurable:!0,writable:!1,value:r.schema}),Object.defineProperty(u,Ome,{enumerable:!1,configurable:!0,writable:!1,value:r.schema}),Object.defineProperty(u,"toObject",{enumerable:!1,configurable:!0,writable:!1,value:function(){return e2.clone(a.get(o,null,{virtuals:oE(this,"schema.options.toObject.virtuals",null)}))}}),Object.defineProperty(u,"$__get",{enumerable:!1,configurable:!0,writable:!1,value:function(){return a.get(o,null,{virtuals:oE(this,"schema.options.toObject.virtuals",null)})}}),Object.defineProperty(u,"toJSON",{enumerable:!1,configurable:!0,writable:!1,value:function(){return a.get(o,null,{virtuals:oE(a,"schema.options.toJSON.virtuals",null)})}}),Object.defineProperty(u,"$__isNested",{enumerable:!1,configurable:!0,writable:!1,value:!0});let c=Object.freeze({minimize:!0,virtuals:!1,getters:!1,transform:!1});Object.defineProperty(u,"$isEmpty",{enumerable:!1,configurable:!0,writable:!1,value:function(){return Object.keys(this.get(o,null,c)||{}).length===0}}),Object.defineProperty(u,"$__parent",{enumerable:!1,configurable:!0,writable:!1,value:this}),t2(t,u,o,s),this.$__.getters[o]=u}return this.$__.getters[o]},set:function(a){a!=null&&a.$__isNested?a=a.$__get():a instanceof ec&&!a.$__isNested&&(a=a.toObject(bme)),(this.$__[hy]||this).$set(o,a)}}):Object.defineProperty(r,e,{enumerable:!0,configurable:!0,get:function(){return this[Eme].call(this.$__[hy]||this,o)},set:function(a){this.$set.call(this.$__[hy]||this,o,a)}})}function Cme(e){let t={};return Object.getOwnPropertyNames(e).forEach(function(r){["isNew","$__","errors","_doc","$locals","$op","__parentArray","__index","$isDocumentArrayElement"].indexOf(r)!==-1&&(t[r]=Object.getOwnPropertyDescriptor(e,r),t[r].enumerable=!1)}),t}});var py=_((oNe,s2)=>{"use strict";var n2=wa(),Tme=dy().defineKey,Ame=je(),xf=Ne(),i2={toJSON:!0,toObject:!0,_id:!0,id:!0};s2.exports=function(t,r,n,i,s){if(!(n&&n.instanceOfSchema))throw new Error("You must pass a valid discriminator Schema");if(t.schema.discriminatorMapping&&!t.schema.discriminatorMapping.isRoot)throw new Error('Discriminator "'+r+'" can only be a discriminator of the root model');if(s){let f=Ame(t.base,"options.applyPluginsToDiscriminators",!1);t.base._applyPlugins(n,{skipTopLevel:!f})}let o=t.schema.options.discriminatorKey,a=t.schema.path(o);if(a!=null)xf.hasUserDefinedProperty(a.options,"select")||(a.options.select=!0),a.options.$skipDiscriminatorCheck=!0;else{let f={};f[o]={default:void 0,select:!0,$skipDiscriminatorCheck:!0},f[o][t.schema.options.typeKey]=String,t.schema.add(f),Tme(o,null,t.prototype,null,[o],t.schema.options)}if(n.path(o)&&n.path(o).options.$skipDiscriminatorCheck!==!0)throw new Error('Discriminator "'+r+'" cannot have field with name "'+o+'"');let u=r;(typeof i=="string"&&i.length||i!=null)&&(u=i);function c(f,h){f._baseSchema=h,h.paths._id&&h.paths._id.options&&!h.paths._id.options.auto&&f.remove("_id");let d=Object.keys(h.paths),p=[];for(let E of d){if(f.nested[E]){p.push(E);continue}if(E.indexOf(".")===-1)continue;let A=E.split(".").slice(0,-1),x="";for(let z of A)x+=(x.length?".":"")+z,(f.paths[x]instanceof n2||f.singleNestedPaths[x]instanceof n2)&&p.push(E)}xf.merge(f,h,{isDiscriminatorSchemaMerge:!0,omit:{discriminators:!0,base:!0},omitNested:p.reduce((E,A)=>(E["tree."+A]=!0,E),{})});for(let E of p)delete f.paths[E];f.childSchemas.forEach(E=>{E.model.prototype.$__setSchema(E.schema)});let m={};m[o]={default:u,select:!0,set:function(E){if(E===u||Array.isArray(u)&&xf.deepEqual(E,u))return u;throw new Error(`Can't set discriminator key "`+o+'"')},$skipDiscriminatorCheck:!0},m[o][f.options.typeKey]=a?a.options[f.options.typeKey]:String,f.add(m),f.discriminatorMapping={key:o,value:u,isRoot:!1},h.options.collection&&(f.options.collection=h.options.collection);let y=f.options.toJSON,g=f.options.toObject,w=f.options._id,S=f.options.id,v=Object.keys(f.options);f.options.discriminatorKey=h.options.discriminatorKey;for(let E of v)if(!i2[E]){if(E==="pluralization"&&f.options[E]==!0&&h.options[E]==null)continue;if(!xf.deepEqual(f.options[E],h.options[E]))throw new Error("Can't customize discriminator option "+E+" (can only modify "+Object.keys(i2).join(", ")+")")}f.options=xf.clone(h.options),y&&(f.options.toJSON=y),g&&(f.options.toObject=g),typeof w<"u"&&(f.options._id=w),f.options.id=S,f.s.hooks=t.schema.s.hooks.merge(f.s.hooks),f.plugins=Array.prototype.slice.call(h.plugins),f.callQueue=h.callQueue.concat(f.callQueue),delete f._requiredpaths}if(c(n,t.schema),t.discriminators||(t.discriminators={}),t.schema.discriminatorMapping||(t.schema.discriminatorMapping={key:o,value:null,isRoot:!0}),t.schema.discriminators||(t.schema.discriminators={}),t.schema.discriminators[r]=n,t.discriminators[r])throw new Error('Discriminator with name "'+r+'" already exists');return n}});var uE=_((aNe,o2)=>{"use strict";var xme=mb();o2.exports=function(t,r){return r==null||r._id==null||(t=t.clone(),r._id?t.paths._id||(xme(t),t.options._id=!0):(t.remove("_id"),t.options._id=!1)),t}});var cE=_((uNe,a2)=>{"use strict";var qme=xi();a2.exports=function(t,r){let n=t.schema.options.discriminatorKey;if(r!=null&&t.discriminators&&r[n]!=null)if(t.discriminators[r[n]])t=t.discriminators[r[n]];else{let i=qme(t.discriminators,r[n]);i&&(t=i)}return t}});var y2=_((cNe,m2)=>{"use strict";var h2=ty(),u2=vn(),lE=require("events").EventEmitter,Mme=ZF(),qf=Wr(),Nme=co(),$me=py(),Pme=je(),c2=uE(),l2=require("util"),d2=Ne(),my=cE(),f2=pe().arrayAtomicsSymbol,fE=pe().arrayPathSymbol,Ime=pe().documentArrayParent,Mi,Oa;function lr(e,t,r,n){n!=null&&n._id!=null?t=c2(t,n):r!=null&&r._id!=null&&(t=c2(t,r));let i=p2(t,r);i.prototype.$basePath=e,h2.call(this,e,i,r),this.schema=t,this.schemaOptions=n||{},this.$isMongooseDocumentArray=!0,this.Constructor=i,i.base=t.base;let s=this.defaultValue;(!("defaultValue"in this)||s!==void 0)&&this.default(function(){let a=s.call(this);return Array.isArray(a)||(a=[a]),a});let o=this;this.$embeddedSchemaType=new qf(e+".$",{required:Pme(this,"schemaOptions.required",!1)}),this.$embeddedSchemaType.cast=function(a,u,c){return o.cast(a,u,c)[0]},this.$embeddedSchemaType.$isMongooseDocumentArrayElement=!0,this.$embeddedSchemaType.caster=this.Constructor,this.$embeddedSchemaType.schema=this.schema}lr.schemaName="DocumentArray";lr.options={castNonArrays:!0};lr.prototype=Object.create(h2.prototype);lr.prototype.constructor=lr;lr.prototype.OptionsConstructor=Mme;function p2(e,t,r){Oa||(Oa=Xu());function n(){Oa.apply(this,arguments),this.$session(this.ownerDocument().$session())}let i=r!=null?r.prototype:Oa.prototype;n.prototype=Object.create(i),n.prototype.$__setSchema(e),n.schema=e,n.prototype.constructor=n,n.$isArraySubdocument=!0,n.events=new lE;for(let s in e.methods)n.prototype[s]=e.methods[s];for(let s in e.statics)n[s]=e.statics[s];for(let s in lE.prototype)n[s]=lE.prototype[s];return n.options=t,n}lr.prototype.discriminator=function(e,t,r){typeof e=="function"&&(e=d2.getFunctionName(e)),t=$me(this.casterConstructor,e,t,r);let n=p2(t,null,this.casterConstructor);n.baseCasterConstructor=this.casterConstructor;try{Object.defineProperty(n,"name",{value:e})}catch{}return this.casterConstructor.discriminators[e]=n,this.casterConstructor.discriminators[e]};lr.prototype.doValidate=function(e,t,r,n){Mi||(Mi=yo());let i=this;try{qf.prototype.doValidate.call(this,e,s,r)}catch(o){return o.$isArrayValidatorError=!0,t(o)}function s(o){if(o)return o.$isArrayValidatorError=!0,t(o);let a=e&&e.length,u;if(!a||n&&n.updateValidator)return t();e.isMongooseDocumentArray||(e=new Mi(e,i.path,r));function c(f){f!=null&&(u=f,u instanceof Nme||(u.$isArrayValidatorError=!0)),--a||t(u)}for(let f=0,h=a;f<h;++f){let d=e[f];if(d==null){--a||t(u);continue}if(!(d instanceof Oa)){let p=my(i.casterConstructor,e[f]);d=e[f]=new p(d,e,void 0,void 0,f)}if(n!=null&&n.validateModifiedOnly&&!d.isModified()){--a||t(u);continue}d.$__validate(c)}}};lr.prototype.doValidateSync=function(e,t,r){let n=qf.prototype.doValidateSync.call(this,e,t);if(n!=null)return n.$isArrayValidatorError=!0,n;let i=e&&e.length,s=null;if(!!i){for(let o=0,a=i;o<a;++o){let u=e[o];if(!u)continue;if(!(u instanceof Oa)){let f=my(this.casterConstructor,e[o]);u=e[o]=new f(u,e,void 0,void 0,o)}if(r!=null&&r.validateModifiedOnly&&!u.isModified())continue;let c=u.validateSync();c&&s==null&&(s=c)}return s}};lr.prototype.getDefault=function(e){let t=typeof this.defaultValue=="function"?this.defaultValue.call(e):this.defaultValue;if(t==null)return t;Mi||(Mi=yo()),Array.isArray(t)||(t=[t]),t=new Mi(t,this.path,e);for(let r=0;r<t.length;++r){let n=my(this.casterConstructor,t[r]),i=new n({},t,void 0,void 0,r);i.init(t[r]),i.isNew=!0,Object.assign(i.$__.activePaths.default,i.$__.activePaths.init),i.$__.activePaths.init={},t[r]=i}return t};lr.prototype.cast=function(e,t,r,n,i){if(Mi||(Mi=yo()),e!=null&&e[fE]!=null&&e===n)return e;let s,o,a={transform:!1,virtuals:!1};if(i=i||{},!Array.isArray(e)){if(!r&&!lr.options.castNonArrays)throw new u2("DocumentArray",l2.inspect(e),this.path,null,this);return!!t&&r&&t.markModified(this.path),this.cast([e],t,r,n,i)}!(e&&e.isMongooseDocumentArray)&&!i.skipDocumentArrayCast?e=new Mi(e,this.path,t):e&&e.isMongooseDocumentArray&&(e=new Mi(e,this.path,t)),n!=null&&(e[f2]=n[f2]||{}),i.arrayPathIndex!=null&&(e[fE]=this.path+"."+i.arrayPathIndex);let u=e.length,c={skipId:!0,willInit:!0};for(let f=0;f<u;++f){if(!e[f])continue;let h=my(this.casterConstructor,e[f]);if(e[f].$__&&(!(e[f]instanceof h)||e[f][Ime]!==t)&&(e[f]=e[f].toObject({transform:!1,virtuals:e[f].schema===h.schema})),e[f]instanceof Oa)e[f].__index==null&&e[f].$setIndex(f);else if(e[f]!=null)if(r)t?s||(s=Rme(this,t.$__.selected,r)):s=!0,o=new h(null,e,c,s,f),e[f]=o.init(e[f]);else if(n&&typeof n.id=="function"&&(o=n.id(e[f]._id)),n&&o&&d2.deepEqual(o.toObject(a),e[f]))o.set(e[f]),e[f]=o;else try{o=new h(e[f],e,void 0,void 0,f),e[f]=o}catch(d){let p=l2.inspect(e[f]);throw new u2("embedded",p,e[fE],d,this)}}return e};lr.prototype.clone=function(){let e=Object.assign({},this.options),t=new this.constructor(this.path,this.schema,e,this.schemaOptions);return t.validators=this.validators.slice(),this.requiredValidator!==void 0&&(t.requiredValidator=this.requiredValidator),t.Constructor.discriminators=Object.assign({},this.Constructor.discriminators),t};lr.prototype.applyGetters=function(e,t){return qf.prototype.applyGetters.call(this,e,t)};function Rme(e,t,r){if(!(r&&t))return;let n=e.path+".",i=Object.keys(t),s=i.length,o={},a,u,c;for(;s--;)if(u=i[s],u.startsWith(n)){if(c=u.substring(n.length),c==="$")continue;c.startsWith("$.")&&(c=c.substr(2)),a||(a=!0),o[c]=t[u]}return a&&o||void 0}lr.defaultOptions={};lr.set=qf.set;m2.exports=lr});var _2=_((lNe,g2)=>{"use strict";var Dme=On(),yy=class extends Dme{},jme=Ln();Object.defineProperty(yy.prototype,"_id",jme);g2.exports=yy});var b2=_((fNe,O2)=>{"use strict";var w2=vn(),hE=require("events").EventEmitter,Bme=fb(),Lme=_2(),Mf=Wr(),kme=Bm(),v2=vf().castToNumber,Fme=py(),dE=Lb(),Ume=je(),pE=cE(),Vme=uE(),Wme=Ss().internalToObjectOptions,gy;O2.exports=It;function It(e,t,r){e=Vme(e,r),this.caster=S2(e),this.caster.path=t,this.caster.prototype.$basePath=t,this.schema=e,this.$isSingleNested=!0,Mf.call(this,t,r,"Embedded")}It.prototype=Object.create(Mf.prototype);It.prototype.constructor=It;It.prototype.OptionsConstructor=Lme;function S2(e,t){gy||(gy=rE());let r=function(s,o,a){let u=this;this.$__parent=a,gy.apply(this,arguments),this.$session(this.ownerDocument().$session()),a&&(a.on("save",function(){u.emit("save",u),u.constructor.emit("save",u)}),a.on("isNew",function(c){u.isNew=c,u.emit("isNew",c),u.constructor.emit("isNew",c)}))},n=t!=null?t.prototype:gy.prototype;r.prototype=Object.create(n),r.prototype.$__setSchema(e),r.prototype.constructor=r,r.schema=e,r.$isSingleNested=!0,r.events=new hE,r.prototype.toBSON=function(){return this.toObject(Wme)};for(let i in e.methods)r.prototype[i]=e.methods[i];for(let i in e.statics)r[i]=e.statics[i];for(let i in hE.prototype)r[i]=hE.prototype[i];return r}It.prototype.$conditionalHandlers.$geoWithin=function(t){return{$geometry:this.castForQuery(t.$geometry)}};It.prototype.$conditionalHandlers.$near=It.prototype.$conditionalHandlers.$nearSphere=dE.cast$near;It.prototype.$conditionalHandlers.$within=It.prototype.$conditionalHandlers.$geoWithin=dE.cast$within;It.prototype.$conditionalHandlers.$geoIntersects=dE.cast$geoIntersects;It.prototype.$conditionalHandlers.$minDistance=v2;It.prototype.$conditionalHandlers.$maxDistance=v2;It.prototype.$conditionalHandlers.$exists=kme;It.prototype.cast=function(e,t,r,n,i){if(e&&e.$isSingleNested&&e.parent===t)return e;if(e!=null&&(typeof e!="object"||Array.isArray(e)))throw new Bme(this.path,e);let s=pE(this.caster,e),o,a=Ume(t,"$__.selected",{}),u=this.path,c=Object.keys(a).reduce((f,h)=>(h.startsWith(u+".")&&(f[h.substr(u.length+1)]=a[h]),f),{});if(i=Object.assign({},i,{priorDoc:n}),r)o=new s(void 0,c,t),o.init(e);else return Object.keys(e).length===0?new s({},c,t,void 0,i):new s(e,c,t,void 0,i);return o};It.prototype.castForQuery=function(e,t,r){let n;if(arguments.length===2){if(n=this.$conditionalHandlers[e],!n)throw new Error("Can't use "+e);return n.call(this,t)}if(t=e,t==null)return t;this.options.runSetters&&(t=this._applySetters(t));let i=pE(this.caster,t),s=r!=null&&r.strict!=null?r.strict:void 0;try{t=new i(t,s)}catch(o){throw o instanceof w2?o:new w2("Embedded",t,this.path,o,this)}return t};It.prototype.doValidate=function(e,t,r,n){let i=pE(this.caster,e);if(n&&n.skipSchemaValidators)return e instanceof i||(e=new i(e,null,r)),e.validate(t);Mf.prototype.doValidate.call(this,e,function(s){if(s)return t(s);if(!e)return t(null);e.validate(t)},r,n)};It.prototype.doValidateSync=function(e,t,r){if(!r||!r.skipSchemaValidators){let n=Mf.prototype.doValidateSync.call(this,e,t);if(n)return n}if(!!e)return e.validateSync()};It.prototype.discriminator=function(e,t,r){return t=Fme(this.caster,e,t,r),this.caster.discriminators[e]=S2(t,this.caster),this.caster.discriminators[e]};It.defaultOptions={};It.set=Mf.set;It.prototype.clone=function(){let e=Object.assign({},this.options),t=new this.constructor(this.schema,this.path,e);return t.validators=this.validators.slice(),this.requiredValidator!==void 0&&(t.requiredValidator=this.requiredValidator),t.caster.discriminators=Object.assign({},this.caster.discriminators),t}});var C2=_((hNe,E2)=>{"use strict";var zme=On(),_y=class extends zme{},Hme=Ln();Object.defineProperty(_y.prototype,"subtype",Hme);E2.exports=_y});var x2=_((dNe,A2)=>{"use strict";var tc=iy(),Kme=C2(),_o=Wr(),wy=Tb(),Gme=Ne(),T2=tc.Binary,mE=_o.CastError;function Hr(e,t){_o.call(this,e,t,"Buffer")}Hr.schemaName="Buffer";Hr.defaultOptions={};Hr.prototype=Object.create(_o.prototype);Hr.prototype.constructor=Hr;Hr.prototype.OptionsConstructor=Kme;Hr._checkRequired=e=>!!(e&&e.length);Hr.set=_o.set;Hr.checkRequired=_o.checkRequired;Hr.prototype.checkRequired=function(e,t){return _o._isRef(this,e,t,!0)?!!e:this.constructor._checkRequired(e)};Hr.prototype.cast=function(e,t,r){let n;if(_o._isRef(this,e,t,r)){if(e&&e.isMongooseBuffer)return e;if(Buffer.isBuffer(e))return(!e||!e.isMongooseBuffer)&&(e=new tc(e,[this.path,t]),this.options.subtype!=null&&(e._subtype=this.options.subtype)),e;if(e instanceof T2){if(n=new tc(e.value(!0),[this.path,t]),typeof e.sub_type!="number")throw new mE("Buffer",e,this.path,null,this);return n._subtype=e.sub_type,n}return this._castRef(e,t,r)}if(e&&e._id&&(e=e._id),e&&e.isMongooseBuffer)return e;if(Buffer.isBuffer(e))return(!e||!e.isMongooseBuffer)&&(e=new tc(e,[this.path,t]),this.options.subtype!=null&&(e._subtype=this.options.subtype)),e;if(e instanceof T2){if(n=new tc(e.value(!0),[this.path,t]),typeof e.sub_type!="number")throw new mE("Buffer",e,this.path,null,this);return n._subtype=e.sub_type,n}if(e===null)return e;let i=typeof e;if(i==="string"||i==="number"||Array.isArray(e)||i==="object"&&e.type==="Buffer"&&Array.isArray(e.data))return i==="number"&&(e=[e]),n=new tc(e,[this.path,t]),this.options.subtype!=null&&(n._subtype=this.options.subtype),n;throw new mE("Buffer",e,this.path,null,this)};Hr.prototype.subtype=function(e){return this.options.subtype=e,this};function vy(e){return this.castForQuery(e)}Hr.prototype.$conditionalHandlers=Gme.options(_o.prototype.$conditionalHandlers,{$bitsAllClear:wy,$bitsAnyClear:wy,$bitsAllSet:wy,$bitsAnySet:wy,$gt:vy,$gte:vy,$lt:vy,$lte:vy});Hr.prototype.castForQuery=function(e,t){let r;if(arguments.length===2){if(r=this.$conditionalHandlers[e],!r)throw new Error("Can't use "+e+" with Buffer.");return r.call(this,t)}t=e;let n=this._castForQuery(t);return n&&n.toObject({transform:!1,virtuals:!1})};A2.exports=Hr});var M2=_((pNe,q2)=>{"use strict";var Qme=On(),rc=class extends Qme{},yE=Ln();Object.defineProperty(rc.prototype,"min",yE);Object.defineProperty(rc.prototype,"max",yE);Object.defineProperty(rc.prototype,"expires",yE);q2.exports=rc});var $2=_((mNe,N2)=>{"use strict";var gE=require("assert");N2.exports=function(t){if(t==null||t==="")return null;if(t instanceof Date)return gE.ok(!isNaN(t.valueOf())),t;let r;if(gE.ok(typeof t!="boolean"),t instanceof Number||typeof t=="number"?r=new Date(t):typeof t=="string"&&!isNaN(Number(t))&&(Number(t)>=275761||Number(t)<-271820)?r=new Date(Number(t)):typeof t.valueOf=="function"?r=new Date(t.valueOf()):r=new Date(t),!isNaN(r.valueOf()))return r;gE.ok(!1)}});var D2=_((yNe,R2)=>{"use strict";var P2=Ft(),Yme=M2(),ba=Wr(),Jme=$2(),Xme=Ur(),I2=Ne(),Zme=ba.CastError;function Rt(e,t){ba.call(this,e,t,"Date")}Rt.schemaName="Date";Rt.defaultOptions={};Rt.prototype=Object.create(ba.prototype);Rt.prototype.constructor=Rt;Rt.prototype.OptionsConstructor=Yme;Rt._cast=Jme;Rt.set=ba.set;Rt.cast=function(t){return arguments.length===0?this._cast:(t===!1&&(t=this._defaultCaster),this._cast=t,this._cast)};Rt._defaultCaster=e=>{if(e!=null&&!(e instanceof Date))throw new Error;return e};Rt.prototype.expires=function(e){return Xme(this._index)!=="Object"&&(this._index={}),this._index.expires=e,I2.expires(this._index),this};Rt._checkRequired=e=>e instanceof Date;Rt.checkRequired=ba.checkRequired;Rt.prototype.checkRequired=function(e,t){return ba._isRef(this,e,t,!0)?!!e:(typeof this.constructor.checkRequired=="function"?this.constructor.checkRequired():Rt.checkRequired())(e)};Rt.prototype.min=function(e,t){if(this.minValidator&&(this.validators=this.validators.filter(function(r){return r.validator!==this.minValidator},this)),e){let r=t||P2.messages.Date.min;typeof r=="string"&&(r=r.replace(/{MIN}/,e===Date.now?"Date.now()":e.toString()));let n=this;this.validators.push({validator:this.minValidator=function(i){let s=e;typeof e=="function"&&e!==Date.now&&(s=s.call(this));let o=s===Date.now?s():n.cast(s);return i===null||i.valueOf()>=o.valueOf()},message:r,type:"min",min:e})}return this};Rt.prototype.max=function(e,t){if(this.maxValidator&&(this.validators=this.validators.filter(function(r){return r.validator!==this.maxValidator},this)),e){let r=t||P2.messages.Date.max;typeof r=="string"&&(r=r.replace(/{MAX}/,e===Date.now?"Date.now()":e.toString()));let n=this;this.validators.push({validator:this.maxValidator=function(i){let s=e;typeof s=="function"&&s!==Date.now&&(s=s.call(this));let o=s===Date.now?s():n.cast(s);return i===null||i.valueOf()<=o.valueOf()},message:r,type:"max",max:e})}return this};Rt.prototype.cast=function(e){let t;typeof this._castFunction=="function"?t=this._castFunction:typeof this.constructor.cast=="function"?t=this.constructor.cast():t=Rt.cast();try{return t(e)}catch(r){throw new Zme("date",e,this.path,r,this)}};function Sy(e){return this.cast(e)}Rt.prototype.$conditionalHandlers=I2.options(ba.prototype.$conditionalHandlers,{$gt:Sy,$gte:Sy,$lt:Sy,$lte:Sy});Rt.prototype.castForQuery=function(e,t){if(arguments.length!==2)return this._castForQuery(e);let r=this.$conditionalHandlers[e];if(!r)throw new Error("Can't use "+e+" with Date.");return r.call(this,t)};R2.exports=Rt});var L2=_((gNe,B2)=>{"use strict";var eye=On(),Nf=class extends eye{},j2=Ln();Object.defineProperty(Nf.prototype,"auto",j2);Object.defineProperty(Nf.prototype,"populate",j2);B2.exports=Nf});var U2=_((_Ne,F2)=>{"use strict";var tye=L2(),Os=Wr(),rye=Yb(),nye=Ur(),nc=Zn(),iye=Ne(),sye=Os.CastError,_E;function Gt(e,t){let r=typeof e=="string"&&e.length===24&&/^[a-f0-9]+$/i.test(e),n=t&&t.suppressWarning;(r||typeof e>"u")&&!n&&(console.warn("mongoose: To create a new ObjectId please try `Mongoose.Types.ObjectId` instead of using `Mongoose.Schema.ObjectId`. Set the `suppressWarning` option if you're trying to create a hex char path in your schema."),console.trace()),Os.call(this,e,t,"ObjectID")}Gt.schemaName="ObjectId";Gt.defaultOptions={};Gt.prototype=Object.create(Os.prototype);Gt.prototype.constructor=Gt;Gt.prototype.OptionsConstructor=tye;Gt.get=Os.get;Gt.set=Os.set;Gt.prototype.auto=function(e){return e&&(this.default(k2),this.set(oye)),this};Gt._checkRequired=e=>e instanceof nc;Gt._cast=rye;Gt.cast=function(t){return arguments.length===0?this._cast:(t===!1&&(t=this._defaultCaster),this._cast=t,this._cast)};Gt._defaultCaster=e=>{if(!(e instanceof nc))throw new Error(e+" is not an instance of ObjectId");return e};Gt.checkRequired=Os.checkRequired;Gt.prototype.checkRequired=function(t,r){return Os._isRef(this,t,r,!0)?!!t:(typeof this.constructor.checkRequired=="function"?this.constructor.checkRequired():Gt.checkRequired())(t)};Gt.prototype.cast=function(e,t,r){if(Os._isRef(this,e,t,r))return e instanceof nc?e:(nye(e)||"").toLowerCase()==="objectid"?new nc(e.toHexString()):this._castRef(e,t,r);let n;typeof this._castFunction=="function"?n=this._castFunction:typeof this.constructor.cast=="function"?n=this.constructor.cast():n=Gt.cast();try{return n(e)}catch(i){throw new sye("ObjectId",e,this.path,i,this)}};function Oy(e){return this.cast(e)}Gt.prototype.$conditionalHandlers=iye.options(Os.prototype.$conditionalHandlers,{$gt:Oy,$gte:Oy,$lt:Oy,$lte:Oy});function k2(){return new nc}k2.$runBeforeSetters=!0;function oye(e){if(_E||(_E=Un()),this instanceof _E){if(e===void 0){let t=new nc;return this.$__._id=t,t}this.$__._id=e}return e}F2.exports=Gt});var W2=_((wNe,V2)=>{"use strict";var ic=ua(),aye=require("assert");V2.exports=function(t){if(t==null)return t;if(typeof t=="object"&&typeof t.$numberDecimal=="string")return ic.fromString(t.$numberDecimal);if(t instanceof ic)return t;if(typeof t=="string")return ic.fromString(t);if(Buffer.isBuffer(t))return new ic(t);if(typeof t=="number")return ic.fromString(String(t));if(typeof t.valueOf=="function"&&typeof t.valueOf()=="string")return ic.fromString(t.valueOf());aye.ok(!1)}});var H2=_((vNe,z2)=>{"use strict";var wo=Wr(),uye=wo.CastError,wE=ua(),cye=W2(),lye=Ne();function fr(e,t){wo.call(this,e,t,"Decimal128")}fr.schemaName="Decimal128";fr.defaultOptions={};fr.prototype=Object.create(wo.prototype);fr.prototype.constructor=fr;fr._cast=cye;fr.set=wo.set;fr.cast=function(t){return arguments.length===0?this._cast:(t===!1&&(t=this._defaultCaster),this._cast=t,this._cast)};fr._defaultCaster=e=>{if(e!=null&&!(e instanceof wE))throw new Error;return e};fr._checkRequired=e=>e instanceof wE;fr.checkRequired=wo.checkRequired;fr.prototype.checkRequired=function(t,r){return wo._isRef(this,t,r,!0)?!!t:(typeof this.constructor.checkRequired=="function"?this.constructor.checkRequired():fr.checkRequired())(t)};fr.prototype.cast=function(e,t,r){if(wo._isRef(this,e,t,r))return e instanceof wE?e:this._castRef(e,t,r);let n;typeof this._castFunction=="function"?n=this._castFunction:typeof this.constructor.cast=="function"?n=this.constructor.cast():n=fr.cast();try{return n(e)}catch(i){throw new uye("Decimal128",e,this.path,i,this)}};function by(e){return this.cast(e)}fr.prototype.$conditionalHandlers=lye.options(wo.prototype.$conditionalHandlers,{$gt:by,$gte:by,$lt:by,$lte:by});z2.exports=fr});var G2=_((SNe,K2)=>{"use strict";var fye=On(),Ey=class extends fye{},hye=Ln();Object.defineProperty(Ey.prototype,"of",hye);K2.exports=Ey});var J2=_((ONe,Y2)=>{"use strict";var vE=tE(),dye=G2(),Q2=Wr();var $f=class extends Q2{constructor(t,r){super(t,r,"Map"),this.$isSchemaMap=!0}set(t,r){return Q2.set(t,r)}cast(t,r,n){if(t instanceof vE)return t;let i=this.path;if(n){let s=new vE({},i,r,this.$__schemaType);if(t instanceof global.Map)for(let o of t.keys()){let a=t.get(o);a==null?a=s.$__schemaType._castNullish(a):a=s.$__schemaType.cast(a,r,!0,null,{path:i+"."+o}),s.$init(o,a)}else for(let o of Object.keys(t)){let a=t[o];a==null?a=s.$__schemaType._castNullish(a):a=s.$__schemaType.cast(a,r,!0,null,{path:i+"."+o}),s.$init(o,a)}return s}return new vE(t,i,r,this.$__schemaType)}clone(){let t=super.clone();return this.$__schemaType!=null&&(t.$__schemaType=this.$__schemaType.clone()),t}};$f.prototype.OptionsConstructor=dye;$f.defaultOptions={};Y2.exports=$f});var wf=_(Dt=>{"use strict";Dt.String=Nk();Dt.Number=xb();Dt.Boolean=Fk();Dt.DocumentArray=y2();Dt.Embedded=b2();Dt.Array=ty();Dt.Buffer=x2();Dt.Date=D2();Dt.ObjectId=U2();Dt.Mixed=wa();Dt.Decimal128=Dt.Decimal=H2();Dt.Map=J2();Dt.Oid=Dt.ObjectId;Dt.Object=Dt.Mixed;Dt.Bool=Dt.Boolean;Dt.ObjectID=Dt.ObjectId});var Ju=_((TE,oU)=>{"use strict";var pye=require("events").EventEmitter,mye=pb(),bE=on(),X2=Wr(),Z2=On(),yye=lk(),EE=zm(),eU=mb(),gye=pe().arrayParentSymbol,Cy=je(),_ye=Ur(),wye=pk(),vye=eb(),SE=ao(),tU=xn().get().ReadPreference,Sye=Ok(),Oye=require("util"),Be=Ne(),bye=Ek(),Ea,Eye=Hm().middlewareFunctions,Cye=Gm().middlewareFunctions,rU=Eye.concat(Cye).reduce((e,t)=>e.add(t),new Set),Tye=0;function fe(e,t){if(!(this instanceof fe))return new fe(e,t);if(this.obj=e,this.paths={},this.aliases={},this.subpaths={},this.virtuals={},this.singleNestedPaths={},this.nested={},this.inherits={},this.callQueue=[],this._indexes=[],this.methods={},this.methodOptions={},this.statics={},this.tree={},this.query={},this.childSchemas=[],this.plugins=[],this.$id=++Tye,this.mapPaths=[],this.s={hooks:new mye},this.options=this.defaultOptions(t),Array.isArray(e))for(let i of e)this.add(i);else e&&this.add(e);let r=e&&e._id&&Be.isObject(e._id);!this.paths._id&&!this.options.noId&&this.options._id&&!r&&eU(this),this.setupTimestamp(this.options.timestamps)}function Aye(e,t){t=t||Object.keys(e.paths);for(let r of t){let n=Cy(e.paths[r],"options");if(n==null)continue;let i=e.paths[r].path,s=n.alias;if(!!s){if(typeof s!="string")throw new Error("Invalid value for alias option on "+i+", got "+s);e.aliases[s]=i,e.virtual(s).get(function(o){return function(){return typeof this.get=="function"?this.get(o):this[o]}}(i)).set(function(o){return function(a){return this.$set(o,a)}}(i))}}}fe.prototype=Object.create(pye.prototype);fe.prototype.constructor=fe;fe.prototype.instanceOfSchema=!0;Object.defineProperty(fe.prototype,"$schemaType",{configurable:!1,enumerable:!1,writable:!0});Object.defineProperty(fe.prototype,"childSchemas",{configurable:!1,enumerable:!0,writable:!0});fe.prototype.obj;fe.prototype.paths;fe.prototype.tree;fe.prototype.clone=function(){let e=this.base==null?fe:this.base.Schema,t=new e({},this._userProvidedOptions);return t.base=this.base,t.obj=this.obj,t.options=Be.clone(this.options),t.callQueue=this.callQueue.map(function(r){return r}),t.methods=Be.clone(this.methods),t.methodOptions=Be.clone(this.methodOptions),t.statics=Be.clone(this.statics),t.query=Be.clone(this.query),t.plugins=Array.prototype.slice.call(this.plugins),t._indexes=Be.clone(this._indexes),t.s.hooks=this.s.hooks.clone(),t.tree=Be.clone(this.tree),t.paths=Be.clone(this.paths),t.nested=Be.clone(this.nested),t.subpaths=Be.clone(this.subpaths),t.singleNestedPaths=Be.clone(this.singleNestedPaths),t.childSchemas=xye(t),t.virtuals=Be.clone(this.virtuals),t.$globalPluginsApplied=this.$globalPluginsApplied,t.$isRootDiscriminator=this.$isRootDiscriminator,t.$implicitlyCreated=this.$implicitlyCreated,t.mapPaths=[].concat(this.mapPaths),this.discriminatorMapping!=null&&(t.discriminatorMapping=Object.assign({},this.discriminatorMapping)),this.discriminators!=null&&(t.discriminators=Object.assign({},this.discriminators)),t.aliases=Object.assign({},this.aliases),t.on("init",r=>this.emit("init",r)),t};fe.prototype.pick=function(e,t){let r=new fe({},t||this.options);if(!Array.isArray(e))throw new bE('Schema#pick() only accepts an array argument, got "'+typeof e+'"');for(let n of e)if(this.nested[n])r.add({[n]:Cy(this.tree,n)});else{let i=this.path(n);if(i==null)throw new bE("Path `"+n+"` is not in the schema");r.add({[n]:i})}return r};fe.prototype.defaultOptions=function(e){e&&e.safe===!1&&(e.safe={w:0}),e&&e.safe&&e.safe.w===0&&(e.versionKey=!1),this._userProvidedOptions=e==null?{}:Be.clone(e);let t=Cy(this,"base.options",{});if(e=Be.options({strict:"strict"in t?t.strict:!0,strictQuery:"strictQuery"in t?t.strictQuery:!1,bufferCommands:!0,capped:!1,versionKey:"__v",optimisticConcurrency:!1,discriminatorKey:"__t",minimize:!0,autoIndex:null,shardKey:null,read:null,validateBeforeSave:!0,noId:!1,_id:!0,noVirtualId:!1,id:!0,typeKey:"type",typePojoToMixed:"typePojoToMixed"in t?t.typePojoToMixed:!0},Be.clone(e)),e.read&&(e.read=tU(e.read)),e.optimisticConcurrency&&!e.versionKey)throw new bE("Must set `versionKey` if using `optimisticConcurrency`");return e};fe.prototype.add=function(t,r){if(t instanceof fe||t!=null&&t.instanceOfSchema)return vye(this,t),this;if(t._id===!1&&r==null&&(this.options._id=!1),r=r||"",r==="__proto__."||r==="constructor."||r==="prototype.")return this;let n=Object.keys(t);for(let s of n){if(Be.specialProperties.has(s))continue;let o=r+s;if(t[s]==null)throw new TypeError("Invalid value for schema path `"+o+'`, got value "'+t[s]+'"');if(!(s==="_id"&&t[s]===!1)){if(t[s]instanceof EE||Cy(t[s],"constructor.name",null)==="VirtualType"){this.virtual(t[s]);continue}if(Array.isArray(t[s])&&t[s].length===1&&t[s][0]==null)throw new TypeError("Invalid value for schema Array path `"+o+'`, got value "'+t[s][0]+'"');if(!(Be.isPOJO(t[s])||t[s]instanceof Z2))r&&(this.nested[r.substr(0,r.length-1)]=!0),this.path(r+s,t[s]);else if(Object.keys(t[s]).length<1)r&&(this.nested[r.substr(0,r.length-1)]=!0),this.path(o,t[s]);else if(!t[s][this.options.typeKey]||this.options.typeKey==="type"&&t[s].type.type)this.nested[o]=!0,this.add(t[s],o+".");else if(!this.options.typePojoToMixed&&Be.isPOJO(t[s][this.options.typeKey])){r&&(this.nested[r.substr(0,r.length-1)]=!0);let a={typePojoToMixed:!1},u=new fe(t[s][this.options.typeKey],a),c=Object.assign({},t[s],{[this.options.typeKey]:u});this.path(r+s,c)}else r&&(this.nested[r.substr(0,r.length-1)]=!0),this.path(r+s,t[s])}}let i=Object.keys(t).map(s=>r?r+s:s);return Aye(this,i),this};fe.reserved=Object.create(null);fe.prototype.reserved=fe.reserved;var hr=fe.reserved;hr.prototype=hr.emit=hr.listeners=hr.on=hr.removeListener=hr.collection=hr.errors=hr.get=hr.init=hr.isModified=hr.isNew=hr.populated=hr.remove=hr.save=hr.toObject=hr.validate=1;fe.prototype.path=function(e,t){let r=nU(e);if(t===void 0){let c=qye(this,e,r);if(c!=null)return c;let f=iU(this,e);return f??(c=this.hasMixedParent(r),c??(/\.\d+\.?.*$/.test(e)?Mye(this,e):void 0))}let n=e.split(".")[0];if(hr[n])throw new Error("`"+n+"` may not be used as a schema pathname");typeof t=="object"&&Be.hasUserDefinedProperty(t,"ref")&&bye(t.ref,e);let i=e.split(/\./),s=i.pop(),o=this.tree,a="";for(let c of i){if(Be.specialProperties.has(c))throw new Error("Cannot set special property `"+c+"` on a schema");if(a=a+=(a.length>0?".":"")+c,o[c]||(this.nested[a]=!0,o[c]={}),typeof o[c]!="object"){let f="Cannot set nested path `"+e+"`. Parent path `"+a+"` already set to type "+o[c].name+".";throw new Error(f)}o=o[c]}o[s]=Be.clone(t),this.paths[e]=this.interpretAsType(e,t,this.options);let u=this.paths[e];if(u.$isSchemaMap){let c=e+".$*",f={type:{}};Be.hasUserDefinedProperty(t,"of")&&(f=Be.isPOJO(t.of)&&Object.keys(t.of).length>0&&!Be.hasUserDefinedProperty(t.of,this.options.typeKey)?new fe(t.of):t.of),Be.hasUserDefinedProperty(t,"ref")&&(f={type:f,ref:t.ref}),this.paths[c]=this.interpretAsType(c,f,this.options),this.mapPaths.push(this.paths[c]),u.$__schemaType=this.paths[c]}if(u.$isSingleNested){for(let c of Object.keys(u.schema.paths))this.singleNestedPaths[e+"."+c]=u.schema.paths[c];for(let c of Object.keys(u.schema.singleNestedPaths))this.singleNestedPaths[e+"."+c]=u.schema.singleNestedPaths[c];for(let c of Object.keys(u.schema.subpaths))this.singleNestedPaths[e+"."+c]=u.schema.subpaths[c];for(let c of Object.keys(u.schema.nested))this.singleNestedPaths[e+"."+c]="nested";Object.defineProperty(u.schema,"base",{configurable:!0,enumerable:!1,writable:!1,value:this.base}),u.caster.base=this.base,this.childSchemas.push({schema:u.schema,model:u.caster})}else u.$isMongooseDocumentArray&&(Object.defineProperty(u.schema,"base",{configurable:!0,enumerable:!1,writable:!1,value:this.base}),u.casterConstructor.base=this.base,this.childSchemas.push({schema:u.schema,model:u.casterConstructor}));if(u.$isMongooseArray&&u.caster instanceof X2){let c=e,f=u,h=[];for(;f.$isMongooseArray;)c=c+".$",f.$isMongooseDocumentArray?(f.$embeddedSchemaType._arrayPath=c,f.$embeddedSchemaType._arrayParentPath=e,f=f.$embeddedSchemaType.clone()):(f.caster._arrayPath=c,f.caster._arrayParentPath=e,f=f.caster.clone()),f.path=c,h.push(f);for(let d of h)this.subpaths[d.path]=d}if(u.$isMongooseDocumentArray){for(let c of Object.keys(u.schema.paths)){let f=u.schema.paths[c];this.subpaths[e+"."+c]=f,typeof f=="object"&&f!=null&&(f.$isUnderneathDocArray=!0)}for(let c of Object.keys(u.schema.subpaths)){let f=u.schema.subpaths[c];this.subpaths[e+"."+c]=f,typeof f=="object"&&f!=null&&(f.$isUnderneathDocArray=!0)}for(let c of Object.keys(u.schema.singleNestedPaths)){let f=u.schema.singleNestedPaths[c];this.subpaths[e+"."+c]=f,typeof f=="object"&&f!=null&&(f.$isUnderneathDocArray=!0)}}return this};function xye(e){let t=[];for(let r of Object.keys(e.paths)){let n=e.paths[r];(n.$isMongooseDocumentArray||n.$isSingleNested)&&t.push({schema:n.schema,model:n.caster})}return t}function qye(e,t,r){return e.paths.hasOwnProperty(t)?e.paths[t]:e.subpaths.hasOwnProperty(r)?e.subpaths[r]:e.singleNestedPaths.hasOwnProperty(r)&&typeof e.singleNestedPaths[r]=="object"?e.singleNestedPaths[r]:null}function nU(e){return/\.\d+/.test(e)?e.replace(/\.\d+\./g,".$.").replace(/\.\d+$/,".$"):e}function iU(e,t){if(e.mapPaths.length===0)return null;for(let r of e.mapPaths){let n=r.path;if(new RegExp("^"+n.replace(/\.\$\*/g,"\\.[^.]+")+"$").test(t))return e.paths[n]}return null}Object.defineProperty(fe.prototype,"base",{configurable:!0,enumerable:!1,writable:!0,value:null});fe.prototype.interpretAsType=function(e,t,r){if(t instanceof X2){if(t.path===e)return t;let o=t.clone();return o.path=e,o}let n=this.base!=null?this.base.Schema.Types:fe.Types;if(!Be.isPOJO(t)&&!(t instanceof Z2)&&Be.getFunctionName(t.constructor)!=="Object"){let a=t;t={},t[r.typeKey]=a}let i=t[r.typeKey]&&(r.typeKey!=="type"||!t.type.type)?t[r.typeKey]:{},s;if(Be.isPOJO(i)||i==="mixed")return new n.Mixed(e,t);if(Array.isArray(i)||i===Array||i==="array"||i===n.Array){let o=i===Array||i==="array"?t.cast||t.of:i[0];if(o&&o.instanceOfSchema){if(!(o instanceof fe))throw new TypeError("Schema for array path `"+e+"` is from a different copy of the Mongoose module. Please make sure you're using the same version of Mongoose everywhere with `npm list mongoose`.");return new n.DocumentArray(e,o,t)}if(o&&o[r.typeKey]&&o[r.typeKey].instanceOfSchema){if(!(o[r.typeKey]instanceof fe))throw new TypeError("Schema for array path `"+e+"` is from a different copy of the Mongoose module. Please make sure you're using the same version of Mongoose everywhere with `npm list mongoose`.");return new n.DocumentArray(e,o[r.typeKey],t,o)}if(Array.isArray(o))return new n.Array(e,this.interpretAsType(e,o,r),t);if(typeof o=="string")o=n[o.charAt(0).toUpperCase()+o.substring(1)];else if(o&&(!o[r.typeKey]||r.typeKey==="type"&&o.type.type)&&Be.isPOJO(o))if(Object.keys(o).length){let a={minimize:r.minimize};r.typeKey&&(a.typeKey=r.typeKey),r.hasOwnProperty("strict")&&(a.strict=r.strict),r.hasOwnProperty("typePojoToMixed")&&(a.typePojoToMixed=r.typePojoToMixed),this._userProvidedOptions.hasOwnProperty("_id")?a._id=this._userProvidedOptions._id:fe.Types.DocumentArray.defaultOptions&&fe.Types.DocumentArray.defaultOptions._id!=null&&(a._id=fe.Types.DocumentArray.defaultOptions._id);let u=new fe(o,a);return u.$implicitlyCreated=!0,new n.DocumentArray(e,u,t)}else return new n.Array(e,n.Mixed,t);if(o&&(i=o[r.typeKey]&&(r.typeKey!=="type"||!o.type.type)?o[r.typeKey]:o,s=typeof i=="string"?i:i.schemaName||Be.getFunctionName(i),s==="ClockDate"&&(s="Date"),!n.hasOwnProperty(s)))throw new TypeError(`Invalid schema configuration: \`${s}\` is not a valid type within the array \`${e}\`.See http://bit.ly/mongoose-schematypes for a list of valid schema types.`);return new n.Array(e,o||n.Mixed,t,r)}if(i&&i.instanceOfSchema)return new n.Embedded(i,e,t);if(Buffer.isBuffer(i)?s="Buffer":typeof i=="function"||typeof i=="object"?s=i.schemaName||Be.getFunctionName(i):s=i==null?""+i:i.toString(),s&&(s=s.charAt(0).toUpperCase()+s.substring(1)),s==="ObjectID"&&(s="ObjectId"),s==="ClockDate"&&(s="Date"),n[s]==null)throw new TypeError(`Invalid schema configuration: \`${s}\` is not a valid type at path \`${e}\`. See http://bit.ly/mongoose-schematypes for a list of valid schema types.`);return new n[s](e,t)};fe.prototype.eachPath=function(e){let t=Object.keys(this.paths),r=t.length;for(let n=0;n<r;++n)e(t[n],this.paths[t[n]]);return this};fe.prototype.requiredPaths=function(t){if(this._requiredpaths&&!t)return this._requiredpaths;let r=Object.keys(this.paths),n=r.length,i=[];for(;n--;){let s=r[n];this.paths[s].isRequired&&i.push(s)}return this._requiredpaths=i,this._requiredpaths};fe.prototype.indexedPaths=function(){return this._indexedpaths?this._indexedpaths:(this._indexedpaths=this.indexes(),this._indexedpaths)};fe.prototype.pathType=function(e){let t=nU(e);if(this.paths.hasOwnProperty(e))return"real";if(this.virtuals.hasOwnProperty(e))return"virtual";if(this.nested.hasOwnProperty(e))return"nested";if(this.subpaths.hasOwnProperty(t)||this.subpaths.hasOwnProperty(e))return"real";let r=this.singleNestedPaths.hasOwnProperty(t)||this.singleNestedPaths.hasOwnProperty(e);return r?r==="nested"?"nested":"real":iU(this,e)!=null?"real":/\.\d+\.|\.\d+$/.test(e)?sU(this,e):"adhocOrUndefined"};fe.prototype.hasMixedParent=function(e){let t=e.split(/\./g);e="";for(let r=0;r<t.length;++r)if(e=r>0?e+"."+t[r]:t[r],this.paths.hasOwnProperty(e)&&this.paths[e]instanceof Ea.Mixed)return this.paths[e];return null};fe.prototype.setupTimestamp=function(e){return Sye(this,e)};function sU(e,t){let r=t.split(/\.(\d+)\.|\.(\d+)$/).filter(Boolean);if(r.length<2)return e.paths.hasOwnProperty(r[0])?e.paths[r[0]]:"adhocOrUndefined";let n=e.path(r[0]),i=!1;if(!n)return"adhocOrUndefined";let s=r.length-1;for(let o=1;o<r.length;++o){i=!1;let a=r[o];if(o===s&&n&&!/\D/.test(a)){n.$isMongooseDocumentArray?n=n.$embeddedSchemaType:n instanceof Ea.Array?n=n.caster:n=void 0;break}if(!/\D/.test(a)){n instanceof Ea.Array&&o!==s&&(n=n.caster);continue}if(!(n&&n.schema)){n=void 0;break}i=n.schema.pathType(a)==="nested",n=n.schema.path(a)}return e.subpaths[t]=n,n?"real":i?"nested":"adhocOrUndefined"}function Mye(e,t){return sU(e,t),e.subpaths[t]}fe.prototype.queue=function(e,t){return this.callQueue.push([e,t]),this};fe.prototype.pre=function(e){if(e instanceof RegExp){let t=Array.prototype.slice.call(arguments,1);for(let r of rU)e.test(r)&&this.pre.apply(this,[r].concat(t));return this}if(Array.isArray(e)){let t=Array.prototype.slice.call(arguments,1);for(let r of e)this.pre.apply(this,[r].concat(t));return this}return this.s.hooks.pre.apply(this.s.hooks,arguments),this};fe.prototype.post=function(e){if(e instanceof RegExp){let t=Array.prototype.slice.call(arguments,1);for(let r of rU)e.test(r)&&this.post.apply(this,[r].concat(t));return this}if(Array.isArray(e)){let t=Array.prototype.slice.call(arguments,1);for(let r of e)this.post.apply(this,[r].concat(t));return this}return this.s.hooks.post.apply(this.s.hooks,arguments),this};fe.prototype.plugin=function(e,t){if(typeof e!="function")throw new Error('First param to `schema.plugin()` must be a function, got "'+typeof e+'"');if(t&&t.deduplicate){for(let r of this.plugins)if(r.fn===e)return this}return this.plugins.push({fn:e,opts:t}),e(this,t),this};fe.prototype.method=function(e,t,r){if(typeof e!="string")for(let n in e)this.methods[n]=e[n],this.methodOptions[n]=Be.clone(r);else this.methods[e]=t,this.methodOptions[e]=Be.clone(r);return this};fe.prototype.static=function(e,t){if(typeof e!="string")for(let r in e)this.statics[r]=e[r];else this.statics[e]=t;return this};fe.prototype.index=function(e,t){return e||(e={}),t||(t={}),t.expires&&Be.expires(t),this._indexes.push([e,t]),this};fe.prototype.set=function(e,t,r){if(arguments.length===1)return this.options[e];switch(e){case"read":this.options[e]=tU(t,r),this._userProvidedOptions[e]=this.options[e];break;case"safe":$ye(this.options,t),this._userProvidedOptions[e]=this.options[e];break;case"timestamps":this.setupTimestamp(t),this.options[e]=t,this._userProvidedOptions[e]=this.options[e];break;case"_id":this.options[e]=t,this._userProvidedOptions[e]=this.options[e],t&&!this.paths._id?eU(this):!t&&this.paths._id!=null&&this.paths._id.auto&&this.remove("_id");break;default:this.options[e]=t,this._userProvidedOptions[e]=this.options[e];break}return this};var Nye="Mongoose: The `safe` option for schemas is deprecated. Use the `writeConcern` option instead: http://bit.ly/mongoose-write-concern",$ye=Oye.deprecate(function(t,r){t.safe=r===!1?{w:0}:r},Nye);fe.prototype.get=function(e){return this.options[e]};var Pye="2d 2dsphere hashed text".split(" ");Object.defineProperty(fe,"indexTypes",{get:function(){return Pye},set:function(){throw new Error("Cannot overwrite Schema.indexTypes")}});fe.prototype.indexes=function(){return wye(this)};fe.prototype.virtual=function(e,t){if(e instanceof EE||_ye(e)==="VirtualType")return this.virtual(e.path,e.options);if(t=new yye(t),Be.hasUserDefinedProperty(t,["ref","refPath"])){if(t.localField==null)throw new Error("Reference virtuals require `localField` option");if(t.foreignField==null)throw new Error("Reference virtuals require `foreignField` option");this.pre("init",function(o){if(SE.has(e,o)){let a=SE.get(e,o);this.$$populatedVirtuals||(this.$$populatedVirtuals={}),t.justOne||t.count?this.$$populatedVirtuals[e]=Array.isArray(a)?a[0]:a:this.$$populatedVirtuals[e]=Array.isArray(a)?a:a==null?[]:[a],SE.unset(e,o)}});let s=this.virtual(e);return s.options=t,s.set(function(o){this.$$populatedVirtuals||(this.$$populatedVirtuals={}),t.justOne||t.count?(this.$$populatedVirtuals[e]=Array.isArray(o)?o[0]:o,typeof this.$$populatedVirtuals[e]!="object"&&(this.$$populatedVirtuals[e]=t.count?o:null)):(this.$$populatedVirtuals[e]=Array.isArray(o)?o:o==null?[]:[o],this.$$populatedVirtuals[e]=this.$$populatedVirtuals[e].filter(function(a){return a&&typeof a=="object"}))}),typeof t.get=="function"&&s.get(t.get),s}let r=this.virtuals,n=e.split(".");if(this.pathType(e)==="real")throw new Error('Virtual path "'+e+'" conflicts with a real path in the schema');r[e]=n.reduce(function(s,o,a){return s[o]||(s[o]=a===n.length-1?new EE(t,e):{}),s[o]},this.tree);let i=n[0];for(let s=0;s<n.length-1;++s){if(this.paths[i]!=null&&this.paths[i].$isMongooseDocumentArray){let o=n.slice(s+1).join(".");this.paths[i].schema.virtual(o).get((u,c,f)=>{let h=f.__parentArray[gye],d=i+"."+f.__index+"."+o;return h.get(d)});break}i+="."+n[s+1]}return r[e]};fe.prototype.virtualpath=function(e){return this.virtuals.hasOwnProperty(e)?this.virtuals[e]:null};fe.prototype.remove=function(e){return typeof e=="string"&&(e=[e]),Array.isArray(e)&&e.forEach(function(t){if(!(this.path(t)==null&&!this.nested[t])){if(this.nested[t]){let r=Object.keys(this.paths).concat(Object.keys(this.nested));for(let n of r)n.startsWith(t+".")&&(delete this.paths[n],delete this.nested[n],OE(this,n));delete this.nested[t],OE(this,t);return}delete this.paths[t],OE(this,t)}},this),this};function OE(e,t){let r=t.split("."),n=r.pop(),i=e.tree;for(let s of r)i=i[s];delete i[n]}fe.prototype.loadClass=function(e,t){return e===Object.prototype||e===Function.prototype||e.prototype.hasOwnProperty("$isMongooseModelPrototype")?this:(this.loadClass(Object.getPrototypeOf(e),t),t||Object.getOwnPropertyNames(e).forEach(function(r){if(r.match(/^(length|name|prototype|constructor|__proto__)$/))return;let n=Object.getOwnPropertyDescriptor(e,r);n.hasOwnProperty("value")&&this.static(r,n.value)},this),Object.getOwnPropertyNames(e.prototype).forEach(function(r){if(r.match(/^(constructor)$/))return;let n=Object.getOwnPropertyDescriptor(e.prototype,r);t||typeof n.value=="function"&&this.method(r,n.value),typeof n.get=="function"&&(this.virtuals[r]&&(this.virtuals[r].getters=[]),this.virtual(r).get(n.get)),typeof n.set=="function"&&(this.virtuals[r]&&(this.virtuals[r].setters=[]),this.virtual(r).set(n.set))},this),this)};fe.prototype._getSchema=function(e){let t=this,r=t.path(e),n=[];if(r)return r.$fullPath=e,r;function i(o,a){let u=o.length+1,c,f;for(;u--;)if(f=o.slice(0,u).join("."),c=a.path(f),c){if(n.push(f),c.caster){if(c.caster instanceof Ea.Mixed)return c.caster.$fullPath=n.join("."),c.caster;if(u!==o.length&&c.schema){let h;return o[u]==="$"||CE(o[u])?u+1===o.length?c:(h=i(o.slice(u+1),c.schema),h&&(h.$isUnderneathDocArray=h.$isUnderneathDocArray||!c.schema.$isSingleNested),h):(h=i(o.slice(u),c.schema),h&&(h.$isUnderneathDocArray=h.$isUnderneathDocArray||!c.schema.$isSingleNested),h)}}else if(c.$isSchemaMap)return u+1>=o.length?c:i(o.slice(u+1),c.$__schemaType.schema);return c.$fullPath=n.join("."),c}}let s=e.split(".");for(let o=0;o<s.length;++o)(s[o]==="$"||CE(s[o]))&&(s[o]="0");return i(s,t)};fe.prototype._getPathType=function(e){let t=this;if(t.path(e))return"real";function n(i,s){let o=i.length+1,a,u;for(;o--;){if(u=i.slice(0,o).join("."),a=s.path(u),a)return a.caster?a.caster instanceof Ea.Mixed?{schema:a,pathType:"mixed"}:o!==i.length&&a.schema?i[o]==="$"||CE(i[o])?o===i.length-1?{schema:a,pathType:"nested"}:n(i.slice(o+1),a.schema):n(i.slice(o),a.schema):{schema:a,pathType:a.$isSingleNested?"nested":"array"}:{schema:a,pathType:"real"};if(o===i.length&&s.nested[u])return{schema:s,pathType:"nested"}}return{schema:a||s,pathType:"undefined"}}return n(e.split("."),t)};function CE(e){return e.startsWith("$[")&&e.endsWith("]")}oU.exports=TE=fe;fe.Types=Ea=wf();TE.ObjectId=Ea.ObjectId});var sc=_(AE=>{"use strict";var Iye=xn().get().Binary,Rye=ua(),Dye=Zn(),aU=rf();AE.flatten=uU;AE.modifiedPaths=cU;function uU(e,t,r,n){let i;e&&aU(e)&&!Buffer.isBuffer(e)?i=Object.keys(e.toObject({transform:!1,virtuals:!1})):i=Object.keys(e||{});let s=i.length,o={};t=t?t+".":"";for(let a=0;a<s;++a){let u=i[a],c=e[u];o[t+u]=c;let f=n&&n.path&&n.path(t+u),h=n&&n.nested&&n.nested[t+u];if(!(f&&f.instance==="Mixed")){if(lU(c)){if(r&&r.skipArrays&&Array.isArray(c))continue;let d=uU(c,t+u,r,n);for(let p in d)o[p]=d[p];Array.isArray(c)&&(o[t+u]=c)}if(h){let d=Object.keys(n.paths);for(let p of d)p.startsWith(t+u+".")&&!o.hasOwnProperty(p)&&(o[p]=void 0)}}}return o}function cU(e,t,r){let n=Object.keys(e||{}),i=n.length;r=r||{},t=t?t+".":"";for(let s=0;s<i;++s){let o=n[s],a=e[o];r[t+o]=!0,aU(a)&&!Buffer.isBuffer(a)&&(a=a.toObject({transform:!1,virtuals:!1})),lU(a)&&cU(a,t+o,r)}return r}function lU(e){return e&&typeof e=="object"&&!(e instanceof Date)&&!(e instanceof Dye)&&(!Array.isArray(e)||e.length>0)&&!(e instanceof Buffer)&&!(e instanceof Rye)&&!(e instanceof Iye)}});var hU=_((CNe,fU)=>{"use strict";var jye=je();fU.exports=function e(t,r,n){n=n||{};let i=n.typeOnly,s=r.split("."),o=null,a="adhocOrUndefined";for(let u=0;u<s.length;++u){let c=s.slice(0,u+1).join(".");if(o=t.schema.path(c),o==null){a="adhocOrUndefined";continue}if(o.instance==="Mixed")return i?"real":o;if(a=t.schema.pathType(c),(o.$isSingleNested||o.$isMongooseDocumentArrayElement)&&o.schema.discriminators!=null){let f=o.schema.discriminators,h=t.get(c+"."+jye(o,"schema.options.discriminatorKey"));if(h==null||f[h]==null)continue;let d=s.slice(u+1).join(".");return e(t.get(c),d,n)}}return i?a:o}});var pU=_((TNe,dU)=>{"use strict";dU.exports=function(e){!(!e.paths.id&&!e.options.noVirtualId&&e.options.id)||e.virtual("id").get(Bye)};function Bye(){return this._id!=null?String(this._id):null}});var oc=_((ANe,mU)=>{"use strict";mU.exports=function(t){return t==null?!0:typeof t=="object"?!("$meta"in t)&&!("$slice"in t):!0}});var Ty=_((xNe,yU)=>{"use strict";var Lye=oc();yU.exports=function(t){if(t==null)return null;let r=Object.keys(t),n=r.length,i=null;if(n===1&&r[0]==="_id")i=!!t[r[n]];else for(;n--;)if(r[n]!=="_id"&&Lye(t[r[n]])){i=!t[r[n]];break}return i}});var _U=_((qNe,gU)=>{"use strict";gU.exports=function(t,r,n,i,s){let o=Object.keys(t).reduce((u,c)=>u||c.startsWith(r+"."),!1),a=r+"."+n.options.discriminatorKey;!o&&s.length===1&&s[0]===a&&i.splice(i.indexOf(a),1)}});var ac=_(Ta=>{"use strict";var kye=_U(),Ca=je(),Fye=xi(),Uye=oc(),Vye=ms();Ta.preparePopulationOptions=function(t,r){let n=t.options.populate,i=Object.keys(n).reduce((s,o)=>s.concat([n[o]]),[]);return r.lean!=null&&i.filter(s=>Ca(s,"options.lean")==null).forEach(wU(r.lean)),i.forEach(s=>{s._localModel=t.model}),i};Ta.preparePopulationOptionsMQ=function(t,r){let n=t._mongooseOptions.populate,i=Object.keys(n).reduce((a,u)=>a.concat([n[u]]),[]);r.lean!=null&&i.filter(a=>Ca(a,"options.lean")==null).forEach(wU(r.lean));let s=Ca(t,"options.session",null);s!=null&&i.forEach(a=>{if(a.options==null){a.options={session:s};return}"session"in a.options||(a.options.session=s)});let o=t._fieldsForExec();return i.forEach(a=>{a._queryProjection=o}),i.forEach(a=>{a._localModel=t.model}),i};Ta.createModel=function(t,r,n,i,s){t.hooks.execPreSync("createModel",r);let o=t.schema?t.schema.discriminatorMapping:null,a=o&&o.isRoot?o.key:null,u=r[a];if(a&&u&&t.discriminators){let c=t.discriminators[u]||Fye(t.discriminators,u);if(c){let f=Vye(i);return Ta.applyPaths(f,c.schema),new c(void 0,f,!0)}}return typeof s>"u"&&(s={},s.defaults=!0),new t(void 0,n,{skipId:!0,isNew:!1,willInit:!0,defaults:s.defaults})};Ta.applyPaths=function(t,r){let n,i,s;if(t)for(i=Object.keys(t),s=i.length;s--;){if(i[s][0]==="+")continue;let h=t[i[s]];if(!!Uye(h)){n=!h;break}}let o=[],a=[],u=[];switch(c(r),n){case!0:for(let h of a)t[h]=0;break;case!1:r&&r.paths._id&&r.paths._id.options&&r.paths._id.options.select===!1&&(t._id=0);for(let h of o)t[h]=t[h]||1;break;case void 0:if(t==null)break;for(let h of Object.keys(t||{}))h.startsWith("+")&&delete t[h];for(let h of a)t[h]=0;break}function c(h,d){if(d||(d=""),u.indexOf(h)!==-1)return[];u.push(h);let p=[];return h.eachPath(function(m,y){d&&(m=d+"."+m);let g=f(m,y);if(g==null&&y.$isMongooseArray&&!y.$isMongooseDocumentArray&&(g=f(m,y.caster)),g!=null&&p.push(g),y.schema){let w=c(y.schema,m);n===!1&&kye(t,m,y.schema,o,w)}}),u.pop(),p}function f(h,d){let p="+"+h,m=t&&p in t;if(m&&delete t[p],typeof d.selected!="boolean")return;if(m){delete t[p],n===!1&&i.length>1&&!~i.indexOf(h)&&(t[h]=1);return}let y=h.split("."),g="";for(let w=0;w<y.length;++w)if(g+=g.length?"."+y[w]:y[w],a.indexOf(g)!==-1)return;if(!n&&Ca(d,"options.$skipDiscriminatorCheck",!1)){let w="";for(let S=0;S<y.length;++S){w+=(w.length===0?"":".")+y[S];let v=Ca(t,w,!1)||Ca(t,w+".$",!1);if(v&&typeof v!="object")return}}return(d.selected?o:a).push(h),h}};function wU(e){return function(t){t.options||(t.options={}),e!=null&&Array.isArray(e.virtuals)&&(e=Object.assign({},e),e.virtuals=e.virtuals.filter(r=>typeof r=="string"&&r.startsWith(t.path+".")).map(r=>r.slice(t.path.length+1))),t.options.lean=e}}Ta.handleDeleteWriteOpResult=function(t){return function(n,i){if(n)return t(n);let s=Object.assign({},i.result);return Ca(i,"result.n",null)!=null&&(s.deletedCount=i.result.n),i.deletedCount!=null&&(s.deletedCount=i.deletedCount),t(null,s)}}});var SU=_((NNe,vU)=>{"use strict";function Wye(e){return!!e&&(typeof e=="object"||typeof e=="function")&&typeof e.then=="function"}vU.exports=Wye});var Un=_((LU,kU)=>{"use strict";var xy=require("events").EventEmitter,zye=_L(),So=Ft(),NE=wa(),Hye=fb(),Kye=hb(),OU=ok(),Gye=Ju(),bU=ga(),My=co(),xU=rb(),Qye=zm(),qU=an(),xE=Ub(),Yye=dy().compile,Jye=dy().defineKey,Xye=sc().flatten,bs=je(),qE=hU(),Zye=Zb(),ege=pU(),EU=Cr(),MU=oc(),tge=Ty(),$E=require("util").inspect,rge=Ss().internalToObjectOptions,nge=ao(),ige=ac(),$e=Ne(),sge=SU(),vo=$e.clone,Ay=$e.deepEqual,oge=$e.isMongooseObject,qy=Symbol("mongoose.Array#atomicsBackup"),Ni=pe().arrayAtomicsSymbol,age=pe().documentArrayParent,uge=pe().documentIsModified,NU=pe().documentModifiedPaths,PE=pe().documentSchemaSymbol,cge=pe().getSymbol,CU=pe().populateModelSymbol,lge=pe().scopeSymbol,fge=_a().schemaMixedSymbol,uc,TU,Aa,hge=$e.specialProperties;function Q(e,t,r,n){typeof r=="object"&&r!=null&&(n=r,r=n.skipId),n=Object.assign({},n);let i=bs(n,"defaults",!0);if(n.defaults=i,this.$__schema==null){let c=$e.isObject(t)&&!t.instanceOfSchema?new Gye(t):t;this.$__setSchema(c),t=r,r=n,n=arguments[4]||{}}if(this.$__=new zye,this.$__.emitter=new xy,this.isNew="isNew"in n?n.isNew:!0,this.errors=void 0,this.$__.$options=n||{},this.$locals={},this.$op=null,e!=null&&typeof e!="object")throw new Kye(e,"obj","Document");let s=this.$__schema;typeof t=="boolean"||t==="throw"?(this.$__.strictMode=t,t=void 0):(this.$__.strictMode=s.options.strict,this.$__.selected=t);let o=s.requiredPaths(!0);for(let c of o)this.$__.activePaths.require(c);this.$__.emitter.setMaxListeners(0);let a=null;$e.isPOJO(t)&&(a=tge(t));let u=a===!1&&t?dge(t):{};if(this._doc==null&&(this.$__buildDoc(e,t,r,a,u,!1),i&&ME(this,t,r,a,u,!0,{isNew:this.isNew})),e&&(this.$__original_set?this.$__original_set(e,void 0,!0):this.$set(e,void 0,!0),e instanceof Q&&(this.isNew=e.isNew)),n.willInit&&i?xy.prototype.once.call(this,"init",()=>{ME(this,t,r,a,u,!1,n.skipDefaults,{isNew:this.isNew})}):i&&ME(this,t,r,a,u,!1,n.skipDefaults,{isNew:this.isNew}),this.$__._id=this._id,!this.$__.strictMode&&e){let c=this;Object.keys(this._doc).forEach(function(h){h in s.tree||Jye(h,null,c)})}wge(this)}$e.each(["on","once","emit","listeners","removeListener","setMaxListeners","removeAllListeners","addListener"],function(e){Q.prototype[e]=function(){return this.$__.emitter[e].apply(this.$__.emitter,arguments)}});Q.prototype.constructor=Q;for(let e in xy.prototype)Q[e]=xy.prototype[e];Q.prototype.$__schema;Q.prototype.schema;Object.defineProperty(Q.prototype,"$locals",{configurable:!1,enumerable:!1,writable:!0});Q.prototype.isNew;Object.defineProperty(Q.prototype,"$where",{configurable:!1,enumerable:!1,writable:!0});Q.prototype.id;Q.prototype.errors;Q.prototype.$op;function dge(e){let t={},r=Object.keys(e);for(let n of r){let i=n.split("."),s=[];for(let o of i)s.push(o),t[s.join(".")]=1}return t}function ME(e,t,r,n,i,s,o){let a=Object.keys(e.$__schema.paths),u=a.length;for(let c=0;c<u;++c){let f,h="",d=a[c];if(d==="_id"&&r)continue;let p=e.$__schema.paths[d],m=p.splitPath(),y=m.length,g=!1,w=e._doc;for(let S=0;S<y&&w!=null;++S){let v=m[S];if(h+=(h.length?".":"")+v,n===!0){if(h in t)break}else if(n===!1&&t&&!g){if(h in t)g=!0;else if(!i[h])break}if(S===y-1){if(w[v]!==void 0)break;if(typeof p.defaultValue=="function"){if(!p.defaultValue.$runBeforeSetters&&s||p.defaultValue.$runBeforeSetters&&!s)break}else if(!s)continue;if(o&&o[h])break;if(t&&n!==null){if(n===!0){if(d in t)continue;try{f=p.getDefault(e,!1)}catch(E){e.invalidate(d,E);break}typeof f<"u"&&(w[v]=f,e.$__.activePaths.default(d))}else if(g){try{f=p.getDefault(e,!1)}catch(E){e.invalidate(d,E);break}typeof f<"u"&&(w[v]=f,e.$__.activePaths.default(d))}}else{try{f=p.getDefault(e,!1)}catch(E){e.invalidate(d,E);break}typeof f<"u"&&(w[v]=f,e.$__.activePaths.default(d))}}else w=w[v]}}}Q.prototype.$__buildDoc=function(e,t,r,n,i){let s={},o=Object.keys(this.$__schema.paths).filter(c=>!c.includes("$*")),a=o.length,u=0;for(;u<a;++u){let c=o[u];if(c==="_id"&&(r||e&&"_id"in e))continue;let f=this.$__schema.paths[c].splitPath(),h=f.length,d=h-1,p="",m=s,y=!1;for(let g=0;g<h;++g){let w=f[g];if(p+=(p.length?".":"")+w,n===!0){if(p in t)break}else if(n===!1&&t&&!y){if(p in t)y=!0;else if(!i[p])break}g<d&&(m=m[w]||(m[w]={}))}}this._doc=s};Q.prototype.toBSON=function(){return this.toObject(rge)};Q.prototype.init=function(e,t,r){return typeof t=="function"&&(r=t,t=null),this.$__init(e,t),r&&r(null,this),this};Q.prototype.$__init=function(e,t){if(this.isNew=!1,this.$init=!0,t=t||{},e._id!=null&&t.populated&&t.populated.length){let r=String(e._id);for(let n of t.populated)if(n.isVirtual?this.populated(n.path,$e.getValue(n.path,e),n):this.populated(n.path,n._docs[r],n),n._childDocs!=null){for(let i of n._childDocs)i==null||i.$__==null||(i.$__.parent=this);n._childDocs=[]}}return $U(this,e,this._doc,t),pge(this,t.populated),this.emit("init",this),this.constructor.emit("init",this),this.$__._id=this._id,this};function pge(e,t){if(e._id==null||t==null||t.length===0)return;let r=String(e._id);for(let n of t){if(n.isVirtual)continue;let s=n.path.split(".");for(let o=0;o<s.length-1;++o){let a=s.slice(0,o+1).join("."),u=s.slice(o+1).join("."),c=e.get(a);if(c!=null&&c.isMongooseDocumentArray){for(let f=0;f<c.length;++f)c[f].populated(u,n._docs[r]==null?[]:n._docs[r][f],n);break}}}}function $U(e,t,r,n,i){i=i||"";let s=Object.keys(t),o=s.length,a,u,c,f=0;for(;f<o;)h(f++);function h(d){if(c=s[d],u=i+c,a=e.$__schema.path(u),!(e.$__schema.$isRootDiscriminator&&!e.$__isSelected(u)))if(!a&&$e.isPOJO(t[c]))r[c]||(r[c]={}),$U(e,t[c],r[c],n,u+".");else if(!a)r[c]=t[c];else{if(t[c]===null)r[c]=a._castNullish(null);else if(t[c]!==void 0){let m=(t[c].$__||{}).wasPopulated||null;if(a&&!m)try{r[c]=a.cast(t[c],e,!0)}catch(y){e.invalidate(y.path,new xU({path:y.path,message:y.message,type:"cast",value:y.value,reason:y}))}else r[c]=t[c]}e.isModified(u)||e.$__.activePaths.init(u)}}}Q.prototype.update=function(){let t=$e.args(arguments);t.unshift({_id:this._id});let r=this.constructor.update.apply(this.constructor,t);return this.$session()!=null&&("session"in r.options||(r.options.session=this.$session())),r};Q.prototype.updateOne=function(t,r,n){let i=this.constructor.updateOne({_id:this._id},t,r);return i.pre(s=>{this.constructor._middleware.execPre("updateOne",this,[this],s)}),i.post(s=>{this.constructor._middleware.execPost("updateOne",this,[this],{},s)}),this.$session()!=null&&("session"in i.options||(i.options.session=this.$session())),n!=null?i.exec(n):i};Q.prototype.replaceOne=function(){let t=$e.args(arguments);return t.unshift({_id:this._id}),this.constructor.replaceOne.apply(this.constructor,t)};Q.prototype.$session=function(t){if(arguments.length===0)return this.$__.session!=null&&this.$__.session.hasEnded?(this.$__.session=null,null):this.$__.session;if(t!=null&&t.hasEnded)throw new So("Cannot set a document's session to a session that has ended. Make sure you haven't called `endSession()` on the session you are passing to `$session()`.");if(this.$__.session=t,!this.ownerDocument){let r=this.$getAllSubdocs();for(let n of r)n.$session(t)}return t};Q.prototype.overwrite=function(t){let r=Array.from(new Set(Object.keys(this._doc).concat(Object.keys(t))));for(let n of r)n!=="_id"&&(this.$__schema.options.versionKey&&n===this.$__schema.options.versionKey||this.$__schema.options.discriminatorKey&&n===this.$__schema.options.discriminatorKey||this.$set(n,t[n]));return this};Q.prototype.$set=function(t,r,n,i){$e.isPOJO(n)&&(i=n,n=void 0),i=i||{};let s=i.merge,o=n&&n!==!0,a=n===!0,u=this.$__schema.options.typeKey,c,f,h=0,d,p,m,y="strict"in i?i.strict:this.$__.strictMode;if(o&&(c=this.$__.adhocPaths||(this.$__.adhocPaths={}),c[t]=this.$__schema.interpretAsType(t,n,this.$__schema.options)),t==null){let k=t;t=r,r=k}else if(typeof t!="string"){if(t instanceof Q&&(t.$__isNested?t=t.toObject():t=t._doc),t==null){let Z=t;t=r,r=Z}m=r?r+".":"",f=Object.keys(t);let k=f.length,P=bs(i,"_skipMinimizeTopLevel",!1);if(k===0&&P)return delete i._skipMinimizeTopLevel,r&&this.$set(r,{}),this;for(let Z=0;Z<k;++Z){p=f[Z];let F=m+p;if(d=this.$__schema.pathType(F),n===!0&&!m&&t[p]!=null&&d==="nested"&&this._doc[p]!=null&&Object.keys(this._doc[p]).length===0?(delete this._doc[p],i=Object.assign({},i,{_skipMinimizeTopLevel:!0})):i=Object.assign({},i,{_skipMinimizeTopLevel:!1}),typeof t[p]=="object"&&!$e.isNativeObject(t[p])&&!$e.isMongooseType(t[p])&&t[p]!=null&&d!=="virtual"&&d!=="real"&&d!=="adhocOrUndefined"&&!(this.$__path(F)instanceof NE)&&!(this.$__schema.paths[F]&&this.$__schema.paths[F].options&&this.$__schema.paths[F].options.ref))this.$__.$setCalled.add(m+p),this.$set(t[p],m+p,a,i);else if(y){if(a&&t[p]===void 0&&this.get(F)!==void 0)continue;if(d==="adhocOrUndefined"&&(d=qE(this,F,{typeOnly:!0})),d==="real"||d==="virtual"){let q=t[p];this.$__schema.paths[F]&&this.$__schema.paths[F].$isSingleNested&&t[p]instanceof Q&&(q=q.toObject({virtuals:!1,transform:!1})),this.$set(m+p,q,a,i)}else if(d==="nested"&&t[p]instanceof Q)this.$set(m+p,t[p].toObject({transform:!1}),a,i);else if(y==="throw")throw d==="nested"?new Hye(p,t[p]):new bU(p)}else t[p]!==void 0&&this.$set(m+p,t[p],a,i)}return this}else this.$__.$setCalled.add(t);let g=this.$__schema.pathType(t);if(g==="adhocOrUndefined"&&(g=qE(this,t,{typeOnly:!0})),r=Zye(r),g==="nested"&&r){if(typeof r=="object"&&r!=null){let k=this.$__.savedState!=null&&this.$__.savedState.hasOwnProperty(t);if(this.$__.savedState!=null&&!this.isNew&&!this.$__.savedState.hasOwnProperty(t)){let Z=this.$__getValue(t);this.$__.savedState[t]=Z;let F=Object.keys(Z||{});for(let b of F)this.$__.savedState[t+"."+b]=Z[b]}if(!s)this.$__setValue(t,null),xE(this,t);else return this.$set(r,t,a);let P=Object.keys(r);this.$__setValue(t,{});for(let Z of P)this.$set(t+"."+Z,r[Z],a);return k&&$e.deepEqual(this.$__.savedState[t],r)?this.unmarkModified(t):this.markModified(t),xE(this,t,{skipDocArrays:!0}),this}return this.invalidate(t,new So.CastError("Object",r,t)),this}let w,S=t.indexOf(".")===-1?[t]:t.split(".");if(typeof this.$__schema.aliases[S[0]]=="string"&&(S[0]=this.$__schema.aliases[S[0]]),g==="adhocOrUndefined"&&y){let k;for(h=0;h<S.length;++h){let P=S.slice(0,h+1).join(".");if(h+1<S.length&&this.$__schema.pathType(P)==="virtual")return nge.set(t,r,this),this;if(w=this.$__schema.path(P),w!=null&&w instanceof NE){k=!0;break}}if(w==null&&(w=qE(this,t)),!k&&!w){if(y==="throw")throw new bU(t);return this}}else{if(g==="virtual")return w=this.$__schema.virtualpath(t),w.applySetters(r,this),this;w=this.$__path(t)}let v=this._doc,E="";for(h=0;h<S.length-1;++h)v=v[S[h]],E+=(E.length>0?".":"")+S[h],v||(this.$set(E,{}),this.$__isSelected(E)||this.unmarkModified(E),v=this.$__getValue(E));let A;if(S.length<=1)A=t;else{for(h=0;h<S.length;++h){let k=S.slice(0,h+1).join(".");if(this.get(k,null,{getters:!1})===null){A=k;break}}A||(A=t)}let x=(()=>{if(this.$__.$options.priorDoc!=null)return this.$__.$options.priorDoc.$__getValue(t);if(!a)return this.$__getValue(t)})();if(!w)return this.$__set(A,t,a,S,w,r,x),this;if((w.$isSingleNested||w.$isMongooseArray)&&gge(this,t),w.$isSingleNested&&r!=null&&s){r instanceof Q&&(r=r.toObject({virtuals:!1,transform:!1}));let k=Object.keys(r);for(let P of k)this.$set(t+"."+P,r[P],a,i);return this}let z=!0;try{let k=(()=>{if(w.options==null||!(r instanceof Q))return!1;let F=r.constructor,b=w.options.ref;if(b!=null&&(b===F.modelName||b===F.baseModelName))return!0;let q=w.options.refPath;if(q==null)return!1;let I=r.get(q);return I===F.modelName||I===F.baseModelName})(),P=!1;k&&r instanceof Q&&(this.populated(t,r._id,{[CU]:r.constructor}),r.$__.wasPopulated=!0,P=!0);let Z;if(w.options&&Array.isArray(w.options[u])&&w.options[u].length&&w.options[u][0].ref&&mge(r,w.options[u][0].ref)){Z={[CU]:r[0].constructor},this.populated(t,r.map(function(F){return F._id}),Z);for(let F of r)F.$__.wasPopulated=!0;P=!0}if(this.$__schema.singleNestedPaths[t]==null&&(r=w.applySetters(r,this,!1,x)),w.$isMongooseDocumentArray&&Array.isArray(r)&&r.length>0&&r[0]!=null&&r[0].$__!=null&&r[0].$__.populated!=null){let F=Object.keys(r[0].$__.populated);for(let b of F)this.populated(t+"."+b,r.map(q=>q.populated(b)),r[0].$__.populated[b].options);P=!0}if(!P&&this.$__.populated){if(Array.isArray(r)&&this.$__.populated[t])for(let F=0;F<r.length;++F)r[F]instanceof Q&&(r[F]=r[F]._id);delete this.$__.populated[t]}w.$isSingleNested&&r!=null&&_ge(r,w,x),this.$markValid(t)}catch(k){k instanceof So.StrictModeError&&k.isImmutableError?this.invalidate(t,k):k instanceof So.CastError?(this.invalidate(k.path,k),k.$originalErrorPath&&this.invalidate(t,new So.CastError(w.instance,r,t,k.$originalErrorPath))):this.invalidate(t,new So.CastError(w.instance,r,t,k)),z=!1}return z&&(this.$__set(A,t,a,S,w,r,x),this.$__.savedState!=null&&(!this.isNew&&!this.$__.savedState.hasOwnProperty(t)?this.$__.savedState[t]=x:this.$__.savedState.hasOwnProperty(t)&&$e.deepEqual(r,this.$__.savedState[t])&&this.unmarkModified(t))),w.$isSingleNested&&(this.isDirectModified(t)||r==null)&&xE(this,t),this};function mge(e,t){if(!Array.isArray(e)||e.length===0)return!1;for(let r of e)if(!(r instanceof Q)||r.constructor.modelName==null||r.constructor.modelName!=t&&r.constructor.baseModelName!=t)return!1;return!0}Q.prototype.set=Q.prototype.$set;Q.prototype.$__shouldModify=function(e,t,r,n,i,s,o){return this.isNew?!0:this.$__schema.singleNestedPaths[t]!=null?!1:s===void 0&&!this.$__isSelected(t)?!0:s===void 0&&t in this.$__.activePaths.states.default||this.populated(t)&&s instanceof Q&&Ay(s._id,o)?!1:!!(!Ay(s,o||$e.getValue(t,this))||!r&&s!==null&&s!==void 0&&t in this.$__.activePaths.states.default&&Ay(s,i.getDefault(this,r)))};Q.prototype.$__set=function(e,t,r,n,i,s,o){Aa=Aa||Xu();let a=this.$__shouldModify(e,t,r,n,i,s,o),u=this;a&&(this.markModified(e),TU||(TU=Gb()),s&&s.isMongooseArray&&(s._registerAtomic("$set",s),s.isMongooseDocumentArray&&s.forEach(function(p){p&&p.__parentArray&&(p.__parentArray=s)}),this.$__.activePaths.forEach(function(p){p.startsWith(t+".")&&u.$__.activePaths.ignore(p)})));let c=this._doc,f=0,h=n.length,d="";for(;f<h;f++){let m=f+1===h;if(d+=d?"."+n[f]:n[f],hge.has(n[f]))return;m?c instanceof Map?c.set(n[f],s):c[n[f]]=s:($e.isPOJO(c[n[f]])||c[n[f]]&&c[n[f]]instanceof Aa||c[n[f]]&&c[n[f]].$isSingleNested||c[n[f]]&&Array.isArray(c[n[f]])||(c[n[f]]=c[n[f]]||{}),c=c[n[f]])}};Q.prototype.$__getValue=function(e){return $e.getValue(e,this._doc)};Q.prototype.$__setValue=function(e,t){return $e.setValue(e,t,this._doc),this};Q.prototype.get=function(e,t,r){let n;r=r||{},t&&(n=this.$__schema.interpretAsType(e,t,this.$__schema.options));let i=this.$__path(e);if(i==null&&(i=this.$__schema.virtualpath(e)),i instanceof NE){let a=this.$__schema.virtualpath(e);a!=null&&(i=a)}let s=e.indexOf(".")===-1?[e]:e.split("."),o=this._doc;if(i instanceof Qye)return i.applyGetters(void 0,this);typeof this.$__schema.aliases[s[0]]=="string"&&(s[0]=this.$__schema.aliases[s[0]]);for(let a=0,u=s.length;a<u;a++)o&&o._doc&&(o=o._doc),o==null?o=void 0:o instanceof Map?o=o.get(s[a],{getters:!1}):a===u-1?o=$e.getValue(s[a],o):o=o[s[a]];if(n&&(o=n.cast(o)),i!=null&&r.getters!==!1)o=i.applyGetters(o,this);else if(this.$__schema.nested[e]&&r.virtuals)return BU(this,$e.clone(o)||{},{path:e});return o};Q.prototype[cge]=Q.prototype.get;Q.prototype.$__path=function(e){let t=this.$__.adhocPaths,r=t&&t.hasOwnProperty(e)?t[e]:null;return r||this.$__schema.path(e)};Q.prototype.markModified=function(e,t){this.$__.activePaths.modify(e),t!=null&&!this.ownerDocument&&(this.$__.pathsToScopes[e]=t)};Q.prototype.unmarkModified=function(e){this.$__.activePaths.init(e),delete this.$__.pathsToScopes[e]};Q.prototype.$ignore=function(e){this.$__.activePaths.ignore(e)};Q.prototype.directModifiedPaths=function(){return Object.keys(this.$__.activePaths.states.modify)};Q.prototype.$isEmpty=function(e){let t={minimize:!0,virtuals:!1,getters:!1,transform:!1};if(arguments.length>0){let r=this.get(e);return r==null?!0:typeof r!="object"?!1:$e.isPOJO(r)?PU(r):Object.keys(r.toObject(t)).length===0}return Object.keys(this.toObject(t)).length===0};function PU(e){if(e==null)return!0;if(typeof e!="object"||Array.isArray(e))return!1;for(let t of Object.keys(e))if(!PU(e[t]))return!1;return!0}Q.prototype.modifiedPaths=function(e){e=e||{};let t=Object.keys(this.$__.activePaths.states.modify),r=this;return t.reduce(function(n,i){let s=i.split(".");if(n=n.concat(s.reduce(function(a,u,c){return a.concat(s.slice(0,c).concat(u).join("."))},[]).filter(function(a){return n.indexOf(a)===-1})),!e.includeChildren)return n;let o=r.get(i);if(o!=null&&typeof o=="object")if(o._doc&&(o=o._doc),Array.isArray(o)){let a=o.length;for(let u=0;u<a;++u)if(n.indexOf(i+"."+u)===-1&&(n.push(i+"."+u),o[u]!=null&&o[u].$__)){let c=o[u].modifiedPaths();for(let f of c)n.push(i+"."+u+"."+f)}}else Object.keys(o).filter(function(a){return n.indexOf(i+"."+a)===-1}).forEach(function(a){n.push(i+"."+a)});return n},[])};Q.prototype[NU]=Q.prototype.modifiedPaths;Q.prototype.isModified=function(e,t){if(e){Array.isArray(e)||(e=e.split(" "));let r=t||this[NU](),n=Object.keys(this.$__.activePaths.states.modify);return e.some(function(s){return!!~r.indexOf(s)})||e.some(function(s){return n.some(function(o){return o===s||s.startsWith(o+".")})})}return this.$__.activePaths.some("modify")};Q.prototype[uge]=Q.prototype.isModified;Q.prototype.$isDefault=function(e){if(e==null)return this.$__.activePaths.some("default");if(typeof e=="string"&&e.indexOf(" ")===-1)return this.$__.activePaths.states.default.hasOwnProperty(e);let t=e;return Array.isArray(t)||(t=t.split(" ")),t.some(r=>this.$__.activePaths.states.default.hasOwnProperty(r))};Q.prototype.$isDeleted=function(e){return arguments.length===0?!!this.$__.isDeleted:(this.$__.isDeleted=!!e,this)};Q.prototype.isDirectModified=function(e){if(e==null)return this.$__.activePaths.some("modify");if(typeof e=="string"&&e.indexOf(" ")===-1)return this.$__.activePaths.states.modify.hasOwnProperty(e);let t=e;return Array.isArray(t)||(t=t.split(" ")),t.some(r=>this.$__.activePaths.states.modify.hasOwnProperty(r))};Q.prototype.isInit=function(e){if(e==null)return this.$__.activePaths.some("init");if(typeof e=="string"&&e.indexOf(" ")===-1)return this.$__.activePaths.states.init.hasOwnProperty(e);let t=e;return Array.isArray(t)||(t=t.split(" ")),t.some(r=>this.$__.activePaths.states.init.hasOwnProperty(r))};Q.prototype.isSelected=function(t){if(this.$__.selected==null)return!0;if(t==="_id")return this.$__.selected._id!==0;if(t.indexOf(" ")!==-1&&(t=t.split(" ")),Array.isArray(t))return t.some(s=>this.$__isSelected(s));let r=Object.keys(this.$__.selected),n=null;if(r.length===1&&r[0]==="_id")return this.$__.selected._id===0;for(let s of r)if(s!=="_id"&&!!MU(this.$__.selected[s])){n=!!this.$__.selected[s];break}if(n===null)return!0;if(t in this.$__.selected)return n;let i=t+".";for(let s of r)if(s!=="_id"){if(s.startsWith(i))return n||s!==i;if(i.startsWith(s+"."))return n}return!n};Q.prototype.$__isSelected=Q.prototype.isSelected;Q.prototype.isDirectSelected=function(t){if(this.$__.selected==null)return!0;if(t==="_id")return this.$__.selected._id!==0;if(t.indexOf(" ")!==-1&&(t=t.split(" ")),Array.isArray(t))return t.some(i=>this.isDirectSelected(i));let r=Object.keys(this.$__.selected),n=null;if(r.length===1&&r[0]==="_id")return this.$__.selected._id===0;for(let i of r)if(i!=="_id"&&!!MU(this.$__.selected[i])){n=!!this.$__.selected[i];break}return n===null?!0:this.$__.selected.hasOwnProperty(t)?n:!n};Q.prototype.validate=function(e,t,r){let n;if(this.$op="validate",this.ownerDocument!=null||(this.$__.validating?n=new OU(this,{parentStack:t&&t.parentStack,conflictStack:this.$__.validating.stack}):this.$__.validating=new OU(this,{parentStack:t&&t.parentStack})),arguments.length===1?typeof arguments[0]=="object"&&!Array.isArray(arguments[0])?(t=arguments[0],r=null,e=null):typeof arguments[0]=="function"&&(r=arguments[0],t=null,e=null):typeof e=="function"?(r=e,t=null,e=null):typeof t=="function"&&(r=t,t=e,e=null),t&&typeof t.pathsToSkip=="string"){let i=t.pathsToSkip.indexOf(" ")===-1;t.pathsToSkip=i?[t.pathsToSkip]:t.pathsToSkip.split(" ")}return qU(r,i=>{if(n!=null)return i(n);this.$__validate(e,t,s=>{this.$op=null,i(s)})},this.constructor.events)};function yge(e){Object.keys(e.$__.activePaths.states.require).forEach(t=>{let r=e.$__schema.path(t);r!=null&&typeof r.originalRequiredValue=="function"&&(e.$__.cachedRequired[t]=r.originalRequiredValue.call(e,e))})}function IU(e){let t={};yge(e);let r=new Set(Object.keys(e.$__.activePaths.states.require).filter(function(u){return!e.$__isSelected(u)&&!e.isModified(u)?!1:u in e.$__.cachedRequired?e.$__.cachedRequired[u]:!0}));Object.keys(e.$__.activePaths.states.init).forEach(n),Object.keys(e.$__.activePaths.states.modify).forEach(n),Object.keys(e.$__.activePaths.states.default).forEach(n);function n(u){r.add(u)}let i=e.$getAllSubdocs(),s=e.modifiedPaths();for(let u of i)if(u.$basePath){for(let c of r)(c===null||c.startsWith(u.$basePath+"."))&&r.delete(c);e.isModified(u.$basePath,s)&&!e.isDirectModified(u.$basePath)&&!e.$isDefault(u.$basePath)&&(r.add(u.$basePath),t[u.$basePath]=!0)}for(let u of r){let c=e.$__schema.path(u);if(!c||!c.$isMongooseArray||c.$isMongooseDocumentArray&&!bs(c,"schemaOptions.required"))continue;let f=e.$__getValue(u);o(f,r,u)}function o(u,c,f){if(u!=null){let h=u.length;for(let d=0;d<h;++d)Array.isArray(u[d])?o(u[d],c,f+"."+d):c.add(f+"."+d)}}let a={skipArrays:!0};for(let u of r)if(e.$__schema.nested[u]){let c=e.$__getValue(u);oge(c)&&(c=c.toObject({transform:!1}));let f=Xye(c,u,a,e.$__schema);Object.keys(f).forEach(n)}for(let u of r){if(e.$__schema.singleNestedPaths.hasOwnProperty(u)){r.delete(u);continue}let c=e.$__schema.path(u);if(!c||!c.$isSchemaMap)continue;let f=e.$__getValue(u);if(f!=null)for(let h of f.keys())r.add(u+"."+h)}return r=Array.from(r),[r,t]}Q.prototype.$__validate=function(e,t,r){typeof e=="function"?(r=e,t=null,e=null):typeof t=="function"&&(r=t,t=null);let n=t&&typeof t=="object"&&"validateModifiedOnly"in t,i=bs(t,"pathsToSkip",null),s;n?s=!!t.validateModifiedOnly:s=this.$__schema.options.validateModifiedOnly;let o=this,a=()=>{let y=this.$__.validationError;if(this.$__.validationError=void 0,s&&y!=null){let g=Object.keys(y.errors);for(let w of g)this.isModified(w)||delete y.errors[w];Object.keys(y.errors).length===0&&(y=void 0)}if(this.$__.cachedRequired={},this.emit("validate",o),this.constructor.emit("validate",o),this.$__.validating=null,y){for(let g in y.errors)!this[age]&&y.errors[g]instanceof So.CastError&&this.invalidate(g,y.errors[g]);return y}},u=IU(this),c=s?u[0].filter(y=>this.isModified(y)):u[0],f=u[1];if(typeof e=="string"&&(e=e.split(" ")),Array.isArray(e)?c=RU(c,e):i&&(c=DU(c,i)),c.length===0)return EU(function(){let y=a();if(y)return o.$__schema.s.hooks.execPost("validate:error",o,[o],{error:y},function(g){r(g)});r(null,o)});let h={},d=0;for(let y of c)p(y);function p(y){y==null||h[y]||(h[y]=!0,d++,EU(function(){let g=o.$__schema.path(y);if(!g)return--d||m();if(!o.$isValid(y)){--d||m();return}if(g[fge]!=null&&y!==g.path)return--d||m();let w=o.$__getValue(y),S;w==null&&(S=o.populated(y))&&(w=S);let v=y in o.$__.pathsToScopes?o.$__.pathsToScopes[y]:o,E={skipSchemaValidators:f[y],path:y,validateModifiedOnly:s};g.doValidate(w,function(A){if(A&&(!g.$isMongooseDocumentArray||A.$isArrayValidatorError)){if(g.$isSingleNested&&A instanceof My&&g.schema.options.storeSubdocValidationError===!1)return--d||m();o.invalidate(y,A,void 0,!0)}--d||m()},v,E)}))}function m(){let y=a();if(y)return o.$__schema.s.hooks.execPost("validate:error",o,[o],{error:y},function(g){r(g)});r(null,o)}};function RU(e,t){let r=new Set(t),n=new Map([]);for(let s of t){if(s.indexOf(".")===-1)continue;let o=s.split("."),a=o[0];for(let u=1;u<o.length;++u)n.set(a,s),a=a+"."+o[u]}let i=[];for(let s of e)r.has(s)?i.push(s):n.has(s)&&i.push(n.get(s));return i}function DU(e,t){return t=new Set(t),e=e.filter(r=>!t.has(r)),e}Q.prototype.validateSync=function(e,t){let r=this;arguments.length===1&&typeof arguments[0]=="object"&&!Array.isArray(arguments[0])&&(t=arguments[0],e=null);let n=t&&typeof t=="object"&&"validateModifiedOnly"in t,i;n?i=!!t.validateModifiedOnly:i=this.$__schema.options.validateModifiedOnly;let s=t&&t.pathsToSkip;typeof e=="string"?e=e.indexOf(" ")===-1?[e]:e.split(" "):typeof s=="string"&&s.indexOf(" ")!==-1&&(s=s.split(" "));let o=IU(this),a=i?o[0].filter(h=>this.isModified(h)):o[0],u=o[1];Array.isArray(e)?a=RU(a,e):Array.isArray(s)&&(a=DU(a,s));let c={};a.forEach(function(h){if(c[h])return;c[h]=!0;let d=r.$__schema.path(h);if(!d||!r.$isValid(h))return;let p=r.$__getValue(h),m=d.doValidateSync(p,r,{skipSchemaValidators:u[h],path:h,validateModifiedOnly:i});if(m&&(!d.$isMongooseDocumentArray||m.$isArrayValidatorError)){if(d.$isSingleNested&&m instanceof My&&d.schema.options.storeSubdocValidationError===!1)return;r.invalidate(h,m,void 0,!0)}});let f=r.$__.validationError;if(r.$__.validationError=void 0,r.emit("validate",r),r.constructor.emit("validate",r),f)for(let h in f.errors)f.errors[h]instanceof So.CastError&&r.invalidate(h,f.errors[h]);return f};Q.prototype.invalidate=function(e,t,r,n){if(this.$__.validationError||(this.$__.validationError=new My(this)),!this.$__.validationError.errors[e])return(!t||typeof t=="string")&&(t=new xU({path:e,message:t,type:n||"user defined",value:r})),this.$__.validationError===t?this.$__.validationError:(this.$__.validationError.addError(e,t),this.$__.validationError)};Q.prototype.$markValid=function(e){!this.$__.validationError||!this.$__.validationError.errors[e]||(delete this.$__.validationError.errors[e],Object.keys(this.$__.validationError.errors).length===0&&(this.$__.validationError=null))};function gge(e,t){if(!e.$__.validationError)return;let r=Object.keys(e.$__.validationError.errors);for(let n of r)n.startsWith(t+".")&&delete e.$__.validationError.errors[n];Object.keys(e.$__.validationError.errors).length===0&&(e.$__.validationError=null)}function _ge(e,t,r){let n=t.schema;if(n!=null)for(let i of Object.keys(n.paths)){let s=n.paths[i];if(s.$immutableSetter==null)continue;let o=r==null?void 0:r.$__getValue(i);s.$immutableSetter.call(e,o)}}Q.prototype.$isValid=function(e){return this.$__.validationError==null||Object.keys(this.$__.validationError.errors).length===0?!0:e==null?!1:(e.indexOf(" ")!==-1&&(e=e.split(" ")),Array.isArray(e)?e.some(t=>this.$__.validationError.errors[t]==null):this.$__.validationError.errors[e]==null)};Q.prototype.$__reset=function(){let t=this;return uc||(uc=yo()),this.$__.activePaths.map("init","modify",function(r){return t.$__getValue(r)}).filter(function(r){return r&&r instanceof Array&&r.isMongooseDocumentArray&&r.length}).forEach(function(r){let n=r.length;for(;n--;){let i=r[n];!i||i.$__reset()}t.$__.activePaths.init(r.$path()),r[qy]=r[Ni],r[Ni]={}}),this.$__.activePaths.map("init","modify",function(r){return t.$__getValue(r)}).filter(function(r){return r&&r.$isSingleNested}).forEach(function(r){r.$__reset(),r.$__parent===t?t.$__.activePaths.init(r.$basePath):r.$__parent!=null&&r.$__parent.ownerDocument&&r.$__parent.$__reset()}),this.$__dirty().forEach(function(r){let n=r.value;n&&n[Ni]&&(n[qy]=n[Ni],n[Ni]={})}),this.$__.backup={},this.$__.backup.activePaths={modify:Object.assign({},this.$__.activePaths.states.modify),default:Object.assign({},this.$__.activePaths.states.default)},this.$__.backup.validationError=this.$__.validationError,this.$__.backup.errors=this.errors,this.$__.activePaths.clear("modify"),this.$__.activePaths.clear("default"),this.$__.validationError=void 0,this.errors=void 0,t=this,this.$__schema.requiredPaths().forEach(function(r){t.$__.activePaths.require(r)}),this};Q.prototype.$__undoReset=function(){if(!(this.$__.backup==null||this.$__.backup.activePaths==null)){this.$__.activePaths.states.modify=this.$__.backup.activePaths.modify,this.$__.activePaths.states.default=this.$__.backup.activePaths.default,this.$__.validationError=this.$__.backup.validationError,this.errors=this.$__.backup.errors;for(let t of this.$__dirty()){let r=t.value;r&&r[Ni]&&r[qy]&&(r[Ni]=r[qy])}for(let t of this.$getAllSubdocs())t.$__undoReset()}};Q.prototype.$__dirty=function(){let e=this,t=this.$__.activePaths.map("modify",function(s){return{path:s,value:e.$__getValue(s),schema:e.$__path(s)}});t=t.concat(this.$__.activePaths.map("default",function(s){if(!(s==="_id"||e.$__getValue(s)==null))return{path:s,value:e.$__getValue(s),schema:e.$__path(s)}})),t.sort(function(s,o){return s.path<o.path?-1:s.path>o.path?1:0});let r=[],n,i;return t.forEach(function(s){!s||(n==null||s.path.indexOf(n)!==0?(n=s.path+".",r.push(s),i=s):i!=null&&i.value!=null&&i.value[Ni]!=null&&i.value.hasAtomics()&&(i.value[Ni]={},i.value[Ni].$set=i.value))}),i=n=null,r};Q.prototype.$__setSchema=function(e){e.plugin(ege,{deduplicate:!0}),Yye(e.tree,this,void 0,e.options);for(let t of Object.keys(e.virtuals))e.virtuals[t]._applyDefaultGetters();e.path("schema")==null&&(this.schema=e),this.$__schema=e,this[PE]=e};Q.prototype.$__getArrayPathsToValidate=function(){return uc||(uc=yo()),this.$__.activePaths.map("init","modify",function(e){return this.$__getValue(e)}.bind(this)).filter(function(e){return e&&e instanceof Array&&e.isMongooseDocumentArray&&e.length}).reduce(function(e,t){return e.concat(t)},[]).filter(function(e){return e})};Q.prototype.$getAllSubdocs=function(){uc||(uc=yo()),Aa=Aa||Xu();function t(n,i,s){let o=n,a=!1;if(s&&(n instanceof Q&&n[PE].paths[s]?o=n._doc[s]:n instanceof Q&&n[PE].nested[s]?(o=n._doc[s],a=!0):o=n[s]),o instanceof Aa)i.push(o);else if(o instanceof Map)i=Array.from(o.keys()).reduce(function(u,c){return t(o.get(c),u,null)},i);else if(o&&o.$isSingleNested)i=Object.keys(o._doc).reduce(function(u,c){return t(o._doc,u,c)},i),i.push(o);else if(o&&o.isMongooseDocumentArray)o.forEach(function(c){!c||!c._doc||(i=Object.keys(c._doc).reduce(function(f,h){return t(c._doc,f,h)},i),c instanceof Aa&&i.push(c))});else if(a&&o!=null)for(let u of Object.keys(o))t(o,i,u);return i}let r=[];for(let n of Object.keys(this._doc))t(this,r,n);return r};function wge(e){let t=e.$__schema&&e.$__schema.callQueue;if(!!t.length)for(let r of t)r[0]!=="pre"&&r[0]!=="post"&&r[0]!=="on"&&e[r[0]].apply(e,r[1])}Q.prototype.$__handleReject=function(t){this.listeners("error").length?this.emit("error",t):this.constructor.listeners&&this.constructor.listeners("error").length&&this.constructor.emit("error",t)};Q.prototype.$toObject=function(e,t){let r={transform:!0,flattenDecimals:!0},n=t?"toJSON":"toObject",i=bs(this,"constructor.base.options."+n,{}),s=bs(this,"$__schema.options",{});r=$e.options(r,vo(i)),r=$e.options(r,vo(s[n]||{})),e=$e.isPOJO(e)?vo(e):{},e._calledWithOptions=e._calledWithOptions||vo(e);let o;e._calledWithOptions.minimize!=null?o=e.minimize:r.minimize!=null?o=r.minimize:o=s.minimize;let a;e._calledWithOptions.flattenMaps!=null?a=e.flattenMaps:r.flattenMaps!=null?a=r.flattenMaps:a=s.flattenMaps;let u=Object.assign($e.clone(e),{_isNested:!0,json:t,minimize:o,flattenMaps:a});if($e.hasUserDefinedProperty(e,"getters")&&(u.getters=e.getters),$e.hasUserDefinedProperty(e,"virtuals")&&(u.virtuals=e.virtuals),(e.depopulate||bs(e,"_parentOptions.depopulate",!1))&&e._isNested&&this.$__.wasPopulated)return vo(this._id,u);e=$e.options(r,e),e._isNested=!0,e.json=t,e.minimize=o,u._parentOptions=e,u._skipSingleNestedGetters=!0;let f=Object.assign({},u);f._skipSingleNestedGetters=!1;let h=e.transform,d=vo(this._doc,u)||{};e.getters&&(vge(this,d,f),e.minimize&&(d=jU(d)||{})),(e.virtuals||e.getters&&e.virtuals!==!1)&&BU(this,d,f,e),e.versionKey===!1&&this.$__schema.options.versionKey&&delete d[this.$__schema.options.versionKey];let p=e.transform;if(p&&Sge(this,d),e.useProjection&&Oge(this,d),p===!0||s.toObject&&p){let m=e.json?s.toJSON:s.toObject;m&&(p=typeof e.transform=="function"?e.transform:m.transform)}else e.transform=h;if(typeof p=="function"){let m=p(this,d,e);typeof m<"u"&&(d=m)}return d};Q.prototype.toObject=function(e){return this.$toObject(e)};function jU(e){let t=Object.keys(e),r=t.length,n,i,s;for(;r--;){if(i=t[r],s=e[i],$e.isObject(s)&&!Buffer.isBuffer(s)&&(e[i]=jU(s)),e[i]===void 0){delete e[i];continue}n=!0}return n?e:void 0}function BU(e,t,r,n){let i=e.$__schema,s=Object.keys(i.virtuals),o=s.length,a=o,u,c,f=e._doc,h,d=bs(n,"aliases",!0),p=null;if(Array.isArray(r.virtuals))p=new Set(r.virtuals);else if(r.virtuals&&r.virtuals.pathsToSkip){p=new Set(s);for(let m=0;m<r.virtuals.pathsToSkip.length;m++)p.has(r.virtuals.pathsToSkip[m])&&p.delete(r.virtuals.pathsToSkip[m])}if(!f)return t;for(r=r||{},o=0;o<a;++o){if(u=s[o],p!=null&&!p.has(u)||!d&&i.aliases.hasOwnProperty(u))continue;if(c=u,r.path!=null){if(!u.startsWith(r.path+"."))continue;c=u.substr(r.path.length+1)}let m=c.split(".");if(h=vo(e.get(u),r),h===void 0)continue;let y=m.length;f=t;for(let g=0;g<y-1;++g)f[m[g]]=f[m[g]]||{},f=f[m[g]];f[m[y-1]]=h}return t}function vge(e,t,r){let n=e.$__schema,i=Object.keys(n.paths),s=i.length,o,a=e._doc,u;if(!a)return t;for(;s--;){o=i[s];let c=o.split("."),f=c.length,h=f-1,d=t,p;if(a=e._doc,!!e.$__isSelected(o))for(let m=0;m<f;++m){if(p=c[m],u=a[p],m===h){let y=e.get(o);d[p]=vo(y,r)}else if(u==null){p in a&&(d[p]=u);break}else d=d[p]||(d[p]={});a=u}}return t}function Sge(e,t){let r=e.$__schema,n=Object.keys(r.paths||{});if(!e._doc)return t;for(let s of n){let o=r.paths[s];if(typeof o.options.transform=="function"){let a=e.get(s),u=o.options.transform.call(e,a);AU(s,u),$e.setValue(s,u,t)}else if(o.$embeddedSchemaType!=null&&typeof o.$embeddedSchemaType.options.transform=="function"){let a=[].concat(e.get(s)),u=o.$embeddedSchemaType.options.transform;for(let c=0;c<a.length;++c){let f=u.call(e,a[c]);a[c]=f,AU(s,f)}t[s]=a}}return t}function AU(e,t){if(sge(t))throw new Error("`transform` function must be synchronous, but the transform on path `"+e+"` returned a promise.")}function Oge(e,t){let r=e.$__schema,n=Object.keys(r.paths||{});if(!e._doc)return t;let s=e.$__.selected;if(s===void 0&&(s={},ige.applyPaths(s,r)),s==null||Object.keys(s).length===0)return t;for(let o of n)s[o]!=null&&!s[o]&&delete t[o];return t}Q.prototype.toJSON=function(e){return this.$toObject(e,!0)};Q.prototype.parent=function(){return this.$__.parent};Q.prototype.$parent=Q.prototype.parent;Q.prototype.inspect=function(e){let t=$e.isPOJO(e),r;t&&(r=e,r.minimize=!1);let n=this.toObject(r);return n??"MongooseDocument { "+n+" }"};if($E.custom){Q.prototype[$E.custom]=Q.prototype.inspect}Q.prototype.toString=function(){let e=this.inspect();return typeof e=="string"?e:$E(e)};Q.prototype.equals=function(e){if(!e)return!1;let t=this.$__getValue("_id"),r=e.$__!=null?e.$__getValue("_id"):e;return!t&&!r?Ay(this,e):t&&t.equals?t.equals(r):t===r};Q.prototype.populate=function(){if(arguments.length===0)return this;let t=this.$__.populate||(this.$__.populate={}),r=$e.args(arguments),n;if(typeof r[r.length-1]=="function"&&(n=r.pop()),r.length){let i=$e.populate.apply(null,r);for(let s of i)t[s.path]=s}if(n){let i=$e.object.vals(t);this.$__.populate=void 0;let s=this.constructor;if(this.$__isNested){s=this.$__[lge].constructor;let o=this.$__.nestedPath;i.forEach(function(a){a.path=o+"."+a.path})}if(this.$session()!=null){let o=this.$session();i.forEach(a=>{if(a.options==null){a.options={session:o};return}"session"in a.options||(a.options.session=o)})}s.populate(this,i,n)}return this};Q.prototype.$getPopulatedDocs=function(){let t=[];this.$__.populated!=null&&(t=t.concat(Object.keys(this.$__.populated))),this.$$populatedVirtuals!=null&&(t=t.concat(Object.keys(this.$$populatedVirtuals)));let r=[];for(let n of t){let i=this.get(n);Array.isArray(i)?r=r.concat(i):i instanceof Q&&r.push(i)}return r};Q.prototype.execPopulate=function(e){return e!=null&&typeof e!="function"?this.populate.apply(this,arguments).execPopulate():qU(e,r=>{this.populate(r)},this.constructor.events)};Q.prototype.populated=function(e,t,r){if(t==null||t===!0){if(!this.$__.populated)return;let i=e.endsWith(".$*")?e.replace(/\.\$\*$/,""):e,s=this.$__.populated[i];return s?t===!0?s:s.value:void 0}this.$__.populated||(this.$__.populated={}),this.$__.populated[e]={value:t,options:r};let n=e.split(".");for(let i=0;i<n.length-1;++i){let s=n.slice(0,i+1).join("."),o=this.get(s);if(o!=null&&o.$__!=null&&this.populated(s)){let a=n.slice(i+1).join(".");o.populated(a,t,r);break}}return t};Q.prototype.depopulate=function(e){typeof e=="string"&&(e=e.split(" "));let t,r=this.$$populatedVirtuals?Object.keys(this.$$populatedVirtuals):[],n=bs(this,"$__.populated",{});if(arguments.length===0){for(let s of r)delete this.$$populatedVirtuals[s],delete this._doc[s],delete n[s];let i=Object.keys(n);for(let s of i)t=this.populated(s),t&&(delete n[s],$e.setValue(s,t,this._doc));return this}for(let i of e)t=this.populated(i),delete n[i],r.indexOf(i)!==-1?(delete this.$$populatedVirtuals[i],delete this._doc[i]):t&&$e.setValue(i,t,this._doc);return this};Q.prototype.$__fullPath=function(e){return e||""};Q.prototype.getChanges=function(){let e=this.$__delta();return e?e[1]:{}};Q.ValidationError=My;kU.exports=LU=Q});var Ne=_(ae=>{"use strict";var bge=O0(),UU=ao(),Ege=tf(),Pf=E0().Buffer,Cge=ua(),$y=Zn(),VU=tj(),Tge=ms(),Age=Cr(),xge=ca(),Ny=S0(),qge=v0(),If=rf(),Mge=an(),Nge=eb(),Rf=dm(),IE;ae.specialProperties=Rf;ae.toCollectionName=function(e,t){return e==="system.profile"||e==="system.indexes"?e:typeof t=="function"?t(e):e};ae.deepEqual=function e(t,r){if(t===r)return!0;if(typeof t!="object"&&typeof r!="object")return t===r;if(t instanceof Date&&r instanceof Date)return t.getTime()===r.getTime();if(Ny(t,"ObjectID")&&Ny(r,"ObjectID")||Ny(t,"Decimal128")&&Ny(r,"Decimal128"))return t.toString()===r.toString();if(t instanceof RegExp&&r instanceof RegExp)return t.source===r.source&&t.ignoreCase===r.ignoreCase&&t.multiline===r.multiline&&t.global===r.global;if(t==null||r==null||t.prototype!==r.prototype)return!1;if(t instanceof Map&&r instanceof Map)return e(Array.from(t.keys()),Array.from(r.keys()))&&e(Array.from(t.values()),Array.from(r.values()));if(t instanceof Number&&r instanceof Number)return t.valueOf()===r.valueOf();if(Pf.isBuffer(t))return ae.buffer.areEqual(t,r);if(Array.isArray(t)&&Array.isArray(r)){let o=t.length;if(o!==r.length)return!1;for(let a=0;a<o;++a)if(!e(t[a],r[a]))return!1;return!0}t.$__!=null?t=t._doc:If(t)&&(t=t.toObject()),r.$__!=null?r=r._doc:If(r)&&(r=r.toObject());let n=Object.keys(t),i=Object.keys(r),s=n.length;if(s!==i.length)return!1;n.sort(),i.sort();for(let o=s-1;o>=0;o--)if(n[o]!==i[o])return!1;for(let o of n)if(!e(t[o],r[o]))return!1;return!0};ae.last=function(e){if(e.length>0)return e[e.length-1]};ae.clone=Tge;ae.promiseOrCallback=Mge;ae.omit=function(t,r){if(r==null)return Object.assign({},t);Array.isArray(r)||(r=[r]);let n=Object.assign({},t);for(let i of r)delete n[i];return n};ae.options=function(e,t){let r=Object.keys(e),n=r.length,i;for(t=t||{};n--;)i=r[n],i in t||(t[i]=e[i]);return t};ae.random=function(){return Math.random().toString().substr(3)};ae.merge=function e(t,r,n,i){n=n||{};let s=Object.keys(r),o=0,a=s.length,u;i=i||"";let c=n.omitNested||{};for(;o<a;)if(u=s[o++],!(n.omit&&n.omit[u])&&!c[i]&&!Rf.has(u))if(t[u]==null)t[u]=r[u];else if(ae.isObject(r[u])){if(ae.isObject(t[u])||(t[u]={}),r[u]!=null){if(n.isDiscriminatorSchemaMerge&&r[u].$isSingleNested&&t[u].$isMongooseDocumentArray||r[u].$isMongooseDocumentArray&&t[u].$isSingleNested)continue;if(r[u].instanceOfSchema){t[u].instanceOfSchema?Nge(t[u],r[u].clone(),n.isDiscriminatorSchemaMerge):t[u]=r[u].clone();continue}else if(r[u]instanceof $y){t[u]=new $y(r[u]);continue}}e(t[u],r[u],n,i?i+"."+u:u)}else n.overwrite&&(t[u]=r[u])};ae.toObject=function e(t){IE||(IE=Un());let r;if(t==null)return t;if(t instanceof IE)return t.toObject();if(Array.isArray(t)){r=[];for(let n of t)r.push(e(n));return r}if(ae.isPOJO(t)){r={};for(let n of Object.keys(t))Rf.has(n)||(r[n]=e(t[n]));return r}return t};ae.isObject=xge;ae.isPOJO=function(t){if(t==null||typeof t!="object")return!1;let r=Object.getPrototypeOf(t);return!r||r.constructor.name==="Object"};ae.isNativeObject=function(e){return Array.isArray(e)||e instanceof Date||e instanceof Boolean||e instanceof Number||e instanceof String};ae.isEmptyObject=function(e){return e!=null&&typeof e=="object"&&Object.keys(e).length===0};ae.hasKey=function(t,r){let n=Object.keys(t);for(let i of n)if(i===r||ae.isPOJO(t[i])&&ae.hasKey(t[i],r))return!0;return!1};ae.args=Ege;ae.tick=function(t){if(typeof t=="function")return function(){try{t.apply(this,arguments)}catch(r){Age(function(){throw r})}}};ae.isMongooseType=function(e){return e instanceof $y||e instanceof Cge||e instanceof Pf};ae.isMongooseObject=If;ae.expires=function(t){if(!(t&&t.constructor.name==="Object")||!("expires"in t))return;let r;typeof t.expires!="string"?r=t.expires:r=Math.round(bge(t.expires)/1e3),t.expireAfterSeconds=r,delete t.expires};ae.populate=function(t,r,n,i,s,o,a,u){let c=null;if(arguments.length===1){if(t instanceof VU)return[t];if(Array.isArray(t))return f(t).map(d=>ae.populate(d)[0]);ae.isObject(t)?c=Object.assign({},t):c={path:t}}else typeof n=="object"?c={path:t,select:r,match:n,options:i}:c={path:t,select:r,model:n,match:i,options:s,populate:o,justOne:a,count:u};if(typeof c.path!="string")throw new TypeError("utils.populate: invalid path. Expected string. Got typeof `"+typeof t+"`");return $ge(c);function f(h){let d=[];return h.forEach(function(p){/[\s]/.test(p.path)?p.path.split(" ").forEach(function(y){let g=Object.assign({},p);g.path=y,d.push(g)}):d.push(p)}),d}};function $ge(e){if(Array.isArray(e.populate)){let n=[];e.populate.forEach(function(i){if(/[\s]/.test(i.path)){let s=Object.assign({},i);s.path.split(" ").forEach(function(a){s.path=a,n.push(ae.populate(s)[0])})}else n.push(ae.populate(i)[0])}),e.populate=ae.populate(n)}else e.populate!=null&&typeof e.populate=="object"&&(e.populate=ae.populate(e.populate));let t=[],r=e.path.split(" ");e.options!=null&&(e.options=ae.clone(e.options));for(let n of r)t.push(new VU(Object.assign({},e,{path:n})));return t}ae.getValue=function(e,t,r){return UU.get(e,t,"_doc",r)};ae.setValue=function(e,t,r,n,i){UU.set(e,t,r,"_doc",n,i)};ae.object={};ae.object.vals=function(t){let r=Object.keys(t),n=r.length,i=[];for(;n--;)i.push(t[r[n]]);return i};ae.object.shallowCopy=ae.options;var Pge=Object.prototype.hasOwnProperty;ae.object.hasOwnProperty=function(e,t){return Pge.call(e,t)};ae.isNullOrUndefined=function(e){return e==null};ae.array={};ae.array.flatten=function e(t,r,n){return n||(n=[]),t.forEach(function(i){Array.isArray(i)?e(i,r,n):(!r||r(i))&&n.push(i)}),n};var Ige=Object.prototype.hasOwnProperty;ae.hasUserDefinedProperty=function(e,t){if(e==null)return!1;if(Array.isArray(t)){for(let r of t)if(ae.hasUserDefinedProperty(e,r))return!0;return!1}if(Ige.call(e,t))return!0;if(typeof e=="object"&&t in e){let r=e[t];return r!==Object.prototype[t]&&r!==Array.prototype[t]}return!1};var FU=Math.pow(2,32)-1;ae.isArrayIndex=function(e){return typeof e=="number"?e>=0&&e<=FU:typeof e=="string"&&/^\d+$/.test(e)?(e=+e,e>=0&&e<=FU):!1};ae.array.unique=function(e){let t=new Set,r=new Set,n=[];for(let i of e)if(typeof i=="number"||typeof i=="string"||i==null){if(t.has(i))continue;n.push(i),t.add(i)}else if(i instanceof $y){if(r.has(i.toString()))continue;n.push(i),r.add(i.toString())}else n.push(i);return n};ae.buffer={};ae.buffer.areEqual=function(e,t){if(!Pf.isBuffer(e)||!Pf.isBuffer(t)||e.length!==t.length)return!1;for(let r=0,n=e.length;r<n;++r)if(e[r]!==t[r])return!1;return!0};ae.getFunctionName=qge;ae.decorate=function(e,t){for(let r in t)Rf.has(r)||(e[r]=t[r])};ae.mergeClone=function(e,t){If(t)&&(t=t.toObject({transform:!1,virtuals:!1,depopulate:!0,getters:!1,flattenDecimals:!1}));let r=Object.keys(t),n=r.length,i=0,s;for(;i<n;)if(s=r[i++],!Rf.has(s))if(typeof e[s]>"u")e[s]=ae.clone(t[s],{transform:!1,virtuals:!1,depopulate:!0,getters:!1,flattenDecimals:!1});else{let o=t[s];if(o!=null&&o.valueOf&&!(o instanceof Date)&&(o=o.valueOf()),ae.isObject(o)){let a=o;If(o)&&!o.isMongooseBuffer&&(a=a.toObject({transform:!1,virtuals:!1,depopulate:!0,getters:!1,flattenDecimals:!1})),o.isMongooseBuffer&&(a=Pf.from(a)),ae.mergeClone(e[s],a)}else e[s]=ae.clone(o,{flattenDecimals:!1})}};ae.each=function(e,t){for(let r of e)t(r)};ae.getOption=function(e){let t=Array.prototype.slice.call(arguments,1);for(let r of t)if(r[e]!=null)return r[e];return null};ae.noop=function(){};ae.errorToPOJO=function(t){if(!(t instanceof Error))throw new Error("`error` must be `instanceof Error`.");let n={};for(let i of Object.getOwnPropertyNames(t))n[i]=t[i];return n};ae.nodeMajorVersion=parseInt(process.versions.node.split(".")[0],10)});var ms=_((PNe,zU)=>{"use strict";var Rge=_0(),Dge=ua(),WU=Zn(),jge=dm(),Bge=rf(),Lge=v0(),kge=S0(),Fge=ca(),Uge=pe(),Vge=Ne();function DE(e,t,r){if(e==null)return e;if(Array.isArray(e))return Wge(e,t);if(Bge(e))return t&&t._skipSingleNestedGetters&&e.$isSingleNested&&(t=Object.assign({},t,{getters:!1})),Vge.isPOJO(e)&&e.$__!=null&&e._doc!=null?e._doc:t&&t.json&&typeof e.toJSON=="function"?e.toJSON(t):e.toObject(t);if(e.constructor)switch(Lge(e.constructor)){case"Object":return RE(e,t,r);case"Date":return new e.constructor(+e);case"RegExp":return Rge(e);default:break}return e instanceof WU?new WU(e.id):kge(e,"Decimal128")?t&&t.flattenDecimals?e.toJSON():Dge.fromString(e.toString()):!e.constructor&&Fge(e)?RE(e,t,r):e[Uge.schemaTypeSymbol]?e.clone():t&&t.bson&&typeof e.toBSON=="function"?e:e.valueOf!=null?e.valueOf():RE(e,t,r)}zU.exports=DE;function RE(e,t,r){let n=t&&t.minimize,i={},s;for(let o of Object.keys(e)){if(jge.has(o))continue;let a=DE(e[o],t);(!n||typeof a<"u")&&(n===!1&&typeof a>"u"?delete i[o]:(s||(s=!0),i[o]=a))}return n&&!r?s&&i:i}function Wge(e,t){let r=[];for(let n of e)r.push(DE(n,t,!0));return r}});var YU=_((INe,QU)=>{"use strict";var Df=AD(),jE=on(),BE=fs().Collection,zge=y0(),GU=je(),HU=Ur(),Hge=tf(),Kge=require("stream"),LE=require("util");function $i(e,t,r){this.collection=null,this.Promise=r.Promise||Promise,this.modelName=r.modelName,delete r.modelName,this._closed=!1,Df.apply(this,arguments)}$i.prototype.__proto__=Df.prototype;$i.prototype.onOpen=function(){let e=this;if(!e.opts.capped.size)return t(null,e.conn.db.collection(e.name)),e.collection;if(e.opts.autoCreate===!1)return e.collection=e.conn.db.collection(e.name),Df.prototype.onOpen.call(e),e.collection;return e.conn.db.collection(e.name,function(r,n){if(r)return t(r);e.conn.db.listCollections({name:e.name}).toArray(function(i,s){if(i)return t(i);let o=s[0];if(!!o)if(o.options&&o.options.capped)t(null,n);else{let u="A non-capped collection exists with the name: "+e.name+`

 To use this collection as a capped collection, please first convert it.
 http://www.mongodb.org/display/DOCS/Capped+Collections#CappedCollections-Convertingacollectiontocapped`;i=new Error(u),t(i)}else{let u=Object.assign({},e.opts.capped);u.capped=!0,e.conn.db.createCollection(e.name,u,t)}})});function t(r,n){r?e.conn.emit("error",r):(e.collection=n,Df.prototype.onOpen.call(e))}};$i.prototype.onClose=function(e){Df.prototype.onClose.call(this,e)};var KU={watch:!0};function Gge(e){$i.prototype[e]=function(){let t=this.collection,r=Array.from(arguments),n=this,i=GU(n,"conn.base.options.debug"),s=arguments[arguments.length-1],o=new zge;if(this.conn.$wasForceClosed){let c=new jE("Connection was force closed");if(r.length>0&&typeof r[r.length-1]=="function"){r[r.length-1](c);return}else throw c}let a=r,u=null;if(this._shouldBufferCommands()&&this.buffer){if(KU[e])throw new Error("Collection method "+e+" is synchronous");this.conn.emit("buffer",{_id:o,modelName:n.modelName,collectionName:n.name,method:e,args:r});let c,f,h=null,d=null;typeof s=="function"?(c=function(){return d!=null&&clearTimeout(d),s.apply(this,arguments)},f=r.slice(0,r.length-1).concat([c])):h=new this.Promise((m,y)=>{c=function(w,S){if(d!=null&&clearTimeout(d),w!=null)return y(w);m(S)},f=r.concat([c]),this.addQueue(e,f)});let p=this._getBufferTimeoutMS();if(d=setTimeout(()=>{if(this.removeQueue(e,f)){let y="Operation `"+this.name+"."+e+"()` buffering timed out after "+p+"ms",g=new jE(y);this.conn.emit("buffer-end",{_id:o,modelName:n.modelName,collectionName:n.name,method:e,error:g}),c(g)}},p),typeof s=="function"){this.addQueue(e,f);return}return h}else!KU[e]&&typeof s=="function"&&(u=function(f,h){return f!=null?n.conn.emit("operation-end",{_id:o,modelName:n.modelName,collectionName:n.name,method:e,error:f}):n.conn.emit("operation-end",{_id:o,modelName:n.modelName,collectionName:n.name,method:e,result:h}),s.apply(this,arguments)},a=r.slice(0,r.length-1).concat([u]));if(i)if(typeof i=="function")i.apply(n,[n.name,e].concat(Hge(r,0,r.length-1)));else if(i instanceof Kge.Writable)this.$printToStream(n.name,e,r,i);else{let c=i.color==null?!0:i.color,f=i.shell==null?!1:i.shell;this.$print(n.name,e,r,c,f)}this.conn.emit("operation-start",{_id:o,modelName:n.modelName,collectionName:this.name,method:e,params:a});try{if(t==null){let f="Cannot call `"+this.name+"."+e+"()` before initial connection is complete if `bufferCommands = false`. Make sure you `await mongoose.connect()` if you have `bufferCommands = false`.";throw new jE(f)}let c=t[e].apply(t,a);return c!=null&&typeof c.then=="function"?c.then(f=>(this.conn.emit("operation-end",{_id:o,modelName:this.modelName,collectionName:this.name,method:e,result:f}),f),f=>{throw this.conn.emit("operation-end",{_id:o,modelName:this.modelName,collectionName:this.name,method:e,error:f}),f}):c}catch(c){if(typeof u=="function"?u(c):this.conn.emit("operation-end",{_id:o,modelName:n.modelName,collectionName:this.name,method:e,error:c}),typeof s=="function")s(c);else throw c}}}for(let e of Object.keys(BE.prototype))Object.getOwnPropertyDescriptor(BE.prototype,e).get===void 0&&typeof BE.prototype[e]=="function"&&Gge(e);$i.prototype.$print=function(e,t,r,n,i){let s=n?"\x1B[0;36mMongoose:\x1B[0m ":"Mongoose: ",o=[e,t].join("."),a=[];for(let c=r.length-1;c>=0;--c)(this.$format(r[c])||a.length)&&a.unshift(this.$format(r[c],n,i));let u="("+a.join(", ")+")";console.info(s+o+u)};$i.prototype.$printToStream=function(e,t,r,n){let i=[e,t].join("."),s=[];for(let a=r.length-1;a>=0;--a)(this.$format(r[a])||s.length)&&s.unshift(this.$format(r[a]));let o="("+s.join(", ")+")";n.write(i+o,"utf8")};$i.prototype.$format=function(e,t,r){let n=typeof e;return n==="function"||n==="undefined"?"":kE(e,!1,t,r)};function cc(e){let t={inspect:function(){return e}};return LE.inspect.custom&&(t[LE.inspect.custom]=t.inspect),t}function Qge(e){return kE(e,!0)}function Yge(e,t){e[t]=cc('ObjectId("'+e[t].toHexString()+'")')}function Jge(e,t,r){r?e[t]=cc('ISODate("'+e[t].toUTCString()+'")'):e[t]=cc('new Date("'+e[t].toUTCString()+'")')}function kE(e,t,r,n){if(e&&typeof e.toBSON=="function"&&(e=e.toBSON()),e==null)return e;let s=ms()(e,{transform:!1}),o=HU(s);if(o==="Binary")s="BinData("+s.sub_type+', "'+s.toString("base64")+'")';else if(o==="ObjectID")s=cc('ObjectId("'+s.toHexString()+'")');else if(o==="Date")s=cc('new Date("'+s.toUTCString()+'")');else if(o==="Object"){let a=Object.keys(s),u=a.length,c;for(let f=0;f<u;++f)if(c=a[f],s[c]){let h;if(typeof s[c].toBSON=="function")try{s[c]=s[c].toBSON()}catch(p){h=p}let d=HU(s[c]);if(d==="Binary")s[c]="BinData("+s[c].sub_type+', "'+s[c].buffer.toString("base64")+'")';else if(d==="Object")s[c]=kE(s[c],!0);else if(d==="ObjectID")Yge(s,c);else if(d==="Date")Jge(s,c,n);else if(d==="ClientSession")s[c]=cc('ClientSession("'+GU(s[c],"id.id.buffer","").toString("hex")+'")');else if(Array.isArray(s[c]))s[c]=s[c].map(Qge);else if(h!=null)throw h}}return t?s:LE.inspect(s,!1,10,r).replace(/\n/g,"").replace(/\s{2,}/g," ")}$i.prototype.getIndexes=$i.prototype.indexInformation;QU.exports=$i});var XU=_((RNe,JU)=>{"use strict";JU.exports=fs().Decimal128});var tV=_((DNe,eV)=>{"use strict";var Xge=fs(),ZU=Xge.ReadPreference;eV.exports=function(t,r){if(Array.isArray(t)&&(r=t[1],t=t[0]),t instanceof ZU)return t;switch(t){case"p":t="primary";break;case"pp":t="primaryPreferred";break;case"s":t="secondary";break;case"sp":t="secondaryPreferred";break;case"n":t="nearest";break}return new ZU(t,r)}});var UE=_((jNe,rV)=>{"use strict";var Zge=require("events").EventEmitter;var FE=class extends Zge{constructor(t,r,n){super(),this.driverChangeStream=null,this.closed=!1,this.pipeline=r,this.options=n,t((i,s)=>{if(i!=null){this.emit("error",i);return}this.driverChangeStream=s,this._bindEvents(),this.emit("ready")})}_bindEvents(){this.driverChangeStream.on("close",()=>{this.closed=!0}),["close","change","end","error"].forEach(t=>{this.driverChangeStream.on(t,r=>this.emit(t,r))})}_queue(t){this.once("ready",()=>t())}close(){this.closed=!0,this.driverChangeStream&&this.driverChangeStream.close()}};rV.exports=FE});var iV=_((BNe,nV)=>{"use strict";var e_e=Ur();nV.exports=function(t){if(e_e(t)!=="TopologyDescription")return!1;let r=Array.from(t.servers.values());return r.length>0&&r.every(n=>n.type==="Unknown")}});var oV=_((LNe,sV)=>{"use strict";var t_e=Ur();sV.exports=function(t){if(t_e(t)!=="TopologyDescription")return!1;let r=Array.from(t.servers.keys());return r.length>0&&r.every(n=>n.endsWith(".mongodb.net:27017"))}});var uV=_((kNe,aV)=>{"use strict";var r_e=Ur(),n_e="Client network socket disconnected before secure TLS connection was established";aV.exports=function(t){if(r_e(t)!=="TopologyDescription")return!1;let r=Array.from(t.servers.values());return r.length>0&&r.every(n=>n.error&&n.error.message.indexOf(n_e)!==-1)}});var VE=_((FNe,cV)=>{"use strict";var i_e=on(),s_e=iV(),o_e=oV(),a_e=uV();var u_e="Could not connect to any servers in your MongoDB Atlas cluster. One common reason is that you're trying to access the database from an IP that isn't whitelisted. Make sure your current IP address is on your Atlas cluster's IP whitelist: https://docs.atlas.mongodb.com/security-whitelist/",c_e="Mongoose is connecting with SSL enabled, but the server is not accepting SSL connections. Please ensure that the MongoDB server you are connecting to is configured to accept SSL connections. Learn more: https://mongoosejs.com/docs/tutorials/ssl.html",Py=class extends i_e{assimilateError(t){let r=t.reason;o_e(r)&&s_e(r)&&t.message.indexOf("bad auth")===-1&&t.message.indexOf("Authentication failed")===-1?this.message=u_e:a_e(r)?this.message=c_e:this.message=t.message;for(let i in t)i!=="name"&&(this[i]=t[i]);return this}};Object.defineProperty(Py.prototype,"name",{value:"MongooseServerSelectionError"});cV.exports=Py});var WE=_((UNe,lV)=>{"use strict";lV.exports=function e(t,r,n,i){if(t[i])return;if(t[i]=!0,!n||!n.skipTopLevel)for(let u of r)t.plugin(u[0],u[1]);if(n=Object.assign({},n),delete n.skipTopLevel,n.applyPluginsToChildSchemas!==!1)for(let u of Object.keys(t.paths)){let c=t.paths[u];c.schema!=null&&(e(c.schema,r,n,i),c.caster.prototype.$__setSchema(c.schema))}let s=t.discriminators;if(s==null)return;let o=n.applyPluginsToDiscriminators,a=Object.keys(s);for(let u of a){let c=s[u];e(c,r,{skipTopLevel:!o},i)}}});var zE=_((VNe,l_e)=>{l_e.exports={_args:[["mongoose@5.13.15","D:\\FaztWeb\\TokenizadorApp"]],_from:"mongoose@5.13.15",_id:"mongoose@5.13.15",_inBundle:!1,_integrity:"sha512-cxp1Gbb8yUWkaEbajdhspSaKzAvsIvOtRlYD87GN/P2QEUhpd6bIvebi36T6M0tIVAMauNaK9SPA055N3PwF8Q==",_location:"/mongoose",_phantomChildren:{},_requested:{type:"version",registry:!0,raw:"mongoose@5.13.15",name:"mongoose",escapedName:"mongoose",rawSpec:"5.13.15",saveSpec:null,fetchSpec:"5.13.15"},_requiredBy:["/","/@types/mongoose"],_resolved:"https://registry.npmjs.org/mongoose/-/mongoose-5.13.15.tgz",_spec:"5.13.15",_where:"D:\\FaztWeb\\TokenizadorApp",author:{name:"Guillermo Rauch",email:"guillermo@learnboost.com"},browser:"./dist/browser.umd.js",bugs:{url:"https://github.com/Automattic/mongoose/issues/new"},dependencies:{"@types/bson":"1.x || 4.0.x","@types/mongodb":"^3.5.27",bson:"^1.1.4",kareem:"2.3.2",mongodb:"3.7.3","mongoose-legacy-pluralize":"1.0.2",mpath:"0.8.4",mquery:"3.2.5",ms:"2.1.2","optional-require":"1.0.x","regexp-clone":"1.0.0","safe-buffer":"5.2.1",sift:"13.5.2",sliced:"1.0.1"},description:"Mongoose MongoDB ODM",devDependencies:{"@babel/core":"7.10.5","@babel/preset-env":"7.10.4","@types/node":"16.11.23","@typescript-eslint/eslint-plugin":"4.10.0","@typescript-eslint/parser":"4.10.0",acquit:"1.x","acquit-ignore":"0.1.x","acquit-require":"0.1.x","babel-loader":"8.1.0",benchmark:"2.1.4",bluebird:"3.5.5",chalk:"2.4.2",cheerio:"1.0.0-rc.2",co:"4.6.0",dox:"0.3.1",eslint:"7.1.0","eslint-plugin-mocha-no-only":"1.1.0","highlight.js":"9.18.2","lodash.isequal":"4.5.0","lodash.isequalwith":"4.4.0",marked:"1.1.1",mkdirp:"0.5.5",mocha:"5.x",moment:"2.x","node-static":"0.7.11","object-sizeof":"1.3.0",pug:"2.0.3",q:"1.5.1",rimraf:"2.6.3",semver:"5.5.0",typescript:"4.1.x",uuid:"2.0.3","uuid-parse":"1.0.0",validator:"10.8.0",webpack:"4.44.0"},directories:{lib:"./lib/mongoose"},engines:{node:">=4.0.0"},eslintConfig:{extends:["eslint:recommended"],overrides:[{files:["**/*.{ts,tsx}"],extends:["plugin:@typescript-eslint/eslint-recommended","plugin:@typescript-eslint/recommended"],plugins:["@typescript-eslint"],rules:{"@typescript-eslint/no-explicit-any":"off","@typescript-eslint/ban-types":"off","@typescript-eslint/no-unused-vars":"off","@typescript-eslint/explicit-module-boundary-types":"off"}}],plugins:["mocha-no-only"],parserOptions:{ecmaVersion:2015},env:{node:!0,es6:!0},rules:{"comma-style":"error",indent:["error",2,{SwitchCase:1,VariableDeclarator:2}],"keyword-spacing":"error","no-whitespace-before-property":"error","no-buffer-constructor":"warn","no-console":"off","no-multi-spaces":"error","no-constant-condition":"off","func-call-spacing":"error","no-trailing-spaces":"error","no-undef":"error","no-unneeded-ternary":"error","no-const-assign":"error","no-useless-rename":"error","no-dupe-keys":"error","space-in-parens":["error","never"],"spaced-comment":["error","always",{block:{markers:["!"],balanced:!0}}],"key-spacing":["error",{beforeColon:!1,afterColon:!0}],"comma-spacing":["error",{before:!1,after:!0}],"array-bracket-spacing":1,"arrow-spacing":["error",{before:!0,after:!0}],"object-curly-spacing":["error","always"],"comma-dangle":["error","never"],"no-unreachable":"error",quotes:["error","single"],"quote-props":["error","as-needed"],semi:"error","no-extra-semi":"error","semi-spacing":"error","no-spaced-func":"error","no-throw-literal":"error","space-before-blocks":"error","space-before-function-paren":["error","never"],"space-infix-ops":"error","space-unary-ops":"error","no-var":"warn","prefer-const":"warn",strict:["error","global"],"no-restricted-globals":["error",{name:"context",message:"Don't use Mocha's global context"}],"no-prototype-builtins":"off","mocha-no-only/mocha-no-only":["error"]}},funding:{type:"opencollective",url:"https://opencollective.com/mongoose"},homepage:"https://mongoosejs.com",keywords:["mongodb","document","model","schema","database","odm","data","datastore","query","nosql","orm","db"],license:"MIT",main:"./index.js",mocha:{extension:["test.js"],"watch-files":["test/**/*.js"]},name:"mongoose",repository:{type:"git",url:"git://github.com/Automattic/mongoose.git"},scripts:{"build-browser":"node build-browser.js",lint:"eslint .",prepublishOnly:"npm run build-browser",release:"git pull && git push origin master --tags && npm publish","release-legacy":"git pull origin 5.x && git push origin 5.x --tags && npm publish --tag legacy",tdd:"mocha ./test/*.test.js ./test/typescript/main.test.js --watch --recursive --watch-files ./**/*.js",test:"mocha --exit ./test/*.test.js ./test/typescript/main.test.js","test-cov":"nyc --reporter=html --reporter=text npm test"},types:"./index.d.ts",version:"5.13.15"}});var yV=_((WNe,mV)=>{"use strict";var f_e=UE(),h_e=require("events").EventEmitter,d_e=Ju(),p_e=xn().get().Collection,Ke=ef(),Wn=Ft(),fV=ff(),m_e=VE(),y_e=WE(),hV=an(),Pi=je(),HE=Cr(),dV=fs(),g_e=zE(),Oo=Ne(),__e=ie().parseConnectionString,w_e=pe().arrayAtomicsSymbol,jf=pe().sessionNewDocuments;var v_e=["MONGODB-X509"];function Ce(e){this.base=e,this.collections={},this.models={},this.config={},this.replica=!1,this.options=null,this.otherDbs=[],this.relatedDbs={},this.states=Ke,this._readyState=Ke.disconnected,this._closeCalled=!1,this._hasOpened=!1,this.plugins=[],typeof e>"u"||!e.connections.length?this.id=0:this.id=e.connections.length,this._queue=[]}Ce.prototype.__proto__=h_e.prototype;Object.defineProperty(Ce.prototype,"readyState",{get:function(){return this._readyState},set:function(e){if(!(e in Ke))throw new Error("Invalid connection state: "+e);if(this._readyState!==e){this._readyState=e;for(let t of this.otherDbs)t.readyState=e;Ke.connected===e&&(this._hasOpened=!0),this.emit(Ke[e])}}});Ce.prototype.get=function(e){return this.config.hasOwnProperty(e)?this.config[e]:Pi(this.options,e)};Ce.prototype.set=function(e,t){return this.config.hasOwnProperty(e)?(this.config[e]=t,t):(this.options=this.options||{},this.options[e]=t,t)};Ce.prototype.collections;Ce.prototype.name;Ce.prototype.models;Ce.prototype.id;Object.defineProperty(Ce.prototype,"plugins",{configurable:!1,enumerable:!0,writable:!0});Object.defineProperty(Ce.prototype,"host",{configurable:!0,enumerable:!0,writable:!0});Object.defineProperty(Ce.prototype,"port",{configurable:!0,enumerable:!0,writable:!0});Object.defineProperty(Ce.prototype,"user",{configurable:!0,enumerable:!0,writable:!0});Object.defineProperty(Ce.prototype,"pass",{configurable:!0,enumerable:!0,writable:!0});Ce.prototype.db;Ce.prototype.client;Ce.prototype.config;Ce.prototype.createCollection=Iy(function(t,r,n){typeof r=="function"&&(n=r,r={}),this.db.createCollection(t,r,n)});Ce.prototype.startSession=Iy(function(t,r){typeof t=="function"&&(r=t,t=null);let n=this.client.startSession(t);r(null,n)});Ce.prototype.transaction=function(t,r){return this.startSession().then(n=>(n[jf]=new Map,n.withTransaction(()=>t(n),r).then(i=>(delete n[jf],i)).catch(i=>{for(let s of n[jf].keys()){let o=n[jf].get(s);o.hasOwnProperty("isNew")&&(s.isNew=o.isNew),o.hasOwnProperty("versionKey")&&s.set(s.schema.options.versionKey,o.versionKey);for(let a of o.modifiedPaths)s.$__.activePaths.paths[a]="modify",s.$__.activePaths.states.modify[a]=!0;for(let a of o.atomics.keys()){let u=s.$__getValue(a);u!=null&&(u[w_e]=o.atomics.get(a))}}throw delete n[jf],i})))};Ce.prototype.dropCollection=Iy(function(t,r){this.db.dropCollection(t,r)});Ce.prototype.dropDatabase=Iy(function(t){for(let r of Object.keys(this.models))delete this.models[r].$init;this.db.dropDatabase(t)});function Iy(e){return function(){let t=arguments.length>0?arguments[arguments.length-1]:null,r=typeof t=="function"?Array.prototype.slice.call(arguments,0,arguments.length-1):Array.prototype.slice.call(arguments),n=new Wn("Connection "+this.id+" was disconnected when calling `"+e.name+"`");return hV(t,i=>{HE(()=>{if(this.readyState===Ke.connecting&&this._shouldBufferCommands())this._queue.push({fn:e,ctx:this,args:r.concat([i])});else if(this.readyState===Ke.disconnected&&this.db==null)i(n);else try{e.apply(this,r.concat([i]))}catch(s){return i(s)}})})}}Ce.prototype._shouldBufferCommands=function(){return this.config.bufferCommands!=null?this.config.bufferCommands:this.base.get("bufferCommands")!=null?this.base.get("bufferCommands"):!0};Ce.prototype.error=function(e,t){return t?(t(e),null):(this.listeners("error").length>0&&this.emit("error",e),Promise.reject(e))};Ce.prototype.onOpen=function(){this.readyState=Ke.connected;for(let e of this._queue)e.fn.apply(e.ctx,e.args);this._queue=[];for(let e in this.collections)Oo.object.hasOwnProperty(this.collections,e)&&this.collections[e].onOpen();this.emit("open")};Ce.prototype.openUri=function(e,t,r){if(typeof t=="function"&&(r=t,t=null),["string","number"].indexOf(typeof t)!==-1)throw new Wn("Mongoose 5.x no longer supports `mongoose.connect(host, dbname, port)` or `mongoose.createConnection(host, dbname, port)`. See http://mongoosejs.com/docs/connections.html for supported connection syntax");if(typeof e!="string")throw new Wn(`The \`uri\` parameter to \`openUri()\` must be a string, got "${typeof e}". Make sure the first parameter to \`mongoose.connect()\` or \`mongoose.createConnection()\` is a string.`);if(r!=null&&typeof r!="function")throw new Wn('3rd parameter to `mongoose.connect()` or `mongoose.createConnection()` must be a function, got "'+typeof r+'"');if(this.readyState===Ke.connecting||this.readyState===Ke.connected){if(this._connectionString!==e)throw new Wn("Can't call `openUri()` on an active connection with different connection strings. Make sure you aren't calling `mongoose.connect()` multiple times. See: https://mongoosejs.com/docs/connections.html#multiple_connections");return typeof r=="function"&&(this.$initialConnection=this.$initialConnection.then(()=>r(null,this),c=>r(c))),this}this._connectionString=e,this.readyState=Ke.connecting,this._closeCalled=!1;let n=fV.get(),i=this;if(t){t=Oo.clone(t);let c=t.config&&t.config.autoIndex!=null?t.config.autoIndex:t.autoIndex;c!=null&&(this.config.autoIndex=c!==!1,delete t.config,delete t.autoIndex),"autoCreate"in t&&(this.config.autoCreate=!!t.autoCreate,delete t.autoCreate),"useCreateIndex"in t&&(this.config.useCreateIndex=!!t.useCreateIndex,delete t.useCreateIndex),"useFindAndModify"in t&&(this.config.useFindAndModify=!!t.useFindAndModify,delete t.useFindAndModify),(t.user||t.pass)&&(t.auth=t.auth||{},t.auth.user=t.user,t.auth.password=t.pass,this.user=t.user,this.pass=t.pass),delete t.user,delete t.pass,t.bufferCommands!=null&&(t.bufferMaxEntries==null&&(t.bufferMaxEntries=0),this.config.bufferCommands=t.bufferCommands,delete t.bufferCommands),t.useMongoClient!=null&&S_e(t)}else t={};this._connectionOptions=t;let s=t.dbName;s!=null&&(this.$dbName=s),delete t.dbName,"promiseLibrary"in t||(t.promiseLibrary=fV.get()),"useNewUrlParser"in t||("useNewUrlParser"in this.base.options?t.useNewUrlParser=this.base.options.useNewUrlParser:t.useNewUrlParser=!1),Oo.hasUserDefinedProperty(t,"useUnifiedTopology")||(Oo.hasUserDefinedProperty(this.base.options,"useUnifiedTopology")?t.useUnifiedTopology=this.base.options.useUnifiedTopology:t.useUnifiedTopology=!1),Oo.hasUserDefinedProperty(t,"driverInfo")||(t.driverInfo={name:"Mongoose",version:g_e.version});let o=new n((c,f)=>{__e(e,t,(h,d)=>{if(h)return f(h);s?this.name=s:d.defaultDatabase?this.name=d.defaultDatabase:this.name=Pi(d,"auth.db",null),this.host=Pi(d,"hosts.0.host","localhost"),this.port=Pi(d,"hosts.0.port",27017),this.user=this.user||Pi(d,"auth.username"),this.pass=this.pass||Pi(d,"auth.password"),c()})}),a=new n((c,f)=>{let h=new dV.MongoClient(e,t);i.client=h,h.setMaxListeners(0),h.connect(d=>{if(d)return f(d);pV(i,h,t,s),c(i)})}),u=new m_e;return this.$initialConnection=n.all([a,o]).then(c=>c[0]).catch(c=>{throw this.readyState=Ke.disconnected,c!=null&&c.name==="MongoServerSelectionError"&&(c=u.assimilateError(c)),this.listeners("error").length>0&&HE(()=>this.emit("error",c)),c}),this.then=function(c,f){return this.$initialConnection.then(()=>{if(typeof c=="function")return c(i)},f)},this.catch=function(c){return this.$initialConnection.catch(c)},r!=null&&(this.$initialConnection=this.$initialConnection.then(()=>r(null,this),c=>r(c))),this};function pV(e,t,r,n){let i=n!=null?t.db(n):t.db();e.db=i,e.client=t,e._closeCalled=t._closeCalled;let s=()=>{e.readyState!==Ke.connected&&(e.readyState=Ke.connected,e.emit("reconnect"),e.emit("reconnected"),e.onOpen())},o=Pi(i,"s.topology.s.description.type","");if(r.useUnifiedTopology)if(o==="Single"){let a=Array.from(i.s.topology.s.servers.values())[0];a.s.topology.on("serverHeartbeatSucceeded",()=>{s()}),a.s.pool.on("reconnect",()=>{s()}),t.on("serverDescriptionChanged",u=>{u.newDescription.type==="Standalone"?s():e.readyState=Ke.disconnected})}else o.startsWith("ReplicaSet")&&(t.on("topologyDescriptionChanged",a=>{let u=a.newDescription,c=Array.from(a.newDescription.servers.values()),f=u.type==="ReplicaSetNoPrimary"&&c.reduce((h,d)=>h||d.type==="Unknown",!1);e.readyState===Ke.connected&&f?e.readyState=Ke.disconnected:e.readyState===Ke.disconnected&&!f&&s()}),t.on("close",function(){Pi(i,"s.topology.s.description.type","")!=="ReplicaSetWithPrimary"&&(e.readyState=Ke.disconnected)}));i.s.topology.on("reconnectFailed",function(){e.emit("reconnectFailed")}),r.useUnifiedTopology||(t.on("reconnect",function(){s()}),i.s.topology.on("left",function(a){e.emit("left",a)})),i.s.topology.on("joined",function(a){e.emit("joined",a)}),i.s.topology.on("fullsetup",function(a){e.emit("fullsetup",a)}),Pi(i,"s.topology.s.coreTopology.s.pool")!=null&&i.s.topology.s.coreTopology.s.pool.on("attemptReconnect",function(){e.emit("attemptReconnect")}),r.useUnifiedTopology?o.startsWith("ReplicaSet")||t.on("close",function(){e.readyState=Ke.disconnected}):t.on("close",function(){e.readyState=Ke.disconnected}),r.useUnifiedTopology||(t.on("left",function(){e.readyState===Ke.connected&&Pi(i,"s.topology.s.coreTopology.s.replicaSetState.topologyType")==="ReplicaSetNoPrimary"&&(e.readyState=Ke.disconnected)}),t.on("timeout",function(){e.emit("timeout")})),delete e.then,delete e.catch,e.onOpen()}var S_e=function(t){console.warn("WARNING: The `useMongoClient` option is no longer necessary in mongoose 5.x, please remove it.");let r=new Error().stack;console.warn(r.substr(r.indexOf(`
`)+1)),delete t.useMongoClient};Ce.prototype.close=function(e,t){return typeof e=="function"&&(t=e,e=!1),this.$wasForceClosed=!!e,hV(t,r=>{this._close(e,r)})};Ce.prototype._close=function(e,t){let r=this,n=this._closeCalled;switch(this._closeCalled=!0,this.client!=null&&(this.client._closeCalled=!0),this.readyState){case Ke.disconnected:n?t():this.doClose(e,function(i){if(i)return t(i);r.onClose(e),t(null)});break;case Ke.connected:this.readyState=Ke.disconnecting,this.doClose(e,function(i){if(i)return t(i);r.onClose(e),t(null)});break;case Ke.connecting:this.once("open",function(){r.close(t)});break;case Ke.disconnecting:this.once("close",function(){t()});break}return this};Ce.prototype.onClose=function(e){this.readyState=Ke.disconnected;for(let t in this.collections)Oo.object.hasOwnProperty(this.collections,t)&&this.collections[t].onClose(e);this.emit("close",e)};Ce.prototype.collection=function(e,t){let r={autoIndex:this.config.autoIndex!=null?this.config.autoIndex:this.base.options.autoIndex,autoCreate:this.config.autoCreate!=null?this.config.autoCreate:this.base.options.autoCreate};return t=Object.assign({},r,t?Oo.clone(t):{}),t.$wasForceClosed=this.$wasForceClosed,e in this.collections||(this.collections[e]=new p_e(e,this,t)),this.collections[e]};Ce.prototype.plugin=function(e,t){return this.plugins.push([e,t]),this};Ce.prototype.model=function(e,t,r,n){if(!(this instanceof Ce))throw new Wn("`connection.model()` should not be run with `new`. If you are doing `new db.model(foo)(bar)`, use `db.model(foo)(bar)` instead");let i;if(typeof e=="function"&&(i=e,e=i.name),typeof t=="string"&&(r=t,t=!1),Oo.isObject(t)&&!t.instanceOfSchema&&(t=new d_e(t)),t&&!t.instanceOfSchema)throw new Error("The 2nd parameter to `mongoose.model()` should be a schema or a POJO");let s={cache:!1,overwriteModels:this.base.options.overwriteModels},o=Object.assign(s,n,{connection:this});if(this.models[e]&&!r&&o.overwriteModels!==!0){if(t&&t.instanceOfSchema&&t!==this.models[e].schema)throw new Wn.OverwriteModelError(e);return this.models[e]}let a;if(t&&t.instanceOfSchema)return y_e(t,this.plugins,null,"$connectionPluginsApplied"),a=this.base.model(i||e,t,r,o),this.models[e]||(this.models[e]=a),a.init(function(){}),a;if(this.models[e]&&r)return a=this.models[e],t=a.prototype.schema,a.__subclass(this,t,r);if(a=this.base.models[e],!a)throw new Wn.MissingSchemaError(e);return this===a.prototype.db&&(!r||r===a.collection.name)?(this.models[e]||(this.models[e]=a),a):(this.models[e]=a.__subclass(this,t,r),this.models[e])};Ce.prototype.deleteModel=function(e){if(typeof e=="string"){let t=this.model(e);if(t==null)return this;let r=t.collection.name;delete this.models[e],delete this.collections[r],delete this.base.modelSchemas[e],this.emit("deleteModel",t)}else if(e instanceof RegExp){let t=e,r=this.modelNames();for(let n of r)t.test(n)&&this.deleteModel(n)}else throw new Error('First parameter to `deleteModel()` must be a string or regexp, got "'+e+'"');return this};Ce.prototype.watch=function(e,t){let r=new Wn("Connection "+this.id+" was disconnected when calling `watch()`"),n=s=>{HE(()=>{if(this.readyState===Ke.connecting)this.once("open",function(){let o=this.db.watch(e,t);s(null,o)});else if(this.readyState===Ke.disconnected&&this.db==null)s(r);else{let o=this.db.watch(e,t);s(null,o)}})};return new f_e(n,e,t)};Ce.prototype.modelNames=function(){return Object.keys(this.models)};Ce.prototype.shouldAuthenticate=function(){return this.user!=null&&(this.pass!=null||this.authMechanismDoesNotRequirePassword())};Ce.prototype.authMechanismDoesNotRequirePassword=function(){return this.options&&this.options.auth?v_e.indexOf(this.options.auth.authMechanism)>=0:!0};Ce.prototype.optionsProvideAuthenticationData=function(e){return e&&e.user&&(e.pass||this.authMechanismDoesNotRequirePassword())};Ce.prototype.getClient=function(){return this.client};Ce.prototype.setClient=function(t){if(!(t instanceof dV.MongoClient))throw new Wn("Must call `setClient()` with an instance of MongoClient");if(this.client!=null||this.readyState!==Ke.disconnected)throw new Wn("Cannot call `setClient()` on a connection that is already connected.");if(!t.isConnected())throw new Wn("Cannot call `setClient()` with a MongoClient that is not connected.");return this._connectionString=t.s.url,pV(this,t,{useUnifiedTopology:t.s.options.useUnifiedTopology},t.s.options.dbName),this};Ce.STATES=Ke;mV.exports=Ce});var _V=_(gV=>{"use strict";gV.setTimeout=setTimeout});var SV=_((HNe,vV)=>{"use strict";var wV=yV(),lc=ef(),O_e=Cr(),b_e=_V().setTimeout;function Bf(){wV.apply(this,arguments),this._listening=!1}Bf.STATES=lc;Bf.prototype.__proto__=wV.prototype;Bf.prototype.useDb=function(e,t){if(t=t||{},t.useCache&&this.relatedDbs[e])return this.relatedDbs[e];let r=new this.constructor;r.name=e,r.base=this.base,r.collections={},r.models={},r.replica=this.replica,r.config=Object.assign({},this.config,r.config),r.name=this.name,r.options=this.options,r._readyState=this._readyState,r._closeCalled=this._closeCalled,r._hasOpened=this._hasOpened,r._listening=!1,r.host=this.host,r.port=this.port,r.user=this.user,r.pass=this.pass;let n=this;r.client=n.client,this.db&&this._readyState===lc.connected?i():this.once("connected",i);function i(){r.client=n.client;let s={};t.hasOwnProperty("noListener")&&(s.noListener=t.noListener),r.db=n.client.db(e,s),r.onOpen(),t.noListener!==!0&&E_e(r)}return r.name=e,t.noListener!==!0&&this.otherDbs.push(r),r.otherDbs.push(this),t&&t.useCache&&(this.relatedDbs[r.name]=r,r.relatedDbs=this.relatedDbs),r};function E_e(e){e._listening||(e._listening=!0,e.client.on("close",function(t){if(!e._closeCalled){if(e._closeCalled=e.client._closeCalled,e.db.serverConfig.autoReconnect){e.readyState=lc.disconnected,e.emit("close");return}e.onClose(t)}}),e.client.on("error",function(t){e.emit("error",t)}),e.client.s.options.useUnifiedTopology||(e.db.on("reconnect",function(){e.readyState=lc.connected,e.emit("reconnect"),e.emit("reconnected"),e.onOpen()}),e.db.on("open",function(t,r){lc.disconnected===e.readyState&&r&&r.databaseName&&(e.readyState=lc.connected,e.emit("reconnect"),e.emit("reconnected"))})),e.client.on("timeout",function(t){e.emit("timeout",t)}),e.client.on("parseError",function(t){e.emit("parseError",t)}))}Bf.prototype.doClose=function(e,t){return this.client==null?(O_e(()=>t()),this):(this.client.close(e,(r,n)=>{b_e(()=>t(r,n),1)}),this)};vV.exports=Bf});var OV=_(xa=>{"use strict";xa.Binary=yD();xa.Collection=YU();xa.Decimal128=XU();xa.ObjectId=y0();xa.ReadPreference=tV();xa.getConnection=()=>SV()});var EV=_((GNe,bV)=>{"use strict";var C_e=Object.freeze(["applyPluginsToChildSchemas","applyPluginsToDiscriminators","autoCreate","autoIndex","bufferCommands","bufferTimeoutMS","cloneSchemas","debug","maxTimeMS","objectIdGetter","overwriteModels","returnOriginal","runValidators","sanitizeProjection","selectPopulatedPaths","setDefaultsOnInsert","strict","strictQuery","toJSON","toObject","typePojoToMixed","useCreateIndex","useFindAndModify","useNewUrlParser","usePushEach","useUnifiedTopology"]);bV.exports=C_e});var KE=_((QNe,CV)=>{"use strict";var T_e=Cr(),A_e=an();CV.exports=function(t,r,n,i){let s=n.parallel||1,o=n.batchSize,a=x_e();return A_e(i,f=>{if(o!=null){if(typeof o!="number")throw new TypeError("batchSize must be a number");if(o<1)throw new TypeError("batchSize must be at least 1");if(o!==Math.floor(o))throw new TypeError("batchSize must be a positive integer")}u(f)});function u(f){let h=!1,d=0,p=0,m=[],y=null;for(let w=0;w<s;++w)a(g);function g(w){if(h||y)return w();t(function(S,v){if(h||y!=null)return w();if(S!=null)return y=S,f(S),w();if(v==null)return h=!0,d<=0?f(null):o!=null&&m.length&&c(m,p++,A),w();if(++d,T_e(()=>w()),o!=null&&m.push(v),o!=null&&m.length!==o){setTimeout(()=>a(g),0);return}let E=o!=null?m:v;function A(x){if(o!=null?(d-=m.length,m=[]):--d,x!=null)return y=x,f(x);if(h&&d<=0)return f(null);setTimeout(()=>a(g),0)}c(E,p++,A)})}}function c(f,h,d){let p=r(f,h);p&&typeof p.then=="function"?p.then(function(){d(null)},function(m){d(m||new Error("`eachAsync()` promise rejected without error"))}):d(null)}};function x_e(){let e=[],t=null,r=0;return function(s){if(e.length===0&&t==null)return t=r++,s(n);e.push(s)};function n(){t=null,e.length>0&&(t=r++,e.shift()(n))}}});var IV=_((YNe,PV)=>{"use strict";var xV=require("stream").Readable,qV=an(),q_e=KE(),MV=ac(),NV=Cr(),M_e=require("util"),$V=Ne();function En(e,t){let r={objectMode:!0};$V.nodeMajorVersion>=12&&(r.autoDestroy=!0),xV.call(this,r),this.cursor=null,this.query=e;let n=this,i=e.model;this._mongooseOptions={},this._transforms=[],this.model=i,this.options=t||{},i.hooks.execPre("find",e,()=>{this._transforms=this._transforms.concat(e._transforms.slice()),this.options.transform&&this._transforms.push(t.transform),this.options.batchSize&&(this.options.cursor=t.cursor||{},this.options.cursor.batchSize=t.batchSize,this.options._populateBatchSize=Math.min(this.options.batchSize,5e3)),i.collection.find(e._conditions,this.options,function(s,o){if(n._error){o!=null&&o.close(function(){}),n.emit("cursor",null),n.listeners("error").length>0&&n.emit("error",n._error);return}if(s)return n.emit("error",s);n.cursor=o,n.emit("cursor",o)})})}M_e.inherits(En,xV);En.prototype._read=function(){let e=this;Dy(this,function(t,r){if(t)return e.emit("error",t);if(!r){e.push(null),e.cursor.close(function(n){if(n)return e.emit("error",n);$V.nodeMajorVersion<12&&e.on("end",()=>e.emit("close"))});return}e.push(r)})};En.prototype.map=function(e){return this._transforms.push(e),this};En.prototype._markError=function(e){return this._error=e,this};En.prototype.close=function(e){return qV(e,t=>{this.cursor.close(r=>{if(r)return t(r),this.listeners("error").length>0&&this.emit("error",r);this.emit("close"),t(null)})},this.model.events)};En.prototype.next=function(e){return qV(e,t=>{Dy(this,function(r,n){if(r)return t(r);t(null,n)})},this.model.events)};En.prototype.eachAsync=function(e,t,r){let n=this;return typeof t=="function"&&(r=t,t={}),t=t||{},q_e(function(i){return Dy(n,i)},e,t,r)};En.prototype.options;En.prototype.addCursorFlag=function(e,t){let r=this;return N_e(this,function(){r.cursor.addCursorFlag(e,t)}),this};En.prototype.transformNull=function(e){return arguments.length===0&&(e=!0),this._mongooseOptions.transformNull=e,this};En.prototype._transformForAsyncIterator=function(){return this._transforms.indexOf(TV)===-1&&this.map(TV),this};Symbol.asyncIterator!=null&&(En.prototype[Symbol.asyncIterator]=function(){return this.transformNull()._transformForAsyncIterator()});function TV(e){return e==null?{done:!0}:{value:e,done:!1}}function Dy(e,t){let r=t;if(e._transforms.length&&(r=function(n,i){if(n||i===null&&!e._mongooseOptions.transformNull)return t(n,i);t(n,e._transforms.reduce(function(s,o){return o.call(e,s)},i))}),e._error)return NV(function(){r(e._error)});if(e.cursor)return e.query._mongooseOptions.populate&&!e._pop&&(e._pop=MV.preparePopulationOptionsMQ(e.query,e.query._mongooseOptions),e._pop.__noPromise=!0),e.query._mongooseOptions.populate&&e.options._populateBatchSize>1?e._batchDocs&&e._batchDocs.length?Ry(e,e._batchDocs.shift(),e._pop,r):e._batchExhausted?r(null,null):(e._batchDocs=[],e.cursor.next(GE.bind({ctx:e,callback:r}))):e.cursor.next(function(n,i){if(n)return r(n);if(!i)return r(null,null);if(!e.query._mongooseOptions.populate)return Ry(e,i,null,r);e.query.model.populate(i,e._pop,function(s,o){return s?r(s):Ry(e,o,e._pop,r)})});e.once("cursor",function(n){n!=null&&Dy(e,t)})}function GE(e,t){if(e)return this.callback(e);if(!t)return this.ctx._batchExhausted=!0,AV.call(this);if(this.ctx._batchDocs.push(t),this.ctx._batchDocs.length<this.ctx.options._populateBatchSize){if(this.ctx._batchDocs.length>0&&this.ctx._batchDocs.length%1e3===0)return NV(()=>this.ctx.cursor.next(GE.bind(this)));this.ctx.cursor.next(GE.bind(this))}else AV.call(this)}function AV(){if(!this.ctx._batchDocs.length)return this.callback(null,null);let e=this;this.ctx.query.model.populate(this.ctx._batchDocs,this.ctx._pop,function(t){if(t)return e.callback(t);Ry(e.ctx,e.ctx._batchDocs.shift(),e.ctx._pop,e.callback)})}function Ry(e,t,r,n){if(e.query._mongooseOptions.lean)return e.model.hooks.execPost("find",e.query,[[t]],i=>{if(i!=null)return n(i);n(null,t)});$_e(e,t,r,(i,s)=>{if(i!=null)return n(i);e.model.hooks.execPost("find",e.query,[[s]],o=>{if(o!=null)return n(o);n(null,s)})})}function N_e(e,t){if(e.cursor)return t();e.once("cursor",function(r){r!=null&&t()})}function $_e(e,t,r,n){let i=MV.createModel(e.query.model,t,e.query._fields),s=r?{populated:r}:void 0;i.init(t,s,function(o){if(o)return n(o);n(null,i)})}PV.exports=En});var YE=_((JNe,RV)=>{"use strict";var QE=Ne();RV.exports=function(t,r){QE.hasUserDefinedProperty(t,"maxTimeMS")||(QE.hasUserDefinedProperty(r.db.options,"maxTimeMS")?t.maxTimeMS=r.db.options.maxTimeMS:QE.hasUserDefinedProperty(r.base.options,"maxTimeMS")&&(t.maxTimeMS=r.base.options.maxTimeMS))}});var JE=_((XNe,DV)=>{"use strict";var P_e=je();DV.exports=function(t,r){let n=P_e(t,"options.writeConcern",{});Object.keys(n).length!=0?(r.writeConcern={},!("w"in r)&&n.w!=null&&(r.writeConcern.w=n.w),!("j"in r)&&n.j!=null&&(r.writeConcern.j=n.j),!("wtimeout"in r)&&n.wtimeout!=null&&(r.writeConcern.wtimeout=n.wtimeout)):(!("w"in r)&&n.w!=null&&(r.w=n.w),!("j"in r)&&n.j!=null&&(r.j=n.j),!("wtimeout"in r)&&n.wtimeout!=null&&(r.wtimeout=n.wtimeout))}});var LV=_((ZNe,BV)=>{"use strict";var jV=Zm();BV.exports=function(t,r,n){let i=t;if(!Object.keys(n).some(jV))return r.castForQueryWrapper({val:n,context:i});let o=Object.keys(n),a=o.length;for(;a--;){let u=o[a],c=n[u];if(u==="$not"){if(c&&r&&!r.caster){let f=Object.keys(c);if(f.length&&jV(f[0]))for(let h of Object.keys(c))c[h]=r.castForQueryWrapper({$conditional:h,val:c[h],context:i});else n[u]=r.castForQueryWrapper({$conditional:u,val:c,context:i});continue}}else n[u]=r.castForQueryWrapper({$conditional:u,val:c,context:i})}return n}});var FV=_((e$e,kV)=>{"use strict";kV.exports=function(t,r){let n=t.path(r);if(n!=null)return n;let i=r.split("."),s="",o=!1;for(let a of i)/^\d+$/.test(a)&&o||(s=s.length===0?a:s+"."+a,n=t.path(s),n!=null&&n.schema&&(t=n.schema,s="",n.$isMongooseDocumentArray&&(o=!0)));return n}});var XE=_((t$e,VV)=>{"use strict";var UV=sc().modifiedPaths;VV.exports=function(t){let r=Object.keys(t),n={},i={};for(let s of r){if(s.startsWith("$")){UV(t[s],"",n);continue}i[s]=t[s]}return UV(i,"",n),n}});var ZE=_((r$e,WV)=>{"use strict";var I_e=XE();WV.exports=function(t){let r=I_e(t);return Object.keys(r).reduce((n,i)=>{let s=i.match(/\$\[[^\]]+\]/g);if(s==null)return n;for(let o of s){let a=i.indexOf(o);if(a!==i.lastIndexOf(o))throw new Error(`Path '${i}' contains the same array filter multiple times`);n[o.substring(2,o.length-1)]=i.substr(0,a-1).replace(/\$\[[^\]]+\]/g,"0")}return n},{})}});var HV=_((n$e,zV)=>{"use strict";var R_e=LV(),D_e=pf(),j_e=FV(),B_e=ZE();zV.exports=function(t){let r=t.options.arrayFilters;if(!Array.isArray(r))return;let n=t.getUpdate(),i=t.schema,s=i.options.strictQuery,o=B_e(n);for(let a of r){if(a==null)throw new Error(`Got null array filter in ${r}`);for(let u of Object.keys(a)){if(a[u]==null)continue;let c=u.indexOf("."),f=c===-1?o[u]+".0":o[u.substr(0,c)]+".0"+u.substr(c);if(f==null)throw new Error(`Filter path not found for ${u}`);f=D_e(f);let h=j_e(i,f);if(h==null){if(!s)return;throw new Error(`Could not find path "${f}" in schema`)}typeof a[u]=="object"?a[u]=R_e(t,h,a[u]):a[u]=h.castForQuery(a[u])}}}});var QV=_((i$e,GV)=>{"use strict";var L_e=pf(),KV=je(),k_e=xi(),F_e=ZE();GV.exports=function(t,r,n,i,s){let o=i.split("."),a=null,u="adhocOrUndefined";n=n||{},r=r||{};let c=s!=null&&Array.isArray(s.arrayFilters)?s.arrayFilters:[],f=F_e(r);for(let h=0;h<o.length;++h){let d=L_e(o.slice(0,h+1).join("."));if(a=t.path(d),a!=null&&(u=t.pathType(d),(a.$isSingleNested||a.$isMongooseDocumentArrayElement)&&a.schema.discriminators!=null)){let p=KV(a,"schema.options.discriminatorKey"),m=d+"."+p,y=m.replace(/\.\d+\./,"."),g=null;m in n&&(g=n[m]),y in n&&(g=n[y]);let w=d.replace(/\.\d+$/,"");a.$isMongooseDocumentArrayElement&&KV(n[w],"$elemMatch."+p)!=null&&(g=n[w].$elemMatch[p]),m in r&&(g=r[m]);for(let E of Object.keys(f)){let A=f[E]+"."+p,x=E+"."+p;if(A===y){let z=c.find(k=>k.hasOwnProperty(x));z!=null&&(g=z[x])}}if(g==null)continue;let S=k_e(a.caster.discriminators,g).schema,v=o.slice(h+1).join(".");if(a=S.path(v),a!=null){u=S._getPathType(v);break}}}return{type:u,schematype:a}}});var JV=_((s$e,YV)=>{"use strict";var U_e=ga();YV.exports=function(t,r,n,i,s,o){if(t==null||!t.options||!t.options.immutable)return!1;let a=t.options.immutable;if(typeof a=="function"&&(a=a.call(o,o)),!a||r===!1)return!1;if(r==="throw")throw new U_e(null,`Field ${s} is immutable and strict = 'throw'`);return delete n[i],!0}});var eW=_((o$e,ZV)=>{"use strict";var V_e=je();ZV.exports=function(t,r,n){if(r==null)return;let i=Object.keys(r);for(let s of i){let o=s.startsWith("$");if(s==="$set"){let a=Object.keys(r[s]);for(let u of a)XV(t,r[s],u,r,n)}else o||XV(t,r,s,r,n)}};function XV(e,t,r,n,i){let s=e.path(r);if(s==null)return;let o=V_e(s,"options.immutable",null);o!=null&&(typeof o=="function"&&(o=o.call(i,i)),o&&(n.$setOnInsert=n.$setOnInsert||{},n.$setOnInsert[r]=t[r],delete t[r]))}});var rW=_((a$e,tW)=>{"use strict";tW.exports=function(t,r,n){let i=r.split("."),s=t;for(let a of i.slice(0,-1))s[a]==null&&(s[a]={}),s=s[a];let o=i[i.length-1];s[o]=n}});var sC=_((u$e,uW)=>{"use strict";var eC=vn(),Lf=on(),nW=ga(),W_e=co(),tC=Cb(),z_e=Yu(),H_e=Ur(),iW=QV(),sW=JV(),K_e=eW(),G_e=_a().schemaMixedSymbol,Q_e=rW(),iC=Ne();uW.exports=function(t,r,n,i,s){if(r==null)return;if(n=n||{},Array.isArray(r)){let d=r.length;for(let p=0;p<d;++p){let m=Object.keys(r[p]);for(let y of m)r[p][y]=Y_e(y,r[p][y])}return r}n.upsert&&K_e(t,r,i);let o=Object.keys(r),a=o.length,u={},c,f=!1,h=n.overwrite;for(s=s||{};a--;){let d=o[a];d[0]!=="$"&&!h?(u.$set||(r.$set?u.$set=r.$set:u.$set={}),u.$set[d]=r[d],o.splice(a,1),~o.indexOf("$set")||o.push("$set")):d==="$set"&&u.$set||(u[d]=r[d])}for(a=o.length;a--;){let d=o[a];if(c=u[d],f=f||d.startsWith("$"),c&&typeof c=="object"&&!Buffer.isBuffer(c)&&(!h||f))rC(t,c,d,n,i,s);else if(h&&u&&typeof u=="object")rC(t,u,"$set",n,i,s);else{let p="Invalid atomic update value for "+d+". Expected an object, received "+typeof c;throw new Error(p)}d.startsWith("$")&&iC.isEmptyObject(c)&&delete u[d]}return Object.keys(u).length===0&&n.upsert&&Object.keys(s).length>0?{$setOnInsert:s}:u};function Y_e(e,t){if(e==="$unset"){if(!Array.isArray(t)||t.find(r=>typeof r!="string"))throw new Lf("Invalid $unset in pipeline, must be an array of strings");return t}if(e==="$project"){if(t==null||typeof t!="object")throw new Lf("Invalid $project in pipeline, must be an object");return t}if(e==="$addFields"||e==="$set"){if(t==null||typeof t!="object")throw new Lf("Invalid "+e+" in pipeline, must be an object");return t}else if(e==="$replaceRoot"||e==="$replaceWith"){if(t==null||typeof t!="object")throw new Lf("Invalid "+e+" in pipeline, must be an object");return t}throw new Lf('Invalid update pipeline operator: "'+e+'"')}function rC(e,t,r,n,i,s,o){let a=n.strict,u=o?o+".":"",c=Object.keys(t),f=c.length,h=!1,d,p,m,y=null,g;for(n.useNestedStrict===void 0?g=e.options.useNestedStrict:g=n.useNestedStrict;f--;){if(p=c[f],m=t[p],r==="$pull"&&(d=e._getSchema(u+p),d!=null&&d.schema!=null)){t[p]=z_e(d.schema,t[p],n,i),h=!0;continue}if(H_e(m)==="Object"){if(d=e._getSchema(u+p),d==null){let w=iW(e,t,s,u+p,n);w.schematype!=null&&(d=w.schematype)}if(r!=="$setOnInsert"&&sW(d,a,t,p,u+p,i))continue;if(d&&d.caster&&r in nC)if("$each"in m){h=!0;try{t[p]={$each:Ff(d,m.$each,r,p,i,u+p)}}catch(w){y=kf(w,i,p,y)}m.$slice!=null&&(t[p].$slice=m.$slice|0),m.$sort&&(t[p].$sort=m.$sort),m.$position!=null&&(t[p].$position=tC(m.$position))}else{if(d!=null&&d.$isSingleNested){let w=a;g!==!1&&d.schema.options.hasOwnProperty("strict")?w=d.schema.options.strict:g===!1&&(w=e.options.strict);try{t[p]=d.castForQuery(m,i,{strict:w})}catch(S){y=kf(S,i,p,y)}}else try{t[p]=Ff(d,m,r,p,i,u+p)}catch(w){y=kf(w,i,p,y)}if(n.omitUndefined&&t[p]===void 0){delete t[p];continue}h=!0}else if(r==="$currentDate"||r in nC&&d){try{t[p]=Ff(d,m,r,p,i,u+p)}catch(w){y=kf(w,i,p,y)}if(n.omitUndefined&&t[p]===void 0){delete t[p];continue}h=!0}else{let w=u+p,S=e._getPathType(w),v=a;if(g&&S&&S.schema&&"strict"in S.schema.options&&(v=S.schema.options.strict),S.pathType==="undefined"){if(v==="throw")throw new nW(w);if(v){delete t[p];continue}}h|=rC(e,m,r,n,i,s,u+p)||iC.isObject(m)&&Object.keys(m).length===0}}else{let w=p==="$each"||p==="$or"||p==="$and"||p==="$in"?o:u+p;if(d=e._getSchema(w),r!=="$setOnInsert"&&sW(d,a,t,p,u+p,i))continue;let S=e._getPathType(w);if(d==null){let A=iW(e,t,s,w,n);A.schematype!=null&&(d=A.schematype,S=A.type)}let v=a;if(g&&S&&S.schema&&"strict"in S.schema.options&&(v=S.schema.options.strict),v&&!d&&!/real|nested/.test(S.pathType)){if(v==="throw"&&e.virtuals[w]==null)throw new nW(u+p);delete t[p]}else{if(r==="$rename"){h=!0;continue}try{u.length===0||p.indexOf(".")===-1?t[p]=Ff(d,m,r,p,i,u+p):(Q_e(t,p,Ff(d,m,r,p,i,u+p)),delete t[p])}catch(A){y=kf(A,i,p,y)}if(Array.isArray(t[p])&&(r==="$addToSet"||r==="$push")&&p!=="$each"&&d&&d.caster&&!d.caster.$isMongooseArray&&(t[p]={$each:t[p]}),n.omitUndefined&&t[p]===void 0){delete t[p];continue}h=!0}}}if(y!=null)throw y;return h}function kf(e,t,r,n){if(typeof t!="object"||!t.options.multipleCastError)throw e;return n=n||new W_e,n.addError(r,e),n}var oW={$pop:1,$inc:1};var J_e={$unset:1};var nC={$push:1,$addToSet:1,$set:1,$setOnInsert:1};var aW={$set:1,$setOnInsert:1};function Ff(e,t,r,n,i,s){if(!e){if(r in oW)try{return tC(t)}catch{throw new eC("number",t,s)}return t}if(e.caster&&r in nC&&(iC.isObject(t)||Array.isArray(t))&&!aW[r]){let a=0,u=e;for(;u.$isMongooseArray;)++a,u=u.caster;let c=0,f=t;for(;Array.isArray(f);)++c,f=f[0];let h=a-c;for(;c<a;)t=[t],++c;let d=e.applySetters(Array.isArray(t)?t:[t],i);for(let p=0;p<h;++p)d=d[0];return d}if(r in J_e)return t;if(r in oW){if(t==null)throw new eC("number",t,e.path);if(r==="$inc")return e.castForQueryWrapper({val:t,context:i});try{return tC(t)}catch{throw new eC("number",t,e.path)}}return r==="$currentDate"?typeof t=="object"?{$type:t.$type}:Boolean(t):/^\$/.test(n)?e.castForQueryWrapper({$conditional:n,val:t,context:i}):aW[r]?e.castForQueryWrapper({val:t,context:i,$skipQueryCastForUpdate:t!=null&&e.$isMongooseArray&&e.$fullPath!=null&&!e.$fullPath.match(/\d+$/),$applySetters:e[G_e]!=null}):e.castForQueryWrapper({val:t,context:i})}});var fW=_((c$e,lW)=>{"use strict";var X_e=ac(),cW=Cr();lW.exports=Z_e;function Z_e(e,t,r,n,i,s){let o=[],a=t.length,u=a,c=null;function f(h){if(h!=null&&(c=c||h),c!=null){--a||cW(()=>s(c));return}--a||cW(()=>s(c,o))}for(let h=0;h<u;++h){o[h]=X_e.createModel(e,t[h],r,n);try{o[h].init(t[h],i,f)}catch(d){f(d)}i.session!=null&&o[h].$session(i.session)}}});var dW=_((l$e,hW)=>{"use strict";hW.exports=function(e){if(e==null)return!1;let t=Object.keys(e),r=t.length;for(let n=0;n<r;++n)if(t[n].startsWith("$"))return!0;return!1}});var oC=_((f$e,pW)=>{"use strict";var ewe=oc();pW.exports=function(t){if(t==null)return!1;let r=Object.keys(t),n=r.length;if(n===0)return!1;for(let i=0;i<n;++i){let s=r[i];if(!s.startsWith("+")&&ewe(t[s])&&!!t[s])return!0}return!1}});var aC=_((h$e,mW)=>{"use strict";mW.exports=function(t,r){if(typeof t==="string"&&(t=t.split(/\s+/)),!Array.isArray(t)&&Object.prototype.toString.call(t)!=="[object Arguments]")return t;let i=t.length,s={};for(let o=0;o<i;++o){let a=t[o];if(!a)continue;let u=a[0]=="-"?0:1;!r&&u===0&&(a=a.substring(1)),s[a]=u}return s}});var gW=_((d$e,yW)=>{"use strict";yW.exports=function(t,r){let n=Object.keys(t).map(i=>Object.keys(t[i])).reduce((i,s)=>i.concat(s),[]);return r.filter(i=>{let s=Object.keys(i)[0],o=s.indexOf("."),a=o===-1?s:s.slice(0,o);return n.find(u=>u.includes("$["+a+"]"))!=null})}});var wW=_((p$e,_W)=>{"use strict";_W.exports=function(t){if(t==null)return;let r=Object.keys(t);for(let n=0;n<r.length;++n)typeof t[r[n]]=="string"&&(t[r[n]]=1)}});var SW=_((m$e,vW)=>{"use strict";var twe=Ty(),rwe=oC();vW.exports=function(t,r,n){if(n==null)return;let i=Object.keys(n);if(r=r||{},rwe(t))for(let s of i)nwe(r,s)?r[s]===0&&delete t[s]:t[s]=1;else if(twe(t))for(let s of i)r[s]==null&&delete t[s]};function nwe(e,t){let r=t.split("."),n=r.length,i=r[0];for(let s=1;s<n;++s){if(e[i]!=null||e[i+".$"]!=null)return!0;i+="."+r[s]}return e[i]!=null||e[i+".$"]!=null}});var uC=_((y$e,EW)=>{"use strict";var OW=sc().modifiedPaths,iwe=je();EW.exports=function(e,t,r,n){n=n||{};let i=n.setDefaultsOnInsert!=null?n.setDefaultsOnInsert:t.base.options.setDefaultsOnInsert;if(!n.upsert||!i)return r;let s=Object.keys(r||{}),o={},a={},u=s.length,c={},f=!1;for(let p=0;p<u;++p)s[p].startsWith("$")&&(OW(r[s[p]],"",c),f=!0);f||OW(r,"",c);let h=Object.keys(e),d=h.length;for(let p=0;p<d;++p){let m=h[p],y=e[m];if(y&&typeof y=="object"){let g=Object.keys(y),w=g.length,S=!1;for(let v=0;v<w;++v)if(g[v].startsWith("$")){S=!0;break}if(S)continue}o[m]=!0,c[m]=!0}return n&&n.overwrite&&!f||t.eachPath(function(p,m){let y=m.path.endsWith(".$*")||m.path.indexOf(".$*.")!==-1;if(m.$isSingleNested&&!y)m.schema.eachPath(function(g,w){if(g==="_id"&&w.auto)return;let S=w.getDefault(null,!0);!bW(c,p+"."+g)&&typeof S<"u"&&(r=r||{},r.$setOnInsert=r.$setOnInsert||{},r.$setOnInsert[p+"."+g]=S,a[p+"."+g]=S)});else{let g=m.getDefault(null,!0);!bW(c,p)&&typeof g<"u"&&(r=r||{},r.$setOnInsert=r.$setOnInsert||{},iwe(r,p)==null&&(r.$setOnInsert[p]=g),a[p]=g)}}),r};function bW(e,t){if(e[t])return!0;let r=t.split("."),n=r[0];for(let i=1;i<r.length;++i){if(e[n])return!0;n+="."+r[i]}return!1}});var qW=_((g$e,xW)=>{"use strict";var CW=co(),swe=pf(),TW=sc().flatten,AW=sc().modifiedPaths;xW.exports=function(e,t,r,n,i){let s,o=Object.keys(r||{}),a={},u={},c={},f={},h=o.length,d=!1,p={},m,y,g;for(g=0;g<h;++g)if(o[g].startsWith("$")){if(d=!0,o[g]==="$push"||o[g]==="$addToSet"){s=Object.keys(r[o[g]]);for(let I=0;I<s.length;++I)m=r[o[g]][s[I]],m&&m.$each?f[s[I]]=(f[s[I]]||[]).concat(m.$each):f[s[I]]=(f[s[I]]||[]).concat([m]);continue}AW(r[o[g]],"",p);let F=TW(r[o[g]],null,null,t),b=Object.keys(F),q=b.length;for(let I=0;I<q;++I){let K=swe(b[I]);y=o[g],!K.includes("$")&&(y==="$set"||y==="$setOnInsert"||y==="$pull"||y==="$pullAll"?(u[K]=F[b[I]],c[K]=y==="$pull"||y==="$pullAll"):y==="$unset"&&(u[K]=void 0),a[K]=!0)}}d||(AW(r,"",p),u=TW(r,null,null,t),a=Object.keys(u));let w=Object.keys(u),S=w.length,v=[],E=[],A=[],x=n&&n.context==="query"?e:null;function z(F,b){let q=t._getSchema(w[F]);if(q!=null&&!(q.instance==="Mixed"&&q.path!==w[F]))if(b&&Array.isArray(b.$in))b.$in.forEach((I,K)=>{v.push(function(C){q.doValidate(I,function(R){R&&(R.path=w[K]+".$in."+K,E.push(R)),C(null)},x,{updateValidator:!0})})});else{if(c[w[F]]&&q.$isMongooseArray)return;q.$isMongooseDocumentArrayElement&&b!=null&&b.$__!=null?(A.push(w[F]),v.push(function(I){q.doValidate(b,function(K){if(K)return K.path=w[F],E.push(K),I(null);b.validate(function(C){if(C)if(C.errors)for(let R of Object.keys(C.errors)){let j=C.errors[R];j.path=w[F]+"."+R,E.push(j)}else C.path=w[F],E.push(C);I(null)})},x,{updateValidator:!0})})):v.push(function(I){for(let K of A)if(w[F].startsWith(K+"."))return I(null);q.doValidate(b,function(K){if(q.schema!=null&&q.schema.options.storeSubdocValidationError===!1&&K instanceof CW)return I(null);K&&(K.path=w[F],E.push(K)),I(null)},x,{updateValidator:!0})})}}for(g=0;g<S;++g)z(g,u[w[g]]);let k=Object.keys(f);for(let F of k){let b=t._getSchema(F);if(b&&b.$isMongooseDocumentArray)v.push(function(q){b.doValidate(f[F],Z(F,E,q),n&&n.context==="query"?e:null)});else{b=t._getSchema(F+".0");for(let q of f[F])v.push(function(I){b.doValidate(q,Z(F,E,I),n&&n.context==="query"?e:null,{updateValidator:!0})})}}if(i!=null){let F=v.length;if(F===0)return P(i);for(let b of v)b(function(){--F<=0&&P(i)});return}return function(F){let b=v.length;if(b===0)return P(F);for(let q of v)q(function(){--b<=0&&P(F)})};function P(F){if(E.length){let b=new CW(null);for(let q of E)b.addError(q.path,q);return F(b)}F(null)}function Z(F,b,q){return function(I){I&&(I.path=F,b.push(I)),q(null)}}}});var NW=_((_$e,MW)=>{"use strict";MW.exports=function(t){return function(n){++this._executionCount,t.call(this,n)}}});var Fy=_((w$e,HW)=>{"use strict";var lC=vn(),owe=qm(),awe=pb(),uwe=on(),qa=hb(),$W=IV(),cwe=xn().get().ReadPreference,Uf=YE(),lwe=JE(),fwe=Yu(),hwe=HV(),dwe=sC(),PW=fW(),Kr=je(),jW=an(),BW=xi(),fC=dW(),Ma=ac(),jy=Cr(),pwe=Ty(),mwe=oC(),Mr=Tm(),ywe=aC(),LW=gW(),gwe=wW(),_we=SW(),kW=uC(),By=tf(),wwe=qW(),hC=require("util"),me=Ne(),dr=NW();function V(e,t,r,n){this._mongooseOptions||(this._mongooseOptions={}),t=t||{},this._transforms=[],this._hooks=new awe,this._executionCount=0;let i=Object.keys(t);for(let o of i)this._mongooseOptions[o]=t[o];n&&(this.mongooseCollection=n),r&&(this.model=r,this.schema=r.schema),this.model&&this.model._mapreduce&&this.lean(),Mr.call(this,this.mongooseCollection,t),e&&this.find(e),this.options=this.options||{},this.$useProjection=!0;let s=Kr(this,"schema.options.collation",null);s!=null&&(this.options.collation=s)}V.prototype=new Mr;V.prototype.constructor=V;V.base=Mr.prototype;V.use$geoWithin=Mr.use$geoWithin;V.prototype.toConstructor=function(){let t=this.model,r=this.mongooseCollection,n=function(o,a){if(!(this instanceof n))return new n(o,a);this._mongooseOptions=me.clone(i._mongooseOptions),V.call(this,o,a||null,t,r)};hC.inherits(n,t.Query);let i=n.prototype;i.options={};let s=Object.assign({},this.options);return s.sort!=null&&(i.sort(s.sort),delete s.sort),i.setOptions(s),i.op=this.op,i._conditions=me.clone(this._conditions),i._fields=me.clone(this._fields),i._update=me.clone(this._update,{flattenDecimals:!1}),i._path=this._path,i._distinct=this._distinct,i._collection=this._collection,i._mongooseOptions=this._mongooseOptions,n};V.prototype.slice=function(){if(arguments.length===0)return this;this._validate("slice");let e,t;if(arguments.length===1){let n=arguments[0];if(typeof n=="object"&&!Array.isArray(n)){let i=Object.keys(n),s=i.length;for(let o=0;o<s;++o)this.slice(i[o],n[i[o]]);return this}this._ensurePath("slice"),e=this._path,t=arguments[0]}else arguments.length===2?typeof arguments[0]=="number"?(this._ensurePath("slice"),e=this._path,t=By(arguments)):(e=arguments[0],t=arguments[1]):arguments.length===3&&(e=arguments[0],t=By(arguments,1));let r={};return r[e]={$slice:t},this.select(r),this};V.prototype.mod=function(){let e,t;arguments.length===1?(this._ensurePath("mod"),e=arguments[0],t=this._path):arguments.length===2&&!Array.isArray(arguments[1])?(this._ensurePath("mod"),e=By(arguments),t=this._path):arguments.length===3?(e=By(arguments,1),t=arguments[0]):(e=arguments[1],t=arguments[0]);let r=this._conditions[t]||(this._conditions[t]={});return r.$mod=e,this};V.prototype.projection=function(e){return arguments.length===0?this._fields:(this._fields={},this._userProvidedFields={},this.select(e),this._fields)};V.prototype.select=function(){let t=arguments[0];if(!t)return this;if(arguments.length!==1)throw new Error("Invalid select: select only takes 1 argument");this._validate("select");let r=this._fields||(this._fields={}),n=this._userProvidedFields||(this._userProvidedFields={}),i;if(this.model!=null&&me.hasUserDefinedProperty(this.model.db.options,"sanitizeProjection")?i=this.model.db.options.sanitizeProjection:this.model!=null&&me.hasUserDefinedProperty(this.model.base.options,"sanitizeProjection")?i=this.model.base.options.sanitizeProjection:i=this._mongooseOptions.sanitizeProjection,t=ywe(t),me.isObject(t)){let s=Object.keys(t);for(let o=0;o<s.length;++o){let a=t[s[o]];typeof a=="string"&&i&&(a=1),r[s[o]]=a,n[s[o]]=a}return this}throw new TypeError("Invalid select() argument. Must be string or object.")};V.prototype.read=function(t,r){let n=new cwe(t,r);return this.options.readPreference=n,this};V.prototype.session=function(t){return t==null&&delete this.options.session,this.options.session=t,this};V.prototype.writeConcern=function(t){return t==null?(delete this.options.writeConcern,this):(this.options.writeConcern=t,this)};V.prototype.w=function(t){return t==null&&delete this.options.w,this.options.writeConcern!=null?this.options.writeConcern.w=t:this.options.w=t,this};V.prototype.j=function(t){return t==null&&delete this.options.j,this.options.writeConcern!=null?this.options.writeConcern.j=t:this.options.j=t,this};V.prototype.wtimeout=function(t){return t==null&&delete this.options.wtimeout,this.options.writeConcern!=null?this.options.writeConcern.wtimeout=t:this.options.wtimeout=t,this};V.prototype.getOptions=function(){return this.options};V.prototype.setOptions=function(e,t){if(t)return this._mongooseOptions=e&&me.clone(e)||{},this.options=e||{},"populate"in e&&this.populate(this._mongooseOptions),this;if(e==null)return this;if(typeof e!="object")throw new Error('Options must be an object, got "'+e+'"');if(Array.isArray(e.populate)){let r=e.populate;delete e.populate;let n=r.length;for(let i=0;i<n;++i)this.populate(r[i])}return"useFindAndModify"in e&&(this._mongooseOptions.useFindAndModify=e.useFindAndModify,delete e.useFindAndModify),"omitUndefined"in e&&(this._mongooseOptions.omitUndefined=e.omitUndefined,delete e.omitUndefined),"setDefaultsOnInsert"in e&&(this._mongooseOptions.setDefaultsOnInsert=e.setDefaultsOnInsert,delete e.setDefaultsOnInsert),"overwriteDiscriminatorKey"in e&&(this._mongooseOptions.overwriteDiscriminatorKey=e.overwriteDiscriminatorKey,delete e.overwriteDiscriminatorKey),"sanitizeProjection"in e&&(e.sanitizeProjection&&!this._mongooseOptions.sanitizeProjection&&gwe(this._fields),this._mongooseOptions.sanitizeProjection=e.sanitizeProjection,delete e.sanitizeProjection),"defaults"in e&&(this._mongooseOptions.defaults=e.defaults),V.base.setOptions.call(this,e)};V.prototype.explain=function(e){return arguments.length===0?this.options.explain=!0:e===!1?delete this.options.explain:this.options.explain=e,this};V.prototype.allowDiskUse=function(e){return arguments.length===0?this.options.allowDiskUse=!0:e===!1?delete this.options.allowDiskUse:this.options.allowDiskUse=e,this};V.prototype.maxTimeMS=function(e){return this.options.maxTimeMS=e,this};V.prototype.getFilter=function(){return this._conditions};V.prototype.getQuery=function(){return this._conditions};V.prototype.setQuery=function(e){this._conditions=e};V.prototype.getUpdate=function(){return this._update};V.prototype.setUpdate=function(e){this._update=e};V.prototype._fieldsForExec=function(){return me.clone(this._fields)};V.prototype._updateForExec=function(){let e=me.clone(this._update,{transform:!1,depopulate:!0}),t=Object.keys(e),r=t.length,n={};for(;r--;){let i=t[r];if(this.options.overwrite){n[i]=e[i];continue}i[0]!=="$"?(n.$set||(e.$set?n.$set=e.$set:n.$set={}),n.$set[i]=e[i],t.splice(r,1),~t.indexOf("$set")||t.push("$set")):i==="$set"&&n.$set||(n[i]=e[i])}return n};V.prototype._optionsForExec=function(e){let t=me.clone(this.options);if(delete t.populate,e=e||this.model,!e)return t;let r=Kr(e,"schema.options.safe",null);!("safe"in t)&&r!=null&&Swe(t,r),lwe(e.schema,t);let n=Kr(e,"schema.options.read");return!("readPreference"in t)&&n&&(t.readPreference=n),t.upsert!==void 0&&(t.upsert=!!t.upsert),t.writeConcern&&(t.j&&(t.writeConcern.j=t.j,delete t.j),t.w&&(t.writeConcern.w=t.w,delete t.w),t.wtimeout&&(t.writeConcern.wtimeout=t.wtimeout,delete t.wtimeout)),t};var vwe="Mongoose: the `safe` option is deprecated. Use write concerns instead: http://bit.ly/mongoose-w",Swe=hC.deprecate(function(t,r){t.safe=r},vwe);V.prototype.lean=function(e){return this._mongooseOptions.lean=arguments.length?e:!0,this};V.prototype.set=function(e,t){if(typeof e=="object"){let r=Object.keys(e);for(let n of r)this.set(n,e[n]);return this}return this._update=this._update||{},this._update.$set=this._update.$set||{},this._update.$set[e]=t,this};V.prototype.get=function(t){let r=this._update;if(r==null)return;let n=r.$set;if(n==null||me.hasUserDefinedProperty(r,t))return r[t];if(me.hasUserDefinedProperty(n,t))return n[t]};V.prototype.error=function(t){return arguments.length===0?this._error:(this._error=t,this)};V.prototype._unsetCastError=function(){if(!(this._error!=null&&!(this._error instanceof lC)))return this.error(null)};V.prototype.mongooseOptions=function(e){return arguments.length>0&&(this._mongooseOptions=e),this._mongooseOptions};V.prototype._castConditions=function(){try{this.cast(this.model),this._unsetCastError()}catch(e){this.error(e)}};function FW(e){try{hwe(e)}catch(t){e.error(t)}}V.prototype._find=dr(function(e){if(this._castConditions(),this.error()!=null)return e(this.error()),null;e=zn(this,e),this._applyPaths(),this._fields=this._castFields(this._fields);let t=this._fieldsForExec(),r=this._mongooseOptions,n=this,i=n._userProvidedFields||{};Uf(this.options,this.model);let s=Object.assign({},{session:Kr(this,"options.session",null)}),o=(c,f)=>{if(c)return e(c);if(f.length===0||this.options.explain)return e(null,f);if(!r.populate)return r.lean?e(null,f):PW(n.model,f,t,i,s,e);let h=Ma.preparePopulationOptionsMQ(n,r);s.populated=h,n.model.populate(f,h,function(d,p){return d?e(d):r.lean?e(null,p):PW(n.model,p,t,i,s,e)})},a=this._optionsForExec();a.projection=this._fieldsForExec();let u=this._conditions;return this._collection.find(u,a,o),null});V.prototype.find=function(e,t){return this.op="find",typeof e=="function"&&(t=e,e={}),e=me.toObject(e),Mr.canMerge(e)?(this.merge(e),hc(this)):e!=null&&this.error(new qa(e,"filter","find")),t?(this.exec(t),this):V.base.find.call(this)};V.prototype.merge=function(e){if(!e)return this;let t={overwrite:!0};return e instanceof V?(e._conditions&&me.merge(this._conditions,e._conditions,t),e._fields&&(this._fields||(this._fields={}),me.merge(this._fields,e._fields,t)),e.options&&(this.options||(this.options={}),me.merge(this.options,e.options,t)),e._update&&(this._update||(this._update={}),me.mergeClone(this._update,e._update)),e._distinct&&(this._distinct=e._distinct),me.merge(this._mongooseOptions,e._mongooseOptions),this):(me.merge(this._conditions,e,t),this)};V.prototype.collation=function(e){return this.options==null&&(this.options={}),this.options.collation=e,this};V.prototype._completeOne=function(e,t,r){if(!e&&!this.options.rawResult)return r(null,null);let n=this.model,i=me.clone(this._fields),s=this._userProvidedFields||{},o=this._mongooseOptions,a=this.options;if(a.explain)return r(null,e);if(!o.populate)return o.lean?RW(e,t,a,r):IW(n,e,t,a,i,s,null,r);let u=Ma.preparePopulationOptionsMQ(this,this._mongooseOptions);n.populate(e,u,(c,f)=>c?r(c):o.lean?RW(f,t,a,r):IW(n,f,t,a,i,s,u,r))};V.prototype._findOne=dr(function(e){if(this._castConditions(),this.error())return e(this.error()),null;this._applyPaths(),this._fields=this._castFields(this._fields),Uf(this.options,this.model),V.base.findOne.call(this,{},(t,r)=>{if(t)return e(t),null;this._completeOne(r,null,zn(this,e))})});V.prototype.findOne=function(e,t,r,n){return this.op="findOne",typeof e=="function"?(n=e,e=null,t=null,r=null):typeof t=="function"?(n=t,r=null,t=null):typeof r=="function"&&(n=r,r=null),e=me.toObject(e),r&&this.setOptions(r),t&&this.select(t),Mr.canMerge(e)?(this.merge(e),hc(this)):e!=null&&this.error(new qa(e,"filter","findOne")),n?(this.exec(n),this):V.base.findOne.call(this)};V.prototype._count=dr(function(e){try{this.cast(this.model)}catch(n){this.error(n)}if(this.error())return e(this.error());Uf(this.options,this.model);let t=this._conditions,r=this._optionsForExec();this._collection.count(t,r,me.tick(e))});V.prototype._countDocuments=dr(function(e){try{this.cast(this.model)}catch(n){this.error(n)}if(this.error())return e(this.error());Uf(this.options,this.model);let t=this._conditions,r=this._optionsForExec();this._collection.collection.countDocuments(t,r,me.tick(e))});V.prototype._estimatedDocumentCount=dr(function(e){if(this.error())return e(this.error());let t=this._optionsForExec();this._collection.collection.estimatedDocumentCount(t,me.tick(e))});V.prototype.count=function(e,t){return this.op="count",typeof e=="function"&&(t=e,e=void 0),e=me.toObject(e),Mr.canMerge(e)&&this.merge(e),t?(this.exec(t),this):this};V.prototype.estimatedDocumentCount=function(e,t){return this.op="estimatedDocumentCount",typeof e=="function"&&(t=e,e=void 0),typeof e=="object"&&e!=null&&this.setOptions(e),t?(this.exec(t),this):this};V.prototype.countDocuments=function(e,t){return this.op="countDocuments",typeof e=="function"&&(t=e,e=void 0),e=me.toObject(e),Mr.canMerge(e)&&this.merge(e),t?(this.exec(t),this):this};V.prototype.__distinct=dr(function(t){if(this._castConditions(),this.error())return t(this.error()),null;Uf(this.options,this.model);let r=this._optionsForExec();this._collection.collection.distinct(this._distinct,this._conditions,r,t)});V.prototype.distinct=function(e,t,r){return this.op="distinct",r||(typeof t=="function"?(r=t,t=void 0):typeof e=="function"&&(r=e,e=void 0,t=void 0)),t=me.toObject(t),Mr.canMerge(t)?(this.merge(t),hc(this)):t!=null&&this.error(new qa(t,"filter","distinct")),e!=null&&(this._distinct=e),r!=null&&this.exec(r),this};V.prototype.sort=function(e){if(arguments.length>1)throw new Error("sort() only takes 1 Argument");return V.base.sort.call(this,e)};V.prototype.remove=function(e,t){return this.op="remove",typeof e=="function"&&(t=e,e=null),e=me.toObject(e),Mr.canMerge(e)?(this.merge(e),hc(this)):e!=null&&this.error(new qa(e,"filter","remove")),t?(this.exec(t),this):V.base.remove.call(this)};V.prototype._remove=dr(function(e){return this._castConditions(),this.error()!=null?(e(this.error()),this):(e=zn(this,e),V.base.remove.call(this,Ma.handleDeleteWriteOpResult(e)))});V.prototype.deleteOne=function(e,t,r){return this.op="deleteOne",typeof e=="function"?(r=e,e=null,t=null):typeof t=="function"?(r=t,t=null):this.setOptions(t),e=me.toObject(e),Mr.canMerge(e)?(this.merge(e),hc(this)):e!=null&&this.error(new qa(e,"filter","deleteOne")),r?(this.exec.call(this,r),this):V.base.deleteOne.call(this)};V.prototype._deleteOne=dr(function(e){return this._castConditions(),this.error()!=null?(e(this.error()),this):(e=zn(this,e),V.base.deleteOne.call(this,Ma.handleDeleteWriteOpResult(e)))});V.prototype.deleteMany=function(e,t,r){return this.op="deleteMany",typeof e=="function"?(r=e,e=null,t=null):typeof t=="function"?(r=t,t=null):this.setOptions(t),e=me.toObject(e),Mr.canMerge(e)?(this.merge(e),hc(this)):e!=null&&this.error(new qa(e,"filter","deleteMany")),r?(this.exec.call(this,r),this):V.base.deleteMany.call(this)};V.prototype._deleteMany=dr(function(e){return this._castConditions(),this.error()!=null?(e(this.error()),this):(e=zn(this,e),V.base.deleteMany.call(this,Ma.handleDeleteWriteOpResult(e)))});function IW(e,t,r,n,i,s,o,a){let u=o?{populated:o}:void 0;if(n.rawResult&&t==null)return f(null),null;let c=Ma.createModel(e,t,i,s,n);try{c.init(t,u,f)}catch(h){f(h)}function f(h){if(h)return jy(()=>a(h));if(n.rawResult)return t&&c?(n.session!=null&&c.$session(n.session),r.value=c):r.value=null,jy(()=>a(null,r));n.session!=null&&c.$session(n.session),jy(()=>a(null,c))}}function hc(e){if(!e||!e.model||!e.model.schema)return;let t=e.model.schema;t&&t.discriminatorMapping&&!t.discriminatorMapping.isRoot&&(e._conditions[t.discriminatorMapping.key]=t.discriminatorMapping.value)}V.prototype.findOneAndUpdate=function(e,t,r,n){switch(this.op="findOneAndUpdate",this._validate(),arguments.length){case 3:typeof r=="function"&&(n=r,r={});break;case 2:typeof t=="function"&&(n=t,t=e,e=void 0),r=void 0;break;case 1:typeof e=="function"?(n=e,e=r=t=void 0):(t=e,e=r=void 0)}Mr.canMerge(e)&&this.merge(e),t&&this._mergeUpdate(t),r=r?me.clone(r):{},r.projection&&(this.select(r.projection),delete r.projection),r.fields&&(this.select(r.fields),delete r.fields);let i=Kr(this,"model.base.options.returnOriginal");return r.new==null&&r.returnDocument==null&&r.returnOriginal==null&&i!=null&&(r.returnOriginal=i),this.setOptions(r),n?(this.exec(n),this):this};V.prototype._findOneAndUpdate=dr(function(e){if(this.error()!=null)return e(this.error());this._findAndModify("update",e)});V.prototype.findOneAndRemove=function(e,t,r){switch(this.op="findOneAndRemove",this._validate(),arguments.length){case 2:typeof t=="function"&&(r=t,t={});break;case 1:typeof e=="function"&&(r=e,e=void 0,t=void 0);break}return Mr.canMerge(e)&&this.merge(e),t&&this.setOptions(t),r?(this.exec(r),this):this};V.prototype.findOneAndDelete=function(e,t,r){switch(this.op="findOneAndDelete",this._validate(),arguments.length){case 2:typeof t=="function"&&(r=t,t={});break;case 1:typeof e=="function"&&(r=e,e=void 0,t=void 0);break}return Mr.canMerge(e)&&this.merge(e),t&&this.setOptions(t),r?(this.exec(r),this):this};V.prototype._findOneAndDelete=dr(function(e){if(this._castConditions(),this.error()!=null)return e(this.error()),null;let t=this._conditions,r=this._optionsForExec(),n=null;if(this._fields!=null&&(r.projection=this._castFields(me.clone(this._fields)),n=r.projection,n instanceof Error))return e(n),null;this._collection.collection.findOneAndDelete(t,r,zn(this,(i,s)=>{if(i)return e(i);let o=s.value;return this._completeOne(o,s,e)}))});V.prototype.findOneAndReplace=function(e,t,r,n){switch(this.op="findOneAndReplace",this._validate(),arguments.length){case 3:typeof r=="function"&&(n=r,r=void 0);break;case 2:typeof t=="function"&&(n=t,t=void 0);break;case 1:typeof e=="function"&&(n=e,e=void 0,t=void 0,r=void 0);break}if(Mr.canMerge(e)&&this.merge(e),t!=null){if(fC(t))throw new Error("The replacement document must not contain atomic operators.");this._mergeUpdate(t)}r=r||{};let i=Kr(this,"model.base.options.returnOriginal");return r.new==null&&r.returnDocument==null&&r.returnOriginal==null&&i!=null&&(r.returnOriginal=i),this.setOptions(r),this.setOptions({overwrite:!0}),n?(this.exec(n),this):this};V.prototype._findOneAndReplace=dr(function(e){if(this._castConditions(),this.error()!=null)return e(this.error()),null;let t=this._conditions,r=this._optionsForExec();UW(r);let n=null,i=new this.model(this._update,null,!0);if(this._update=i,this._applyPaths(),this._fields!=null&&(r.projection=this._castFields(me.clone(this._fields)),n=r.projection,n instanceof Error))return e(n),null;i.validate(s=>{if(s!=null)return e(s);i.toBSON&&(i=i.toBSON()),this._collection.collection.findOneAndReplace(t,i,r,zn(this,(o,a)=>{if(o)return e(o);let u=a.value;return this._completeOne(u,a,e)}))})});function UW(e){"new"in e&&(e.returnDocument=e.new?"after":"before",delete e.new),"returnOriginal"in e&&(e.returnDocument=e.returnOriginal?"before":"after",delete e.returnOriginal)}V.prototype._findOneAndRemove=dr(function(e){if(this.error()!=null){e(this.error());return}this._findAndModify("remove",e)});function VW(e,t,r){let n=e._optionsForExec(e.model);return t in n?n[t]:t in e.model.base.options?e.model.base.options[t]:r}V.prototype._findAndModify=function(e,t){if(typeof t!="function")throw new Error("Expected callback in _findAndModify");let r=this.model,n=r.schema,i=this,s,o=bwe(this);if(o instanceof Error)return t(o);FW(this);let a=this._optionsForExec(r);"strict"in a&&(this._mongooseOptions.strict=a.strict);let u=this.options.overwrite&&!fC(this._update);if(u&&(this._update=new this.model(this._update,null,!0)),e==="remove")a.remove=!0;else{if(!("new"in a)&&!("returnOriginal"in a)&&!("returnDocument"in a)&&(a.new=!1),"upsert"in a||(a.upsert=!1),(a.upsert||a.new)&&(a.remove=!1),!u){this._update=WW(this,a.overwrite);let y=Object.assign({},a,{setDefaultsOnInsert:this._mongooseOptions.setDefaultsOnInsert});if(this._update=kW(this._conditions,n,this._update,y),!this._update||Object.keys(this._update).length===0)if(a.upsert){let g=me.clone(o);delete g._id,this._update={$set:g}}else return this.findOne(t),this;else{if(this._update instanceof Error)return t(this._update);this._update.$set&&Object.keys(this._update.$set).length===0&&delete this._update.$set}}Array.isArray(a.arrayFilters)&&(a.arrayFilters=LW(this._update,a.arrayFilters))}this._applyPaths();let c=this._mongooseOptions;if(this._fields&&(s=me.clone(this._fields),a.projection=this._castFields(s),a.projection instanceof Error))return t(a.projection);a.sort&&Owe(a);let f=function(y,g,w){if(y)return t(y);i._completeOne(g,w,t)},h=!0,d=VW(this,"runValidators",!1),p=i.model&&i.model.base,m=Kr(r,"collection.conn",{});if("useFindAndModify"in p.options&&(h=p.get("useFindAndModify")),"useFindAndModify"in m.config&&(h=m.config.useFindAndModify),"useFindAndModify"in c&&(h=c.useFindAndModify),h===!1){let y=i._collection.collection;if(UW(a),e==="remove")return y.findOneAndDelete(o,a,zn(i,function(w,S){return f(w,S&&S.value,S)})),this;let g=u?"findOneAndReplace":"findOneAndUpdate";return d?this.validate(this._update,a,u,w=>{if(w)return t(w);this._update&&this._update.toBSON&&(this._update=this._update.toBSON()),y[g](o,this._update,a,zn(i,function(S,v){return f(S,v&&v.value,v)}))}):(this._update&&this._update.toBSON&&(this._update=this._update.toBSON()),y[g](o,this._update,a,zn(i,function(w,S){return f(w,S&&S.value,S)}))),this}return d?this.validate(this._update,a,u,function(y){if(y)return t(y);DW.call(i,o,i._update,a,f)}):DW.call(i,o,i._update,a,f),this};function RW(e,t,r,n){return r.rawResult?n(null,t):n(null,e)}var DW=hC.deprecate(function(e,t,r,n){t&&t.toBSON&&(t=t.toBSON());let i=this._collection,s=r!=null&&Array.isArray(r.sort)?r.sort:[],o=zn(this,function(a,u){return n(a,u&&u.value,u)});i.collection._findAndModify(e,s,t,r,o)},"Mongoose: `findOneAndUpdate()` and `findOneAndDelete()` without the `useFindAndModify` option set to false are deprecated. See: https://mongoosejs.com/docs/5.x/docs/deprecations.html#findandmodify");V.prototype._mergeUpdate=function(e){if(!(e==null||typeof e=="object"&&Object.keys(e).length===0))if(this._update||(this._update=Array.isArray(e)?[]:{}),e instanceof V){if(Array.isArray(this._update))throw new Error("Cannot mix array and object updates");e._update&&me.mergeClone(this._update,e._update)}else if(Array.isArray(e)){if(!Array.isArray(this._update))throw new Error("Cannot mix array and object updates");this._update=this._update.concat(e)}else{if(Array.isArray(this._update))throw new Error("Cannot mix array and object updates");me.mergeClone(this._update,e)}};function Owe(e){if(Array.isArray(e.sort)||!me.isObject(e.sort))return;let t=[];for(let r in e.sort)me.object.hasOwnProperty(e.sort,r)&&t.push([r,e.sort[r]]);e.sort=t}function Ly(e,t){if(this._castConditions(),FW(this),this.error()!=null)return t(this.error()),null;t=zn(this,t);let r=t;t=function(a,u){r(a,u?u.result:{ok:0,n:0,nModified:0})};let n=this._conditions,i=this._optionsForExec(this.model);++this._executionCount,this._update=me.clone(this._update,i);let s=this.options.overwrite&&!fC(this._update);if(s){if(e==="updateOne"||e==="updateMany")return t(new uwe("The MongoDB server disallows overwriting documents using `"+e+"`. See: https://mongoosejs.com/docs/deprecations.html#update"));this._update=new this.model(this._update,null,!0)}else{if(this._update=WW(this,i.overwrite),this._update instanceof Error)return t(this._update),null;if(this._update==null||Object.keys(this._update).length===0)return t(null,0),null;let a=Object.assign({},i,{setDefaultsOnInsert:this._mongooseOptions.setDefaultsOnInsert});this._update=kW(this._conditions,this.model.schema,this._update,a)}return Array.isArray(i.arrayFilters)&&(i.arrayFilters=LW(this._update,i.arrayFilters)),VW(this,"runValidators",!1)?(this.validate(this._update,i,s,a=>{if(a)return t(a);this._update.toBSON&&(this._update=this._update.toBSON()),this._collection[e](n,this._update,i,t)}),null):(this._update.toBSON&&(this._update=this._update.toBSON()),this._collection[e](n,this._update,i,t),null)}V.prototype.validate=function(t,r,n,i){return jW(i,s=>{try{n?t.validate(s):wwe(this,this.model.schema,t,r,s)}catch(o){jy(function(){s(o)})}})};V.prototype._execUpdate=dr(function(e){return Ly.call(this,"update",e)});V.prototype._updateMany=dr(function(e){return Ly.call(this,"updateMany",e)});V.prototype._updateOne=dr(function(e){return Ly.call(this,"updateOne",e)});V.prototype._replaceOne=dr(function(e){return Ly.call(this,"replaceOne",e)});V.prototype.update=function(e,t,r,n){return typeof r=="function"?(n=r,r=null):typeof t=="function"?(n=t,t=e,e={},r=null):typeof e=="function"?(n=e,e=void 0,t=void 0,r=void 0):typeof e=="object"&&!t&&!r&&!n&&(t=e,e=void 0,r=void 0,n=void 0),ky(this,"update",e,t,r,n)};V.prototype.updateMany=function(e,t,r,n){return typeof r=="function"?(n=r,r=null):typeof t=="function"?(n=t,t=e,e={},r=null):typeof e=="function"?(n=e,e=void 0,t=void 0,r=void 0):typeof e=="object"&&!t&&!r&&!n&&(t=e,e=void 0,r=void 0,n=void 0),ky(this,"updateMany",e,t,r,n)};V.prototype.updateOne=function(e,t,r,n){return typeof r=="function"?(n=r,r=null):typeof t=="function"?(n=t,t=e,e={},r=null):typeof e=="function"?(n=e,e=void 0,t=void 0,r=void 0):typeof e=="object"&&!t&&!r&&!n&&(t=e,e=void 0,r=void 0,n=void 0),ky(this,"updateOne",e,t,r,n)};V.prototype.replaceOne=function(e,t,r,n){return typeof r=="function"?(n=r,r=null):typeof t=="function"?(n=t,t=e,e={},r=null):typeof e=="function"?(n=e,e=void 0,t=void 0,r=void 0):typeof e=="object"&&!t&&!r&&!n&&(t=e,e=void 0,r=void 0,n=void 0),this.setOptions({overwrite:!0}),ky(this,"replaceOne",e,t,r,n)};function ky(e,t,r,n,i,s){return e.op=t,r=me.toObject(r),n=n||{},i!=null&&"strict"in i&&(e._mongooseOptions.strict=i.strict),!(r instanceof V)&&r!=null&&r.toString()!=="[object Object]"?e.error(new qa(r,"filter",t)):e.merge(r),me.isObject(i)&&e.setOptions(i),e._mergeUpdate(n),s?(e.exec(s),e):V.base[t].call(e,r,void 0,i,s)}V.prototype.map=function(e){return this._transforms.push(e),this};V.prototype.orFail=function(e){return this.map(t=>{switch(this.op){case"find":if(t.length===0)throw fc(e,this);break;case"findOne":if(t==null)throw fc(e,this);break;case"update":case"updateMany":case"updateOne":if(Kr(t,"nModified")===0)throw fc(e,this);break;case"findOneAndDelete":case"findOneAndRemove":if(Kr(t,"lastErrorObject.n")===0)throw fc(e,this);break;case"findOneAndUpdate":case"findOneAndReplace":if(Kr(t,"lastErrorObject.updatedExisting")===!1)throw fc(e,this);break;case"deleteMany":case"deleteOne":case"remove":if(t.n===0)throw fc(e,this);break;default:break}return t}),this};function fc(e,t){return typeof e=="function"&&(e=e.call(t)),e==null&&(e=new owe(t.getQuery(),t.model.modelName)),e}V.prototype.exec=function(t,r){let n=this,i=new lC;return typeof t=="function"?(r=t,t=null):typeof t=="string"&&(this.op=t),r=this.model.$handleCallbackError(r),jW(r,s=>{if(s=this.model.$wrapCallback(s),!n.op){s();return}this._hooks.execPre("exec",this,[],o=>{if(o!=null)return s(cC(i,o));let a="_"+this.op;this.op==="update"?a="_execUpdate":this.op==="distinct"&&(a="__distinct"),this[a].call(this,(u,c)=>{if(u)return s(cC(i,u));this._hooks.execPost("exec",this,[],{},f=>{if(f)return s(cC(i,f));s(null,c)})})})},this.model.events)};function cC(e,t){return t instanceof lC?(e.copy(t),e):t}function zn(e,t){return function(r,n){if(r!=null)return t(r);for(let i of e._transforms)try{n=i(n)}catch(s){return t(s)}return t(null,n)}}V.prototype.then=function(e,t){return this.exec().then(e,t)};V.prototype.catch=function(e){return this.exec().then(null,e)};V.prototype.pre=function(e){return this._hooks.pre("exec",e),this};V.prototype.post=function(e){return this._hooks.post("exec",e),this};V.prototype._castUpdate=function(t,r){let n,i=this.schema,s=i.options.discriminatorKey,o=i._baseSchema?i._baseSchema:i;if(this._mongooseOptions.overwriteDiscriminatorKey&&t[s]!=null&&o.discriminators){let h=o.discriminators[t[s]];h!=null&&(i=h)}"strict"in this._mongooseOptions?n=this._mongooseOptions.strict:this.schema&&this.schema.options?n=this.schema.options.strict:n=!0;let a=!1;"omitUndefined"in this._mongooseOptions&&(a=this._mongooseOptions.omitUndefined);let u;"useNestedStrict"in this.options&&(u=this.options.useNestedStrict);let c;"upsert"in this.options&&(c=this.options.upsert);let f=this._conditions;if(i!=null&&me.hasUserDefinedProperty(f,i.options.discriminatorKey)&&typeof f[i.options.discriminatorKey]!="object"&&i.discriminators!=null){let h=f[i.options.discriminatorKey],d=BW(this.model.discriminators,h);i=i.discriminators[h]||d&&d.schema||i}return dwe(i,t,{overwrite:r,strict:n,omitUndefined:a,useNestedStrict:u,upsert:c,arrayFilters:this.options.arrayFilters},this,this._conditions)};function bwe(e){try{return e.cast(e.model)}catch(t){return t}}function WW(e,t){try{return e._castUpdate(e._update,t)}catch(r){return r}}V.prototype.populate=function(){if(!Array.from(arguments).some(Boolean))return this;let e=me.populate.apply(null,arguments);if(this.options!=null){let n=this.options.readConcern,i=this.options.readPreference;for(let s of e)n!=null&&Kr(s,"options.readConcern")==null&&(s.options=s.options||{},s.options.readConcern=n),i!=null&&Kr(s,"options.readPreference")==null&&(s.options=s.options||{},s.options.readPreference=i)}let t=this._mongooseOptions;if(t.lean!=null){let n=t.lean;for(let i of e)Kr(i,"options.lean")==null&&(i.options=i.options||{},i.options.lean=n)}me.isObject(t.populate)||(t.populate={});let r=t.populate;for(let n of e){let i=n.path;r[i]&&r[i].populate&&n.populate&&(n.populate=r[i].populate.concat(n.populate)),r[n.path]=n}return this};V.prototype.getPopulatedPaths=function(){let t=this._mongooseOptions.populate||{},r=Object.keys(t);for(let n of Object.keys(t)){let i=t[n];!Array.isArray(i.populate)||zW(r,i.populate,n+".")}return r};function zW(e,t,r){for(let n of t)e.push(r+n.path),Array.isArray(n.populate)&&zW(e,n.populate,r+n.path+".")}V.prototype.cast=function(e,t){t||(t=this._conditions),e=e||this.model;let r=e.schema.options.discriminatorKey;t!=null&&t.hasOwnProperty(r)&&(e=BW(e.discriminators,t[r])||e);try{return fwe(e.schema,t,{upsert:this.options&&this.options.upsert,strict:this.options&&"strict"in this.options?this.options.strict:Kr(e,"schema.options.strict",null),strictQuery:this.options&&this.options.strictQuery||Kr(e,"schema.options.strictQuery",null)},this)}catch(n){throw typeof n.setModel=="function"&&n.setModel(e),n}};V.prototype._castFields=function(t){let r,n,i,s,o,a;if(t)for(i=Object.keys(t),n=[],a=i.length;a--;)s=i[a],t[s].$elemMatch&&(r||(r={}),r[s]=t[s],n.push(s));if(r){try{o=this.cast(this.model,r)}catch(u){return u}for(a=n.length;a--;)s=n[a],t[s]=o[s]}return t};V.prototype._applyPaths=function(){this._fields=this._fields||{},Ma.applyPaths(this._fields,this.model.schema);let t=!0;"selectPopulatedPaths"in this.model.base.options&&(t=this.model.base.options.selectPopulatedPaths),"selectPopulatedPaths"in this.model.schema.options&&(t=this.model.schema.options.selectPopulatedPaths),t&&_we(this._fields,this._userProvidedFields,this._mongooseOptions.populate)};V.prototype.cursor=function(t){this._applyPaths(),this._fields=this._castFields(this._fields),this.setOptions({projection:this._fieldsForExec()}),t&&this.setOptions(t);let r=Object.assign({},this._optionsForExec(),{projection:this.projection()});try{this.cast(this.model)}catch(n){return new $W(this,r)._markError(n)}return new $W(this,r)};V.prototype.maxscan=V.base.maxScan;V.prototype.tailable=function(e,t){if(e!=null&&typeof e.constructor=="function"&&e.constructor.name==="Object"&&(t=e,e=!0),e===void 0&&(e=!0),t&&typeof t=="object")for(let r of Object.keys(t))r==="awaitdata"?this.options[r]=!!t[r]:this.options[r]=t[r];return V.base.tailable.call(this,e)};V.prototype.near=function(){let e=[],t=this._mongooseOptions.nearSphere;if(arguments.length===1)if(Array.isArray(arguments[0]))e.push({center:arguments[0],spherical:t});else if(typeof arguments[0]=="string")e.push(arguments[0]);else if(me.isObject(arguments[0]))typeof arguments[0].spherical!="boolean"&&(arguments[0].spherical=t),e.push(arguments[0]);else throw new TypeError("invalid argument");else if(arguments.length===2)if(typeof arguments[0]=="number"&&typeof arguments[1]=="number")e.push({center:[arguments[0],arguments[1]],spherical:t});else if(typeof arguments[0]=="string"&&Array.isArray(arguments[1]))e.push(arguments[0]),e.push({center:arguments[1],spherical:t});else if(typeof arguments[0]=="string"&&me.isObject(arguments[1]))e.push(arguments[0]),typeof arguments[1].spherical!="boolean"&&(arguments[1].spherical=t),e.push(arguments[1]);else throw new TypeError("invalid argument");else if(arguments.length===3)if(typeof arguments[0]=="string"&&typeof arguments[1]=="number"&&typeof arguments[2]=="number")e.push(arguments[0]),e.push({center:[arguments[1],arguments[2]],spherical:t});else throw new TypeError("invalid argument");else throw new TypeError("invalid argument");return V.base.near.apply(this,e)};V.prototype.nearSphere=function(){return this._mongooseOptions.nearSphere=!0,this.near.apply(this,arguments),this};Symbol.asyncIterator!=null&&(V.prototype[Symbol.asyncIterator]=function(){return this.cursor().transformNull()._transformForAsyncIterator()});V.prototype.box=function(e,t){return!Array.isArray(e)&&me.isObject(e)&&(t=e.ur,e=e.ll),V.base.box.call(this,e,t)};V.prototype.center=V.base.circle;V.prototype.centerSphere=function(){arguments[0]!=null&&typeof arguments[0].constructor=="function"&&arguments[0].constructor.name==="Object"&&(arguments[0].spherical=!0),arguments[1]!=null&&typeof arguments[1].constructor=="function"&&arguments[1].constructor.name==="Object"&&(arguments[1].spherical=!0),V.base.circle.apply(this,arguments)};V.prototype.selectedInclusively=function(){return mwe(this._fields)};V.prototype.selectedExclusively=function(){return pwe(this._fields)};V.prototype.model;HW.exports=V});var XW=_((v$e,JW)=>{"use strict";var Ewe=on(),GW=require("stream").Readable,QW=an(),Cwe=KE(),Twe=Cr(),Awe=require("util"),YW=Ne();function Cn(e){let t={objectMode:!0};YW.nodeMajorVersion>=12&&(t.autoDestroy=!0),GW.call(this,t),this.cursor=null,this.agg=e,this._transforms=[];let r=e._model;delete e.options.cursor.useMongooseAggCursor,this._mongooseOptions={},xwe(r,this,e)}Awe.inherits(Cn,GW);function xwe(e,t,r){e.collection.buffer?e.collection.emitter.once("queue",function(){e.hooks.execPre("aggregate",r,function(){t.cursor=e.collection.aggregate(r._pipeline,r.options||{}),t.emit("cursor",t.cursor)})}):e.hooks.execPre("aggregate",r,function(){t.cursor=e.collection.aggregate(r._pipeline,r.options||{}),t.emit("cursor",t.cursor)})}Cn.prototype._read=function(){let e=this;Uy(this,function(t,r){if(t)return e.emit("error",t);if(!r){e.push(null),e.cursor.close(function(n){if(n)return e.emit("error",n);YW.nodeMajorVersion<12&&e.on("end",()=>e.emit("close"))});return}e.push(r)})};if(Symbol.asyncIterator!=null){let e="Mongoose does not support using async iterators with an existing aggregation cursor. See http://bit.ly/mongoose-async-iterate-aggregation";Cn.prototype[Symbol.asyncIterator]=function(){throw new Ewe(e)}}Cn.prototype.map=function(e){return this._transforms.push(e),this};Cn.prototype._markError=function(e){return this._error=e,this};Cn.prototype.close=function(e){return QW(e,t=>{this.cursor.close(r=>{if(r)return t(r),this.listeners("error").length>0&&this.emit("error",r);this.emit("close"),t(null)})})};Cn.prototype.next=function(e){return QW(e,t=>{Uy(this,t)})};Cn.prototype.eachAsync=function(e,t,r){let n=this;return typeof t=="function"&&(r=t,t={}),t=t||{},Cwe(function(i){return Uy(n,i)},e,t,r)};Symbol.asyncIterator!=null&&(Cn.prototype[Symbol.asyncIterator]=function(){return this.transformNull()._transformForAsyncIterator()});Cn.prototype._transformForAsyncIterator=function(){return this._transforms.indexOf(KW)===-1&&this.map(KW),this};Cn.prototype.transformNull=function(e){return arguments.length===0&&(e=!0),this._mongooseOptions.transformNull=e,this};function KW(e){return e==null?{done:!0}:{value:e,done:!1}}Cn.prototype.addCursorFlag=function(e,t){let r=this;return qwe(this,function(){r.cursor.addCursorFlag(e,t)}),this};function qwe(e,t){if(e.cursor)return t();e.once("cursor",function(){t()})}function Uy(e,t){let r=t;if(e._transforms.length&&(r=function(n,i){if(n||i===null&&!e._mongooseOptions.transformNull)return t(n,i);t(n,e._transforms.reduce(function(s,o){return o(s)},i))}),e._error)return Twe(function(){r(e._error)});if(e.cursor)return e.cursor.next(function(n,i){if(n)return r(n);if(!i)return r(null,null);r(null,i)});e.once("cursor",function(){Uy(e,t)})}JW.exports=Cn});var e3=_((S$e,ZW)=>{"use strict";ZW.exports=function e(t){if(!!Array.isArray(t))for(let r of t){if(r==null)continue;let n=r.$group||r.$bucket||r.$bucketAuto;if(n!=null)for(let s of Object.keys(n))Mwe(n[s]);let i=Object.keys(r)[0];if(i&&typeof r[i]=="object"){let s=r[i];for(let o of Object.keys(s))s[o]!=null&&s[o].$function!=null&&typeof s[o].$function.body=="function"&&(s[o].$function.body=s[o].$function.body.toString())}if(r.$facet!=null)for(let s of Object.keys(r.$facet))e(r.$facet[s])}};function Mwe(e){if(!(e==null||e.$accumulator==null))for(let t of["init","accumulate","merge","finalize"])typeof e.$accumulator[t]=="function"&&(e.$accumulator[t]=String(e.$accumulator[t]))}});var pC=_((O$e,n3)=>{"use strict";var Nwe=XW(),t3=Fy(),$we=YE(),Pwe=Ur(),r3=an(),Iwe=e3(),Wf=require("util"),Vf=Ne(),Rwe=t3.prototype.read,Dwe=t3.prototype.readConcern;function Ue(e){this._pipeline=[],this._model=void 0,this.options={},arguments.length===1&&Wf.isArray(e)&&this.append.apply(this,e)}Ue.prototype.options;Ue.prototype.model=function(e){return arguments.length===0?this._model:(this._model=e,e.schema!=null&&(this.options.readPreference==null&&e.schema.options.read!=null&&(this.options.readPreference=e.schema.options.read),this.options.collation==null&&e.schema.options.collation!=null&&(this.options.collation=e.schema.options.collation)),this)};Ue.prototype.append=function(){let e=arguments.length===1&&Wf.isArray(arguments[0])?arguments[0]:Vf.args(arguments);if(!e.every(jwe))throw new Error("Arguments must be aggregate pipeline operators");return this._pipeline=this._pipeline.concat(e),this};Ue.prototype.addFields=function(e){let t={};if(typeof e=="object"&&!Wf.isArray(e))Object.keys(e).forEach(function(r){t[r]=e[r]});else throw new Error("Invalid addFields() argument. Must be an object");return this.append({$addFields:t})};Ue.prototype.project=function(e){let t={};if(typeof e=="object"&&!Wf.isArray(e))Object.keys(e).forEach(function(r){t[r]=e[r]});else if(arguments.length===1&&typeof e=="string")e.split(/\s+/).forEach(function(r){if(!r)return;let n=r[0]==="-"?0:1;n===0&&(r=r.substring(1)),t[r]=n});else throw new Error("Invalid project() argument. Must be string or object");return this.append({$project:t})};Ue.prototype.near=function(e){let t={};return t.$geoNear=e,this.append(t)};"group match skip limit out".split(" ").forEach(function(e){Ue.prototype[e]=function(t){let r={};return r["$"+e]=t,this.append(r)}});Ue.prototype.unwind=function(){let e=Vf.args(arguments),t=[];for(let r of e)if(r&&typeof r=="object")t.push({$unwind:r});else if(typeof r=="string")t.push({$unwind:r&&r.startsWith("$")?r:"$"+r});else throw new Error('Invalid arg "'+r+'" to unwind(), must be string or object');return this.append.apply(this,t)};Ue.prototype.replaceRoot=function(e){let t;return typeof e=="string"?t=e.startsWith("$")?e:"$"+e:t=e,this.append({$replaceRoot:{newRoot:t}})};Ue.prototype.count=function(e){return this.append({$count:e})};Ue.prototype.sortByCount=function(e){if(e&&typeof e=="object")return this.append({$sortByCount:e});if(typeof e=="string")return this.append({$sortByCount:e&&e.startsWith("$")?e:"$"+e});throw new TypeError('Invalid arg "'+e+'" to sortByCount(), must be string or object')};Ue.prototype.lookup=function(e){return this.append({$lookup:e})};Ue.prototype.graphLookup=function(e){let t={};if(e){if(!Vf.isObject(e))throw new TypeError("Invalid graphLookup() argument. Must be an object.");Vf.mergeClone(t,e);let r=t.startWith;r&&typeof r=="string"&&(t.startWith=t.startWith.startsWith("$")?t.startWith:"$"+t.startWith)}return this.append({$graphLookup:t})};Ue.prototype.sample=function(e){return this.append({$sample:{size:e}})};Ue.prototype.sort=function(e){let t={};if(Pwe(e)==="Object"){let r=["desc","descending",-1];Object.keys(e).forEach(function(n){if(e[n]instanceof Object&&e[n].$meta){t[n]=e[n];return}t[n]=r.indexOf(e[n])===-1?1:-1})}else if(arguments.length===1&&typeof e=="string")e.split(/\s+/).forEach(function(r){if(!r)return;let n=r[0]==="-"?-1:1;n===-1&&(r=r.substring(1)),t[r]=n});else throw new TypeError("Invalid sort() argument. Must be a string or object.");return this.append({$sort:t})};Ue.prototype.read=function(e,t){return this.options||(this.options={}),Rwe.call(this,e,t),this};Ue.prototype.readConcern=function(e){return this.options||(this.options={}),Dwe.call(this,e),this};Ue.prototype.redact=function(e,t,r){if(arguments.length===3){if(typeof t=="string"&&!t.startsWith("$$")||typeof r=="string"&&!r.startsWith("$$"))throw new Error("If thenExpr or elseExpr is string, it must start with $$. e.g. $$DESCEND, $$PRUNE, $$KEEP");e={$cond:{if:e,then:t,else:r}}}else if(arguments.length!==1)throw new TypeError("Invalid arguments");return this.append({$redact:e})};Ue.prototype.explain=function(e){let t=this._model;return r3(e,r=>{if(!this._pipeline.length){let n=new Error("Aggregate has empty pipeline");return r(n)}dC(this),t.hooks.execPre("aggregate",this,n=>{if(n){let i={error:n};return t.hooks.execPost("aggregate",this,[null],i,s=>{r(s)})}this.options.explain=!0,t.collection.aggregate(this._pipeline,this.options||{}).explain((i,s)=>{let o={error:i};return t.hooks.execPost("aggregate",this,[s],o,a=>a?r(a):r(null,s))})})},t.events)};Ue.prototype.allowDiskUse=function(e){return this.options.allowDiskUse=e,this};Ue.prototype.hint=function(e){return this.options.hint=e,this};Ue.prototype.session=function(e){return e==null?delete this.options.session:this.options.session=e,this};Ue.prototype.option=function(e){for(let t in e)this.options[t]=e[t];return this};Ue.prototype.cursor=function(e){return this.options||(this.options={}),this.options.cursor=e||{},this};Ue.prototype.addCursorFlag=Wf.deprecate(function(e,t){return this.options||(this.options={}),this.options[e]=t,this},"Mongoose: `Aggregate#addCursorFlag()` is deprecated, use `option()` instead");Ue.prototype.collation=function(e){return this.options||(this.options={}),this.options.collation=e,this};Ue.prototype.facet=function(e){return this.append({$facet:e})};Ue.prototype.search=function(e){return this.append({$search:e})};Ue.prototype.pipeline=function(){return this._pipeline};Ue.prototype.exec=function(e){if(!this._model)throw new Error("Aggregate not bound to any Model");let t=this._model,r=this._model.collection;return $we(this.options,t),this.options&&this.options.cursor?new Nwe(this):r3(e,n=>{dC(this),Iwe(this._pipeline),t.hooks.execPre("aggregate",this,i=>{if(i){let o={error:i};return t.hooks.execPost("aggregate",this,[null],o,a=>{n(a)})}if(!this._pipeline.length)return n(new Error("Aggregate has empty pipeline"));let s=Vf.clone(this.options||{});r.aggregate(this._pipeline,s,(o,a)=>{if(o){let u={error:o};return t.hooks.execPost("aggregate",this,[null],u,c=>n(c||null))}a.toArray((u,c)=>{let f={error:u};t.hooks.execPost("aggregate",this,[c],f,(h,d)=>{if(h)return n(h);n(null,d)})})})})},t.events)};Ue.prototype.then=function(e,t){return this.exec().then(e,t)};Ue.prototype.catch=function(e){return this.exec().then(null,e)};Symbol.asyncIterator!=null&&(Ue.prototype[Symbol.asyncIterator]=function(){return this.cursor({useMongooseAggCursor:!0}).exec().transformNull()._transformForAsyncIterator()});function jwe(e){if(typeof e!="object")return!1;let t=Object.keys(e);return t.length===1&&t.some(r=>r[0]==="$")}Ue._prepareDiscriminatorPipeline=dC;function dC(e){let t=e._model.schema,r=t&&t.discriminatorMapping;if(r&&!r.isRoot){let n=e._pipeline,i=r.key,s=r.value;if(n[0]&&n[0].$match&&!n[0].$match[i])n[0].$match[i]=s;else if(n[0]&&n[0].$geoNear)n[0].$geoNear.query=n[0].$geoNear.query||{},n[0].$geoNear.query[i]=s;else if(n[0]&&n[0].$search)if(n[1]&&n[1].$match!=null)n[1].$match[i]=n[1].$match[i]||s;else{let o={};o[i]=s,n.splice(1,0,{$match:o})}else{let o={};o[i]=s,e._pipeline.unshift({$match:o})}}}n3.exports=Ue});var s3=_((b$e,i3)=>{"use strict";var Bwe=ms(),mC=class{constructor(t){t!=null&&Object.assign(this,Bwe(t))}};i3.exports=mC});var a3=_((E$e,o3)=>{"use strict";var Lwe=ms(),yC=class{constructor(t){t!=null&&Object.assign(this,Lwe(t))}};o3.exports=yC});var c3=_((C$e,u3)=>{"use strict";var kwe=je();u3.exports=function e(t,r){function n(i,s){Object.defineProperty(t.prototype,i,{get:function(){let o={};for(let a in s.methods[i])o[a]=s.methods[i][a].bind(this);return o},configurable:!0})}for(let i of Object.keys(r.methods)){let s=r.methods[i];if(r.tree.hasOwnProperty(i))throw new Error('You have a method and a property in your schema both named "'+i+'"');r.reserved[i]&&!kwe(r,`methodOptions.${i}.suppressWarning`,!1)&&console.warn(`mongoose: the method name "${i}" is used by mongoose internally, overwriting it may cause bugs. If you're sure you know what you're doing, you can suppress this error by using \`schema.method('${i}', fn, { suppressWarning: true })\`.`),typeof s=="function"?t.prototype[i]=s:n(i,r)}t.$appliedMethods=!0;for(let i of Object.keys(r.paths)){let s=r.paths[i];s.$isSingleNested&&!s.caster.$appliedMethods&&e(s.caster,s.schema),s.$isMongooseDocumentArray&&!s.Constructor.$appliedMethods&&e(s.Constructor,s.schema)}}});var f3=_((T$e,l3)=>{"use strict";var Fwe=Hm().middlewareFunctions,Uwe=an();l3.exports=function(t,r,n){let i={useErrorHandlers:!0,numCallbackParams:1};r=r.filter(s=>Fwe.indexOf(s.name)!==-1?!!s.model:s.model!==!1),t.$__insertMany=r.createWrapper("insertMany",t.$__insertMany,t,i);for(let s of Object.keys(n))if(r.hasHooks(s)){let o=t[s];t[s]=function(){let a=arguments.length,u=a>0?arguments[a-1]:null,c=typeof u=="function"?u:null,f=Array.prototype.slice.call(arguments,0,c==null?a:a-1);return Uwe(c,h=>{r.execPre(s,t,f,function(d){if(d!=null)return h(d);let p=0,m=o.apply(t,f.concat(y));m!=null&&typeof m.then=="function"&&m.then(g=>y(null,g),g=>y(g));function y(g,w){if(!(p++>0)){if(g!=null)return h(g);r.execPost(s,t,[w],function(S){if(S!=null)return h(S);h(null,w)})}}})},t.events)}}}});var d3=_((A$e,h3)=>{"use strict";h3.exports=function(t,r){for(let n in r.statics)t[n]=r.statics[n]}});var Vy=_((x$e,p3)=>{"use strict";p3.exports=function e(t){return this instanceof e?(this.val=t,this):new e(t)}});var zf=_((q$e,m3)=>{"use strict";m3.exports=new WeakMap});var w3=_((M$e,_3)=>{"use strict";var y3=zf(),Vwe=pe().modelSymbol,Wwe=Ne();_3.exports=g3;function g3(e,t,r,n,i){let s=[],o=n.sort&&e.length>1,a=n.$nullIfNotFound,u,c,f;for(let h=0;h<e.length;++h){if(f=e[h],Array.isArray(f)){g3(f,t,r,n,!0),s.push(f);continue}if(f===null&&!o){s.push(f);continue}if(c=String(f),u=t[c],n.clone&&u!=null)if(n.lean){let d=y3.get(u);u=Wwe.clone(u),y3.set(u,d)}else u=u.constructor.hydrate(u._doc);if(i)if(u)if(o){let d=r[c];Array.isArray(d)&&Array.isArray(u)&&d.length===u.length?s.push(u):s[d]=u}else s.push(u);else f!=null&&f[Vwe]!=null?s.push(f):s.push(n.retainNullValues||a?null:f);else s[h]=u||null}e.length=0,s.length&&s.forEach(function(h,d){e[d]=h})}});var _C=_((N$e,v3)=>{"use strict";v3.exports=gC;function gC(e,t){if(e.virtuals[t])return{virtual:e.virtuals[t],path:void 0};let r=t.split("."),n="",i="";for(let s=0;s<r.length;++s){if(n+=(n.length>0?".":"")+r[s],e.virtuals[n]){if(s===r.length-1)return{virtual:e.virtuals[n],path:i};continue}if(!e.nested[n]){if(e.paths[n]&&e.paths[n].schema){e=e.paths[n].schema;let o=r.slice(s+1).join(".");if(e.virtuals[o]){if(s===r.length-2)return{virtual:e.virtuals[o],nestedSchemaPath:[i,n].filter(a=>!!a).join(".")};continue}if(s+1<r.length&&e.discriminators)for(let a of Object.keys(e.discriminators)){let u=gC(e.discriminators[a],o);if(u!=null){let c=[i,n,u.nestedSchemaPath].filter(f=>!!f).join(".");return{virtual:u.virtual,nestedSchemaPath:c}}}i+=(i.length>0?".":"")+n,n="";continue}if(e.discriminators)for(let o of Object.keys(e.discriminators)){let a=gC(e.discriminators[o],t);if(a)return a}return null}}}});var wC=_(($$e,S3)=>{"use strict";S3.exports=function(t,r,n){return t==null?t:(t._doc!=null&&(t=t._doc),arguments.length>=3?typeof t!="object"||n===void 0?void 0:(t[r]=n,n):r==="$*"?t instanceof Map?Array.from(t.values()):Object.keys(t).map(i=>t[i]):t[r])}});var b3=_((Wy,O3)=>{(function(e,t){typeof Wy=="object"&&typeof O3<"u"?t(Wy):typeof define=="function"&&define.amd?define(["exports"],t):(e=e||self,t(e.sift={}))})(Wy,function(e){"use strict";var t=function(O,T){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function($,U){$.__proto__=U}||function($,U){for(var re in U)U.hasOwnProperty(re)&&($[re]=U[re])},t(O,T)};function r(O,T){t(O,T);function $(){this.constructor=O}O.prototype=T===null?Object.create(T):($.prototype=T.prototype,new $)}var n=function(O){var T="[object "+O+"]";return function($){return i($)===T}},i=function(O){return Object.prototype.toString.call(O)},s=function(O){return O instanceof Date?O.getTime():o(O)?O.map(s):O&&typeof O.toJSON=="function"?O.toJSON():O},o=n("Array"),a=n("Object"),u=n("Function"),c=function(O){return O&&(O.constructor===Object||O.constructor===Array||O.constructor.toString()==="function Object() { [native code] }"||O.constructor.toString()==="function Array() { [native code] }")&&!O.toJSON},f=function(O,T){if(O==null&&O==T||O===T)return!0;if(Object.prototype.toString.call(O)!==Object.prototype.toString.call(T))return!1;if(o(O)){if(O.length!==T.length)return!1;for(var $=0,U=O.length;$<U;$++)if(!f(O[$],T[$]))return!1;return!0}else if(a(O)){if(Object.keys(O).length!==Object.keys(T).length)return!1;for(var re in O)if(!f(O[re],T[re]))return!1;return!0}return!1},h=function(O,T,$,U,re,ke){var Fe=T[U];if(o(O)&&isNaN(Number(Fe))){for(var rt=0,An=O.length;rt<An;rt++)if(!h(O[rt],T,$,U,rt,O))return!1}return U===T.length||O==null?$(O,re,ke):h(O[Fe],T,$,U+1,Fe,O)},d=function(){function O(T,$,U){this.params=T,this.owneryQuery=$,this.options=U,this.init()}return O.prototype.init=function(){},O.prototype.reset=function(){this.done=!1,this.keep=!1},O}(),p=function(O){r(T,O);function T($,U,re,ke){var Fe=O.call(this,$,U,re)||this;return Fe.name=ke,Fe}return T}(d),m=function(O){r(T,O);function T($,U,re,ke){var Fe=O.call(this,$,U,re)||this;return Fe.children=ke,Fe}return T.prototype.reset=function(){this.keep=!1,this.done=!1;for(var $=0,U=this.children.length;$<U;$++)this.children[$].reset()},T.prototype.childrenNext=function($,U,re){for(var ke=!0,Fe=!0,rt=0,An=this.children.length;rt<An;rt++){var Yr=this.children[rt];if(Yr.next($,U,re),Yr.keep||(Fe=!1),Yr.done){if(!Yr.keep)break}else ke=!1}this.done=ke,this.keep=Fe},T}(d),y=function(O){r(T,O);function T($,U,re,ke,Fe){var rt=O.call(this,$,U,re,ke)||this;return rt.name=Fe,rt}return T}(m),g=function(O){r(T,O);function T(){return O!==null&&O.apply(this,arguments)||this}return T.prototype.next=function($,U,re){this.childrenNext($,U,re)},T}(m),w=function(O){r(T,O);function T($,U,re,ke,Fe){var rt=O.call(this,U,re,ke,Fe)||this;return rt.keyPath=$,rt._nextNestedValue=function(An,Yr,qs){return rt.childrenNext(An,Yr,qs),!rt.done},rt}return T.prototype.next=function($,U,re){h($,this.keyPath,this._nextNestedValue,0,U,re)},T}(m),S=function(O,T){if(O instanceof Function)return O;if(O instanceof RegExp)return function(U){var re=typeof U=="string"&&O.test(U);return O.lastIndex=0,re};var $=s(O);return function(U){return T($,s(U))}},v=function(O){r(T,O);function T(){return O!==null&&O.apply(this,arguments)||this}return T.prototype.init=function(){this._test=S(this.params,this.options.compare)},T.prototype.next=function($,U,re){(!Array.isArray(re)||re.hasOwnProperty(U))&&this._test($,U,re)&&(this.done=!0,this.keep=!0)},T}(d),E=function(O,T,$){return new v(O,T,$)},A=function(O){r(T,O);function T(){return O!==null&&O.apply(this,arguments)||this}return T.prototype.next=function(){this.done=!0,this.keep=!1},T}(d),x=function(O){return function(T,$,U,re){return T==null?new A(T,$,U):O(T,$,U,re)}},z=function(O){return x(function(T,$,U){var re=typeof s(T),ke=O(T);return new v(function(Fe){return typeof s(Fe)===re&&ke(Fe)},$,U)})},k=function(O,T,$,U){var re=U.operations[O];if(!re)throw new Error("Unsupported operation: "+O);return re(T,$,U,O)},P=function(O){for(var T in O)if(T.charAt(0)==="$")return!0;return!1},Z=function(O,T,$,U){if(P(T)){var re=b(T,U),ke=re[0],Fe=re[1];if(Fe.length)throw new Error("Property queries must contain only operations, or exact objects.");return new w(O,T,$,U,ke)}return new w(O,T,$,U,[new v(T,$,U)])},F=function(O,T,$){T===void 0&&(T=null);var U=$===void 0?{}:$,re=U.compare,ke=U.operations,Fe={compare:re||f,operations:Object.assign({},ke||{})},rt=b(O,Fe),An=rt[0],Yr=rt[1],qs=[];return An.length&&qs.push(new w([],O,T,Fe,An)),qs.push.apply(qs,Yr),qs.length===1?qs[0]:new g(O,T,Fe,qs)},b=function(O,T){var $=[],U=[];if(!c(O))return $.push(new v(O,O,T)),[$,U];for(var re in O)if(re.charAt(0)==="$"){var ke=k(re,O[re],O,T);ke!=null&&$.push(ke)}else U.push(Z(re.split("."),O[re],O,T));return[$,U]},q=function(O){return function(T,$,U){return O.reset(),O.next(T,$,U),O.keep}},I=function(O,T){return T===void 0&&(T={}),q(F(O,null,T))},K=function(O){r(T,O);function T(){return O!==null&&O.apply(this,arguments)||this}return T.prototype.init=function(){this._test=S(this.params,this.options.compare)},T.prototype.reset=function(){O.prototype.reset.call(this),this.keep=!0},T.prototype.next=function($){this._test($)&&(this.done=!0,this.keep=!1)},T}(p),C=function(O){r(T,O);function T(){return O!==null&&O.apply(this,arguments)||this}return T.prototype.init=function(){this._queryOperation=F(this.params,this.owneryQuery,this.options)},T.prototype.reset=function(){O.prototype.reset.call(this),this._queryOperation.reset()},T.prototype.next=function($){if(o($)){for(var U=0,re=$.length;U<re;U++)this._queryOperation.reset(),this._queryOperation.next($[U],U,$),this.keep=this.keep||this._queryOperation.keep;this.done=!0}else this.done=!1,this.keep=!1},T}(p),R=function(O){r(T,O);function T(){return O!==null&&O.apply(this,arguments)||this}return T.prototype.init=function(){this._queryOperation=F(this.params,this.owneryQuery,this.options)},T.prototype.reset=function(){this._queryOperation.reset()},T.prototype.next=function($,U,re){this._queryOperation.next($,U,re),this.done=this._queryOperation.done,this.keep=!this._queryOperation.keep},T}(p),j=function(O){r(T,O);function T(){return O!==null&&O.apply(this,arguments)||this}return T.prototype.init=function(){},T.prototype.next=function($){o($)&&$.length===this.params&&(this.done=!0,this.keep=!0)},T}(p),H=function(O){r(T,O);function T(){return O!==null&&O.apply(this,arguments)||this}return T.prototype.init=function(){var $=this;this._ops=this.params.map(function(U){return F(U,null,$.options)})},T.prototype.reset=function(){this.done=!1,this.keep=!1;for(var $=0,U=this._ops.length;$<U;$++)this._ops[$].reset()},T.prototype.next=function($,U,re){for(var ke=!1,Fe=!1,rt=0,An=this._ops.length;rt<An;rt++){var Yr=this._ops[rt];if(Yr.next($,U,re),Yr.keep){ke=!0,Fe=Yr.keep;break}}this.keep=Fe,this.done=ke},T}(p),ee=function(O){r(T,O);function T(){return O!==null&&O.apply(this,arguments)||this}return T.prototype.next=function($,U,re){O.prototype.next.call(this,$,U,re),this.keep=!this.keep},T}(H),X=function(O){r(T,O);function T(){return O!==null&&O.apply(this,arguments)||this}return T.prototype.init=function(){var $=this;this._testers=this.params.map(function(U){if(P(U))throw new Error("cannot nest $ under "+$.constructor.name.toLowerCase());return S(U,$.options.compare)})},T.prototype.next=function($,U,re){for(var ke=!1,Fe=!1,rt=0,An=this._testers.length;rt<An;rt++){var Yr=this._testers[rt];if(Yr($)){ke=!0,Fe=!0;break}}this.keep=Fe,this.done=ke},T}(p),Se=function(O){r(T,O);function T(){return O!==null&&O.apply(this,arguments)||this}return T.prototype.next=function($,U,re){O.prototype.next.call(this,$,U,re),this.keep=!this.keep},T}(X),Me=function(O){r(T,O);function T(){return O!==null&&O.apply(this,arguments)||this}return T.prototype.next=function($,U,re){re.hasOwnProperty(U)===this.params&&(this.done=!0,this.keep=!0)},T}(p),_t=function(O){r(T,O);function T($,U,re,ke){return O.call(this,$,U,re,$.map(function(Fe){return F(Fe,U,re)}),ke)||this}return T.prototype.next=function($,U,re){this.childrenNext($,U,re)},T}(y),Ge=function(O,T,$){return new v(O,T,$)},le=function(O,T,$,U){return new K(O,T,$,U)},ve=function(O,T,$,U){return new H(O,T,$,U)},et=function(O,T,$,U){return new ee(O,T,$,U)},wt=function(O,T,$,U){return new C(O,T,$,U)},dt=function(O,T,$,U){return new Se(O,T,$,U)},ci=function(O,T,$,U){return new X(O,T,$,U)},Di=z(function(O){return function(T){return T<O}}),ji=z(function(O){return function(T){return T<=O}}),As=z(function(O){return function(T){return T>O}}),xs=z(function(O){return function(T){return T>=O}}),Bi=function(O,T,$){var U=O[0],re=O[1];return new v(function(ke){return s(ke)%U===re},T,$)},To=function(O,T,$,U){return new Me(O,T,$,U)},Li=function(O,T,$){return new v(new RegExp(O,T.$options),T,$)},ja=function(O,T,$,U){return new R(O,T,$,U)},Tn={number:function(O){return typeof O=="number"},string:function(O){return typeof O=="string"},bool:function(O){return typeof O=="boolean"},array:function(O){return Array.isArray(O)},null:function(O){return O===null},timestamp:function(O){return O instanceof Date}},ki=function(O,T,$){return new v(function(U){if(typeof O=="string"){if(!Tn[O])throw new Error("Type alias does not exist");return Tn[O](U)}return U!=null?U instanceof O||U.constructor===O:!1},T,$)},vt=function(O,T,$,U){return new _t(O,T,$,U)},M=vt,D=function(O,T,$){return new j(O,T,$,"$size")},J=function(){return null},te=function(O,T,$){var U;if(u(O))U=O;else if(!process.env.CSP_ENABLED)U=new Function("obj","return "+O);else throw new Error('In CSP mode, sift does not support strings in "$where" condition');return new v(function(re){return U.bind(re)(re)},T,$)},de=Object.freeze({__proto__:null,$Size:j,$eq:Ge,$ne:le,$or:ve,$nor:et,$elemMatch:wt,$nin:dt,$in:ci,$lt:Di,$lte:ji,$gt:As,$gte:xs,$mod:Bi,$exists:To,$regex:Li,$not:ja,$type:ki,$and:vt,$all:M,$size:D,$options:J,$where:te}),pt=function(O,T,$){var U=$===void 0?{}:$,re=U.compare,ke=U.operations;return F(O,T,{compare:re,operations:Object.assign({},de,ke||{})})},tt=function(O,T){T===void 0&&(T={});var $=pt(O,null,T);return q($)};e.$Size=j,e.$all=M,e.$and=vt,e.$elemMatch=wt,e.$eq=Ge,e.$exists=To,e.$gt=As,e.$gte=xs,e.$in=ci,e.$lt=Di,e.$lte=ji,e.$mod=Bi,e.$ne=le,e.$nin=dt,e.$nor=et,e.$not=ja,e.$options=J,e.$or=ve,e.$regex=Li,e.$size=D,e.$type=ki,e.$where=te,e.EqualsOperation=v,e.createDefaultQueryOperation=pt,e.createEqualsOperation=E,e.createOperationTester=q,e.createQueryOperation=F,e.createQueryTester=I,e.default=tt,Object.defineProperty(e,"__esModule",{value:!0})})});var C3=_((P$e,vC)=>{var E3=b3();vC.exports=E3.default;Object.assign(vC.exports,E3)});var $3=_((I$e,N3)=>{"use strict";var zwe=Vy(),Hwe=w3(),zy=je(),Kwe=_C(),q3=zf(),T3=wC(),SC=ao(),A3=C3().default,EC=Ne();N3.exports=function(t){let r=Object.assign({},zy(t,"allOptions.options.options"),zy(t,"allOptions.options")),n=Object.assign({},t.options,r,{justOne:t.justOne});n.$nullIfNotFound=t.isVirtual;let i=t.populatedModel,s=[].concat(t.rawIds);t.allIds=[].concat(t.allIds),Hwe(t.rawIds,t.rawDocs,t.rawOrder,n);let o=t.docs,a=t.rawIds,u=t.options,c=t.count&&t.isVirtual,f;function h(d){if(c)return d;if(d instanceof zwe)return d.val;if(d===void 0)return d;let p=t.allIds[f];if(t.justOne===!0&&Array.isArray(d)){let m=[];for(let y of d){let g=q3.get(y);(g==null||g===i)&&m.push(y)}for(;d.length>m.length;)Array.prototype.pop.apply(d,[]);for(let y=0;y<m.length;++y)d[y]=m[y];return OC(d[0],u,n,p)}else if(t.justOne===!1&&!Array.isArray(d))return OC([d],u,n,p);return OC(d,u,n,p)}for(f=0;f<o.length;++f){let d=t.path.endsWith(".$*")?t.path.slice(0,-3):t.path,p=SC.get(d,o[f],T3);if(p==null&&!Kwe(t.originalModel.schema,d))continue;let m;c?m=M3(a[f]):Array.isArray(t.match)?m=Array.isArray(a[f])?a[f].filter(A3(t.match[f])):[a[f]].filter(A3(t.match[f]))[0]:m=a[f];let y=t.originalModel.schema,g=zy(o[f],"$__",null)!=null,w=g?p instanceof Map:EC.isPOJO(p);if(w=w&&zy(y._getSchema(d),"$isSchemaMap"),!t.isVirtual&&w){let A=p instanceof Map?Array.from(p.keys()):Object.keys(p);m=m.reduce((x,z,k)=>(x.set(A[k],z),x),new Map)}if(g&&Array.isArray(m))for(let A of m)A!=null&&A.$__!=null&&(A.$__.parent=o[f]);else g&&m!=null&&m.$__!=null&&(m.$__.parent=o[f]);if(t.isVirtual&&g){o[f].populated(d,t.justOne?s[0]:s,t.allOptions),SC.set(d,m,o[f],h);continue}let S=d.split("."),v=o[f],E=S[0];for(let A=0;A<S.length-1&&!(Array.isArray(v)&&!EC.isArrayIndex(S[A])||S[A]==="$*");++A){if(v[S[A]]==null){let x=y._getSchema(E);if(m==null&&x!=null&&x.$isMongooseArray)break;v[S[A]]={}}if(v=v[S[A]],typeof v!="object")break}o[f].$__&&o[f].populated(d,t.allIds[f],t.allOptions),SC.set(d,m,o[f],T3,h,!1)}};function M3(e){return Array.isArray(e)?e.some(t=>Array.isArray(t))?e.map(t=>M3(t)):e.length:e==null?0:1}function OC(e,t,r,n){let i=typeof r.transform=="function",s=i?r.transform:Gwe;if(Array.isArray(e)){let o=[],a=e.length;for(let u=0;u<a;++u){let c=e[u],f=Array.isArray(n)?n[u]:n;if(!(!bC(c)&&(!r.retainNullValues||c!=null)&&!i)&&(i&&(c=s(bC(c)?c:null,f)),x3(c,t),o.push(c),t.originalLimit&&o.length>=t.originalLimit))break}for(;e.length>o.length;)Array.prototype.pop.apply(e,[]);for(let u=0;u<o.length;++u)e[u]=o[u];return e}return bC(e)||EC.isPOJO(e)?(x3(e,t),s(e,n)):e instanceof Map?e:r.justOne===!1?[]:e==null?s(e,n):s(null,n)}function x3(e,t){e!=null&&t.excludeId&&(typeof e.$__setValue=="function"?delete e._doc._id:delete e._id)}function bC(e){return e==null?!1:Array.isArray(e)||e.$isMongooseMap||e.$__!=null||q3.has(e)}function Gwe(e){return e}});var B3=_((R$e,j3)=>{"use strict";var Qwe=xi(),P3=vb(),I3=Sb(),Hf=Yu(),R3=sC(),D3=uC();j3.exports=function(t,r,n){let i=t.base.now();return r.insertOne?s=>{let o=dc(t,r.insertOne.document),a=new o(r.insertOne.document);o.schema.options.timestamps&&a.initializeTimestamps(),n.session!=null&&a.$session(n.session),r.insertOne.document=a,r.insertOne.document.validate({__noPromise:!0},function(u){if(u)return s(u,null);s(null)})}:r.updateOne?s=>{try{if(!r.updateOne.filter)throw new Error("Must provide a filter object.");if(!r.updateOne.update)throw new Error("Must provide an update object.");let o=dc(t,r.updateOne.filter),a=o.schema,u=n.strict!=null?n.strict:o.schema.options.strict;if(Kf(a,r.updateOne.filter),o.schema.$timestamps!=null&&r.updateOne.timestamps!==!1){let c=o.schema.$timestamps.createdAt,f=o.schema.$timestamps.updatedAt;I3(i,c,f,r.updateOne.update,{})}P3(i,r.updateOne.update,o.schema),r.updateOne.setDefaultsOnInsert&&D3(r.updateOne.filter,o.schema,r.updateOne.update,{setDefaultsOnInsert:!0,upsert:r.updateOne.upsert}),r.updateOne.filter=Hf(o.schema,r.updateOne.filter,{strict:u,upsert:r.updateOne.upsert}),r.updateOne.update=R3(o.schema,r.updateOne.update,{strict:u,overwrite:!1,upsert:r.updateOne.upsert},o,r.updateOne.filter)}catch(o){return s(o,null)}s(null)}:r.updateMany?s=>{try{if(!r.updateMany.filter)throw new Error("Must provide a filter object.");if(!r.updateMany.update)throw new Error("Must provide an update object.");let o=dc(t,r.updateMany.filter),a=o.schema,u=n.strict!=null?n.strict:o.schema.options.strict;if(r.updateMany.setDefaultsOnInsert&&D3(r.updateMany.filter,o.schema,r.updateMany.update,{setDefaultsOnInsert:!0,upsert:r.updateMany.upsert}),o.schema.$timestamps!=null&&r.updateMany.timestamps!==!1){let c=o.schema.$timestamps.createdAt,f=o.schema.$timestamps.updatedAt;I3(i,c,f,r.updateMany.update,{})}P3(i,r.updateMany.update,o.schema),Kf(a,r.updateMany.filter),r.updateMany.filter=Hf(o.schema,r.updateMany.filter,{strict:u,upsert:r.updateMany.upsert}),r.updateMany.update=R3(o.schema,r.updateMany.update,{strict:u,overwrite:!1,upsert:r.updateMany.upsert},o,r.updateMany.filter)}catch(o){return s(o,null)}s(null)}:r.replaceOne?s=>{let o=dc(t,r.replaceOne.filter),a=o.schema,u=n.strict!=null?n.strict:o.schema.options.strict;Kf(a,r.replaceOne.filter);try{r.replaceOne.filter=Hf(o.schema,r.replaceOne.filter,{strict:u,upsert:r.replaceOne.upsert})}catch(f){return s(f,null)}let c=new o(r.replaceOne.replacement,u,!0);o.schema.options.timestamps&&c.initializeTimestamps(),n.session!=null&&c.$session(n.session),r.replaceOne.replacement=c,r.replaceOne.replacement.validate({__noPromise:!0},function(f){if(f)return s(f,null);r.replaceOne.replacement=r.replaceOne.replacement.toBSON(),s(null)})}:r.deleteOne?s=>{let o=dc(t,r.deleteOne.filter),a=o.schema;Kf(a,r.deleteOne.filter);try{r.deleteOne.filter=Hf(o.schema,r.deleteOne.filter)}catch(u){return s(u,null)}s(null)}:r.deleteMany?s=>{let o=dc(t,r.deleteMany.filter),a=o.schema;Kf(a,r.deleteMany.filter);try{r.deleteMany.filter=Hf(o.schema,r.deleteMany.filter)}catch(u){return s(u,null)}s(null)}:s=>{s(new Error("Invalid op passed to `bulkWrite()`"),null)}};function Kf(e,t){e!=null&&e.discriminatorMapping&&!e.discriminatorMapping.isRoot&&(t[e.discriminatorMapping.key]=e.discriminatorMapping.value)}function dc(e,t){let r=e.schema.options.discriminatorKey;return t!=null&&t.hasOwnProperty(r)&&(e=Qwe(e.discriminators,t[r])||e),e}});var k3=_((D$e,L3)=>{"use strict";L3.exports=function(t){let r=t.split("."),n="",i=[];for(let s=0;s<r.length;++s)n+=(n.length>0?".":"")+r[s],i.push(n);return i}});var V3=_((j$e,U3)=>{"use strict";var Ywe=Vy(),Jwe=k3();U3.exports=function(t,r,n,i,s){let o=Xwe(r);if(n.size===1){let a=Array.from(n)[0],u=i.schema.path(a);(a!=="_id"||!o._id)&&(t=F3(t,u,s),o[a]={$in:t});let c=Jwe(a);for(let f=0;f<c.length-1;++f){let h=c[f];if(o[h]!=null&&o[h].$elemMatch!=null){o[h].$elemMatch[a.slice(h.length+1)]={$in:t},delete o[a];break}}}else{let a=[];Array.isArray(o.$or)?(o.$and=[{$or:o.$or},{$or:a}],delete o.$or):o.$or=a;for(let u of n)if(u!=="_id"||!o._id){let c=i.schema.path(u);t=F3(t,c,s),a.push({[u]:{$in:t}})}}return o};function F3(e,t,r){return e=e.filter(n=>!(n instanceof Ywe)),r?e.filter(n=>{try{return t.cast(n),!0}catch{return!1}}):e}function Xwe(e){return Array.isArray(e)?e.length>1?{$or:[].concat(e.map(t=>Object.assign({},t)))}:Object.assign({},e[0]):Object.assign({},e)}});var z3=_((B$e,W3)=>{"use strict";function Zwe(){return{result:{ok:1,writeErrors:[],writeConcernErrors:[],insertedIds:[],nInserted:0,nUpserted:0,nMatched:0,nModified:0,nRemoved:0,upserted:[]},insertedCount:0,matchedCount:0,modifiedCount:0,deletedCount:0,upsertedCount:0,upsertedIds:{},insertedIds:{},n:0}}W3.exports=Zwe});var Hy=_((L$e,H3)=>{"use strict";H3.exports=function(t,r,n){if(t.length===0)return n();let i=t.length,s=null;for(let o of t)r(o,function(a){if(s==null){if(a!=null)return s=a,n(s);if(--i<=0)return n()}})}});var G3=_((k$e,K3)=>{"use strict";var eve=oc();K3.exports=function(t,r){if(r==="_id")return t._id===0;let n=Object.keys(t),i=null;for(let s of n)if(eve(t[s])){i=t[r]===1?"inclusive":"exclusive";break}return i==="inclusive"?t[r]!==1:i==="exclusive"?t[r]===0:!1}});var J3=_((F$e,Y3)=>{"use strict";var tve=wa(),rve=je(),Q3=zf(),pc=ao(),nve=pe().populateModelSymbol;Y3.exports=function(t,r,n){let i=t.path(n),s=r;if(i)return i;function o(u,c,f,h){let d=u.length+1,p,m;for(;d--;){if(m=u.slice(0,d).join("."),p=c.path(m),p==null)continue;if(p.caster){if(p.caster instanceof tve)return p.caster;let w=null;if(p.schema!=null&&p.schema.discriminators!=null){let S=p.schema.discriminators,v=m+"."+p.schema.options.discriminatorKey,E=f?pc.get(v,f)||[]:[];w=Object.keys(S).reduce(function(A,x){let z=S[x].discriminatorMapping.value;return(r==null||E.indexOf(x)!==-1||E.indexOf(z)!==-1)&&A.push(S[x]),A},[])}if(d!==u.length&&p.schema){let S;if(u[d]==="$")return d+1===u.length?p:(S=o(u.slice(d+1),c,f?pc.get(m,f):null,h.concat(u.slice(0,d))),S&&(S.$isUnderneathDocArray=S.$isUnderneathDocArray||!p.schema.$isSingleNested),S);if(w!=null&&w.length>0){S=[];for(let v of w){let E=o(u.slice(d),v,f?pc.get(m,f):null,h.concat(u.slice(0,d)));E!=null&&(E.$isUnderneathDocArray=E.$isUnderneathDocArray||!p.schema.$isSingleNested,E.$isUnderneathDocArray&&(S.$isUnderneathDocArray=!0),S.push(E))}return S}else return S=o(u.slice(d),p.schema,f?pc.get(m,f):null,h.concat(u.slice(0,d))),S&&(S.$isUnderneathDocArray=S.$isUnderneathDocArray||!p.schema.$isSingleNested),S}else if(d!==u.length&&p.$isMongooseArray&&p.casterConstructor.$isMongooseArray){let S=p;for(;S.$isMongooseArray&&!S.$isMongooseDocumentArray;)S=S.casterConstructor;let v=o(u.slice(d),S.schema,null,h.concat(u.slice(0,d)));if(v!=null)return v;if(S.schema.discriminators){let E=[];for(let A of Object.keys(S.schema.discriminators)){let x=S.schema.discriminators[A]||S.schema,z=o(u.slice(d),x,null,h.concat(u.slice(0,d)));z!=null&&E.push(z)}if(E.length>0)return E}}}let y=h.concat([m]).join(".");if(s!=null&&s.$__&&s.populated(y)&&d<u.length){let w=r.$__.populated[y].options[nve];if(w!=null){let S=o(u.slice(d),w.schema,f?pc.get(m,f):null,h.concat(u.slice(0,d)));return S&&(S.$isUnderneathDocArray=S.$isUnderneathDocArray||!w.schema.$isSingleNested),S}}let g=rve(s,m);if(g!=null){let w=Array.isArray(g)&&g.length>0?Q3.get(g[0]):Q3.get(g),S=w!=null?w.schema:null;if(S!=null){let v=o(u.slice(d),S,f?pc.get(m,f):null,h.concat(u.slice(0,d)));if(v!=null)return v.$isUnderneathDocArray=v.$isUnderneathDocArray||!S.$isSingleNested,v}}return p}}let a=n.split(".");for(let u=0;u<a.length;++u)a[u]==="$"&&(a[u]="0");return o(a,t,r,[])}});var Z3=_((U$e,X3)=>{"use strict";X3.exports=function(t,r,n){if(t==null)return t;typeof t=="function"&&(t=t.call(r,r,n));let i=/(\.\d+$|\.\d+\.)/g;if(i.test(n)){let s=n.split(i);if(s[s.length-1]==="")throw new Error("Can't populate individual element in an array");let o="",a=t;for(let u=0;u<s.length;u+=2){let c=s[u];if(a.startsWith(c+"."))o+=a.substr(0,c.length)+s[u+1],a=a.substr(c.length+1);else if(u===s.length-1){o+=a,a="";break}else throw new Error("Could not normalize ref path, chunk "+c+" not in populated path")}return o}return t}});var az=_((V$e,oz)=>{"use strict";var CC=Ft(),ive=Vy(),Gr=je(),sve=xi(),ove=G3(),ave=Ur(),ez=J3(),tz=_C(),Ky=wC(),Gy=ao(),Qy=Z3(),uve=require("util"),fn=Ne(),TC=pe().modelSymbol,rz=pe().populateModelSymbol,sz=_a().schemaMixedSymbol;oz.exports=function(t,r,n){let i,s,o=r.length,a={},u=[],c=n.model&&n.model.modelName||n.model,f,h,d,p,m,y,g=n.model,w=!1,S=t.schema,v=ez(S,null,n.path);v=Array.isArray(v)?v:[v].filter(x=>x!=null);let E=v.find(x=>Gr(x,"options.refPath",null)!=null);for(i=0;i<o;i++){s=r[i];let x=null;if(f=ez(S,s,n.path),f!=null&&f.$isMongooseDocumentArray&&f.options.ref==null&&f.options.refPath==null||n._localModel!=null&&n._localModel.schema.nested[n.path])continue;if(f&&f.$isUnderneathDocArray&&Gr(n,"options.sort")!=null)return new CC("Cannot populate with `sort` on path "+n.path+" because it is a subproperty of a document array");m=null;let k=!!E,P=E?Gr(E,"options.refPath",null):null,Z=null;if(Array.isArray(f)){let le=f;for(let ve of le){let et,wt;try{wt=A(s,ve),et=wt.modelNames,k=k||wt.isRefPath,P=Qy(P,s,n.path)||wt.refPath,x=wt.justOne}catch(dt){return dt}if(!(k&&!wt.isRefPath)&&!!et){m=m||[];for(let dt of et)m.indexOf(dt)===-1&&m.push(dt)}}}else{try{let le=A(s,f);m=le.modelNames,k=le.isRefPath,P=le.refPath,x=le.justOne,Z=Gr(f,"options.populate",null)}catch(le){return le}if(!m)continue}let F=tz(t.schema,n.path),b=F==null?null:F.virtual,q,I=!1;if(b&&b.options){let le=F.nestedSchemaPath?F.nestedSchemaPath+".":"";typeof b.options.localField=="function"?q=le+b.options.localField.call(s,s):Array.isArray(b.options.localField)?q=b.options.localField.map(ve=>le+ve):q=le+b.options.localField,I=b.options.count,b.options.skip!=null&&!n.hasOwnProperty("skip")&&(n.skip=b.options.skip),b.options.limit!=null&&!n.hasOwnProperty("limit")&&(n.limit=b.options.limit),b.options.perDocumentLimit!=null&&!n.hasOwnProperty("perDocumentLimit")&&(n.perDocumentLimit=b.options.perDocumentLimit)}else q=n.path;let K=b&&b.options?b.options.foreignField:"_id";if("justOne"in n&&n.justOne!==void 0)x=n.justOne;else if(b&&b.options&&b.options.refPath){let le=Qy(b.options.refPath,s,n.path);x=!!b.options.justOne,w=!0;let ve=fn.getValue(le,s);m=Array.isArray(ve)?ve:[ve]}else if(b&&b.options&&b.options.ref){let le;typeof b.options.ref=="function"?le=b.options.ref.call(s,s):le=b.options.ref,x=!!b.options.justOne,w=!0,m||(m=[].concat(le))}else f&&!f[sz]&&n.path.endsWith("."+f.path)&&(x=Array.isArray(f)?f.every(le=>!le.$isMongooseArray):!f.$isMongooseArray);if(!m)continue;if(b&&(!q||!K))return new CC("If you are populating a virtual, you must set the localField and foreignField options");n.isVirtual=w,n.virtual=b,typeof q=="function"&&(q=q.call(s,s)),typeof K=="function"&&(K=K.call(s));let C=Gr(n,"match",null)||Gr(p,"match",null)||Gr(n,"virtual.options.match",null)||Gr(n,"virtual.options.options.match",null),R=typeof C=="function";if(R&&(C=C.call(s,s)),Array.isArray(q)&&Array.isArray(K)&&q.length===K.length){C=Object.assign({},C);for(let le=1;le<q.length;++le)C[K[le]]=iz(Gy.get(q[le],s,Ky),f),R=!0;q=q[0],K=K[0]}let j=S._getPathType(q),H=j==="real"?S.path(q):j.schema,ee=H&&H.getters?H.getters:[],X,Se=Gr(n,"options",{}),Me="getters"in Se?Se.getters:n.isVirtual&&Gr(b,"options.getters",!1);if(ee.length>0&&Me){let le=s.$__!=null?s:t.hydrate(s),ve=Gy.get(q,s,Ky);if(Array.isArray(ve)){let et=Gy.get(q.split(".").slice(0,-1),le,Ky);X=ve.map((wt,dt)=>H.applyGetters(wt,et[dt]))}else X=H.applyGetters(ve,le)}else X=iz(Gy.get(q,s,Ky),f);let _t=String(fn.getValue(K,s));if(n._docs[_t]=Array.isArray(X)?X.slice():X,k&&P!=null){let le=P.split("."),ve="";for(let et=0;et<le.length;++et){let wt=le[et];ve=ve+(ve.length===0?"":".")+wt;let dt=S.path(ve);if(dt!=null&&dt.$isMongooseArray&&dt.caster.discriminators!=null&&Object.keys(dt.caster.discriminators).length>0){let ci=fn.getValue(ve,s),Di=n.path.substr(ve.length+1),ji=dt.caster.schema.options.discriminatorKey;m=[];for(let As of ci){let xs=fn.getValue(ji,As),Bi=dt.caster.discriminators[xs],To=Bi&&Bi.schema;if(To==null)continue;let Li=To.path(Di);if(Li==null||Li.options.refPath==null){let Tn=fn.getValue(q.substr(ve.length+1),As);X=X.map(ki=>ki===Tn?ive(ki):ki);continue}let ja=fn.getValue(le.slice(et+1).join("."),As);m.push(ja)}}}}let Ge=m.length;for(;Ge--;){if(y=m[Ge],y==null)continue;let le=n.connection!=null?n.connection:t.db;try{d=g&&g[TC]?g:y[TC]?y:le.model(y)}catch(wt){if(X!==void 0)return wt}let ve=X,et=Array.isArray(X)?fn.array.flatten(X):[];k&&Array.isArray(X)&&et.length===m.length&&(ve=et.filter((wt,dt)=>m[dt]===y)),!a[y]||p.perDocumentLimit!=null||Gr(p,"options.perDocumentLimit")!=null?(p={model:d},w&&Gr(b,"options.options")?p.options=fn.clone(b.options.options):Z!=null&&(p.options=Object.assign({},Z)),fn.merge(p,n),n[rz]=d,a[y]={model:d,options:p,match:R?[C]:C,docs:[s],ids:[ve],allIds:[X],localField:new Set([q]),foreignField:new Set([K]),justOne:x,isVirtual:w,virtual:b,count:I,[rz]:d},u.push(a[y])):(a[y].localField.add(q),a[y].foreignField.add(K),a[y].docs.push(s),a[y].ids.push(ve),a[y].allIds.push(X),R&&a[y].match.push(C))}}return u;function A(x,z){let k,P,Z=!1,F=null;z&&z.caster&&(z=z.caster),z&&z.$isSchemaMap&&(z=z.$__schemaType),!z&&t.discriminators&&(P=t.schema.discriminatorMapping.key),h=z&&z.options&&z.options.refPath;let b=Qy(h,x,n.path);if(c)k=[c];else if(b){if(n._queryProjection!=null&&ove(n._queryProjection,b))throw new CC("refPath `"+b+"` must not be excluded in projection, got "+uve.inspect(n._queryProjection));S.virtuals.hasOwnProperty(b)&&x.$__==null?k=[S.virtuals[b].applyGetters(void 0,x)]:k=fn.getValue(b,x),Array.isArray(k)&&(k=fn.array.flatten(k)),Z=!0}else{let q=t,I,K;if(!z&&P&&(K=fn.getValue(P,x))){let ee=sve(t.discriminators,K)||t;if(ee!=null)q=ee;else try{q=t.db.model(K)}catch(X){return X}I=q.schema._getSchema(n.path),I&&I.caster&&(I=I.caster)}else I=z;let C=tz(q.schema,n.path),R=C==null?null:C.virtual;I!=null&&(F=!I.$isMongooseArray&&!I._arrayPath);let j,H;(j=Gr(I,"options.ref"))!=null?(j=nz(j,x),k=[j]):(j=Gr(R,"options.ref"))!=null?(j=nz(j,x),Array.isArray(j)?k=j:k=[j],w=!0):(H=Gr(I,"options.refPath"))!=null?(Z=!0,H=Qy(H,x,n.path),k=fn.getValue(H,x),Array.isArray(k)&&(k=fn.array.flatten(k))):k=P?null:[t.modelName]}return k?(Array.isArray(k)||(k=[k]),{modelNames:k,isRefPath:Z,refPath:b,justOne:F}):{modelNames:k,isRefPath:Z,refPath:b,justOne:F}}};function nz(e,t){return typeof e=="function"&&!e[TC]?e.call(t,t):e}function iz(e,t){if(e!=null&&e.$__!=null||e!=null&&e._id!=null&&(t==null||!t.$isSchemaMap))return e._id;if(Array.isArray(e)){for(let r=0;r<e.length;++r)e[r]!=null&&e[r].$__!=null&&(e[r]=e[r]._id);return e.isMongooseArray&&e.$schema()?e.$schema()._castForPopulate(e,e.$parent()):[].concat(e)}if(ave(e)==="Object"&&(t==null||t[sz]==null)){let r=[];for(let n of Object.keys(e))r.push(e[n]);return r}return e instanceof Map?Array.from(e.values()):e}});var cz=_((W$e,uz)=>{"use strict";var cve=je();uz.exports=function(t){if(Array.isArray(t)){let n=Object.keys(t[0]);return n.length===1&&n[0]==="_id"&&t[0]._id!=="hashed"}if(typeof t!="object")return!1;let r=cve(t,"key",{});return Object.keys(r).length===1&&r.hasOwnProperty("_id")}});var hz=_((z$e,fz)=>{"use strict";var Yy=je(),lz=Ne();fz.exports=function(t,r,n){if(n.textIndexVersion!=null){let a=n.weights;if(Object.keys(a).length!==Object.keys(t).length)return!1;for(let u of Object.keys(a)){if(!(u in t))return!1;let c=a[u];if(c!==Yy(r,"weights."+u)&&!(c===1&&Yy(r,"weights."+u)==null))return!1}return r.default_language!==n.default_language?n.default_language==="english"&&r.default_language==null:!0}let i=["unique","partialFilterExpression","sparse","expireAfterSeconds","collation"];for(let a of i)if(!(!(a in r)&&!(a in n))){if(a==="collation"){if(r[a]==null||n[a]==null)return r[a]==null&&n[a]==null;let u=Object.keys(r.collation),c=r.collation,f=n.collation;for(let h of u)if(Yy(c,h)!==Yy(f,h))return!1}else if(!lz.deepEqual(r[a],n[a]))return!1}let s=Object.keys(t),o=Object.keys(n.key);if(s.length!==o.length)return!1;for(let a=0;a<s.length;++a)if(s[a]!==o[a]||!lz.deepEqual(t[s[a]],n.key[o[a]]))return!1;return!0}});var pz=_((H$e,dz)=>{"use strict";dz.exports=function(t,r){let n=r.split("."),i="",s,o,a;for(let u=0;u<n.length;++u)if(i+=i.length?".":""+n[u],t[i]){for(o=Object.keys(t),a=o.length,s=0;s<a;++s)o[u].indexOf(i+".")===0&&o[u].indexOf(r);return!0}return!1}});var yz=_((K$e,mz)=>{"use strict";mz.exports=lve;function lve(e,t,r){let n=0,i=0,s=null;if(t<=0)throw new Error("Limit must be positive");if(e.length===0)return r(null,[]);for(let c=0;c<e.length&&c<t;++c)o();function o(){e[i+n](u(i+n)),++n}let a=[];function u(c){return(f,h)=>{if(--n,++i,s==null){if(f!=null)return s=f,r(s);if(a[c]=h,i===e.length)return r(null,a);i+n<e.length&&o()}}}}});var Sz=_((G$e,vz)=>{"use strict";var gz=je(),_z=ao(),wz=aC();vz.exports=function(t,r,n){let i=wz(gz(r,"select",null),!0)||wz(gz(r,"options.select",null),!0);if(i!=null){for(let s of t)if(!!i.hasOwnProperty("-"+s))for(let o of n)o.$__!=null?_z.unset(s,o._doc):_z.unset(s,o)}}});var Dz=_((Iz,Rz)=>{"use strict";var fve=pC(),hve=UE(),$a=Un(),Cz=qm(),dve=ob(),qC=require("events").EventEmitter,pve=iy(),Nr=Ft(),mve=sb(),yve=ff(),AC=Fy(),gve=s3(),_ve=a3(),IC=Ju(),wve=VE(),xC=co(),Tz=nb(),Oz=ib(),vve=Hm(),Sve=Gm(),Az=c3(),Ove=f3(),xz=d3(),qz=JE(),bve=$3(),Eve=B3(),Cve=V3(),Tve=z3(),Ave=py(),xve=Hy(),Qt=je(),qve=Ur(),Mz=xi(),Mve=az(),Pa=Cr(),MC=Ss().internalToObjectOptions,Jy=cz(),NC=hz(),Nve=pz(),$ve=zf(),Pve=XE(),Ive=yz(),Rve=Sz(),$C=require("util"),Pe=Ne(),Xy=1,yc=2,Gf=Xy|yc,RC=pe().arrayAtomicsSymbol,Yf=Symbol("mongoose#Model#collection"),DC=Symbol("mongoose#Model#db"),Nz=pe().modelSymbol,Qf=Symbol("mongoose#Model#subclassed"),Dve=Object.assign({},MC,{bson:!0});function G(e,t,r){if(t instanceof IC)throw new TypeError("2nd argument to `Model` must be a POJO or string, **not** a schema. Make sure you're calling `mongoose.model()`, not `mongoose.Model()`.");$a.call(this,e,t,r)}G.prototype.__proto__=$a.prototype;G.prototype.$isMongooseModelPrototype=!0;G.prototype.db;G.prototype.collection;G.prototype.$__collection;G.prototype.modelName;G.prototype.$where;G.prototype.baseModelName;G.events;G._middleware;function jC(e,t){if(e.$where!=null)for(let r of Object.keys(e.$where))t[r]=e.$where[r]}G.prototype.$__handleSave=function(e,t){let r=this,n={};"safe"in e&&$z(e),qz(this.$__schema,e),typeof e.writeConcern<"u"?(n.writeConcern={},"w"in e.writeConcern&&(n.writeConcern.w=e.writeConcern.w),"j"in e.writeConcern&&(n.writeConcern.j=e.writeConcern.j),"wtimeout"in e.writeConcern&&(n.writeConcern.wtimeout=e.writeConcern.wtimeout)):("w"in e&&(n.w=e.w),"j"in e&&(n.j=e.j),"wtimeout"in e&&(n.wtimeout=e.wtimeout)),"checkKeys"in e&&(n.checkKeys=e.checkKeys);let i=this.$session();if(n.hasOwnProperty("session")||(n.session=i),Object.keys(n).length===0&&(n=null),this.isNew){let s=this.toObject(Dve);if((s||{})._id===void 0){Pa(function(){t(new Nr("document must have an _id before saving"))});return}this.$__version(!0,s),this[Yf].insertOne(s,n,function(o,a){if(o){mc(r,!0),t(o,null);return}t(null,a)}),this.$__reset(),mc(this,!1),this.$__.inserting=!0}else{this.$__.inserting=!1;let s=this.$__delta();if(s){if(s instanceof Nr){t(s);return}let o=this.$__where(s[0]);if(o instanceof Nr){t(o);return}jC(this,o),this[Yf].updateOne(o,s[1],n,(a,u)=>{if(a){this.$__undoReset(),t(a);return}u.$where=o,t(null,u)})}else{let o=Object.assign({},e,n),a=this.$__where();if(this.$__schema.options.optimisticConcurrency){let u=this.$__schema.options.versionKey,c=this.$__getValue(u);c!=null&&(a[u]=c)}this.constructor.exists(a,o).then(u=>{if(!u)throw new Cz(this.$__where(),this.constructor.modelName);t()}).catch(t);return}this.$__.modifiedPaths=this.modifiedPaths(),this.$__reset(),mc(this,!1)}};G.prototype.$__save=function(e,t){this.$__handleSave(e,(r,n)=>{let i=this.$__schema.s.hooks;if(r)return i.execPost("save:error",this,[this],{error:r},o=>{t(o,this)});let s=0;if(Qt(e,"safe.w")!==0&&Qt(e,"w")!==0){if(n&&(Array.isArray(n)?s=n.length:n.result&&n.result.n!==void 0?s=n.result.n:n.result&&n.result.nModified!==void 0?s=n.result.nModified:s=n),this.$__.version&&!this.$__.inserting){let o=yc===(yc&this.$__.version);this.$__.version=void 0;let a=this.$__schema.options.versionKey,u=this.$__getValue(a)||0;if(s<=0){this.$__undoReset();let c=this.$__.$versionError||new Tz(this,u,this.$__.modifiedPaths);return t(c)}o&&this.$__setValue(a,u+1)}if(n!=null&&s<=0)return this.$__undoReset(),r=new Cz(n.$where,this.constructor.modelName,s,n),i.execPost("save:error",this,[this],{error:r},o=>{t(o,this)})}this.$__.saving=void 0,this.$__.savedState={},this.emit("save",this,s),this.constructor.emit("save",this,s),t(null,this)})};function jve(e,t){let r=e.$__schema.options.versionKey;if(!r)return null;let n=e.$__getValue(r)||0;return new Tz(e,n,t)}G.prototype.save=function(e,t){let r;return this.$op="save",this.$__.saving?r=new Oz(this):this.$__.saving=new Oz(this),typeof e=="function"&&(t=e,e=void 0),e=new _ve(e),e.hasOwnProperty("session")&&this.$session(e.session),this.$__.$versionError=jve(this,this.modifiedPaths()),t=this.constructor.$handleCallbackError(t),this.constructor.db.base._promiseOrCallback(t,n=>{if(n=this.constructor.$wrapCallback(n),r)return this.$__handleReject(r),n(r);this.$__.saveOptions=e,this.$__save(e,i=>{if(this.$__.saving=void 0,delete this.$__.saveOptions,delete this.$__.$versionError,this.$op=null,i)return this.$__handleReject(i),n(i);n(null,this)})},this.constructor.events)};function Bve(e,t){let r=e.$__schema.options.skipVersioning;return r?(t=t.replace(/\.\d+\./,"."),r[t]):!1}function Na(e,t,r,n,i,s){if(s||(s="$set"),r[s]||(r[s]={}),r[s][n.path]=i,e.$__schema.options.versionKey!==!1&&!Bve(e,n.path)&&Gf!==(Gf&e.$__.version)){if(e.$__schema.options.optimisticConcurrency){e.$__.version=Gf;return}switch(s){case"$set":case"$unset":case"$pop":case"$pull":case"$pullAll":case"$push":case"$addToSet":break;default:return}s==="$push"||s==="$addToSet"||s==="$pullAll"||s==="$pull"?e.$__.version=yc:/^\$p/.test(s)||Array.isArray(i)?PC.call(e):/\.\d+\.|\.\d+$/.test(n.path)&&(e.$__.version=Xy)}}function Lve(e,t,r,n,i){if(r.$set&&r.$set[n.path])return;if(typeof i.$__getAtomics=="function"){i.$__getAtomics().forEach(function(h){let d=h[0],p=h[1];Na(e,t,r,n,p,d)});return}let s=i[RC],o=Object.keys(s),a=o.length,u,c;if(a===0)return Pe.isMongooseObject(i)?i=i.toObject({depopulate:1,_isNested:!0}):i.valueOf&&(i=i.valueOf()),Na(e,t,r,n,i);function f(h){return Pe.isMongooseObject(h)?h.toObject({depopulate:1,_isNested:!0}):h}for(;a--;)c=o[a],u=s[c],Pe.isMongooseObject(u)?u=u.toObject({depopulate:!0,transform:!1,_isNested:!0}):Array.isArray(u)?u=u.map(f):u.valueOf&&(u=u.valueOf()),c==="$addToSet"&&(u={$each:u}),Na(e,t,r,n,u,c)}G.prototype.$__delta=function(){let e=this.$__dirty();if(!e.length&&Gf!==this.$__.version)return;let t={},r={},n=e.length,i=[],s=0;for(t._id=this._doc._id,Qt(t,"_id.$__",null)!=null&&(t._id=t._id.toObject({transform:!1,depopulate:!0}));s<n;++s){let o=e[s],a=o.value,u=kve(this,o.path,a);if(u){i.push(u);continue}if(!this.populated(o.path,!0)&&this.$__.selected){let f=o.path.split("."),h=f[0];if(this.$__.selected[h]&&this.$__.selected[h].$elemMatch)if(f.length>1&&f[1]==0&&typeof t[h]>"u")t[h]=this.$__.selected[h],f[1]="$",o.path=f.join(".");else{i.push(o.path);continue}}i.length||(a===void 0?Na(this,t,r,o,1,"$unset"):a===null?Na(this,t,r,o,null):a.isMongooseArray&&a.$path()&&a[RC]?Lve(this,t,r,o,a):a[pve.pathSymbol]&&Buffer.isBuffer(a)?(a=a.toObject(),Na(this,t,r,o,a)):(a=Pe.clone(a,{depopulate:!0,transform:!1,virtuals:!1,getters:!1,_isNested:!0}),Na(this,t,r,o,a)))}return i.length?new dve(i):(this.$__.version&&this.$__version(t,r),[t,r])};function kve(e,t,r){let n=e.populated(t,!0);if(!n&&e.$__.selected){let s=t.split(".")[0];if(e.$__.selected[s+".$"])return s}if(!(n&&r&&r.isMongooseArray))return;if(n.options.match||n.options.options&&Pe.object.hasOwnProperty(n.options.options,"limit")||n.options.options&&n.options.options.skip||n.options.select&&(n.options.select._id===0||/\s?-_id\s?/.test(n.options.select))){let s=r[RC];if(Object.keys(s).length===0||s.$set||s.$pop)return t}}G.prototype.$__version=function(e,t){let r=this.$__schema.options.versionKey;if(e===!0){r&&this.$__setValue(r,t[r]=0);return}if(!!this.$__isSelected(r)){if(Xy===(Xy&this.$__.version)){let n=this.$__getValue(r);n!=null&&(e[r]=n)}yc===(yc&this.$__.version)&&(Qt(t.$set,r,null)!=null?++t.$set[r]:(t.$inc=t.$inc||{},t.$inc[r]=1))}};function PC(){return this.$__.version=Gf,this}G.prototype.increment=PC;G.prototype.$__where=function(t){return t||(t={}),t._id||(t._id=this._doc._id),this._doc._id===void 0?new Nr("No _id found on document!"):t};G.prototype.remove=function(t,r){return typeof t=="function"&&(r=t,t=void 0),t=new gve(t),t.hasOwnProperty("session")&&this.$session(t.session),this.$op="remove",r=this.constructor.$handleCallbackError(r),this.constructor.db.base._promiseOrCallback(r,n=>{n=this.constructor.$wrapCallback(n),this.$__remove(t,(i,s)=>{this.$op=null,n(i,s)})},this.constructor.events)};G.prototype.delete=G.prototype.remove;G.prototype.deleteOne=function(t,r){return typeof t=="function"&&(r=t,t=void 0),t||(t={}),r=this.constructor.$handleCallbackError(r),this.constructor.db.base._promiseOrCallback(r,n=>{n=this.constructor.$wrapCallback(n),this.$__deleteOne(t,n)},this.constructor.events)};G.prototype.$__remove=function(t,r){if(this.$__.isDeleted)return Pa(()=>r(null,this));let n=this.$__where();if(n instanceof Nr)return r(n);jC(this,n);let i=this.$session();t.hasOwnProperty("session")||(t.session=i),this[Yf].deleteOne(n,t,s=>{if(!s)return this.$__.isDeleted=!0,this.emit("remove",this),this.constructor.emit("remove",this),r(null,this);this.$__.isDeleted=!1,r(s)})};G.prototype.$__deleteOne=G.prototype.$__remove;G.prototype.model=function(t){return this[DC].model(t)};G.exists=function(t,r,n){Ee(this,"exists"),typeof r=="function"&&(n=r,r=null);let i=this.findOne(t).select({_id:1}).lean().setOptions(r);if(typeof n=="function"){i.exec(function(s,o){if(s!=null)return n(s);n(null,!!o)});return}return r=r||{},r.explain?i.exec():i.then(s=>!!s)};G.discriminator=function(e,t,r){let n;if(typeof e=="function"&&(n=e,e=Pe.getFunctionName(n),!(n.prototype instanceof G)))throw new Nr("The provided class "+e+" must extend Model");if(Ee(this,"discriminator"),Pe.isObject(t)&&!t.instanceOfSchema&&(t=new IC(t)),t=Ave(this,e,t,r,!0),this.db.models[e])throw new mve(e);t.$isRootDiscriminator=!0,t.$globalPluginsApplied=!0,n=this.db.model(n||e,t,this.$__collection.name),this.discriminators[e]=n;let i=this.discriminators[e];if(i.prototype.__proto__=this.prototype,Object.defineProperty(i,"baseModelName",{value:this.modelName,configurable:!0,writable:!1}),Az(i,t),xz(i,t),this[Qf]!=null)for(let s of this[Qf])s.discriminators=s.discriminators||{},s.discriminators[e]=n.__subclass(n.db,t,s.collection.name);return i};function Ee(e,t){if(e==null||e===global)throw new Nr("`Model."+t+"()` cannot run without a model as `this`. Make sure you are calling `MyModel."+t+"()` where `MyModel` is a Mongoose model.");if(e[Nz]==null)throw new Nr("`Model."+t+"()` cannot run without a model as `this`. Make sure you are not calling `new Model."+t+"()`")}for(let e in qC.prototype)G[e]=qC.prototype[e];G.init=function(t){if(Ee(this,"init"),this.schema.emit("init",this),this.$init!=null)return t?(this.$init.then(()=>t(),a=>t(a)),null):this.$init;let r=yve.get(),n=Pe.getOption("autoIndex",this.schema.options,this.db.config,this.db.base.options),i=Pe.getOption("autoCreate",this.schema.options,this.db.config,this.db.base.options),s=n?a=>this.ensureIndexes({_automatic:!0},a):a=>a(),o=i?a=>this.createCollection({},a):a=>a();if(this.$init=new r((a,u)=>{o(c=>{if(c)return u(c);s(f=>{if(f)return u(f);a(this)})})}),t)return this.$init.then(()=>t(),a=>t(a)),this.$caught=!0,null;{let a=this.$init.catch,u=this;this.$init.catch=function(){return this.$caught=!0,a.apply(u.$init,arguments)}}return this.$init};G.createCollection=function(t,r){if(Ee(this,"createCollection"),typeof t=="string")throw new Nr("You can't specify a new collection name in Model.createCollection.This is not like Connection.createCollection. Only options are accepted here.");typeof t=="function"&&(r=t,t=null);let n=Qt(this,"schema.options.collation",null);return n!=null&&(t=Object.assign({collation:n},t)),r=this.$handleCallbackError(r),this.db.base._promiseOrCallback(r,i=>{i=this.$wrapCallback(i),this.db.createCollection(this.$__collection.collectionName,t,Pe.tick(s=>{if(s!=null&&(s.name!=="MongoError"||s.code!==48))return i(s);this.$__collection=this.db.collection(this.$__collection.collectionName,t),i(null,this.$__collection)}))},this.events)};G.syncIndexes=function(t,r){return Ee(this,"syncIndexes"),r=this.$handleCallbackError(r),this.db.base._promiseOrCallback(r,n=>{n=this.$wrapCallback(n),this.createCollection(i=>{if(i!=null&&(i.name!=="MongoError"||i.code!==48))return n(i);this.cleanIndexes((s,o)=>{if(s!=null)return n(s);this.createIndexes(t,a=>{if(a!=null)return n(a);n(null,o)})})})},this.events)};G.diffIndexes=function(t,r){let n=[],i=[];return r=this.$handleCallbackError(r),this.db.base._promiseOrCallback(r,s=>{s=this.$wrapCallback(s),this.listIndexes((o,a)=>{let u=this.schema.indexes();for(let c of a){let f=!1;if(!Jy(c)){for(let h of u){let d=h[0],p=Zy(this,Pe.clone(h[1]));NC(d,p,c)&&(f=!0)}f||n.push(c.name)}}for(let c of u){let f=c[0],h=!1,d=Zy(this,Pe.clone(c[1]));for(let p of a)Jy(p)||NC(f,d,p)&&(h=!0);h||i.push(f)}s(null,{toDrop:n,toCreate:i})})})};G.cleanIndexes=function(t){return Ee(this,"cleanIndexes"),t=this.$handleCallbackError(t),this.db.base._promiseOrCallback(t,r=>{let n=this.$__collection;this.listIndexes((s,o)=>{if(s!=null)return r(s);let a=this.schema.indexes(),u=[];for(let c of o){let f=!1;if(!Jy(c)){for(let h of a){let d=h[0],p=Zy(this,Pe.clone(h[1]));NC(d,p,c)&&(f=!0)}f||u.push(c.name)}}if(u.length===0)return r(null,[]);i(u,r)});function i(s,o){let a=s.length,u=!1;s.forEach(c=>{n.dropIndex(c,f=>{if(f!=null)return u=!0,o(f);u||--a||o(null,s)})})}})};G.listIndexes=function(t){Ee(this,"listIndexes");let r=n=>{this.$__collection.listIndexes().toArray(n)};return t=this.$handleCallbackError(t),this.db.base._promiseOrCallback(t,n=>{n=this.$wrapCallback(n),this.$__collection.buffer?this.$__collection.addQueue(r,[n]):r(n)},this.events)};G.ensureIndexes=function(t,r){return Ee(this,"ensureIndexes"),typeof t=="function"&&(r=t,t=null),r=this.$handleCallbackError(r),this.db.base._promiseOrCallback(r,n=>{n=this.$wrapCallback(n),Fve(this,t||{},i=>{if(i)return n(i);n(null)})},this.events)};G.createIndexes=function(t,r){return Ee(this,"createIndexes"),typeof t=="function"&&(r=t,t={}),t=t||{},t.createIndex=!0,this.ensureIndexes(t,r)};function Fve(e,t,r){let n=e.schema.indexes(),i;t=t||{};let s=function(h){h&&!e.$caught&&e.emit("error",h),e.emit("index",h||i),r&&r(h||i)};for(let h of n)Jy(h)&&console.warn('mongoose: Cannot specify a custom index on `_id` for model name "'+e.modelName+'", MongoDB does not allow overwriting the default `_id` index. See http://bit.ly/mongodb-id-index');if(!n.length){Pa(function(){s()});return}let o=function(h,d,p,m){e.emit("index-single-done",h,d,p,m)},a=function(h,d){e.emit("index-single-start",h,d)},u=e.schema._baseSchema,c=u?u.indexes():[],f=function(){if(t._automatic&&(e.schema.options.autoIndex===!1||e.schema.options.autoIndex==null&&e.db.config.autoIndex===!1))return s();let h=n.shift();if(!h)return s();if(t._automatic&&h[1]._autoIndex===!1||c.find(w=>Pe.deepEqual(w,h)))return f();let d=Pe.clone(h[0]),p=Pe.clone(h[1]),m=!1;for(let w of Object.keys(d))d[w]==="text"&&(m=!0);delete p._autoIndex,Zy(e,p),"safe"in t&&$z(t),qz(e.schema,p),a(d,t);let y=!!e.base.options.useCreateIndex;"useCreateIndex"in e.db.config&&(y=!!e.db.config.useCreateIndex),"createIndex"in t&&(y=!!t.createIndex),"background"in t&&(p.background=t.background),e.schema.options.hasOwnProperty("collation")&&!p.hasOwnProperty("collation")&&!m&&(p.collation=e.schema.options.collation);let g=y?"createIndex":"ensureIndex";e.collection[g](d,p,Pe.tick(function(w,S){o(w,d,p,S),w&&(i||(i=w),e.$caught||e.emit("error",w)),f()}))};Pa(function(){t._automatic&&!e.collection.collection?e.collection.addQueue(f,[]):f()})}function Zy(e,t){if(e.baseModelName!=null&&!("partialFilterExpression"in t)&&!("sparse"in t)){let r=e.schema.discriminatorMapping&&e.schema.discriminatorMapping.value||e.modelName,n=e.schema.options.discriminatorKey;t.partialFilterExpression={[n]:r}}return t}var Uve="Mongoose: the `safe` option for `save()` is deprecated. Use the `w` option instead: http://bit.ly/mongoose-save",$z=$C.deprecate(function(t){t.safe&&(typeof t.safe=="boolean"&&(t.w=t.safe,delete t.safe),typeof t.safe=="object"&&(t.w=t.safe.w,t.j=t.safe.j,t.wtimeout=t.safe.wtimeout,delete t.safe))},Uve);G.schema;G.db;G.collection;G.$__collection;G.base;G.discriminators;G.translateAliases=function(t){Ee(this,"translateAliases");let r=(n,i)=>{let s,o=[],a=n.split("."),u=this.schema;for(let f in a){let h=a[f];u&&u.aliases[h]?(s=u.aliases[h],o.push(s)):o.push(h),u&&u.paths[s]?u=u.paths[s].schema:u=null}let c=o.join(".");return t instanceof Map?t.set(c,i):t[c]=i,c!==n&&(t instanceof Map?t.delete(n):delete t[n]),t};if(typeof t=="object"){if(t instanceof Map)for(let n of new Map(t))t=r(n[0],n[1]);else for(let n of Object.keys(t))if(t=r(n,t[n]),n[0]==="$"&&Array.isArray(t[n]))for(let i in t[n])t[n][i]=this.translateAliases(t[n][i]);return t}else return t};G.remove=function(t,r,n){Ee(this,"remove"),typeof t=="function"?(n=t,t={},r=null):typeof r=="function"&&(n=r,r=null);let i=new this.Query({},{},this,this.$__collection);return i.setOptions(r),n=this.$handleCallbackError(n),i.remove(t,n)};G.deleteOne=function(t,r,n){Ee(this,"deleteOne"),typeof t=="function"?(n=t,t={},r=null):typeof r=="function"&&(n=r,r=null);let i=new this.Query({},{},this,this.$__collection);return i.setOptions(r),n=this.$handleCallbackError(n),i.deleteOne(t,n)};G.deleteMany=function(t,r,n){Ee(this,"deleteMany"),typeof t=="function"?(n=t,t={},r=null):typeof r=="function"&&(n=r,r=null);let i=new this.Query({},{},this,this.$__collection);return i.setOptions(r),n=this.$handleCallbackError(n),i.deleteMany(t,n)};G.find=function(t,r,n,i){Ee(this,"find"),typeof t=="function"?(i=t,t={},r=null,n=null):typeof r=="function"?(i=r,r=null,n=null):typeof n=="function"&&(i=n,n=null);let s=new this.Query({},{},this,this.$__collection);return s.select(r),s.setOptions(n),this.schema.discriminatorMapping&&this.schema.discriminatorMapping.isRoot&&s.selectedInclusively()&&s.select(this.schema.options.discriminatorKey),i=this.$handleCallbackError(i),s.find(t,i)};G.findById=function(t,r,n,i){return Ee(this,"findById"),typeof t>"u"&&(t=null),i=this.$handleCallbackError(i),this.findOne({_id:t},r,n,i)};G.findOne=function(t,r,n,i){Ee(this,"findOne"),typeof n=="function"?(i=n,n=null):typeof r=="function"?(i=r,r=null,n=null):typeof t=="function"&&(i=t,t={},r=null,n=null);let s=new this.Query({},{},this,this.$__collection);return s.select(r),s.setOptions(n),this.schema.discriminatorMapping&&this.schema.discriminatorMapping.isRoot&&s.selectedInclusively()&&s.select(this.schema.options.discriminatorKey),i=this.$handleCallbackError(i),s.findOne(t,i)};G.estimatedDocumentCount=function(t,r){Ee(this,"estimatedDocumentCount");let n=new this.Query({},{},this,this.$__collection);return r=this.$handleCallbackError(r),n.estimatedDocumentCount(t,r)};G.countDocuments=function(t,r){Ee(this,"countDocuments"),typeof t=="function"&&(r=t,t={});let n=new this.Query({},{},this,this.$__collection);return r=this.$handleCallbackError(r),n.countDocuments(t,r)};G.count=function(t,r){Ee(this,"count"),typeof t=="function"&&(r=t,t={});let n=new this.Query({},{},this,this.$__collection);return r=this.$handleCallbackError(r),n.count(t,r)};G.distinct=function(t,r,n){Ee(this,"distinct");let i=new this.Query({},{},this,this.$__collection);return typeof r=="function"&&(n=r,r={}),n=this.$handleCallbackError(n),i.distinct(t,r,n)};G.where=function(t,r){Ee(this,"where");let n=new this.Query({},{},this,this.$__collection).find({});return n.where.apply(n,arguments)};G.$where=function(){Ee(this,"$where");let t=new this.Query({},{},this,this.$__collection).find({});return t.$where.apply(t,arguments)};G.findOneAndUpdate=function(e,t,r,n){if(Ee(this,"findOneAndUpdate"),typeof r=="function")n=r,r=null;else if(arguments.length===1){if(typeof e=="function"){let o=`Model.findOneAndUpdate(): First argument must not be a function.

  `+this.modelName+`.findOneAndUpdate(conditions, update, options, callback)
  `+this.modelName+`.findOneAndUpdate(conditions, update, options)
  `+this.modelName+`.findOneAndUpdate(conditions, update)
  `+this.modelName+`.findOneAndUpdate(update)
  `+this.modelName+`.findOneAndUpdate()
`;throw new TypeError(o)}t=e,e=void 0}n=this.$handleCallbackError(n);let i;r&&(i=r.fields||r.projection),t=Pe.clone(t,{depopulate:!0,_isNested:!0}),Pz(t,r,this.schema.options.versionKey);let s=new this.Query({},{},this,this.$__collection);return s.select(i),s.findOneAndUpdate(e,t,r,n)};function Pz(e,t,r){if(!r||!Qt(t,"upsert",!1))return;Pve(e)[r]||(t.overwrite?e[r]=0:(e.$setOnInsert||(e.$setOnInsert={}),e.$setOnInsert[r]=0))}G.findByIdAndUpdate=function(e,t,r,n){if(Ee(this,"findByIdAndUpdate"),n=this.$handleCallbackError(n),arguments.length===1){if(typeof e=="function"){let i=`Model.findByIdAndUpdate(): First argument must not be a function.

  `+this.modelName+`.findByIdAndUpdate(id, callback)
  `+this.modelName+`.findByIdAndUpdate(id)
  `+this.modelName+`.findByIdAndUpdate()
`;throw new TypeError(i)}return this.findOneAndUpdate({_id:e},void 0)}return e instanceof $a&&(e=e._id),this.findOneAndUpdate.call(this,{_id:e},t,r,n)};G.findOneAndDelete=function(e,t,r){if(Ee(this,"findOneAndDelete"),arguments.length===1&&typeof e=="function"){let s=`Model.findOneAndDelete(): First argument must not be a function.

  `+this.modelName+`.findOneAndDelete(conditions, callback)
  `+this.modelName+`.findOneAndDelete(conditions)
  `+this.modelName+`.findOneAndDelete()
`;throw new TypeError(s)}typeof t=="function"&&(r=t,t=void 0),r=this.$handleCallbackError(r);let n;t&&(n=t.select,t.select=void 0);let i=new this.Query({},{},this,this.$__collection);return i.select(n),i.findOneAndDelete(e,t,r)};G.findByIdAndDelete=function(e,t,r){if(Ee(this,"findByIdAndDelete"),arguments.length===1&&typeof e=="function"){let n=`Model.findByIdAndDelete(): First argument must not be a function.

  `+this.modelName+`.findByIdAndDelete(id, callback)
  `+this.modelName+`.findByIdAndDelete(id)
  `+this.modelName+`.findByIdAndDelete()
`;throw new TypeError(n)}return r=this.$handleCallbackError(r),this.findOneAndDelete({_id:e},t,r)};G.findOneAndReplace=function(e,t,r,n){if(Ee(this,"findOneAndReplace"),arguments.length===1&&typeof e=="function"){let o=`Model.findOneAndReplace(): First argument must not be a function.

  `+this.modelName+`.findOneAndReplace(conditions, callback)
  `+this.modelName+`.findOneAndReplace(conditions)
  `+this.modelName+`.findOneAndReplace()
`;throw new TypeError(o)}arguments.length===3&&typeof r=="function"&&(n=r,r=t,t=void 0),arguments.length===2&&typeof t=="function"&&(n=t,t=void 0,r=void 0),n=this.$handleCallbackError(n);let i;r&&(i=r.select,r.select=void 0);let s=new this.Query({},{},this,this.$__collection);return s.select(i),s.findOneAndReplace(e,t,r,n)};G.findOneAndRemove=function(e,t,r){if(Ee(this,"findOneAndRemove"),arguments.length===1&&typeof e=="function"){let s=`Model.findOneAndRemove(): First argument must not be a function.

  `+this.modelName+`.findOneAndRemove(conditions, callback)
  `+this.modelName+`.findOneAndRemove(conditions)
  `+this.modelName+`.findOneAndRemove()
`;throw new TypeError(s)}typeof t=="function"&&(r=t,t=void 0),r=this.$handleCallbackError(r);let n;t&&(n=t.select,t.select=void 0);let i=new this.Query({},{},this,this.$__collection);return i.select(n),i.findOneAndRemove(e,t,r)};G.findByIdAndRemove=function(e,t,r){if(Ee(this,"findByIdAndRemove"),arguments.length===1&&typeof e=="function"){let n=`Model.findByIdAndRemove(): First argument must not be a function.

  `+this.modelName+`.findByIdAndRemove(id, callback)
  `+this.modelName+`.findByIdAndRemove(id)
  `+this.modelName+`.findByIdAndRemove()
`;throw new TypeError(n)}return r=this.$handleCallbackError(r),this.findOneAndRemove({_id:e},t,r)};G.create=function(t,r,n){Ee(this,"create");let i,s,o=this.schema.options.discriminatorKey;if(Array.isArray(t))i=t,s=typeof r=="function"?r:n,r=r!=null&&typeof r=="object"?r:{};else{let a=arguments[arguments.length-1];r={},typeof a=="function"||arguments.length>1&&!a?(s=a,i=Pe.args(arguments,0,arguments.length-1)):i=Pe.args(arguments),i.length===2&&i[0]!=null&&i[1]!=null&&i[0].session==null&&qve(a.session)==="ClientSession"&&!this.schema.path("session")&&console.warn("WARNING: to pass a `session` to `Model.create()` in Mongoose, you **must** pass an array as the first argument. See: https://mongoosejs.com/docs/api.html#model_Model.create")}return this.db.base._promiseOrCallback(s,a=>{if(a=this.$wrapCallback(a),i.length===0)return a(null);let u=[],c;i.forEach(p=>{u.push(m=>{let y=this.discriminators&&p[o]!=null?this.discriminators[p[o]]||Mz(this.discriminators,p[o]):this;if(y==null)throw new Nr(`Discriminator "${p[o]}" not found for model "${this.modelName}"`);let g=p,w=(S,v)=>{if(S)return c||(c=S),m(null,{error:S});m(null,{doc:v})};if(!(g instanceof y))try{g=new y(g)}catch(S){return w(S)}g.save(r,w)})});let f=u.length;if(f===0)return a(null,[]);let h=(p,m)=>{let y=[],g=m.length;for(let w=0;w<g;++w)m[w].doc&&y.push(m[w].doc);if(c)return a(c,y);t instanceof Array?a(null,y):a.apply(this,[null].concat(y))},d=[];u.forEach((p,m)=>{p((y,g)=>{if(d[m]=g,--f<=0)return h(null,d)})})},this.events)};G.watch=function(e,t){Ee(this,"watch");let r=n=>{if(this.$__collection.buffer)this.$__collection.addQueue(()=>{if(this.closed)return;let i=this.$__collection.watch(e,t);n(null,i)});else{let i=this.$__collection.watch(e,t);n(null,i)}};return new hve(r,e,t)};G.startSession=function(){return Ee(this,"startSession"),this.db.startSession.apply(this.db,arguments)};G.insertMany=function(e,t,r){return Ee(this,"insertMany"),typeof t=="function"&&(r=t,t=null),this.db.base._promiseOrCallback(r,n=>{this.$__insertMany(e,t,n)},this.events)};G.$__insertMany=function(e,t,r){let n=this;typeof t=="function"&&(r=t,t=null),r&&(r=this.$handleCallbackError(r),r=this.$wrapCallback(r)),r=r||Pe.noop,t=t||{};let i=Qt(t,"limit",1e3),s=Qt(t,"rawResult",!1),o=Qt(t,"ordered",!0),a=Qt(t,"lean",!1);Array.isArray(e)||(e=[e]);let u=[],c=e.map(f=>h=>{if(!(f instanceof n))try{f=new n(f)}catch(d){return h(d)}if(t.session!=null&&f.$session(t.session),a)return Pa(()=>h(null,f));f.validate({__noPromise:!0},function(d){if(d)return o===!1?(u.push(d),h(null,null)):h(d);h(null,f)})});Ive(c,i,function(f,h){if(f){r(f,null);return}let d=h.filter(function(m){return m!=null});if(d.length<1){if(s)return r(null,{mongoose:{validationErrors:u}});r(null,[]);return}let p=d.map(function(m){return m.$__schema.options.versionKey&&(m[m.$__schema.options.versionKey]=0),m.initializeTimestamps?m.initializeTimestamps().toObject(MC):m.toObject(MC)});n.$__collection.insertMany(p,t,function(m,y){if(m){m.writeErrors==null&&Qt(m,"result.result.writeErrors")!=null&&(m.writeErrors=m.result.result.writeErrors);let g=new Set(Qt(m,"writeErrors",[]).map(S=>S.index)),w=-1;m.insertedDocs=d.filter((S,v)=>{let E=g.has(v);if(o){if(w>-1)return v<w;E&&(w=v)}return!E}).map(function(v){return v.$__reset(),mc(v,!1),v}),r(m,null);return}for(let g of d)g.$__reset(),mc(g,!1);if(s)return o===!1&&(y.mongoose={validationErrors:u}),r(null,y);if(t.populate!=null)return n.populate(d,t.populate,g=>{if(g!=null)return m.insertedDocs=d,r(g);r(null,h)});r(null,d)})})};function mc(e,t){e.isNew=t,e.emit("isNew",t),e.constructor.emit("isNew",t);let r=e.$getAllSubdocs();for(let n of r)n.isNew=t}G.bulkWrite=function(e,t,r){Ee(this,"bulkWrite"),typeof t=="function"&&(r=t,t=null),t=t||{};let n=e.map(i=>Eve(this,i,t));return r=this.$handleCallbackError(r),this.db.base._promiseOrCallback(r,i=>{i=this.$wrapCallback(i),xve(n,(s,o)=>s(o),s=>{if(s)return i(s);if(e.length===0)return i(null,Tve());this.$__collection.bulkWrite(e,t,(o,a)=>{if(o)return i(o);i(null,a)})})},this.events)};G.bulkSave=function(e){let t=e.map(Vve),r=this.buildBulkWriteOperations(e,{skipValidation:!0}),n;return Promise.all(t).then(()=>n=this.bulkWrite(r)).then(()=>e.map(bz)).then(()=>n).catch(i=>{if(!Qt(i,"writeErrors.length"))throw i;return Promise.all(e.map(s=>{if(i.writeErrors.find(a=>(a.err.op._id||a.err.op.q._id).toString()===s._id.toString())==null)return bz(s)})).then(()=>{throw i})})};function Vve(e){return new Promise((t,r)=>{e.schema.s.hooks.execPre("save",e,n=>{if(n){r(n);return}t()})})}function bz(e){return new Promise((t,r)=>{Wve(e,t,r)})}function Wve(e,t,r){e.isNew&&mc(e,!1),e.$__reset(),e.schema.s.hooks.execPost("save",e,{},n=>{if(n){r(n);return}t()})}G.buildBulkWriteOperations=function(t,r){if(!Array.isArray(t))throw new Error(`bulkSave expects an array of documents to be passed, received \`${t}\` instead`);return i(),t.reduce((s,o,a)=>{if(!r.skipValidation){if(!(o instanceof $a))throw new Error(`documents.${a} was not a mongoose document, documents must be an array of mongoose documents (instanceof mongoose.Document).`);let h=o.validateSync();if(h)throw h}if(o.isNew)return s.push({insertOne:{document:o}}),s;let c=o.$__delta();if(c!=null&&!Pe.isEmptyObject(c[0])){let h=o.$__where(c[0]),d=c[1];return jC(o,h),o.$__version(h,c),s.push({updateOne:{filter:h,update:d}}),s}return s},[]);function i(){r=r||{},r.skipValidation==null&&(r.skipValidation=!1)}};G.hydrate=function(e,t){Ee(this,"hydrate");let r=ac().createModel(this,e,t);return r.init(e),r};G.update=function(t,r,n,i){return Ee(this,"update"),eg(this,"update",t,r,n,i)};G.updateMany=function(t,r,n,i){return Ee(this,"updateMany"),eg(this,"updateMany",t,r,n,i)};G.updateOne=function(t,r,n,i){return Ee(this,"updateOne"),eg(this,"updateOne",t,r,n,i)};G.replaceOne=function(t,r,n,i){Ee(this,"replaceOne");let s=Qt(this,"schema.options.versionKey",null);return s&&!r[s]&&(r[s]=0),eg(this,"replaceOne",t,r,n,i)};function eg(e,t,r,n,i,s){let o=new e.Query({},{},e,e.collection);s=e.$handleCallbackError(s),r instanceof $a?r=r.toObject():r=Pe.clone(r),i=typeof i=="function"?i:Pe.clone(i);let a=Qt(e,"schema.options.versionKey",null);return Pz(n,i,a),o[t](r,n,i,s)}G.mapReduce=function(t,r){return Ee(this,"mapReduce"),r=this.$handleCallbackError(r),this.db.base._promiseOrCallback(r,n=>{if(n=this.$wrapCallback(n),!G.mapReduce.schema){let i={noId:!0,noVirtualId:!0,strict:!1};G.mapReduce.schema=new IC({},i)}if(t.out||(t.out={inline:1}),t.verbose!==!1&&(t.verbose=!0),t.map=String(t.map),t.reduce=String(t.reduce),t.query){let i=new this.Query(t.query);i.cast(this),t.query=i._conditions,i=void 0}this.$__collection.mapReduce(null,null,t,(i,s)=>{if(i)return n(i);if(s.collection){let o=G.compile("_mapreduce_"+s.collection.collectionName,G.mapReduce.schema,s.collection.collectionName,this.db,this.base);return o._mapreduce=!0,s.model=o,n(null,s)}n(null,s)})},this.events)};G.aggregate=function(t,r){if(Ee(this,"aggregate"),arguments.length>2||Qt(t,"constructor.name")==="Object")throw new Nr("Mongoose 5.x disallows passing a spread of operators to `Model.aggregate()`. Instead of `Model.aggregate({ $match }, { $skip })`, do `Model.aggregate([{ $match }, { $skip }])`");typeof t=="function"&&(r=t,t=[]);let n=new fve(t||[]);return n.model(this),typeof r>"u"||(r=this.$handleCallbackError(r),r=this.$wrapCallback(r),n.exec(r)),n};G.validate=function(t,r,n,i){return(arguments.length<3||arguments.length===3&&typeof arguments[2]=="function")&&(n=t),this.db.base._promiseOrCallback(i,s=>{let o=this.schema,a=Object.keys(o.paths);if(r!=null){let d=new Set(r);a=a.filter(p=>{let m=p.split("."),y=m[0];for(let g of m){if(d.has(y))return!0;y+="."+g}return d.has(p)})}for(let d of a){let p=o.path(d);if(!p||!p.$isMongooseArray)continue;let m=Qt(t,d);f(m,d)}let u=a.length,c=null;for(let d of a){let p=o.path(d);if(p==null){h();continue}let m=d.split("."),y=t;for(let w=0;w<m.length-1;++w)y=y[m[w]];let g=Qt(t,d,void 0);if(g!=null)try{g=p.cast(g),y[m[m.length-1]]=g}catch(w){c=c||new xC,c.addError(d,w),h();continue}p.doValidate(g,w=>{if(w)if(c=c||new xC,w instanceof xC)for(let S of Object.keys(w.errors))c.addError(`${d}.${w.errors[S].path}`,S);else c.addError(w.path,w);h()},n,{path:d})}function f(d,p){if(d!=null)for(let m=0;m<d.length;++m)Array.isArray(d[m])?f(d[m],p+"."+m):a.push(p+"."+m)}function h(){if(--u<=0)return s(c)}})};G.geoSearch=function(e,t,r){return Ee(this,"geoSearch"),typeof t=="function"&&(r=t,t={}),r=this.$handleCallbackError(r),this.db.base._promiseOrCallback(r,n=>{n=this.$wrapCallback(n);let i;if(e===void 0||!Pe.isObject(e)?i=new Nr("Must pass conditions to geoSearch"):t.near?Array.isArray(t.near)||(i=new Nr("near option must be an array [x, y]")):i=new Nr("Must specify the near option in geoSearch"),i)return n(i);t.search=e,this.$__collection.geoHaystackSearch(t.near[0],t.near[1],t,(s,o)=>{if(s)return n(s);let a=o.results.length;if(t.lean||a===0)return n(null,o.results);let u=!1;function c(f){if(f&&!u)return n(f);!--a&&!u&&n(null,o.results)}for(let f=0;f<o.results.length;++f){let h=o.results[f];o.results[f]=new this,o.results[f].init(h,{},c)}})},this.events)};G.populate=function(e,t,r){Ee(this,"populate");let n=this;t=Pe.populate(t);let i={};return r=this.$handleCallbackError(r),this.db.base._promiseOrCallback(r,s=>{s=this.$wrapCallback(s),zve(n,e,t,i,s)},this.events)};function zve(e,t,r,n,i){let s=r.length;if(r.length===0)return i(null,t);for(let a of r)Gve(e,t,a,o);function o(a){if(a)return i(a,null);--s||i(null,t)}}var Hve=/\s?-_id\s?/,Kve=/\s?-_id\s?/g;function Gve(e,t,r,n){if(Array.isArray(t)||(t=[t]),t.length===0||t.every(Pe.isNullOrUndefined))return n();let i=Mve(e,t,r);if(i instanceof Nr)return Pa(function(){n(i)});let s=i.length,o=[];function a(p){return p!==void 0}let u=s,c=!1,f=[];for(let p=0;p<s;++p){let m=i[p],y=m.options.select,g=Pe.array.flatten(m.ids,a);g=Pe.array.unique(g);let w={};if(w.sort=Qt(m,"options.options.sort",void 0),w.excludeId=Hve.test(y)||y&&y._id===0,g.length===0||g.every(Pe.isNullOrUndefined)){--u,(m.count||m.isVirtual)&&Ez(e,[],m,w);continue}c=!0;let S=Cve(g,m.match,m.foreignField,m.model,m.options.skipInvalidIds);w.excludeId&&(typeof y=="string"?y=y.replace(Kve," "):(y=Pe.object.shallowCopy(y),delete y._id)),m.options.options&&m.options.options.limit!=null?w.originalLimit=m.options.options.limit:m.options.limit!=null&&(w.originalLimit=m.options.limit),f.push([m,S,y,w,h])}if(!c){if(r.populate!=null){let p=Pe.populate(r.populate).map(m=>Object.assign({},m,{path:r.path+"."+m.path}));return e.populate(t,p,n)}return n()}for(let p of f)Qve.apply(null,p);function h(p,m){if(p!=null)return n(p,null);o=o.concat(m),--u===0&&d()}function d(){for(let p of f){let m=p[0],y=p[3];for(let g of o)m.options._childDocs.push(g);Ez(e,o,m,y)}for(let p of f)Rve(p[0].foreignField,p[0].options,o);n()}}function Qve(e,t,r,n,i){let s=Pe.clone(e.options.populate),o=Object.assign({skip:e.options.skip,limit:e.options.limit,perDocumentLimit:e.options.perDocumentLimit},e.options.options);e.count&&delete o.skip,o.perDocumentLimit!=null?(o.limit=o.perDocumentLimit,delete o.perDocumentLimit):o.limit!=null&&(o.limit=o.limit*e.ids.length);let a=e.model.find(t,r,o);for(let u of e.foreignField)u!=="_id"&&a.selectedInclusively()&&!Nve(a._fields,u)&&a.select(u);if(e.count)for(let u of e.foreignField)a.select(u);s&&a.populate(s),a.exec((u,c)=>{if(u!=null)return i(u);for(let f of c)$ve.set(f,e.model);i(null,c)})}function Ez(e,t,r,n){let i=r.options,s=r.isVirtual,o=r.justOne,a,u=Qt(i,"options.lean",!1),c=t.length,f={},h={},d,p,m=Pe.clone(r.allIds);for(let y=0;y<c;y++)if(p=t[y],p!=null)for(let g of r.foreignField){if(a=Pe.getValue(g,p),Array.isArray(a)){a=Pe.array.unique(Pe.array.flatten(a));for(let w of a)w instanceof $a&&(w=w._id),d=String(w),h[d]?Array.isArray(h[d])?(h[d].push(p),f[d].push(y)):(h[d]=[h[d],p],f[d]=[f[d],y]):s&&!o?(h[d]=[p],f[d]=[y]):(h[d]=p,f[d]=y)}else a instanceof $a&&(a=a._id),d=String(a),h[d]?Array.isArray(h[d])?(h[d].push(p),f[d].push(y)):(s||h[d].constructor!==p.constructor||String(h[d]._id)!==String(p._id))&&(h[d]=[h[d],p],f[d]=[f[d],y]):(h[d]=p,f[d]=y);u||(p.$__.wasPopulated=!0)}bve({originalModel:e,rawIds:r.isVirtual?m:r.allIds,allIds:m,foreignField:r.foreignField,rawDocs:h,rawOrder:f,docs:r.docs,path:i.path,options:n,justOne:r.justOne,isVirtual:r.isVirtual,allOptions:r,populatedModel:r.model,lean:u,virtual:r.virtual,count:r.count,match:r.match})}G.compile=function(t,r,n,i,s){if(r.options.versionKey!==!1&&!r.paths[r.options.versionKey]){let f={};f[r.options.versionKey]=Number,r.add(f)}let a;typeof t=="function"&&t.prototype instanceof G?(a=t,t=a.name,r.loadClass(a,!1),a.prototype.$isMongooseModelPrototype=!0):a=function f(h,d,p){if(f.hooks.execPreSync("createModel",h),!(this instanceof f))return new f(h,d,p);let m=f.schema.options.discriminatorKey;if(f.discriminators==null||h==null||h[m]==null){G.call(this,h,d,p);return}let y=f.discriminators[h[m]]||Mz(f.discriminators,h[m]);if(y!=null)return new y(h,d,p);G.call(this,h,d,p)},a.hooks=r.s.hooks.clone(),a.base=s,a.modelName=t,a.prototype instanceof G||(a.__proto__=G,a.prototype.__proto__=G.prototype),a.model=function(h){return this.db.model(h)},a.db=i,a.prototype.db=i,a.prototype[DC]=i,a.discriminators=a.prototype.discriminators=void 0,a[Nz]=!0,a.events=new qC,a.prototype.$__setSchema(r);let c={schemaUserProvidedOptions:r._userProvidedOptions||{},capped:r.options.capped,Promise:a.base.Promise,modelName:t};return r.options.autoCreate!==void 0&&(c.autoCreate=r.options.autoCreate),a.prototype.collection=i.collection(n,c),a.prototype[Yf]=a.prototype.collection,Az(a,r),xz(a,r),Sve(a,r),Ove(a,r.s.hooks,r.statics),a.schema=a.prototype.$__schema,a.collection=a.prototype.collection,a.$__collection=a.collection,a.Query=function(){AC.apply(this,arguments)},a.Query.prototype=Object.create(AC.prototype),a.Query.base=AC.base,vve(a.Query,a),Yve(a,r.query),a};function Yve(e,t){for(let r in t)e.Query.prototype[r]=t[r]}G.__subclass=function(t,r,n){let i=this,s=function f(h,d,p){if(!(this instanceof f))return new f(h,d,p);i.call(this,h,d,p)};if(s.__proto__=i,s.prototype.__proto__=i.prototype,s.db=t,s.prototype.db=t,s.prototype[DC]=t,i[Qf]=i[Qf]||[],i[Qf].push(s),i.discriminators!=null){s.discriminators={};for(let f of Object.keys(i.discriminators))s.discriminators[f]=i.discriminators[f].__subclass(i.db,i.discriminators[f].schema,n)}let o=r&&typeof r!="string"?r:i.prototype.$__schema,a=o.options||{},u=o._userProvidedOptions||{};n||(n=i.prototype.$__schema.get("collection")||Pe.toCollectionName(i.modelName,this.base.pluralize()));let c={schemaUserProvidedOptions:u,capped:o&&a.capped};return s.prototype.collection=t.collection(n,c),s.prototype[Yf]=s.prototype.collection,s.collection=s.prototype.collection,s.$__collection=s.collection,s.init(()=>{}),s};G.$handleCallbackError=function(e){if(e==null)return e;if(typeof e!="function")throw new Nr("Callback must be a function, got "+e);let t=this;return function(){Pa(()=>{try{e.apply(null,arguments)}catch(r){t.emit("error",r)}})}};G.$wrapCallback=function(e){let t=new wve,r=this;return function(n){return n!=null&&n.name==="MongoServerSelectionError"&&(arguments[0]=t.assimilateError(n)),n!=null&&n.name==="MongoNetworkTimeoutError"&&n.message.endsWith("timed out")&&r.db.emit("timeout"),e.apply(null,arguments)}};G.inspect=function(){return`Model { ${this.modelName} }`};if($C.inspect.custom){G[$C.inspect.custom]=G.inspect}Rz.exports=Iz=G});var Bz=_((Jf,jz)=>{jz.exports=Zve;Jf.pluralization=[[/(m)an$/gi,"$1en"],[/(pe)rson$/gi,"$1ople"],[/(child)$/gi,"$1ren"],[/^(ox)$/gi,"$1en"],[/(ax|test)is$/gi,"$1es"],[/(octop|vir)us$/gi,"$1i"],[/(alias|status)$/gi,"$1es"],[/(bu)s$/gi,"$1ses"],[/(buffal|tomat|potat)o$/gi,"$1oes"],[/([ti])um$/gi,"$1a"],[/sis$/gi,"ses"],[/(?:([^f])fe|([lr])f)$/gi,"$1$2ves"],[/(hive)$/gi,"$1s"],[/([^aeiouy]|qu)y$/gi,"$1ies"],[/(x|ch|ss|sh)$/gi,"$1es"],[/(matr|vert|ind)ix|ex$/gi,"$1ices"],[/([m|l])ouse$/gi,"$1ice"],[/(kn|w|l)ife$/gi,"$1ives"],[/(quiz)$/gi,"$1zes"],[/s$/gi,"s"],[/([^a-z])$/,"$1"],[/$/gi,"s"]];var Jve=Jf.pluralization;Jf.uncountables=["advice","energy","excretion","digestion","cooperation","health","justice","labour","machinery","equipment","information","pollution","sewage","paper","money","species","series","rain","rice","fish","sheep","moose","deer","news","expertise","status","media"];var Xve=Jf.uncountables;function Zve(e){var t;return e=e.toLowerCase(),!~Xve.indexOf(e)&&(t=Jve.filter(function(r){return e.match(r[0])}),t[0])?e.replace(t[0][0],t[0][1]):e}});var kz=_((Q$e,Lz)=>{"use strict";var eSe=Hy();Lz.exports=function(e){e.s.hooks.pre("remove",!1,function(r){if(this.ownerDocument){r();return}let n=this,i=this.$getAllSubdocs();eSe(i,function(s,o){s.$__remove(o)},function(s){if(s)return n.$__schema.s.hooks.execPost("remove:error",n,[n],{error:s},function(o){r(o)});r()})},null,!0)}});var Vz=_((Y$e,Uz)=>{"use strict";var Fz=Hy();Uz.exports=function(e){e.s.hooks.pre("save",!1,function(r){if(this.ownerDocument){r();return}let n=this,i=this.$getAllSubdocs();if(!i.length){r();return}Fz(i,function(s,o){s.$__schema.s.hooks.execPre("save",s,function(a){o(a)})},function(s){if(s)return n.$__schema.s.hooks.execPost("save:error",n,[n],{error:s},function(o){r(o)});r()})},null,!0),e.s.hooks.post("save",function(r,n){if(this.ownerDocument){n();return}let i=this,s=this.$getAllSubdocs();if(!s.length){n();return}Fz(s,function(o,a){o.$__schema.s.hooks.execPost("save",o,[o],function(u){a(u)})},function(o){if(o)return i.$__schema.s.hooks.execPost("save:error",i,[i],{error:o},function(a){n(a)});n()})},null,!0)}});var Kz=_((J$e,Hz)=>{"use strict";var gc=pe().arrayAtomicsSymbol,tg=pe().sessionNewDocuments;Hz.exports=function(t){t.pre("save",function(){let r=this.$session();if(r!=null&&!(r.transaction==null||r[tg]==null))if(r[tg].has(this)){let n=r[tg].get(this);for(let i of Object.keys(this.$__.activePaths.states.modify))n.modifiedPaths.add(i);n.atomics=Wz(this,n.atomics)}else{let n={};this.isNew&&(n.isNew=!0),this.$__schema.options.versionKey&&(n.versionKey=this.get(this.$__schema.options.versionKey)),n.modifiedPaths=new Set(Object.keys(this.$__.activePaths.states.modify)),n.atomics=Wz(this),r[tg].set(this,n)}})};function Wz(e,t){let r=new Map;t=t||new Map;let n=Object.keys(e.$__.activePaths.init).concat(Object.keys(e.$__.activePaths.modify));for(let s of n){let o=e.$__getValue(s);if(o!=null&&o instanceof Array&&o.isMongooseDocumentArray&&o.length&&o[gc]!=null&&Object.keys(o[gc]).length>0){let a=t.get(s)||{};r.set(s,zz(a,o[gc]))}}let i=e.$__dirty();for(let s of i){let o=s.path,a=s.value;if(a!=null&&a[gc]!=null&&Object.keys(a[gc]).length>0){let u=t.get(o)||{};r.set(o,zz(u,a[gc]))}}return r}function zz(e,t){return e=e||{},t.$pullAll!=null&&(e.$pullAll=(e.$pullAll||[]).concat(t.$pullAll)),t.$push!=null&&(e.$push=e.$push||{},e.$push.$each=(e.$push.$each||[]).concat(t.$push.$each)),t.$addToSet!=null&&(e.$addToSet=(e.$addToSet||[]).concat(t.$addToSet)),t.$set!=null&&(e.$set=Object.assign(e.$set||{},t.$set)),e}});var Qz=_((X$e,Gz)=>{"use strict";Gz.exports=function(e){e.pre("save",!1,function(n,i){let s=this;if(this.ownerDocument)return n();let o=i&&typeof i=="object"&&"validateBeforeSave"in i,a;if(o?a=!!i.validateBeforeSave:a=this.$__schema.options.validateBeforeSave,a){let c=i&&typeof i=="object"&&"validateModifiedOnly"in i?{validateModifiedOnly:i.validateModifiedOnly}:null;this.validate(c,function(f){return s.$__schema.s.hooks.execPost("save:error",s,[s],{error:f},function(h){s.$op="save",n(h)})})}else n()},null,!0)}});var Xz=_((Z$e,LC)=>{"use strict";var tSe=pe().objectIdSymbol,Yz=Ne();LC.exports=function(t){t.post("init",function(){return BC.call(this),this}),t.pre("save",function(r){Jz.call(this),r()}),t.pre("remove",function(r){Jz.call(this),r()}),t.post("save",function(){BC.call(this)})};function Jz(){let e,t;if(this.$__.shardval){e=Object.keys(this.$__.shardval),t=e.length,this.$where=this.$where||{};for(let r=0;r<t;++r)this.$where[e[r]]=this.$__.shardval[e[r]]}}LC.exports.storeShard=BC;function BC(){let e=this.$__schema.options.shardKey||this.$__schema.options.shardkey;if(!Yz.isPOJO(e))return;let t=this.$__.shardval={},r=Object.keys(e),n=r.length,i;for(let s=0;s<n;++s)i=this.$__getValue(r[s]),i==null?t[r[s]]=i:Yz.isMongooseObject(i)?t[r[s]]=i.toObject({depopulate:!0,_isNested:!0}):i instanceof Date||i[tSe]?t[r[s]]=i:typeof i.valueOf=="function"?t[r[s]]=i.valueOf():t[r[s]]=i}});var Zz=_(()=>{"use strict";typeof jest<"u"&&typeof window<"u"&&console.warn("Mongoose: looks like you're trying to test a Mongoose app with Jest's default jsdom test environment. Please make sure you read Mongoose's docs on configuring Jest to test Node.js apps: http://mongoosejs.com/docs/jest.html");typeof jest<"u"&&process.nextTick.toString().indexOf("nextTick")===-1&&console.warn("Mongoose: looks like you're trying to test a Mongoose app with Jest's mock timers enabled. Please make sure you read Mongoose's docs on configuring Jest to test Node.js apps: http://mongoosejs.com/docs/jest.html")});var s6=_((n6,i6)=>{"use strict";if(global.MONGOOSE_DRIVER_PATH){let e="The `MONGOOSE_DRIVER_PATH` global property is deprecated. Use `mongoose.driver.set()` instead.";require("util").deprecate(function(){xn().set(require(global.MONGOOSE_DRIVER_PATH))},e)()}else xn().set(OV());var rSe=Un(),nSe=require("events").EventEmitter,Es=Ju(),iSe=Wr(),Xf=wf(),sSe=zm(),oSe=ef(),aSe=EV(),uSe=Cf(),cSe=Fy(),t6=Dz(),lSe=WE(),UC=xn(),e6=je(),fSe=an(),hSe=Bz(),kC=Ne(),dSe=zE(),pSe=Yu(),mSe=kz(),ySe=Vz(),gSe=Kz(),_Se=Qz(),wSe=pC(),FC=ff(),vSe=Xz(),r6=Symbol.for("mongoose:default");Zz();function ce(e){this.connections=[],this.models={},this.modelSchemas={},this.events=new nSe,this.options=Object.assign({pluralization:!0,autoIndex:!0,useCreateIndex:!1},e);let t=this.createConnection();if(t.models=this.models,this.options.pluralization&&(this._pluralize=hSe),!e||!e[r6]){let r=this;this.Schema=function(){return this.base=r,Es.apply(this,arguments)},this.Schema.prototype=Object.create(Es.prototype),Object.assign(this.Schema,Es),this.Schema.base=this,this.Schema.Types=Object.assign({},Es.Types)}else for(let r of["Schema","model"])this[r]=ce.prototype[r];this.Schema.prototype.base=this,Object.defineProperty(this,"plugins",{configurable:!1,enumerable:!0,writable:!1,value:[[ySe,{deduplicate:!0}],[_Se,{deduplicate:!0}],[vSe,{deduplicate:!0}],[mSe,{deduplicate:!0}],[gSe,{deduplicate:!0}]]})}ce.prototype.cast=pSe;ce.prototype.STATES=oSe;ce.prototype.driver=UC;ce.prototype.set=function(e,t){let r=this instanceof ce?this:$r;if(aSe.indexOf(e)===-1)throw new Error(`\`${e}\` is an invalid option.`);return arguments.length===1?r.options[e]:(r.options[e]=t,e==="objectIdGetter"&&(t?Object.defineProperty($r.Types.ObjectId.prototype,"_id",{enumerable:!1,configurable:!0,get:function(){return this}}):delete $r.Types.ObjectId.prototype._id),r)};ce.prototype.get=ce.prototype.set;ce.prototype.createConnection=function(e,t,r){let n=this instanceof ce?this:$r,i=new VC(n);return typeof t=="function"&&(r=t,t=null),n.connections.push(i),n.events.emit("createConnection",i),arguments.length>0?i.openUri(e,t,r):i};ce.prototype.connect=function(e,t,r){let n=this instanceof ce?this:$r,i=n.connection;return n._promiseOrCallback(r,s=>{i.openUri(e,t,o=>o!=null?s(o):s(null,n))})};ce.prototype.disconnect=function(e){let t=this instanceof ce?this:$r;return t._promiseOrCallback(e,r=>{let n=t.connections.length;if(n<=0)return r(null);t.connections.forEach(i=>{i.close(function(s){if(s)return r(s);--n||r(null)})})})};ce.prototype.startSession=function(){let e=this instanceof ce?this:$r;return e.connection.startSession.apply(e.connection,arguments)};ce.prototype.pluralize=function(e){let t=this instanceof ce?this:$r;return arguments.length>0&&(t._pluralize=e),t._pluralize};ce.prototype.model=function(e,t,r,n){let i=this instanceof ce?this:$r,s;if(typeof e=="function"&&(s=e,e=s.name,!(s.prototype instanceof t6)))throw new i.Error("The provided class "+e+" must extend Model");if(typeof t=="string"&&(r=t,t=!1),kC.isObject(t)&&!(t instanceof Es)&&(t=new Es(t)),t&&!(t instanceof Es))throw new Error("The 2nd parameter to `mongoose.model()` should be a schema or a POJO");typeof r=="boolean"&&(n=r,r=null);let o;if(n&&kC.isObject(n)?(o=n,n=!0):o={},!i.modelSchemas[e])if(t)i.modelSchemas[e]=t;else throw new $r.Error.MissingSchemaError(e);let a=t;t&&(i.get("cloneSchemas")&&(t=t.clone()),i._applyPlugins(t));let u,c=i.options.hasOwnProperty("overwriteModels")?i.options.overwriteModels:o.overwriteModels;if(i.models[e]&&o.cache!==!1&&c!==!0){if(a&&a.instanceOfSchema&&a!==i.models[e].schema)throw new i.Error.OverwriteModelError(e);return r&&r!==i.models[e].collection.name?(s=i.models[e],t=s.prototype.schema,u=s.__subclass(i.connection,t,r),u):i.models[e]}if(!t&&(t=this.modelSchemas[e],!t))throw new $r.Error.MissingSchemaError(e);"pluralization"in t.options||(t.options.pluralization=i.options.pluralization),r||(r=t.get("collection")||kC.toCollectionName(e,i.pluralize()));let f=o.connection||i.connection;return s=i.Model.compile(s||e,t,r,f,i),n||s.init(function(){}),f.emit("model",s),o.cache===!1?s:(i.models[e]=s,i.models[e])};ce.prototype.deleteModel=function(e){let t=this instanceof ce?this:$r;return t.connection.deleteModel(e),t};ce.prototype.modelNames=function(){let e=this instanceof ce?this:$r;return Object.keys(e.models)};ce.prototype._applyPlugins=function(e,t){let r=this instanceof ce?this:$r;t=t||{},t.applyPluginsToDiscriminators=e6(r,"options.applyPluginsToDiscriminators",!1),t.applyPluginsToChildSchemas=e6(r,"options.applyPluginsToChildSchemas",!0),lSe(e,r.plugins,t,"$globalPluginsApplied")};ce.prototype.plugin=function(e,t){let r=this instanceof ce?this:$r;return r.plugins.push([e,t]),r};ce.prototype.__defineGetter__("connection",function(){return this.connections[0]});ce.prototype.__defineSetter__("connection",function(e){e instanceof VC&&(this.connections[0]=e,this.models=e.models)});ce.prototype.connections;var VC=UC.get().getConnection();var SSe=UC.get().Collection;ce.prototype.Aggregate=wSe;ce.prototype.Collection=SSe;ce.prototype.Connection=VC;ce.prototype.version=dSe.version;ce.prototype.Mongoose=ce;ce.prototype.Schema=Es;ce.prototype.SchemaType=iSe;ce.prototype.SchemaTypes=Es.Types;ce.prototype.VirtualType=sSe;ce.prototype.Types=uSe;ce.prototype.Query=cSe;Object.defineProperty(ce.prototype,"Promise",{get:function(){return FC.get()},set:function(e){FC.set(e)}});ce.prototype.PromiseProvider=FC;ce.prototype.Model=t6;ce.prototype.Document=rSe;ce.prototype.DocumentProvider=Fb();ce.prototype.ObjectId=Xf.ObjectId;ce.prototype.isValidObjectId=function(e){if(e==null)return!0;let r=(this||$r).driver.get().ObjectId;if(e instanceof r)return!0;if(e._id!=null){if(e._id instanceof r)return!0;if(e._id.toString instanceof Function)return e=e._id.toString(),!!(typeof e=="string"&&e.length===12||typeof e=="string"&&e.length===24&&/^[a-f0-9]*$/.test(e))}return e.toString instanceof Function&&(e=e.toString()),!!(typeof e=="string"&&e.length===12||typeof e=="string"&&e.length===24&&/^[a-f0-9]*$/.test(e))};ce.prototype.Decimal128=Xf.Decimal128;ce.prototype.Mixed=Xf.Mixed;ce.prototype.Date=Xf.Date;ce.prototype.Number=Xf.Number;ce.prototype.Error=Ft();ce.prototype.now=function(){return new Date};ce.prototype.CastError=vn();ce.prototype.SchemaTypeOptions=On();ce.prototype.mongo=fs();ce.prototype.mquery=Tm();ce.prototype._promiseOrCallback=function(e,t,r){return fSe(e,t,r,this.Promise)};var $r=i6.exports=n6=new ce({[r6]:!0})});var rg=_((rPe,o6)=>{"use strict";o6.exports=s6()});var zC=_(WC=>{"use strict";Object.defineProperty(WC,"__esModule",{value:!0});WC.default=ASe;var CSe=TSe(require("crypto"));function TSe(e){return e&&e.__esModule?e:{default:e}}var ag=new Uint8Array(256),og=ag.length;function ASe(){return og>ag.length-16&&(CSe.default.randomFillSync(ag),og=0),ag.slice(og,og+=16)}});var h6=_(ug=>{"use strict";Object.defineProperty(ug,"__esModule",{value:!0});ug.default=void 0;var xSe=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;ug.default=xSe});var eh=_(cg=>{"use strict";Object.defineProperty(cg,"__esModule",{value:!0});cg.default=void 0;var qSe=MSe(h6());function MSe(e){return e&&e.__esModule?e:{default:e}}function NSe(e){return typeof e=="string"&&qSe.default.test(e)}var $Se=NSe;cg.default=$Se});var rh=_(th=>{"use strict";Object.defineProperty(th,"__esModule",{value:!0});th.default=void 0;th.unsafeStringify=d6;var PSe=ISe(eh());function ISe(e){return e&&e.__esModule?e:{default:e}}var pr=[];for(let e=0;e<256;++e)pr.push((e+256).toString(16).slice(1));function d6(e,t=0){return(pr[e[t+0]]+pr[e[t+1]]+pr[e[t+2]]+pr[e[t+3]]+"-"+pr[e[t+4]]+pr[e[t+5]]+"-"+pr[e[t+6]]+pr[e[t+7]]+"-"+pr[e[t+8]]+pr[e[t+9]]+"-"+pr[e[t+10]]+pr[e[t+11]]+pr[e[t+12]]+pr[e[t+13]]+pr[e[t+14]]+pr[e[t+15]]).toLowerCase()}function RSe(e,t=0){let r=d6(e,t);if(!(0,PSe.default)(r))throw TypeError("Stringified UUID is invalid");return r}var DSe=RSe;th.default=DSe});var m6=_(lg=>{"use strict";Object.defineProperty(lg,"__esModule",{value:!0});lg.default=void 0;var jSe=LSe(zC()),BSe=rh();function LSe(e){return e&&e.__esModule?e:{default:e}}var p6,HC,KC=0,GC=0;function kSe(e,t,r){let n=t&&r||0,i=t||new Array(16);e=e||{};let s=e.node||p6,o=e.clockseq!==void 0?e.clockseq:HC;if(s==null||o==null){let d=e.random||(e.rng||jSe.default)();s==null&&(s=p6=[d[0]|1,d[1],d[2],d[3],d[4],d[5]]),o==null&&(o=HC=(d[6]<<8|d[7])&16383)}let a=e.msecs!==void 0?e.msecs:Date.now(),u=e.nsecs!==void 0?e.nsecs:GC+1,c=a-KC+(u-GC)/1e4;if(c<0&&e.clockseq===void 0&&(o=o+1&16383),(c<0||a>KC)&&e.nsecs===void 0&&(u=0),u>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");KC=a,GC=u,HC=o,a+=122192928e5;let f=((a&268435455)*1e4+u)%4294967296;i[n++]=f>>>24&255,i[n++]=f>>>16&255,i[n++]=f>>>8&255,i[n++]=f&255;let h=a/4294967296*1e4&268435455;i[n++]=h>>>8&255,i[n++]=h&255,i[n++]=h>>>24&15|16,i[n++]=h>>>16&255,i[n++]=o>>>8|128,i[n++]=o&255;for(let d=0;d<6;++d)i[n+d]=s[d];return t||(0,BSe.unsafeStringify)(i)}var FSe=kSe;lg.default=FSe});var QC=_(fg=>{"use strict";Object.defineProperty(fg,"__esModule",{value:!0});fg.default=void 0;var USe=VSe(eh());function VSe(e){return e&&e.__esModule?e:{default:e}}function WSe(e){if(!(0,USe.default)(e))throw TypeError("Invalid UUID");let t,r=new Uint8Array(16);return r[0]=(t=parseInt(e.slice(0,8),16))>>>24,r[1]=t>>>16&255,r[2]=t>>>8&255,r[3]=t&255,r[4]=(t=parseInt(e.slice(9,13),16))>>>8,r[5]=t&255,r[6]=(t=parseInt(e.slice(14,18),16))>>>8,r[7]=t&255,r[8]=(t=parseInt(e.slice(19,23),16))>>>8,r[9]=t&255,r[10]=(t=parseInt(e.slice(24,36),16))/1099511627776&255,r[11]=t/4294967296&255,r[12]=t>>>24&255,r[13]=t>>>16&255,r[14]=t>>>8&255,r[15]=t&255,r}var zSe=WSe;fg.default=zSe});var YC=_(Ia=>{"use strict";Object.defineProperty(Ia,"__esModule",{value:!0});Ia.URL=Ia.DNS=void 0;Ia.default=YSe;var HSe=rh(),KSe=GSe(QC());function GSe(e){return e&&e.__esModule?e:{default:e}}function QSe(e){e=unescape(encodeURIComponent(e));let t=[];for(let r=0;r<e.length;++r)t.push(e.charCodeAt(r));return t}var y6="6ba7b810-9dad-11d1-80b4-00c04fd430c8";Ia.DNS=y6;var g6="6ba7b811-9dad-11d1-80b4-00c04fd430c8";Ia.URL=g6;function YSe(e,t,r){function n(i,s,o,a){var u;if(typeof i=="string"&&(i=QSe(i)),typeof s=="string"&&(s=(0,KSe.default)(s)),((u=s)===null||u===void 0?void 0:u.length)!==16)throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");let c=new Uint8Array(16+i.length);if(c.set(s),c.set(i,s.length),c=r(c),c[6]=c[6]&15|t,c[8]=c[8]&63|128,o){a=a||0;for(let f=0;f<16;++f)o[a+f]=c[f];return o}return(0,HSe.unsafeStringify)(c)}try{n.name=e}catch{}return n.DNS=y6,n.URL=g6,n}});var _6=_(hg=>{"use strict";Object.defineProperty(hg,"__esModule",{value:!0});hg.default=void 0;var JSe=XSe(require("crypto"));function XSe(e){return e&&e.__esModule?e:{default:e}}function ZSe(e){return Array.isArray(e)?e=Buffer.from(e):typeof e=="string"&&(e=Buffer.from(e,"utf8")),JSe.default.createHash("md5").update(e).digest()}var eOe=ZSe;hg.default=eOe});var v6=_(dg=>{"use strict";Object.defineProperty(dg,"__esModule",{value:!0});dg.default=void 0;var tOe=w6(YC()),rOe=w6(_6());function w6(e){return e&&e.__esModule?e:{default:e}}var nOe=(0,tOe.default)("v3",48,rOe.default),iOe=nOe;dg.default=iOe});var S6=_(pg=>{"use strict";Object.defineProperty(pg,"__esModule",{value:!0});pg.default=void 0;var sOe=oOe(require("crypto"));function oOe(e){return e&&e.__esModule?e:{default:e}}var aOe={randomUUID:sOe.default.randomUUID};pg.default=aOe});var E6=_(mg=>{"use strict";Object.defineProperty(mg,"__esModule",{value:!0});mg.default=void 0;var O6=b6(S6()),uOe=b6(zC()),cOe=rh();function b6(e){return e&&e.__esModule?e:{default:e}}function lOe(e,t,r){if(O6.default.randomUUID&&!t&&!e)return O6.default.randomUUID();e=e||{};let n=e.random||(e.rng||uOe.default)();if(n[6]=n[6]&15|64,n[8]=n[8]&63|128,t){r=r||0;for(let i=0;i<16;++i)t[r+i]=n[i];return t}return(0,cOe.unsafeStringify)(n)}var fOe=lOe;mg.default=fOe});var C6=_(yg=>{"use strict";Object.defineProperty(yg,"__esModule",{value:!0});yg.default=void 0;var hOe=dOe(require("crypto"));function dOe(e){return e&&e.__esModule?e:{default:e}}function pOe(e){return Array.isArray(e)?e=Buffer.from(e):typeof e=="string"&&(e=Buffer.from(e,"utf8")),hOe.default.createHash("sha1").update(e).digest()}var mOe=pOe;yg.default=mOe});var A6=_(gg=>{"use strict";Object.defineProperty(gg,"__esModule",{value:!0});gg.default=void 0;var yOe=T6(YC()),gOe=T6(C6());function T6(e){return e&&e.__esModule?e:{default:e}}var _Oe=(0,yOe.default)("v5",80,gOe.default),wOe=_Oe;gg.default=wOe});var x6=_(_g=>{"use strict";Object.defineProperty(_g,"__esModule",{value:!0});_g.default=void 0;var vOe="00000000-0000-0000-0000-000000000000";_g.default=vOe});var q6=_(wg=>{"use strict";Object.defineProperty(wg,"__esModule",{value:!0});wg.default=void 0;var SOe=OOe(eh());function OOe(e){return e&&e.__esModule?e:{default:e}}function bOe(e){if(!(0,SOe.default)(e))throw TypeError("Invalid UUID");return parseInt(e.slice(14,15),16)}var EOe=bOe;wg.default=EOe});var M6=_(ai=>{"use strict";Object.defineProperty(ai,"__esModule",{value:!0});Object.defineProperty(ai,"NIL",{enumerable:!0,get:function(){return qOe.default}});Object.defineProperty(ai,"parse",{enumerable:!0,get:function(){return POe.default}});Object.defineProperty(ai,"stringify",{enumerable:!0,get:function(){return $Oe.default}});Object.defineProperty(ai,"v1",{enumerable:!0,get:function(){return COe.default}});Object.defineProperty(ai,"v3",{enumerable:!0,get:function(){return TOe.default}});Object.defineProperty(ai,"v4",{enumerable:!0,get:function(){return AOe.default}});Object.defineProperty(ai,"v5",{enumerable:!0,get:function(){return xOe.default}});Object.defineProperty(ai,"validate",{enumerable:!0,get:function(){return NOe.default}});Object.defineProperty(ai,"version",{enumerable:!0,get:function(){return MOe.default}});var COe=Cs(m6()),TOe=Cs(v6()),AOe=Cs(E6()),xOe=Cs(A6()),qOe=Cs(x6()),MOe=Cs(q6()),NOe=Cs(eh()),$Oe=Cs(rh()),POe=Cs(QC());function Cs(e){return e&&e.__esModule?e:{default:e}}});var P6=_((BPe,$6)=>{(function(){"use strict";var e=require("crypto"),t=require("assert"),r=e.pseudoRandomBytes||e.randomBytes,n="0123456789",i="abcdefghijklmnopqrstuvwxyz",s=i.toUpperCase(),o=n+s+i,a={chars:"default",source:"default"};function u(g){t(g),t(typeof g=="string"),t(g.length>0),t(g.length<256)}function c(g){return Buffer.alloc?Buffer.alloc(g):new Buffer(g)}function f(g){switch(t(!g||typeof g=="object"),g=g||{},g.chars=g.chars||a.chars,g.source=g.source||a.source,g.chars){case"default":g.chars=o;break;case"a-z":case"alpha":g.chars=i;break;case"A-Z":case"ALPHA":g.chars=s;break;case"0-9":case"numeric":g.chars=n;break;case"base32":g.chars=s+"234567";break;default:}switch(u(g.chars),g.source){case"default":g.source=r;break;case"crypto":g.source=e.randomBytes;break;case"math":g.source=function(w){for(var S=c(w),v=0;v<w;v++)S.writeUInt8(Math.floor(256*Math.random()),v);return S};break;default:t(typeof g.source=="function")}return{generate:function(w,S){S?u(S):S=g.chars;for(var v=Math.floor(256/S.length)*S.length,E="";E.length<w;)for(var A=g.source(w-E.length),x=0;x<A.length;x++){var z=A.readUInt8(x);z<v&&(E+=S[z%S.length])}return E}}}function h(g){t(g>=0),g=Math.floor(g);var w=[];do{var S=g%62;w.push(o[S]),g=Math.floor(g/62)}while(g>0);return w.reverse().join("")}var d=9466848e5,p=8;function m(g,w){for(var S=h(Date.now()-g);S.length<w;)S="0"+S;return S}var y=f();$6.exports={generator:f,generate:y.generate,uid:y.generate,suid:function(g,w,S){return w=w||d,S=S||p,m(w,S)+y.generate(g)}}})()});var JC=_((LPe,I6)=>{var vg=jt().Buffer,IOe=require("stream"),ROe=require("util");function Sg(e){if(this.buffer=null,this.writable=!0,this.readable=!0,!e)return this.buffer=vg.alloc(0),this;if(typeof e.pipe=="function")return this.buffer=vg.alloc(0),e.pipe(this),this;if(e.length||typeof e=="object")return this.buffer=e,this.writable=!1,process.nextTick(function(){this.emit("end",e),this.readable=!1,this.emit("close")}.bind(this)),this;throw new TypeError("Unexpected data type ("+typeof e+")")}ROe.inherits(Sg,IOe);Sg.prototype.write=function(t){this.buffer=vg.concat([this.buffer,vg.from(t)]),this.emit("data",t)};Sg.prototype.end=function(t){t&&this.write(t),this.emit("end",t),this.emit("close"),this.writable=!1,this.readable=!1};I6.exports=Sg});var D6=_((kPe,R6)=>{"use strict";var nh=require("buffer").Buffer,XC=require("buffer").SlowBuffer;R6.exports=Og;function Og(e,t){if(!nh.isBuffer(e)||!nh.isBuffer(t)||e.length!==t.length)return!1;for(var r=0,n=0;n<e.length;n++)r|=e[n]^t[n];return r===0}Og.install=function(){nh.prototype.equal=XC.prototype.equal=function(t){return Og(this,t)}};var DOe=nh.prototype.equal,jOe=XC.prototype.equal;Og.restore=function(){nh.prototype.equal=DOe,XC.prototype.equal=jOe}});var B6=_((FPe,j6)=>{"use strict";function ZC(e){var t=(e/8|0)+(e%8===0?0:1);return t}var BOe={ES256:ZC(256),ES384:ZC(384),ES512:ZC(521)};function LOe(e){var t=BOe[e];if(t)return t;throw new Error('Unknown algorithm "'+e+'"')}j6.exports=LOe});var z6=_((UPe,W6)=>{"use strict";var bg=jt().Buffer,k6=B6(),Eg=128,F6=0,kOe=32,FOe=16,UOe=2,U6=FOe|kOe|F6<<6,Cg=UOe|F6<<6;function VOe(e){return e.replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function V6(e){if(bg.isBuffer(e))return e;if(typeof e=="string")return bg.from(e,"base64");throw new TypeError("ECDSA signature must be a Base64 string or a Buffer")}function WOe(e,t){e=V6(e);var r=k6(t),n=r+1,i=e.length,s=0;if(e[s++]!==U6)throw new Error('Could not find expected "seq"');var o=e[s++];if(o===(Eg|1)&&(o=e[s++]),i-s<o)throw new Error('"seq" specified length of "'+o+'", only "'+(i-s)+'" remaining');if(e[s++]!==Cg)throw new Error('Could not find expected "int" for "r"');var a=e[s++];if(i-s-2<a)throw new Error('"r" specified length of "'+a+'", only "'+(i-s-2)+'" available');if(n<a)throw new Error('"r" specified length of "'+a+'", max of "'+n+'" is acceptable');var u=s;if(s+=a,e[s++]!==Cg)throw new Error('Could not find expected "int" for "s"');var c=e[s++];if(i-s!==c)throw new Error('"s" specified length of "'+c+'", expected "'+(i-s)+'"');if(n<c)throw new Error('"s" specified length of "'+c+'", max of "'+n+'" is acceptable');var f=s;if(s+=c,s!==i)throw new Error('Expected to consume entire buffer, but "'+(i-s)+'" bytes remain');var h=r-a,d=r-c,p=bg.allocUnsafe(h+a+d+c);for(s=0;s<h;++s)p[s]=0;e.copy(p,s,u+Math.max(-h,0),u+a),s=r;for(var m=s;s<m+d;++s)p[s]=0;return e.copy(p,s,f+Math.max(-d,0),f+c),p=p.toString("base64"),p=VOe(p),p}function L6(e,t,r){for(var n=0;t+n<r&&e[t+n]===0;)++n;var i=e[t+n]>=Eg;return i&&--n,n}function zOe(e,t){e=V6(e);var r=k6(t),n=e.length;if(n!==r*2)throw new TypeError('"'+t+'" signatures must be "'+r*2+'" bytes, saw "'+n+'"');var i=L6(e,0,r),s=L6(e,r,e.length),o=r-i,a=r-s,u=1+1+o+1+1+a,c=u<Eg,f=bg.allocUnsafe((c?2:3)+u),h=0;return f[h++]=U6,c?f[h++]=u:(f[h++]=Eg|1,f[h++]=u&255),f[h++]=Cg,f[h++]=o,i<0?(f[h++]=0,h+=e.copy(f,h,0,r)):h+=e.copy(f,h,i,r),f[h++]=Cg,f[h++]=a,s<0?(f[h++]=0,e.copy(f,h,r)):e.copy(f,h,r+s),f}W6.exports={derToJose:WOe,joseToDer:zOe}});var rT=_((VPe,e4)=>{var HOe=D6(),wc=jt().Buffer,Ri=require("crypto"),K6=z6(),H6=require("util"),KOe=`"%s" is not a valid algorithm.
  Supported algorithms are:
  "HS256", "HS384", "HS512", "RS256", "RS384", "RS512", "PS256", "PS384", "PS512", "ES256", "ES384", "ES512" and "none".`,ih="secret must be a string or buffer",_c="key must be a string or a buffer",GOe="key must be a string, a buffer or an object",eT=typeof Ri.createPublicKey=="function";eT&&(_c+=" or a KeyObject",ih+="or a KeyObject");function G6(e){if(!wc.isBuffer(e)&&typeof e!="string"&&(!eT||typeof e!="object"||typeof e.type!="string"||typeof e.asymmetricKeyType!="string"||typeof e.export!="function"))throw ui(_c)}function Q6(e){if(!wc.isBuffer(e)&&typeof e!="string"&&typeof e!="object")throw ui(GOe)}function QOe(e){if(!wc.isBuffer(e)){if(typeof e=="string")return e;if(!eT||typeof e!="object"||e.type!=="secret"||typeof e.export!="function")throw ui(ih)}}function tT(e){return e.replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function Y6(e){e=e.toString();var t=4-e.length%4;if(t!==4)for(var r=0;r<t;++r)e+="=";return e.replace(/\-/g,"+").replace(/_/g,"/")}function ui(e){var t=[].slice.call(arguments,1),r=H6.format.bind(H6,e).apply(null,t);return new TypeError(r)}function YOe(e){return wc.isBuffer(e)||typeof e=="string"}function oh(e){return YOe(e)||(e=JSON.stringify(e)),e}function J6(e){return function(r,n){QOe(n),r=oh(r);var i=Ri.createHmac("sha"+e,n),s=(i.update(r),i.digest("base64"));return tT(s)}}function JOe(e){return function(r,n,i){var s=J6(e)(r,i);return HOe(wc.from(n),wc.from(s))}}function X6(e){return function(r,n){Q6(n),r=oh(r);var i=Ri.createSign("RSA-SHA"+e),s=(i.update(r),i.sign(n,"base64"));return tT(s)}}function Z6(e){return function(r,n,i){G6(i),r=oh(r),n=Y6(n);var s=Ri.createVerify("RSA-SHA"+e);return s.update(r),s.verify(i,n,"base64")}}function XOe(e){return function(r,n){Q6(n),r=oh(r);var i=Ri.createSign("RSA-SHA"+e),s=(i.update(r),i.sign({key:n,padding:Ri.constants.RSA_PKCS1_PSS_PADDING,saltLength:Ri.constants.RSA_PSS_SALTLEN_DIGEST},"base64"));return tT(s)}}function ZOe(e){return function(r,n,i){G6(i),r=oh(r),n=Y6(n);var s=Ri.createVerify("RSA-SHA"+e);return s.update(r),s.verify({key:i,padding:Ri.constants.RSA_PKCS1_PSS_PADDING,saltLength:Ri.constants.RSA_PSS_SALTLEN_DIGEST},n,"base64")}}function e0e(e){var t=X6(e);return function(){var n=t.apply(null,arguments);return n=K6.derToJose(n,"ES"+e),n}}function t0e(e){var t=Z6(e);return function(n,i,s){i=K6.joseToDer(i,"ES"+e).toString("base64");var o=t(n,i,s);return o}}function r0e(){return function(){return""}}function n0e(){return function(t,r){return r===""}}e4.exports=function(t){var r={hs:J6,rs:X6,ps:XOe,es:e0e,none:r0e},n={hs:JOe,rs:Z6,ps:ZOe,es:t0e,none:n0e},i=t.match(/^(RS|PS|ES|HS)(256|384|512)$|^(none)$/i);if(!i)throw ui(KOe,t);var s=(i[1]||i[3]).toLowerCase(),o=i[2];return{sign:r[s](o),verify:n[s](o)}}});var nT=_((WPe,t4)=>{var i0e=require("buffer").Buffer;t4.exports=function(t){return typeof t=="string"?t:typeof t=="number"||i0e.isBuffer(t)?t.toString():JSON.stringify(t)}});var a4=_((zPe,o4)=>{var s0e=jt().Buffer,r4=JC(),o0e=rT(),a0e=require("stream"),n4=nT(),iT=require("util");function i4(e,t){return s0e.from(e,t).toString("base64").replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function u0e(e,t,r){r=r||"utf8";var n=i4(n4(e),"binary"),i=i4(n4(t),r);return iT.format("%s.%s",n,i)}function s4(e){var t=e.header,r=e.payload,n=e.secret||e.privateKey,i=e.encoding,s=o0e(t.alg),o=u0e(t,r,i),a=s.sign(o,n);return iT.format("%s.%s",o,a)}function Tg(e){var t=e.secret||e.privateKey||e.key,r=new r4(t);this.readable=!0,this.header=e.header,this.encoding=e.encoding,this.secret=this.privateKey=this.key=r,this.payload=new r4(e.payload),this.secret.once("close",function(){!this.payload.writable&&this.readable&&this.sign()}.bind(this)),this.payload.once("close",function(){!this.secret.writable&&this.readable&&this.sign()}.bind(this))}iT.inherits(Tg,a0e);Tg.prototype.sign=function(){try{var t=s4({header:this.header,payload:this.payload.buffer,secret:this.secret.buffer,encoding:this.encoding});return this.emit("done",t),this.emit("data",t),this.emit("end"),this.readable=!1,t}catch(r){this.readable=!1,this.emit("error",r),this.emit("close")}};Tg.sign=s4;o4.exports=Tg});var g4=_((HPe,y4)=>{var c4=jt().Buffer,u4=JC(),c0e=rT(),l0e=require("stream"),l4=nT(),f0e=require("util"),h0e=/^[a-zA-Z0-9\-_]+?\.[a-zA-Z0-9\-_]+?\.([a-zA-Z0-9\-_]+)?$/;function d0e(e){return Object.prototype.toString.call(e)==="[object Object]"}function p0e(e){if(d0e(e))return e;try{return JSON.parse(e)}catch{return}}function f4(e){var t=e.split(".",1)[0];return p0e(c4.from(t,"base64").toString("binary"))}function m0e(e){return e.split(".",2).join(".")}function h4(e){return e.split(".")[2]}function y0e(e,t){t=t||"utf8";var r=e.split(".")[1];return c4.from(r,"base64").toString(t)}function d4(e){return h0e.test(e)&&!!f4(e)}function p4(e,t,r){if(!t){var n=new Error("Missing algorithm parameter for jws.verify");throw n.code="MISSING_ALGORITHM",n}e=l4(e);var i=h4(e),s=m0e(e),o=c0e(t);return o.verify(s,i,r)}function m4(e,t){if(t=t||{},e=l4(e),!d4(e))return null;var r=f4(e);if(!r)return null;var n=y0e(e);return(r.typ==="JWT"||t.json)&&(n=JSON.parse(n,t.encoding)),{header:r,payload:n,signature:h4(e)}}function vc(e){e=e||{};var t=e.secret||e.publicKey||e.key,r=new u4(t);this.readable=!0,this.algorithm=e.algorithm,this.encoding=e.encoding,this.secret=this.publicKey=this.key=r,this.signature=new u4(e.signature),this.secret.once("close",function(){!this.signature.writable&&this.readable&&this.verify()}.bind(this)),this.signature.once("close",function(){!this.secret.writable&&this.readable&&this.verify()}.bind(this))}f0e.inherits(vc,l0e);vc.prototype.verify=function(){try{var t=p4(this.signature.buffer,this.algorithm,this.key.buffer),r=m4(this.signature.buffer,this.encoding);return this.emit("done",t,r),this.emit("data",t),this.emit("end"),this.readable=!1,t}catch(n){this.readable=!1,this.emit("error",n),this.emit("close")}};vc.decode=m4;vc.isValid=d4;vc.verify=p4;y4.exports=vc});var xg=_(bo=>{var _4=a4(),Ag=g4(),g0e=["HS256","HS384","HS512","RS256","RS384","RS512","PS256","PS384","PS512","ES256","ES384","ES512"];bo.ALGORITHMS=g0e;bo.sign=_4.sign;bo.verify=Ag.verify;bo.decode=Ag.decode;bo.isValid=Ag.isValid;bo.createSign=function(t){return new _4(t)};bo.createVerify=function(t){return new Ag(t)}});var sT=_((GPe,w4)=>{var _0e=xg();w4.exports=function(e,t){t=t||{};var r=_0e.decode(e,t);if(!r)return null;var n=r.payload;if(typeof n=="string")try{var i=JSON.parse(n);i!==null&&typeof i=="object"&&(n=i)}catch{}return t.complete===!0?{header:r.header,payload:n,signature:r.signature}:n}});var ah=_((QPe,v4)=>{var qg=function(e,t){Error.call(this,e),Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor),this.name="JsonWebTokenError",this.message=e,t&&(this.inner=t)};qg.prototype=Object.create(Error.prototype);qg.prototype.constructor=qg;v4.exports=qg});var oT=_((YPe,O4)=>{var S4=ah(),Mg=function(e,t){S4.call(this,e),this.name="NotBeforeError",this.date=t};Mg.prototype=Object.create(S4.prototype);Mg.prototype.constructor=Mg;O4.exports=Mg});var aT=_((JPe,E4)=>{var b4=ah(),Ng=function(e,t){b4.call(this,e),this.name="TokenExpiredError",this.expiredAt=t};Ng.prototype=Object.create(b4.prototype);Ng.prototype.constructor=Ng;E4.exports=Ng});var uT=_((XPe,C4)=>{var w0e=O0();C4.exports=function(e,t){var r=t||Math.floor(Date.now()/1e3);if(typeof e=="string"){var n=w0e(e);return typeof n>"u"?void 0:Math.floor(r+n/1e3)}else return typeof e=="number"?r+e:void 0}});var U4=_((Oe,F4)=>{Oe=F4.exports=Ve;var Ze;typeof process=="object"&&process.env&&process.env.NODE_DEBUG&&/\bsemver\b/i.test(process.env.NODE_DEBUG)?Ze=function(){var e=Array.prototype.slice.call(arguments,0);e.unshift("SEMVER"),console.log.apply(console,e)}:Ze=function(){};Oe.SEMVER_SPEC_VERSION="2.0.0";var lT=256,$g=Number.MAX_SAFE_INTEGER||9007199254740991,cT=16,ct=Oe.re=[],Y=Oe.src=[],Le=0,Sc=Le++;Y[Sc]="0|[1-9]\\d*";var Oc=Le++;Y[Oc]="[0-9]+";var pT=Le++;Y[pT]="\\d*[a-zA-Z-][a-zA-Z0-9-]*";var A4=Le++;Y[A4]="("+Y[Sc]+")\\.("+Y[Sc]+")\\.("+Y[Sc]+")";var x4=Le++;Y[x4]="("+Y[Oc]+")\\.("+Y[Oc]+")\\.("+Y[Oc]+")";var fT=Le++;Y[fT]="(?:"+Y[Sc]+"|"+Y[pT]+")";var hT=Le++;Y[hT]="(?:"+Y[Oc]+"|"+Y[pT]+")";var mT=Le++;Y[mT]="(?:-("+Y[fT]+"(?:\\."+Y[fT]+")*))";var yT=Le++;Y[yT]="(?:-?("+Y[hT]+"(?:\\."+Y[hT]+")*))";var dT=Le++;Y[dT]="[0-9A-Za-z-]+";var lh=Le++;Y[lh]="(?:\\+("+Y[dT]+"(?:\\."+Y[dT]+")*))";var gT=Le++,q4="v?"+Y[A4]+Y[mT]+"?"+Y[lh]+"?";Y[gT]="^"+q4+"$";var _T="[v=\\s]*"+Y[x4]+Y[yT]+"?"+Y[lh]+"?",wT=Le++;Y[wT]="^"+_T+"$";var Cc=Le++;Y[Cc]="((?:<|>)?=?)";var Pg=Le++;Y[Pg]=Y[Oc]+"|x|X|\\*";var Ig=Le++;Y[Ig]=Y[Sc]+"|x|X|\\*";var Ra=Le++;Y[Ra]="[v=\\s]*("+Y[Ig]+")(?:\\.("+Y[Ig]+")(?:\\.("+Y[Ig]+")(?:"+Y[mT]+")?"+Y[lh]+"?)?)?";var Ec=Le++;Y[Ec]="[v=\\s]*("+Y[Pg]+")(?:\\.("+Y[Pg]+")(?:\\.("+Y[Pg]+")(?:"+Y[yT]+")?"+Y[lh]+"?)?)?";var M4=Le++;Y[M4]="^"+Y[Cc]+"\\s*"+Y[Ra]+"$";var N4=Le++;Y[N4]="^"+Y[Cc]+"\\s*"+Y[Ec]+"$";var $4=Le++;Y[$4]="(?:^|[^\\d])(\\d{1,"+cT+"})(?:\\.(\\d{1,"+cT+"}))?(?:\\.(\\d{1,"+cT+"}))?(?:$|[^\\d])";var kg=Le++;Y[kg]="(?:~>?)";var Rg=Le++;Y[Rg]="(\\s*)"+Y[kg]+"\\s+";ct[Rg]=new RegExp(Y[Rg],"g");var v0e="$1~",P4=Le++;Y[P4]="^"+Y[kg]+Y[Ra]+"$";var I4=Le++;Y[I4]="^"+Y[kg]+Y[Ec]+"$";var Fg=Le++;Y[Fg]="(?:\\^)";var Dg=Le++;Y[Dg]="(\\s*)"+Y[Fg]+"\\s+";ct[Dg]=new RegExp(Y[Dg],"g");var S0e="$1^",R4=Le++;Y[R4]="^"+Y[Fg]+Y[Ra]+"$";var D4=Le++;Y[D4]="^"+Y[Fg]+Y[Ec]+"$";var vT=Le++;Y[vT]="^"+Y[Cc]+"\\s*("+_T+")$|^$";var ST=Le++;Y[ST]="^"+Y[Cc]+"\\s*("+q4+")$|^$";var uh=Le++;Y[uh]="(\\s*)"+Y[Cc]+"\\s*("+_T+"|"+Y[Ra]+")";ct[uh]=new RegExp(Y[uh],"g");var O0e="$1$2$3",j4=Le++;Y[j4]="^\\s*("+Y[Ra]+")\\s+-\\s+("+Y[Ra]+")\\s*$";var B4=Le++;Y[B4]="^\\s*("+Y[Ec]+")\\s+-\\s+("+Y[Ec]+")\\s*$";var L4=Le++;Y[L4]="(<|>)?=?\\s*\\*";for(Eo=0;Eo<Le;Eo++)Ze(Eo,Y[Eo]),ct[Eo]||(ct[Eo]=new RegExp(Y[Eo]));var Eo;Oe.parse=Da;function Da(e,t){if((!t||typeof t!="object")&&(t={loose:!!t,includePrerelease:!1}),e instanceof Ve)return e;if(typeof e!="string"||e.length>lT)return null;var r=t.loose?ct[wT]:ct[gT];if(!r.test(e))return null;try{return new Ve(e,t)}catch{return null}}Oe.valid=b0e;function b0e(e,t){var r=Da(e,t);return r?r.version:null}Oe.clean=E0e;function E0e(e,t){var r=Da(e.trim().replace(/^[=v]+/,""),t);return r?r.version:null}Oe.SemVer=Ve;function Ve(e,t){if((!t||typeof t!="object")&&(t={loose:!!t,includePrerelease:!1}),e instanceof Ve){if(e.loose===t.loose)return e;e=e.version}else if(typeof e!="string")throw new TypeError("Invalid Version: "+e);if(e.length>lT)throw new TypeError("version is longer than "+lT+" characters");if(!(this instanceof Ve))return new Ve(e,t);Ze("SemVer",e,t),this.options=t,this.loose=!!t.loose;var r=e.trim().match(t.loose?ct[wT]:ct[gT]);if(!r)throw new TypeError("Invalid Version: "+e);if(this.raw=e,this.major=+r[1],this.minor=+r[2],this.patch=+r[3],this.major>$g||this.major<0)throw new TypeError("Invalid major version");if(this.minor>$g||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>$g||this.patch<0)throw new TypeError("Invalid patch version");r[4]?this.prerelease=r[4].split(".").map(function(n){if(/^[0-9]+$/.test(n)){var i=+n;if(i>=0&&i<$g)return i}return n}):this.prerelease=[],this.build=r[5]?r[5].split("."):[],this.format()}Ve.prototype.format=function(){return this.version=this.major+"."+this.minor+"."+this.patch,this.prerelease.length&&(this.version+="-"+this.prerelease.join(".")),this.version};Ve.prototype.toString=function(){return this.version};Ve.prototype.compare=function(e){return Ze("SemVer.compare",this.version,this.options,e),e instanceof Ve||(e=new Ve(e,this.options)),this.compareMain(e)||this.comparePre(e)};Ve.prototype.compareMain=function(e){return e instanceof Ve||(e=new Ve(e,this.options)),bc(this.major,e.major)||bc(this.minor,e.minor)||bc(this.patch,e.patch)};Ve.prototype.comparePre=function(e){if(e instanceof Ve||(e=new Ve(e,this.options)),this.prerelease.length&&!e.prerelease.length)return-1;if(!this.prerelease.length&&e.prerelease.length)return 1;if(!this.prerelease.length&&!e.prerelease.length)return 0;var t=0;do{var r=this.prerelease[t],n=e.prerelease[t];if(Ze("prerelease compare",t,r,n),r===void 0&&n===void 0)return 0;if(n===void 0)return 1;if(r===void 0)return-1;if(r===n)continue;return bc(r,n)}while(++t)};Ve.prototype.inc=function(e,t){switch(e){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",t);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",t);break;case"prepatch":this.prerelease.length=0,this.inc("patch",t),this.inc("pre",t);break;case"prerelease":this.prerelease.length===0&&this.inc("patch",t),this.inc("pre",t);break;case"major":(this.minor!==0||this.patch!==0||this.prerelease.length===0)&&this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":(this.patch!==0||this.prerelease.length===0)&&this.minor++,this.patch=0,this.prerelease=[];break;case"patch":this.prerelease.length===0&&this.patch++,this.prerelease=[];break;case"pre":if(this.prerelease.length===0)this.prerelease=[0];else{for(var r=this.prerelease.length;--r>=0;)typeof this.prerelease[r]=="number"&&(this.prerelease[r]++,r=-2);r===-1&&this.prerelease.push(0)}t&&(this.prerelease[0]===t?isNaN(this.prerelease[1])&&(this.prerelease=[t,0]):this.prerelease=[t,0]);break;default:throw new Error("invalid increment argument: "+e)}return this.format(),this.raw=this.version,this};Oe.inc=C0e;function C0e(e,t,r,n){typeof r=="string"&&(n=r,r=void 0);try{return new Ve(e,r).inc(t,n).version}catch{return null}}Oe.diff=T0e;function T0e(e,t){if(OT(e,t))return null;var r=Da(e),n=Da(t),i="";if(r.prerelease.length||n.prerelease.length){i="pre";var s="prerelease"}for(var o in r)if((o==="major"||o==="minor"||o==="patch")&&r[o]!==n[o])return i+o;return s}Oe.compareIdentifiers=bc;var T4=/^[0-9]+$/;function bc(e,t){var r=T4.test(e),n=T4.test(t);return r&&n&&(e=+e,t=+t),e===t?0:r&&!n?-1:n&&!r?1:e<t?-1:1}Oe.rcompareIdentifiers=A0e;function A0e(e,t){return bc(t,e)}Oe.major=x0e;function x0e(e,t){return new Ve(e,t).major}Oe.minor=q0e;function q0e(e,t){return new Ve(e,t).minor}Oe.patch=M0e;function M0e(e,t){return new Ve(e,t).patch}Oe.compare=Ts;function Ts(e,t,r){return new Ve(e,r).compare(new Ve(t,r))}Oe.compareLoose=N0e;function N0e(e,t){return Ts(e,t,!0)}Oe.rcompare=$0e;function $0e(e,t,r){return Ts(t,e,r)}Oe.sort=P0e;function P0e(e,t){return e.sort(function(r,n){return Oe.compare(r,n,t)})}Oe.rsort=I0e;function I0e(e,t){return e.sort(function(r,n){return Oe.rcompare(r,n,t)})}Oe.gt=ch;function ch(e,t,r){return Ts(e,t,r)>0}Oe.lt=jg;function jg(e,t,r){return Ts(e,t,r)<0}Oe.eq=OT;function OT(e,t,r){return Ts(e,t,r)===0}Oe.neq=k4;function k4(e,t,r){return Ts(e,t,r)!==0}Oe.gte=bT;function bT(e,t,r){return Ts(e,t,r)>=0}Oe.lte=ET;function ET(e,t,r){return Ts(e,t,r)<=0}Oe.cmp=Bg;function Bg(e,t,r,n){switch(t){case"===":return typeof e=="object"&&(e=e.version),typeof r=="object"&&(r=r.version),e===r;case"!==":return typeof e=="object"&&(e=e.version),typeof r=="object"&&(r=r.version),e!==r;case"":case"=":case"==":return OT(e,r,n);case"!=":return k4(e,r,n);case">":return ch(e,r,n);case">=":return bT(e,r,n);case"<":return jg(e,r,n);case"<=":return ET(e,r,n);default:throw new TypeError("Invalid operator: "+t)}}Oe.Comparator=Hn;function Hn(e,t){if((!t||typeof t!="object")&&(t={loose:!!t,includePrerelease:!1}),e instanceof Hn){if(e.loose===!!t.loose)return e;e=e.value}if(!(this instanceof Hn))return new Hn(e,t);Ze("comparator",e,t),this.options=t,this.loose=!!t.loose,this.parse(e),this.semver===fh?this.value="":this.value=this.operator+this.semver.version,Ze("comp",this)}var fh={};Hn.prototype.parse=function(e){var t=this.options.loose?ct[vT]:ct[ST],r=e.match(t);if(!r)throw new TypeError("Invalid comparator: "+e);this.operator=r[1],this.operator==="="&&(this.operator=""),r[2]?this.semver=new Ve(r[2],this.options.loose):this.semver=fh};Hn.prototype.toString=function(){return this.value};Hn.prototype.test=function(e){return Ze("Comparator.test",e,this.options.loose),this.semver===fh?!0:(typeof e=="string"&&(e=new Ve(e,this.options)),Bg(e,this.operator,this.semver,this.options))};Hn.prototype.intersects=function(e,t){if(!(e instanceof Hn))throw new TypeError("a Comparator is required");(!t||typeof t!="object")&&(t={loose:!!t,includePrerelease:!1});var r;if(this.operator==="")return r=new Tt(e.value,t),Lg(this.value,r,t);if(e.operator==="")return r=new Tt(this.value,t),Lg(e.semver,r,t);var n=(this.operator===">="||this.operator===">")&&(e.operator===">="||e.operator===">"),i=(this.operator==="<="||this.operator==="<")&&(e.operator==="<="||e.operator==="<"),s=this.semver.version===e.semver.version,o=(this.operator===">="||this.operator==="<=")&&(e.operator===">="||e.operator==="<="),a=Bg(this.semver,"<",e.semver,t)&&(this.operator===">="||this.operator===">")&&(e.operator==="<="||e.operator==="<"),u=Bg(this.semver,">",e.semver,t)&&(this.operator==="<="||this.operator==="<")&&(e.operator===">="||e.operator===">");return n||i||s&&o||a||u};Oe.Range=Tt;function Tt(e,t){if((!t||typeof t!="object")&&(t={loose:!!t,includePrerelease:!1}),e instanceof Tt)return e.loose===!!t.loose&&e.includePrerelease===!!t.includePrerelease?e:new Tt(e.raw,t);if(e instanceof Hn)return new Tt(e.value,t);if(!(this instanceof Tt))return new Tt(e,t);if(this.options=t,this.loose=!!t.loose,this.includePrerelease=!!t.includePrerelease,this.raw=e,this.set=e.split(/\s*\|\|\s*/).map(function(r){return this.parseRange(r.trim())},this).filter(function(r){return r.length}),!this.set.length)throw new TypeError("Invalid SemVer Range: "+e);this.format()}Tt.prototype.format=function(){return this.range=this.set.map(function(e){return e.join(" ").trim()}).join("||").trim(),this.range};Tt.prototype.toString=function(){return this.range};Tt.prototype.parseRange=function(e){var t=this.options.loose;e=e.trim();var r=t?ct[B4]:ct[j4];e=e.replace(r,W0e),Ze("hyphen replace",e),e=e.replace(ct[uh],O0e),Ze("comparator trim",e,ct[uh]),e=e.replace(ct[Rg],v0e),e=e.replace(ct[Dg],S0e),e=e.split(/\s+/).join(" ");var n=t?ct[vT]:ct[ST],i=e.split(" ").map(function(s){return D0e(s,this.options)},this).join(" ").split(/\s+/);return this.options.loose&&(i=i.filter(function(s){return!!s.match(n)})),i=i.map(function(s){return new Hn(s,this.options)},this),i};Tt.prototype.intersects=function(e,t){if(!(e instanceof Tt))throw new TypeError("a Range is required");return this.set.some(function(r){return r.every(function(n){return e.set.some(function(i){return i.every(function(s){return n.intersects(s,t)})})})})};Oe.toComparators=R0e;function R0e(e,t){return new Tt(e,t).set.map(function(r){return r.map(function(n){return n.value}).join(" ").trim().split(" ")})}function D0e(e,t){return Ze("comp",e,t),e=L0e(e,t),Ze("caret",e),e=j0e(e,t),Ze("tildes",e),e=F0e(e,t),Ze("xrange",e),e=V0e(e,t),Ze("stars",e),e}function Qr(e){return!e||e.toLowerCase()==="x"||e==="*"}function j0e(e,t){return e.trim().split(/\s+/).map(function(r){return B0e(r,t)}).join(" ")}function B0e(e,t){var r=t.loose?ct[I4]:ct[P4];return e.replace(r,function(n,i,s,o,a){Ze("tilde",e,n,i,s,o,a);var u;return Qr(i)?u="":Qr(s)?u=">="+i+".0.0 <"+(+i+1)+".0.0":Qr(o)?u=">="+i+"."+s+".0 <"+i+"."+(+s+1)+".0":a?(Ze("replaceTilde pr",a),u=">="+i+"."+s+"."+o+"-"+a+" <"+i+"."+(+s+1)+".0"):u=">="+i+"."+s+"."+o+" <"+i+"."+(+s+1)+".0",Ze("tilde return",u),u})}function L0e(e,t){return e.trim().split(/\s+/).map(function(r){return k0e(r,t)}).join(" ")}function k0e(e,t){Ze("caret",e,t);var r=t.loose?ct[D4]:ct[R4];return e.replace(r,function(n,i,s,o,a){Ze("caret",e,n,i,s,o,a);var u;return Qr(i)?u="":Qr(s)?u=">="+i+".0.0 <"+(+i+1)+".0.0":Qr(o)?i==="0"?u=">="+i+"."+s+".0 <"+i+"."+(+s+1)+".0":u=">="+i+"."+s+".0 <"+(+i+1)+".0.0":a?(Ze("replaceCaret pr",a),i==="0"?s==="0"?u=">="+i+"."+s+"."+o+"-"+a+" <"+i+"."+s+"."+(+o+1):u=">="+i+"."+s+"."+o+"-"+a+" <"+i+"."+(+s+1)+".0":u=">="+i+"."+s+"."+o+"-"+a+" <"+(+i+1)+".0.0"):(Ze("no pr"),i==="0"?s==="0"?u=">="+i+"."+s+"."+o+" <"+i+"."+s+"."+(+o+1):u=">="+i+"."+s+"."+o+" <"+i+"."+(+s+1)+".0":u=">="+i+"."+s+"."+o+" <"+(+i+1)+".0.0"),Ze("caret return",u),u})}function F0e(e,t){return Ze("replaceXRanges",e,t),e.split(/\s+/).map(function(r){return U0e(r,t)}).join(" ")}function U0e(e,t){e=e.trim();var r=t.loose?ct[N4]:ct[M4];return e.replace(r,function(n,i,s,o,a,u){Ze("xRange",e,n,i,s,o,a,u);var c=Qr(s),f=c||Qr(o),h=f||Qr(a),d=h;return i==="="&&d&&(i=""),c?i===">"||i==="<"?n="<0.0.0":n="*":i&&d?(f&&(o=0),a=0,i===">"?(i=">=",f?(s=+s+1,o=0,a=0):(o=+o+1,a=0)):i==="<="&&(i="<",f?s=+s+1:o=+o+1),n=i+s+"."+o+"."+a):f?n=">="+s+".0.0 <"+(+s+1)+".0.0":h&&(n=">="+s+"."+o+".0 <"+s+"."+(+o+1)+".0"),Ze("xRange return",n),n})}function V0e(e,t){return Ze("replaceStars",e,t),e.trim().replace(ct[L4],"")}function W0e(e,t,r,n,i,s,o,a,u,c,f,h,d){return Qr(r)?t="":Qr(n)?t=">="+r+".0.0":Qr(i)?t=">="+r+"."+n+".0":t=">="+t,Qr(u)?a="":Qr(c)?a="<"+(+u+1)+".0.0":Qr(f)?a="<"+u+"."+(+c+1)+".0":h?a="<="+u+"."+c+"."+f+"-"+h:a="<="+a,(t+" "+a).trim()}Tt.prototype.test=function(e){if(!e)return!1;typeof e=="string"&&(e=new Ve(e,this.options));for(var t=0;t<this.set.length;t++)if(z0e(this.set[t],e,this.options))return!0;return!1};function z0e(e,t,r){for(var n=0;n<e.length;n++)if(!e[n].test(t))return!1;if(t.prerelease.length&&!r.includePrerelease){for(n=0;n<e.length;n++)if(Ze(e[n].semver),e[n].semver!==fh&&e[n].semver.prerelease.length>0){var i=e[n].semver;if(i.major===t.major&&i.minor===t.minor&&i.patch===t.patch)return!0}return!1}return!0}Oe.satisfies=Lg;function Lg(e,t,r){try{t=new Tt(t,r)}catch{return!1}return t.test(e)}Oe.maxSatisfying=H0e;function H0e(e,t,r){var n=null,i=null;try{var s=new Tt(t,r)}catch{return null}return e.forEach(function(o){s.test(o)&&(!n||i.compare(o)===-1)&&(n=o,i=new Ve(n,r))}),n}Oe.minSatisfying=K0e;function K0e(e,t,r){var n=null,i=null;try{var s=new Tt(t,r)}catch{return null}return e.forEach(function(o){s.test(o)&&(!n||i.compare(o)===1)&&(n=o,i=new Ve(n,r))}),n}Oe.minVersion=G0e;function G0e(e,t){e=new Tt(e,t);var r=new Ve("0.0.0");if(e.test(r)||(r=new Ve("0.0.0-0"),e.test(r)))return r;r=null;for(var n=0;n<e.set.length;++n){var i=e.set[n];i.forEach(function(s){var o=new Ve(s.semver.version);switch(s.operator){case">":o.prerelease.length===0?o.patch++:o.prerelease.push(0),o.raw=o.format();case"":case">=":(!r||ch(r,o))&&(r=o);break;case"<":case"<=":break;default:throw new Error("Unexpected operation: "+s.operator)}})}return r&&e.test(r)?r:null}Oe.validRange=Q0e;function Q0e(e,t){try{return new Tt(e,t).range||"*"}catch{return null}}Oe.ltr=Y0e;function Y0e(e,t,r){return CT(e,t,"<",r)}Oe.gtr=J0e;function J0e(e,t,r){return CT(e,t,">",r)}Oe.outside=CT;function CT(e,t,r,n){e=new Ve(e,n),t=new Tt(t,n);var i,s,o,a,u;switch(r){case">":i=ch,s=ET,o=jg,a=">",u=">=";break;case"<":i=jg,s=bT,o=ch,a="<",u="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(Lg(e,t,n))return!1;for(var c=0;c<t.set.length;++c){var f=t.set[c],h=null,d=null;if(f.forEach(function(p){p.semver===fh&&(p=new Hn(">=0.0.0")),h=h||p,d=d||p,i(p.semver,h.semver,n)?h=p:o(p.semver,d.semver,n)&&(d=p)}),h.operator===a||h.operator===u||(!d.operator||d.operator===a)&&s(e,d.semver))return!1;if(d.operator===u&&o(e,d.semver))return!1}return!0}Oe.prerelease=X0e;function X0e(e,t){var r=Da(e,t);return r&&r.prerelease.length?r.prerelease:null}Oe.intersects=Z0e;function Z0e(e,t,r){return e=new Tt(e,r),t=new Tt(t,r),e.intersects(t)}Oe.coerce=ebe;function ebe(e){if(e instanceof Ve)return e;if(typeof e!="string")return null;var t=e.match(ct[$4]);return t==null?null:Da(t[1]+"."+(t[2]||"0")+"."+(t[3]||"0"))}});var TT=_((ZPe,V4)=>{var tbe=U4();V4.exports=tbe.satisfies(process.version,"^6.12.0 || >=8.0.0")});var G4=_((eIe,K4)=>{var Vt=ah(),rbe=oT(),W4=aT(),nbe=sT(),ibe=uT(),sbe=TT(),obe=xg(),z4=["RS256","RS384","RS512","ES256","ES384","ES512"],H4=["RS256","RS384","RS512"],abe=["HS256","HS384","HS512"];sbe&&(z4.splice(3,0,"PS256","PS384","PS512"),H4.splice(3,0,"PS256","PS384","PS512"));K4.exports=function(e,t,r,n){typeof r=="function"&&!n&&(n=r,r={}),r||(r={}),r=Object.assign({},r);var i;if(n?i=n:i=function(f,h){if(f)throw f;return h},r.clockTimestamp&&typeof r.clockTimestamp!="number")return i(new Vt("clockTimestamp must be a number"));if(r.nonce!==void 0&&(typeof r.nonce!="string"||r.nonce.trim()===""))return i(new Vt("nonce must be a non-empty string"));var s=r.clockTimestamp||Math.floor(Date.now()/1e3);if(!e)return i(new Vt("jwt must be provided"));if(typeof e!="string")return i(new Vt("jwt must be a string"));var o=e.split(".");if(o.length!==3)return i(new Vt("jwt malformed"));var a;try{a=nbe(e,{complete:!0})}catch(f){return i(f)}if(!a)return i(new Vt("invalid token"));var u=a.header,c;if(typeof t=="function"){if(!n)return i(new Vt("verify must be called asynchronous if secret or public key is provided as a callback"));c=t}else c=function(f,h){return h(null,t)};return c(u,function(f,h){if(f)return i(new Vt("error in secret or public key callback: "+f.message));var d=o[2].trim()!=="";if(!d&&h)return i(new Vt("jwt signature is required"));if(d&&!h)return i(new Vt("secret or public key must be provided"));if(!d&&!r.algorithms&&(r.algorithms=["none"]),r.algorithms||(r.algorithms=~h.toString().indexOf("BEGIN CERTIFICATE")||~h.toString().indexOf("BEGIN PUBLIC KEY")?z4:~h.toString().indexOf("BEGIN RSA PUBLIC KEY")?H4:abe),!~r.algorithms.indexOf(a.header.alg))return i(new Vt("invalid algorithm"));var p;try{p=obe.verify(e,a.header.alg,h)}catch(A){return i(A)}if(!p)return i(new Vt("invalid signature"));var m=a.payload;if(typeof m.nbf<"u"&&!r.ignoreNotBefore){if(typeof m.nbf!="number")return i(new Vt("invalid nbf value"));if(m.nbf>s+(r.clockTolerance||0))return i(new rbe("jwt not active",new Date(m.nbf*1e3)))}if(typeof m.exp<"u"&&!r.ignoreExpiration){if(typeof m.exp!="number")return i(new Vt("invalid exp value"));if(s>=m.exp+(r.clockTolerance||0))return i(new W4("jwt expired",new Date(m.exp*1e3)))}if(r.audience){var y=Array.isArray(r.audience)?r.audience:[r.audience],g=Array.isArray(m.aud)?m.aud:[m.aud],w=g.some(function(A){return y.some(function(x){return x instanceof RegExp?x.test(A):x===A})});if(!w)return i(new Vt("jwt audience invalid. expected: "+y.join(" or ")))}if(r.issuer){var S=typeof r.issuer=="string"&&m.iss!==r.issuer||Array.isArray(r.issuer)&&r.issuer.indexOf(m.iss)===-1;if(S)return i(new Vt("jwt issuer invalid. expected: "+r.issuer))}if(r.subject&&m.sub!==r.subject)return i(new Vt("jwt subject invalid. expected: "+r.subject));if(r.jwtid&&m.jti!==r.jwtid)return i(new Vt("jwt jwtid invalid. expected: "+r.jwtid));if(r.nonce&&m.nonce!==r.nonce)return i(new Vt("jwt nonce invalid. expected: "+r.nonce));if(r.maxAge){if(typeof m.iat!="number")return i(new Vt("iat required when maxAge is specified"));var v=ibe(r.maxAge,m.iat);if(typeof v>"u")return i(new Vt('"maxAge" should be a number of seconds or string representing a timespan eg: "1d", "20h", 60'));if(s>=v+(r.clockTolerance||0))return i(new W4("maxAge exceeded",new Date(v*1e3)))}if(r.complete===!0){var E=a.signature;return i(null,{header:u,payload:m,signature:E})}return i(null,m)})}});var eH=_((tIe,Z4)=>{var Q4=1/0,J4=9007199254740991,ube=17976931348623157e292,Y4=0/0,cbe="[object Arguments]",lbe="[object Function]",fbe="[object GeneratorFunction]",hbe="[object String]",dbe="[object Symbol]",pbe=/^\s+|\s+$/g,mbe=/^[-+]0x[0-9a-f]+$/i,ybe=/^0b[01]+$/i,gbe=/^0o[0-7]+$/i,_be=/^(?:0|[1-9]\d*)$/,wbe=parseInt;function vbe(e,t){for(var r=-1,n=e?e.length:0,i=Array(n);++r<n;)i[r]=t(e[r],r,e);return i}function Sbe(e,t,r,n){for(var i=e.length,s=r+(n?1:-1);n?s--:++s<i;)if(t(e[s],s,e))return s;return-1}function Obe(e,t,r){if(t!==t)return Sbe(e,bbe,r);for(var n=r-1,i=e.length;++n<i;)if(e[n]===t)return n;return-1}function bbe(e){return e!==e}function Ebe(e,t){for(var r=-1,n=Array(e);++r<e;)n[r]=t(r);return n}function Cbe(e,t){return vbe(t,function(r){return e[r]})}function Tbe(e,t){return function(r){return e(t(r))}}var Ug=Object.prototype,xT=Ug.hasOwnProperty,Vg=Ug.toString,Abe=Ug.propertyIsEnumerable,xbe=Tbe(Object.keys,Object),qbe=Math.max;function Mbe(e,t){var r=X4(e)||Rbe(e)?Ebe(e.length,String):[],n=r.length,i=!!n;for(var s in e)(t||xT.call(e,s))&&!(i&&(s=="length"||$be(s,n)))&&r.push(s);return r}function Nbe(e){if(!Pbe(e))return xbe(e);var t=[];for(var r in Object(e))xT.call(e,r)&&r!="constructor"&&t.push(r);return t}function $be(e,t){return t=t??J4,!!t&&(typeof e=="number"||_be.test(e))&&e>-1&&e%1==0&&e<t}function Pbe(e){var t=e&&e.constructor,r=typeof t=="function"&&t.prototype||Ug;return e===r}function Ibe(e,t,r,n){e=qT(e)?e:zbe(e),r=r&&!n?Ube(r):0;var i=e.length;return r<0&&(r=qbe(i+r,0)),Lbe(e)?r<=i&&e.indexOf(t,r)>-1:!!i&&Obe(e,t,r)>-1}function Rbe(e){return Dbe(e)&&xT.call(e,"callee")&&(!Abe.call(e,"callee")||Vg.call(e)==cbe)}var X4=Array.isArray;function qT(e){return e!=null&&Bbe(e.length)&&!jbe(e)}function Dbe(e){return MT(e)&&qT(e)}function jbe(e){var t=AT(e)?Vg.call(e):"";return t==lbe||t==fbe}function Bbe(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=J4}function AT(e){var t=typeof e;return!!e&&(t=="object"||t=="function")}function MT(e){return!!e&&typeof e=="object"}function Lbe(e){return typeof e=="string"||!X4(e)&&MT(e)&&Vg.call(e)==hbe}function kbe(e){return typeof e=="symbol"||MT(e)&&Vg.call(e)==dbe}function Fbe(e){if(!e)return e===0?e:0;if(e=Vbe(e),e===Q4||e===-Q4){var t=e<0?-1:1;return t*ube}return e===e?e:0}function Ube(e){var t=Fbe(e),r=t%1;return t===t?r?t-r:t:0}function Vbe(e){if(typeof e=="number")return e;if(kbe(e))return Y4;if(AT(e)){var t=typeof e.valueOf=="function"?e.valueOf():e;e=AT(t)?t+"":t}if(typeof e!="string")return e===0?e:+e;e=e.replace(pbe,"");var r=ybe.test(e);return r||gbe.test(e)?wbe(e.slice(2),r?2:8):mbe.test(e)?Y4:+e}function Wbe(e){return qT(e)?Mbe(e):Nbe(e)}function zbe(e){return e?Cbe(e,Wbe(e)):[]}Z4.exports=Ibe});var rH=_((rIe,tH)=>{var Hbe="[object Boolean]",Kbe=Object.prototype,Gbe=Kbe.toString;function Qbe(e){return e===!0||e===!1||Ybe(e)&&Gbe.call(e)==Hbe}function Ybe(e){return!!e&&typeof e=="object"}tH.exports=Qbe});var aH=_((nIe,oH)=>{var nH=1/0,Jbe=17976931348623157e292,iH=0/0,Xbe="[object Symbol]",Zbe=/^\s+|\s+$/g,eEe=/^[-+]0x[0-9a-f]+$/i,tEe=/^0b[01]+$/i,rEe=/^0o[0-7]+$/i,nEe=parseInt,iEe=Object.prototype,sEe=iEe.toString;function oEe(e){return typeof e=="number"&&e==lEe(e)}function sH(e){var t=typeof e;return!!e&&(t=="object"||t=="function")}function aEe(e){return!!e&&typeof e=="object"}function uEe(e){return typeof e=="symbol"||aEe(e)&&sEe.call(e)==Xbe}function cEe(e){if(!e)return e===0?e:0;if(e=fEe(e),e===nH||e===-nH){var t=e<0?-1:1;return t*Jbe}return e===e?e:0}function lEe(e){var t=cEe(e),r=t%1;return t===t?r?t-r:t:0}function fEe(e){if(typeof e=="number")return e;if(uEe(e))return iH;if(sH(e)){var t=typeof e.valueOf=="function"?e.valueOf():e;e=sH(t)?t+"":t}if(typeof e!="string")return e===0?e:+e;e=e.replace(Zbe,"");var r=tEe.test(e);return r||rEe.test(e)?nEe(e.slice(2),r?2:8):eEe.test(e)?iH:+e}oH.exports=oEe});var cH=_((iIe,uH)=>{var hEe="[object Number]",dEe=Object.prototype,pEe=dEe.toString;function mEe(e){return!!e&&typeof e=="object"}function yEe(e){return typeof e=="number"||mEe(e)&&pEe.call(e)==hEe}uH.exports=yEe});var dH=_((sIe,hH)=>{var gEe="[object Object]";function _Ee(e){var t=!1;if(e!=null&&typeof e.toString!="function")try{t=!!(e+"")}catch{}return t}function wEe(e,t){return function(r){return e(t(r))}}var vEe=Function.prototype,lH=Object.prototype,fH=vEe.toString,SEe=lH.hasOwnProperty,OEe=fH.call(Object),bEe=lH.toString,EEe=wEe(Object.getPrototypeOf,Object);function CEe(e){return!!e&&typeof e=="object"}function TEe(e){if(!CEe(e)||bEe.call(e)!=gEe||_Ee(e))return!1;var t=EEe(e);if(t===null)return!0;var r=SEe.call(t,"constructor")&&t.constructor;return typeof r=="function"&&r instanceof r&&fH.call(r)==OEe}hH.exports=TEe});var mH=_((oIe,pH)=>{var AEe="[object String]",xEe=Object.prototype,qEe=xEe.toString,MEe=Array.isArray;function NEe(e){return!!e&&typeof e=="object"}function $Ee(e){return typeof e=="string"||!MEe(e)&&NEe(e)&&qEe.call(e)==AEe}pH.exports=$Ee});var vH=_((aIe,wH)=>{var PEe="Expected a function",yH=1/0,IEe=17976931348623157e292,gH=0/0,REe="[object Symbol]",DEe=/^\s+|\s+$/g,jEe=/^[-+]0x[0-9a-f]+$/i,BEe=/^0b[01]+$/i,LEe=/^0o[0-7]+$/i,kEe=parseInt,FEe=Object.prototype,UEe=FEe.toString;function VEe(e,t){var r;if(typeof t!="function")throw new TypeError(PEe);return e=GEe(e),function(){return--e>0&&(r=t.apply(this,arguments)),e<=1&&(t=void 0),r}}function WEe(e){return VEe(2,e)}function _H(e){var t=typeof e;return!!e&&(t=="object"||t=="function")}function zEe(e){return!!e&&typeof e=="object"}function HEe(e){return typeof e=="symbol"||zEe(e)&&UEe.call(e)==REe}function KEe(e){if(!e)return e===0?e:0;if(e=QEe(e),e===yH||e===-yH){var t=e<0?-1:1;return t*IEe}return e===e?e:0}function GEe(e){var t=KEe(e),r=t%1;return t===t?r?t-r:t:0}function QEe(e){if(typeof e=="number")return e;if(HEe(e))return gH;if(_H(e)){var t=typeof e.valueOf=="function"?e.valueOf():e;e=_H(t)?t+"":t}if(typeof e!="string")return e===0?e:+e;e=e.replace(DEe,"");var r=BEe.test(e);return r||LEe.test(e)?kEe(e.slice(2),r?2:8):jEe.test(e)?gH:+e}wH.exports=WEe});var MH=_((uIe,qH)=>{var SH=uT(),YEe=TT(),OH=xg(),JEe=eH(),bH=rH(),EH=aH(),NT=cH(),TH=dH(),Co=mH(),XEe=vH(),AH=["RS256","RS384","RS512","ES256","ES384","ES512","HS256","HS384","HS512","none"];YEe&&AH.splice(3,0,"PS256","PS384","PS512");var ZEe={expiresIn:{isValid:function(e){return EH(e)||Co(e)&&e},message:'"expiresIn" should be a number of seconds or string representing a timespan'},notBefore:{isValid:function(e){return EH(e)||Co(e)&&e},message:'"notBefore" should be a number of seconds or string representing a timespan'},audience:{isValid:function(e){return Co(e)||Array.isArray(e)},message:'"audience" must be a string or array'},algorithm:{isValid:JEe.bind(null,AH),message:'"algorithm" must be a valid string enum value'},header:{isValid:TH,message:'"header" must be an object'},encoding:{isValid:Co,message:'"encoding" must be a string'},issuer:{isValid:Co,message:'"issuer" must be a string'},subject:{isValid:Co,message:'"subject" must be a string'},jwtid:{isValid:Co,message:'"jwtid" must be a string'},noTimestamp:{isValid:bH,message:'"noTimestamp" must be a boolean'},keyid:{isValid:Co,message:'"keyid" must be a string'},mutatePayload:{isValid:bH,message:'"mutatePayload" must be a boolean'}},eCe={iat:{isValid:NT,message:'"iat" should be a number of seconds'},exp:{isValid:NT,message:'"exp" should be a number of seconds'},nbf:{isValid:NT,message:'"nbf" should be a number of seconds'}};function xH(e,t,r,n){if(!TH(r))throw new Error('Expected "'+n+'" to be a plain object.');Object.keys(r).forEach(function(i){var s=e[i];if(!s){if(!t)throw new Error('"'+i+'" is not allowed in "'+n+'"');return}if(!s.isValid(r[i]))throw new Error(s.message)})}function tCe(e){return xH(ZEe,!1,e,"options")}function rCe(e){return xH(eCe,!0,e,"payload")}var CH={audience:"aud",issuer:"iss",subject:"sub",jwtid:"jti"},nCe=["expiresIn","notBefore","noTimestamp","audience","issuer","subject","jwtid"];qH.exports=function(e,t,r,n){typeof r=="function"?(n=r,r={}):r=r||{};var i=typeof e=="object"&&!Buffer.isBuffer(e),s=Object.assign({alg:r.algorithm||"HS256",typ:i?"JWT":void 0,kid:r.keyid},r.header);function o(f){if(n)return n(f);throw f}if(!t&&r.algorithm!=="none")return o(new Error("secretOrPrivateKey must have a value"));if(typeof e>"u")return o(new Error("payload is required"));if(i){try{rCe(e)}catch(f){return o(f)}r.mutatePayload||(e=Object.assign({},e))}else{var a=nCe.filter(function(f){return typeof r[f]<"u"});if(a.length>0)return o(new Error("invalid "+a.join(",")+" option for "+typeof e+" payload"))}if(typeof e.exp<"u"&&typeof r.expiresIn<"u")return o(new Error('Bad "options.expiresIn" option the payload already has an "exp" property.'));if(typeof e.nbf<"u"&&typeof r.notBefore<"u")return o(new Error('Bad "options.notBefore" option the payload already has an "nbf" property.'));try{tCe(r)}catch(f){return o(f)}var u=e.iat||Math.floor(Date.now()/1e3);if(r.noTimestamp?delete e.iat:i&&(e.iat=u),typeof r.notBefore<"u"){try{e.nbf=SH(r.notBefore,u)}catch(f){return o(f)}if(typeof e.nbf>"u")return o(new Error('"notBefore" should be a number of seconds or string representing a timespan eg: "1d", "20h", 60'))}if(typeof r.expiresIn<"u"&&typeof e=="object"){try{e.exp=SH(r.expiresIn,u)}catch(f){return o(f)}if(typeof e.exp>"u")return o(new Error('"expiresIn" should be a number of seconds or string representing a timespan eg: "1d", "20h", 60'))}Object.keys(CH).forEach(function(f){var h=CH[f];if(typeof r[f]<"u"){if(typeof e[h]<"u")return o(new Error('Bad "options.'+f+'" option. The payload already has an "'+h+'" property.'));e[h]=r[f]}});var c=r.encoding||"utf8";if(typeof n=="function")n=n&&XEe(n),OH.createSign({header:s,privateKey:t,payload:e,encoding:c}).once("error",n).once("done",function(f){n(null,f)});else return OH.sign({header:s,payload:e,secret:t,encoding:c})}});var $H=_((cIe,NH)=>{NH.exports={decode:sT(),verify:G4(),sign:MH(),JsonWebTokenError:ah(),NotBeforeError:oT(),TokenExpiredError:aT()}});var aCe={};UH(aCe,{generateToken:()=>sCe,getCustomer:()=>oCe});module.exports=VH(aCe);var IH=li(Kg()),RH=li(require("path"));var a6=li(rg()),u6=li(Kg()),c6=li(require("path")),OSe=c6.default.join(__dirname,"../","../","../",`config/.env.${process.env.NODE_ENV}`);u6.default.config({path:OSe});var nPe=a6.default.connect(process.env.DB_URL||"",{useUnifiedTopology:!0,useNewUrlParser:!0});var ng=li(rg()),bSe=new ng.default.Schema({id:String,email:String,card_number:Number,cvv:Number,expiration_year:String,expiration_month:String}),l6=ng.default.models.customerAccounts||ng.default.model("customerAccounts",bSe,process.env.DB_CUSTOMERACCOUNTS_COLLECTION);var ig=li(rg()),ESe=new ig.default.Schema({id:String,token:String}),f6=ig.default.models.tokens||ig.default.model("tokens",ESe,process.env.DB_TOKENS_COLLECTION);var Zf=class{statusCode;code;message;data;constructor(t,r,n,i){this.statusCode=t,this.code=r,this.message=n,this.data=i}bodyToString(){return{statusCode:this.statusCode,body:JSON.stringify({code:this.code,message:this.message,data:this.data})}}},Ct=class{static success(t){return new Zf(200,0,"success",t).bodyToString()}static generateResult(t,r,n){return new Zf(200,r,n).bodyToString()}static error(t=1e3,r){let n=new Zf(200,t,r);return console.log(n.bodyToString()),n.bodyToString()}};var sg=class{customerAccounts;tokens;constructor(t,r){this.customerAccounts=t,this.tokens=r}async createCustomerAccount(t){try{return await this.customerAccounts.create({id:t.id,email:t.email,card_number:t.card_number,cvv:t.cvv,expiration_year:t.expiration_year,expiration_month:t.expiration_month})}catch(r){throw console.log(r),r}}validateCardNumberLength(t){let r=t.toString().split("").length;return!(r<13||r>16)}validateCardNumberPattern(t){let r=/^(?:(4[0-9]{12}(?:[0-9]{3})?)|(5[1-5][0-9]{14})|(6(?:011|5[0-9]{2})[0-9]{12})|(3[47][0-9]{13})|(3(?:0[0-5]|[68][0-9])[0-9]{11})|((?:2131|1800|35[0-9]{3})[0-9]{11}))$/,n=t.toString();return r.test(n)}validateCvvLength(t){let r=t.toString().split("").length;return!(r<3||r>4)}getCardType(t){switch(t){case 123:return console.log("Card Type: Visa / Mastercard"),"Visa / MasterCard";break;case 4532:return console.log("Card Type: Amex"),"Amex";break;default:return console.log("No registrado"),"none";break}}validateExpirationMonthLength(t){let r=t.split("").length;return!(r<1||r>2)}validateExpirationMonthNumber(t){let r=+t;return!(r<1||r>12)}getMonthNumberString(t){let r=+t;return r<10?"0".concat(r.toString()):r.toString()}validateExpirationYearLength(t){return t.split("").length===4}validateExpirationYearRange(t){let r=+t,n=new Date;return!(r<n.getFullYear()||r>n.getFullYear()+5)}validateEmailLength(t){let r=t.split("").length;return!(r<5||r>100)}validateDomainEmail(t){switch(t.split("@")[1]){case"gmail.com":return console.log("Email Domain: Gmail."),"Gmail";break;case"hotmail.com":return console.log("Email Domain: Hotmail."),"Hotmail";break;case"yahoo.es":return console.log("Email Domain: Yahoo."),"Yahoo";break;default:return console.log("Email Domain: No registrado."),"none";break}}validateHeaderPK(t){let r=t.split("_"),n=r[0];return!(r[1]!=="tknzr"||n!=="pk")}async setIdToken(t,r){try{await this.tokens.create({id:t,token:r})}catch(n){throw console.log(n),n}}getIdToken(t){let r=t.split("_"),n=r[2];return r.length===3?n:"none"}getToken(t){return this.tokens.find({id:t})}getCustomer(t){return this.customerAccounts.find({id:t})}};var Ii=li(M6(),1),qPe=Ii.default.v1,MPe=Ii.default.v3,N6=Ii.default.v4,NPe=Ii.default.v5,$Pe=Ii.default.NIL,PPe=Ii.default.version,IPe=Ii.default.validate,RPe=Ii.default.stringify,DPe=Ii.default.parse;var PH=li(P6()),zg=li($H()),Wg=class extends sg{constructor(t,r){super(t,r)}async generateToken(t,r){console.log("functionName",r==null?void 0:r.functionName);let n=JSON.parse(t.body),i=N6(),s=(0,PH.generate)(16),o="",a="",u="";if(!this.validateHeaderPK(t.headers.Authorization.split(" ")[1]))return Ct.error(2e3,"Pk de negocio incorrecto.");if(!this.validateCardNumberLength(n.card_number))return Ct.error(1001,"Longitud de tarjeta inv\xE1lida.");if(!this.validateCardNumberPattern(n.card_number))return Ct.error(1002,"El n\xFAmero de tarjeta no corresponde a una tarjeta de cr\xE9dito o d\xE9bito.");if(!this.validateCvvLength(n.cvv))return Ct.error(1003,"Longitud de cvv inv\xE1lido.");if(a=this.getCardType(n.cvv),a.toLowerCase()==="none")return Ct.error(1004,"Tipo de tarjeta no registrado.");if(!this.validateExpirationMonthLength(n.expiration_month))return Ct.error(1005,"Longitud de mes de expiraci\xF3n inv\xE1lido.");if(!this.validateExpirationMonthNumber(n.expiration_month))return Ct.error(1006,"N\xFAmero de mes de expiraci\xF3n inv\xE1lido.");if(!this.validateExpirationYearLength(n.expiration_year))return Ct.error(1007,"Longitud de a\xF1o de expiraci\xF3n inv\xE1lido.");if(!this.validateExpirationYearRange(n.expiration_year))return Ct.error(1008,"A\xF1o de expiraci\xF3n fuera de rango.");if(!this.validateEmailLength(n.email))return Ct.error(1009,"Longitud de email fuera de rango.");if(u=this.validateDomainEmail(n.email),u.toLowerCase()==="none")return Ct.error(1010,"Dominio de email inv\xE1lido.");o=(0,zg.sign)({idCustomer:i},process.env.SECRET_KEY,{expiresIn:60*15});try{this.setIdToken(s,o)}catch(c){return console.log(c),Ct.error(c.code,c.message)}try{let c=await this.createCustomerAccount({id:i,email:n.email,card_number:n.card_number,cvv:n.cvv,expiration_year:n.expiration_year,expiration_month:this.getMonthNumberString(n.expiration_month)}),f={token:s};return Ct.success(f)}catch(c){return console.log(c),Ct.error(c.code,c.message)}}async getCustomerAccount(t,r){console.log("functionName",r==null?void 0:r.functionName);let n="";if(!this.validateHeaderPK(t.headers.Authorization.split(" ")[1]))return Ct.error(2e3,"Pk de negocio incorrecto.");if(n=this.getIdToken(t.headers.Authorization.split(" ")[1]),n==="none")return Ct.error(1011,"No se ha introducido el token.");try{let i=await this.getToken(n),o=(0,zg.verify)(i[0].token,process.env.SECRET_KEY).idCustomer,a=await this.getCustomer(o);return Ct.success({email:a[0].email,card_number:a[0].card_number,expiration_year:a[0].expiration_year,expiration_month:a[0].expiration_month})}catch(i){return console.log(i),i.message==="jwt expired"?Ct.error(1012,"El token ha expirado."):i.message==="Cannot read property 'token' of undefined"?Ct.error(1014,"El token no existe."):Ct.error(i.code,i.message)}}};var iCe=RH.default.join(__dirname,"../",`config/.env.${process.env.NODE_ENV}`);IH.default.config({path:iCe});var DH=new Wg(l6,f6),sCe=(e,t)=>DH.generateToken(e,t),oCe=(e,t)=>DH.getCustomerAccount(e,t);0&&(module.exports={generateToken,getCustomer});
/*!
 * 1) Apply backwards compatible find/findOne behavior to sub documents
 *
 *    find logic:
 *      a) filter out non-documents
 *      b) remove _id from sub docs when user specified
 *
 *    findOne
 *      a) if no doc found, set to null
 *      b) remove _id from sub docs when user specified
 *
 * 2) Remove _ids when specified by users query.
 *
 * background:
 * _ids are left in the query even when user excludes them so
 * that population mapping can occur.
 */
/*!
 * @ignore
 */
/*!
 * @param {Schema} schema
 * @param {Object} doc POJO
 * @param {string} path
 */
/*!
 * @see exports.options
 */
/*!
 * A faster Array.prototype.slice.call(arguments) alternative
 * @api private
 */
/*!
 * A list of authentication mechanisms that don't require a password for authentication.
 * This is used by the authMechanismDoesNotRequirePassword method.
 *
 * @api private
 */
/*!
 * A query thunk is the function responsible for sending the query to MongoDB,
 * like `Query#_findOne()` or `Query#_execUpdate()`. The `Query#exec()` function
 * calls a thunk. The term "thunk" here is the traditional Node.js definition:
 * a function that takes exactly 1 parameter, a callback.
 *
 * This function defines common behavior for all query thunks.
 */
/*!
 * Adds the appropriate `$match` pipeline step to the top of an aggregate's
 * pipeline, should it's model is a non-root discriminator type. This is
 * analogous to the `prepareDiscriminatorCriteria` function in `lib/query.js`.
 *
 * @param {Aggregate} aggregate Aggregate to prepare
 */
/*!
 * Applies schema type transforms to `json`.
 *
 * @param {Document} self
 * @param {Object} json
 * @return {Object} `json`
 */
/*!
 * Applies setters without casting
 *
 * @api private
 */
/*!
 * Applies toObject recursively.
 *
 * @param {Document|Array|Object} obj
 * @return {Object}
 * @api private
 */
/*!
 * Applies virtuals properties to `json`.
 *
 * @param {Document} self
 * @param {Object} json
 * @return {Object} `json`
 */
/*!
 * Applies virtuals properties to `json`.
 */
/*!
 * Apply query middleware
 *
 * @param {Query} query constructor
 * @param {Model} model
 */
/*!
 * Apply the operation to the delta (update) clause as
 * well as track versioning for our where clause.
 *
 * @param {Document} self
 * @param {Object} where
 * @param {Object} delta
 * @param {Object} data
 * @param {Mixed} val
 * @param {String} [operation]
 */
/*!
 * Assign `vals` returned by mongo query to the `rawIds`
 * structure returned from utils.getVals() honoring
 * query sort order if specified by user.
 *
 * This can be optimized.
 *
 * Rules:
 *
 *   if the value of the path is not an array, use findOne rules, else find.
 *   for findOne the results are assigned directly to doc path (including null results).
 *   for find, if user specified sort order, results are assigned directly
 *   else documents are put back in original order of array if found in results
 *
 * @param {Array} rawIds
 * @param {Array} vals
 * @param {Boolean} sort
 * @api private
 */
/*!
 * Behaves like `Schema#path()`, except for it also digs into arrays without
 * needing to put `.0.`, so `getPath(schema, 'docArr.elProp')` works.
 */
/*!
 * Browser doc exposes the event emitter API
 */
/*!
 * Casts `val` according to `schema` and atomic `op`.
 *
 * @param {SchemaType} schema
 * @param {Object} val
 * @param {String} op - the atomic operator ($pull, $set, etc)
 * @param {String} $conditional
 * @param {Query} context
 * @api private
 */
/*!
 * Casts an update op based on the given schema
 *
 * @param {Schema} schema
 * @param {Object} obj
 * @param {Object} options
 * @param {Boolean} [options.overwrite] defaults to false
 * @param {Boolean|String} [options.strict] defaults to true
 * @param {Query} context passed to setters
 * @return {Boolean} true iff the update is non-empty
 */
/*!
 * Casts obj for an update command.
 *
 * @param {Object} obj
 * @return {Object} obj after casting its values
 * @api private
 */
/*!
 * Casts val to an object suitable for `$text`. Throws an error if the object
 * can't be casted.
 *
 * @param {Any} val value to cast
 * @param {String} [path] path to associate with any errors that occured
 * @return {Object} casted object
 * @see https://docs.mongodb.com/manual/reference/operator/query/text/
 * @api private
 */
/*!
 * Centralize this so we can more easily work around issues with people
 * stubbing out `process.nextTick()` in tests using sinon:
 * https://github.com/sinonjs/lolex#automatically-incrementing-mocked-time
 * See gh-6074
 */
/*!
 * Checks for indexes added to subdocs using Schema.index().
 * These indexes need their paths prefixed properly.
 *
 * schema._indexes = [ [indexObj, options], [indexObj, options] ..]
 */
/*!
 * Checks to see if at least one path is in the states passed in via `arguments`
 * e.g., this.some('required', 'inited')
 *
 * @param {String} state that we want to check for.
 * @private
 */
/*!
 * Collection
 */
/*!
 * Collection the model uses.
 *
 * @property collection
 * @api public
 * @memberOf Model
 */
/*!
 * Common code for `updateOne()`, `updateMany()`, `replaceOne()`, and `update()`
 * because they need to do the same thing
 */
/*!
 * Compile other Buffer methods marking this buffer as modified.
 */
/*!
 * Compiled middleware for this model. Set in `applyHooks()`.
 *
 * @api private
 * @property _middleware
 * @memberOf Model
 * @static
 */
/*!
 * Compiler utility.
 *
 * @param {String|Function} name model name or class extending Model
 * @param {Schema} schema
 * @param {String} collectionName
 * @param {Connection} connection
 * @param {Mongoose} base mongoose instance
 */
/*!
 * Compiles an update and where clause for a `val` with _atomics.
 *
 * @param {Document} self
 * @param {Object} where
 * @param {Object} delta
 * @param {Object} data
 * @param {Array} value
 */
/*!
 * Compiles schemas.
 */
/*!
 * Connection
 */
/*!
 * Connection instance the model uses.
 *
 * @property db
 * @api public
 * @memberOf Model
 */
/*!
 * Connection states
 */
/*!
 * Convert a raw doc into a full mongoose doc.
 */
/*!
 * Converts `expires` options of index objects to `expiresAfterSeconds` options for MongoDB.
 *
 * @param {Object} object
 * @api private
 */
/*!
 * Converts arguments to ReadPrefs the driver
 * can understand.
 *
 * @param {String|Array} pref
 * @param {Array} [tags]
 */
/*!
 * Converts to POJO when you use the document for querying
 */
/*!
 * Copy the collection methods and make them subject to queues
 */
/*!
 * Create virtual properties with alias field
 */
/*!
 * Date Query casting.
 *
 * @api private
 */
/*!
 * Debug print helper
 */
/*!
 * Decorate buffers
 */
/*!
 * Decorate the update with a version key, if necessary
 */
/*!
 * Defines the accessor named prop on the incoming prototype.
 */
/*!
 * Dependencies
 */
/*!
 * Determine if `obj` is something we can set a populated path to. Can be a
 * document, a lean document, or an array/map that contains docs.
 */
/*!
 * Determine if `val` is null or undefined
 *
 * @return {Boolean}
 */
/*!
 * Determine if array was populated with some form of filter and is now
 * being updated in a manner which could overwrite data unintentionally.
 *
 * @see https://github.com/Automattic/mongoose/issues/1334
 * @param {Document} doc
 * @param {String} path
 * @return {String|undefined}
 */
/*!
 * Determines if `a` and `b` are deep equal.
 *
 * Modified from node/lib/assert.js
 *
 * @param {any} a a value to compare to `b`
 * @param {any} b a value to compare to `a`
 * @return {Boolean}
 * @api private
 */
/*!
 * Determines if `arg` is a plain old JavaScript object (POJO). Specifically,
 * `arg` must be an object but not an instance of any special class, like String,
 * ObjectId, etc.
 *
 * `Object.getPrototypeOf()` is part of ES5: https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/getPrototypeOf
 *
 * @param {Object|Array|String|Function|RegExp|any} arg
 * @api private
 * @return {Boolean}
 */
/*!
 * Determines if `arg` is an object.
 *
 * @param {Object|Array|String|Function|RegExp|any} arg
 * @api private
 * @return {Boolean}
 */
/*!
 * Determines if `obj` is a built-in object like an array, date, boolean,
 * etc.
 */
/*!
 * Determines if `path` is excluded by `projection`
 *
 * @param {Object} projection
 * @param {string} path
 * @return {Boolean}
 */
/*!
 * Determines if `val` is an object that has no own keys
 */
/*!
 * Determines if two buffers are equal.
 *
 * @param {Buffer} a
 * @param {Object} b
 */
/*!
 * Determines whether versioning should be skipped for the given path
 *
 * @param {Document} self
 * @param {String} path
 * @return {Boolean} true if versioning should be skipped for the given path
 */
/*!
 * Document exposes the NodeJS event emitter API, so you can use
 * `on`, `once`, etc.
 */
/*!
 * Export
 */
/*!
 * Exports
 */
/*!
 * Exports.
 */
/*!
 * Find the correct constructor, taking into account discriminators
 */
/*!
 * Flattens an array.
 *
 * [ 1, [ 2, 3, [4] ]] -> [1,2,3,4]
 *
 * @param {Array} arr
 * @param {Function} [filter] If passed, will be invoked with each item in the array. If `filter` returns a falsy value, the item will not be included in the results.
 * @return {Array}
 * @private
 */
/*!
 * Format `mod.match` given that it may be an array that we need to $or if
 * the client has multiple docs with match functions
 */
/*!
 * Formats error messages
 */
/*!
 * Gather all indexes defined in the schema, including single nested,
 * document arrays, and embedded discriminators.
 */
/*!
 * Generates a random string
 *
 * @api private
 */
/*!
 * Get options from query opts, falling back to the base mongoose object.
 */
/*!
 * Get the bson type, if it exists
 */
/*!
 * Get the error to throw for `orFail()`
 */
/*!
 * Get the last element of an array
 */
/*!
 * Get the next doc from the underlying cursor and mongooseify it
 * (populate, etc.)
 */
/*!
 * Getter for convenience with populate, see gh-6115
 */
/*!
 * Give the constructor the ability to emit events.
 */
/*!
 * Given a model and a bulkWrite op, return a thunk that handles casting and
 * validating the individual op.
 */
/*!
 * Given a model and an array of docs, hydrates all the docs to be instances
 * of the model. Used to initialize docs returned from the db from `find()`
 *
 * @param {Model} model
 * @param {Array} docs
 * @param {Object} fields the projection used, including `select` from schemas
 * @param {Object} userProvidedFields the user-specified projection
 * @param {Object} opts
 * @param {Array} [opts.populated]
 * @param {ClientSession} [opts.session]
 * @param {Function} callback
 */
/*!
 * Given a value, cast it to a boolean, or throw a `CastError` if the value
 * cannot be casted. `null` and `undefined` are considered valid.
 *
 * @param {Any} value
 * @param {String} [path] optional the path to set on the CastError
 * @return {Boolean|null|undefined}
 * @throws {CastError} if `value` is not one of the allowed values
 * @api private
 */
/*!
 * Given a value, cast it to a number, or throw a `CastError` if the value
 * cannot be casted. `null` and `undefined` are considered valid.
 *
 * @param {Any} value
 * @param {String} [path] optional the path to set on the CastError
 * @return {Boolean|null|undefined}
 * @throws {Error} if `value` is not one of the allowed values
 * @api private
 */
/*!
 * Given a value, cast it to a string, or throw a `CastError` if the value
 * cannot be casted. `null` and `undefined` are considered valid.
 *
 * @param {Any} value
 * @param {String} [path] optional the path to set on the CastError
 * @return {string|null|undefined}
 * @throws {CastError}
 * @api private
 */
/*!
 * Handle async validators
 */
/*!
 * Handle the `WriteOpResult` from the server
 */
/*!
 * Helper for JSON.stringify
 * Ensure `name` and `message` show up in toJSON output re: gh-9847
 */
/*!
 * Helpers
 */
/*!
 * If `val` is an object, returns constructor name, if possible. Otherwise returns undefined.
 */
/*!
 * If populating a path within a document array, make sure each
 * subdoc within the array knows its subpaths are populated.
 *
 * ####Example:
 *     const doc = await Article.findOne().populate('comments.author');
 *     doc.comments[0].populated('author'); // Should be set
 */
/*!
 * If the document is a mapped discriminator type, it returns a model instance for that type, otherwise,
 * it returns an instance of the given model.
 *
 * @param {Model}  model
 * @param {Object} doc
 * @param {Object} fields
 *
 * @return {Document}
 */
/*!
 * If the model is a discriminator type and not root, then add the key & value to the criteria.
 */
/*!
 * If this is a document array, each element may contain single
 * populated paths, so we need to modify the top-level document's
 * populated cache. See gh-8247, gh-8265.
 */
/*!
 * Ignore
 */
/*!
 * Inherit from Buffer.
 */
/*!
 * Inherit from Document
 */
/*!
 * Inherit from EventEmitter
 */
/*!
 * Inherit from EventEmitter.
 */
/*!
 * Inherit from abstract Collection.
 */
/*!
 * Inherit from the NodeJS document
 */
/*!
 * Inherits from ArrayType.
 */
/*!
 * Inherits from Connection.
 */
/*!
 * Inherits from Document.
 *
 * All Model.prototype features are available on
 * top level (non-sub) documents.
 */
/*!
 * Inherits from SchemaType.
 */
/*!
 * Init helper.
 *
 * @param {Object} self document instance
 * @param {Object} obj raw mongodb doc
 * @param {Object} doc object we are initializing
 * @api private
 */
/*!
 * Internal helper for update, updateMany, updateOne
 */
/*!
 * Internal helper for update, updateMany, updateOne, replaceOne
 */
/*!
 * Internal switch for runSetters
 *
 * @api private
 */
/*!
 * Internal thunk around `deleteMany()`
 */
/*!
 * Internal thunk for .replaceOne()
 *
 * @param {Function} callback
 * @see Model.replaceOne #model_Model.replaceOne
 * @api private
 */
/*!
 * Internal thunk for .update()
 *
 * @param {Function} callback
 * @see Model.update #model_Model.update
 * @api private
 */
/*!
 * Internal thunk for .updateMany()
 *
 * @param {Function} callback
 * @see Model.update #model_Model.update
 * @api private
 */
/*!
 * Internal thunk for .updateOne()
 *
 * @param {Function} callback
 * @see Model.update #model_Model.update
 * @api private
 */
/*!
 * Internal thunk for `deleteOne()`
 */
/*!
 * Iterates over the paths that belong to one of the parameter states.
 *
 * The function profile can look like:
 * this.forEach(state1, fn);         // iterates over all paths in state1
 * this.forEach(state1, state2, fn); // iterates over all paths in state1 or state2
 * this.forEach(fn);                 // iterates over all paths in all states
 *
 * @param {String} [state]
 * @param {String} [state]
 * @param {Function} callback
 * @private
 */
/*!
 * Just like handleArray, except also allows `[]` because surprisingly
 * `$in: [1, []]` works fine
 */
/*!
 * Like `schema.path()`, except with a document, because impossible to
 * determine path type without knowing the embedded discriminator key.
 */
/*!
 * Make sure `this` is a model
 */
/*!
 * Maps over the paths that belong to one of the parameter states.
 *
 * The function profile can look like:
 * this.forEach(state1, fn);         // iterates over all paths in state1
 * this.forEach(state1, state2, fn); // iterates over all paths in state1 or state2
 * this.forEach(fn);                 // iterates over all paths in all states
 *
 * @param {String} [state]
 * @param {String} [state]
 * @param {Function} callback
 * @return {Array}
 * @private
 */
/*!
 * Marks this cursor as errored
 */
/*!
 * Merges `from` into `to` without overwriting existing properties.
 *
 * @param {Object} to
 * @param {Object} from
 * @api private
 */
/*!
 * Minimizes an object, removing undefined values and empty objects
 *
 * @param {Object} object to minimize
 * @return {Object}
 */
/*!
 * Module dependencies
 */
/*!
 * Module dependencies.
 */
/*!
 * Module exports
 */
/*!
 * Module exports.
 */
/*!
 * Module requirements
 */
/*!
 * Module requirements.
 */
/*!
 * Mongoose calls this function internally to validate the query if
 * `runValidators` is set
 *
 * @param {Object} castedDoc the update, after casting
 * @param {Object} options the options from `_optionsForExec()`
 * @param {Function} callback
 * @api private
 */
/*!
 * Necessary to satisfy the Readable API
 */
/*!
 * Object clone with Mongoose natives support.
 *
 * If options.minimize is true, creates a minimal data object. Empty objects and undefined values will not be cloned. This makes the data payload sent to MongoDB as small as possible.
 *
 * Functions are never cloned.
 *
 * @param {Object} obj the object to clone
 * @param {Object} options
 * @param {Boolean} isArrayChild true if cloning immediately underneath an array. Special case for minimize.
 * @return {Object} the cloned object
 * @api private
 */
/*!
 * Optionally filter out invalid ids that don't conform to foreign field's schema
 * to avoid cast errors (gh-7706)
 */
/*!
 * Override mquery.prototype._findAndModify to provide casting etc.
 *
 * @param {String} type - either "remove" or "update"
 * @param {Function} callback
 * @api private
 */
/*!
 * Override mquery.prototype._mergeUpdate to handle mongoose objects in
 * updates.
 *
 * @param {Object} doc
 * @api private
 */
/*!
 * Overwriting mquery is needed to support a couple different near() forms found in older
 * versions of mongoose
 * near([1,1])
 * near(1,1)
 * near(field, [1,2])
 * near(field, 1, 2)
 * In addition to all of the normal forms supported by mquery
 */
/*!
 * Permissions
 */
/*!
 * Pluralize function.
 *
 * @author TJ Holowaychuk (extracted from _ext.js_)
 * @param {String} string to pluralize
 * @api private
 */
/*!
 * Populate helper
 *
 * @param {Model} model the model to use
 * @param {Document|Array} docs Either a single document or array of documents to populate.
 * @param {Object} paths
 * @param {Function} [cb(err,doc)] Optional callback, executed upon completion. Receives `err` and the `doc(s)`.
 * @return {Function}
 * @api private
 */
/*!
 * Populates `docs`
 */
/*!
 * Prepare a set of path options for query population.
 *
 * @param {Query} query
 * @param {Object} options
 * @return {Array}
 */
/*!
 * Prepare a set of path options for query population. This is the MongooseQuery
 * version
 *
 * @param {Query} query
 * @param {Object} options
 * @return {Array}
 */
/*!
 * Produces a collection name from model `name`. By default, just returns
 * the model name
 *
 * @param {String} name a model name
 * @param {Function} pluralize function that pluralizes the collection name
 * @return {String} a collection name
 * @api private
 */
/*!
 * Recursively set nested arrays
 */
/*!
 * Register custom query methods for this model
 *
 * @param {Model} model
 * @param {Schema} schema
 */
/*!
 * Register hooks for this model
 *
 * @param {Model} model
 * @param {Schema} schema
 */
/*!
 * Register listeners for important events and bubble appropriately.
 */
/*!
 * Register methods for this model
 *
 * @param {Model} model
 * @param {Schema} schema
 */
/*!
 * Register statics for this model
 * @param {Model} model
 * @param {Schema} schema
 */
/*!
 * Registers remove event listeners for triggering
 * on subdocuments.
 *
 * @param {EmbeddedDocument} sub
 * @api private
 */
/*!
 * Registers remove event listeners for triggering
 * on subdocuments.
 *
 * @param {Subdocument} sub
 * @api private
 */
/*!
 * Remove _id from `subdoc` if user specified "lean" query option
 */
/*!
 * Removes duplicate values from an array
 *
 * [1, 2, 3, 3, 5] => [1, 2, 3, 5]
 * [ ObjectId("550988ba0c19d57f697dc45e"), ObjectId("550988ba0c19d57f697dc45e") ]
 *    => [ObjectId("550988ba0c19d57f697dc45e")]
 *
 * @param {Array} arr
 * @return {Array}
 * @private
 */
/*!
 * Retrieve the _id of `val` if a Document or Array of Documents.
 *
 * @param {Array|Document|Any} val
 * @return {Array|Document|Any}
 */
/*!
 * Return the value of `obj` at the given `path`.
 *
 * @param {String} path
 * @param {Object} obj
 */
/*!
 * Returns an array of values from object `o`.
 *
 * @param {Object} o
 * @return {Array}
 * @private
 */
/*!
 * Returns if `v` is a mongoose object that has a `toObject()` method we can use.
 *
 * This is for compatibility with libs like Date.js which do foolish things to Natives.
 *
 * @param {any} v
 * @api private
 */
/*!
 * Returns the value passed to it.
 */
/*!
 * Returns this documents _id cast to a string.
 */
/*!
 * Returns true if `v` is an object that can be serialized as a primitive in
 * MongoDB
 */
/*!
 * Runs queued functions
 */
/*!
 * Safer helper for hasOwnProperty checks
 *
 * @param {Object} obj
 * @param {String} prop
 */
/*!
 * Scopes paths selected in a query to this array.
 * Necessary for proper default application of subdocument values.
 *
 * @param {DocumentArrayPath} array - the array to scope `fields` paths
 * @param {Object|undefined} fields - the root fields selected in the query
 * @param {Boolean|undefined} init - if we are being created part of a query result
 */
/*!
 * Search if `obj` or any POJOs nested underneath `obj` has a property named
 * `key`
 */
/*!
 * Set each path query option to lean
 *
 * @param {Object} option
 */
/*!
 * Sets the value of `obj` at the given `path`.
 *
 * @param {String} path
 * @param {Anything} val
 * @param {Object} obj
 */
/*!
 * Shallow copies defaults into options.
 *
 * @param {Object} defaults
 * @param {Object} options
 * @return {Object} the merged object
 * @api private
 */
/*!
 * Simplified lodash.get to work around the annoying null quirk. See:
 * https://github.com/lodash/lodash/issues/3659
 */
/*!
 * Since maps are stored as objects under the hood, keys must be strings
 * and can't contain any invalid characters
 */
/*!
 * Special case for when users use a common location schema to represent
 * locations for use with $geoWithin.
 * https://docs.mongodb.org/manual/reference/operator/query/geoWithin/
 *
 * @param {Object} val
 * @api private
 */
/*!
 * StateMachine represents a minimal `interface` for the
 * constructors it builds via StateMachine.ctor(...).
 *
 * @api private
 */
/*!
 * StateMachine.ctor('state1', 'state2', ...)
 * A factory method for subclassing StateMachine.
 * The arguments are a list of states. For each state,
 * the constructor's prototype gets state transition
 * methods named after each state. These transition methods
 * place their path argument into the given state.
 *
 * @param {String} state
 * @param {String} [state]
 * @return {Function} subclass constructor
 * @private
 */
/*!
 * Subclass this model with `conn`, `schema`, and `collection` settings.
 *
 * @param {Connection} conn
 * @param {Schema} [schema]
 * @param {String} [collection]
 * @return {Model}
 */
/*!
 * Support the `new` option as an alternative to `returnOriginal` for backwards
 * compat.
 */
/*!
 * The class that Mongoose uses internally to instantiate this SchemaType's `options` property.
 */
/*!
 * The exports object is an instance of Mongoose.
 *
 * @api public
 */
/*!
 * The mongodb driver 1.3.23 only supports the nested array sort
 * syntax. We must convert it or sorting findAndModify will not work.
 */
/*!
 * The object used to define this validator. Not enumerable to hide
 * it from `require('util').inspect()` output re: gh-3925
 */
/*!
 * These operators require casting docs
 * to real Documents for Update operations.
 */
/*!
 * These operators should be cast to numbers instead
 * of their path schema type.
 */
/*!
 * These ops require no casting because the RHS doesn't do anything.
 */
/*!
 * This function builds the functions that get assigned to `forEach` and `map`,
 * since both of those methods share a lot of the same logic.
 *
 * @param {String} iterMethod is either 'forEach' or 'map'
 * @return {Function}
 * @api private
 */
/*!
 * This function is wrapped by the state change functions:
 *
 * - `require(path)`
 * - `modify(path)`
 * - `init(path)`
 *
 * @api private
 */
/*!
 * Thunk around findOneAndDelete()
 *
 * @param {Function} [callback]
 * @return {Query} this
 * @api private
 */
/*!
 * Thunk around findOneAndRemove()
 *
 * @param {Function} [callback]
 * @return {Query} this
 * @api private
 */
/*!
 * Thunk around findOneAndReplace()
 *
 * @param {Function} [callback]
 * @return {Query} this
 * @api private
 */
/*!
 * Thunk around findOneAndUpdate()
 *
 * @param {Function} [callback]
 * @api private
 */
/*!
 * Use native promises by default
 */
/*!
 * Valid mongoose options
 */
/*!
 * Walk each path of obj and cast its values
 * according to its schema.
 *
 * @param {Schema} schema
 * @param {Object} obj - part of a query
 * @param {String} op - the atomic operator ($pull, $set, etc)
 * @param {Object} options
 * @param {Boolean|String} [options.strict]
 * @param {Boolean} [options.omitUndefined]
 * @param {Query} context
 * @param {String} pref - path prefix (internal only)
 * @return {Bool} true if this path has keys to update
 * @api private
 */
/*!
 * Wraps `castForQuery` to handle context
 */
/*!
 * [node-mongodb-native](https://github.com/mongodb/node-mongodb-native) ObjectId
 * @constructor NodeMongoDbObjectId
 * @see ObjectId
 */
/*!
 * castDoc
 * @api private
 */
/*!
 * castQuery
 * @api private
 */
/*!
 * define methods
 */
/*!
 * exports
 */
/*!
 * gets discriminator model if discriminator key is present in object
 */
/*!
 * gt, gte, lt, lte, ne, in, nin, all, regex, size, maxDistance
 *
 *     Thing.where('type').nin(array)
 */
/*!
 * hydrates a document
 *
 * @param {Model} model
 * @param {Document} doc
 * @param {Object} res 3rd parameter to callback
 * @param {Object} fields
 * @param {Query} self
 * @param {Array} [pop] array of paths used in population
 * @param {Function} callback
 */
/*!
 * ignore
 */
/*!
 * ignore. Deprecated re: #6405
 */
/*!
 * inherit mquery
 */
/*!
 * limit, skip, maxScan, batchSize, comment
 *
 * Sets these associated options.
 *
 *     query.comment('feed query');
 */
/*!
 * no-op for hooks
 */
/*!
 * populate helper
 */
/*!
 * process.nextTick helper.
 *
 * Wraps `callback` in a try/catch + nextTick.
 *
 * node-mongodb-native has a habit of state corruption when an error is immediately thrown from within a collection callback.
 *
 * @param {Function} callback
 * @api private
 */
/*!
 * this is needed to support the mongoose syntax of:
 * box(field, { ll : [x,y], ur : [x2,y2] })
 * box({ ll : [x,y], ur : [x2,y2] })
 */
/*!
* Avoid Node deprecation warning DEP0079
*/
/*!
* returns discriminator by discriminatorMapping.value
*
* @param {Model} model
* @param {string} value
*/
/*!
* returns discriminator by discriminatorMapping.value
*
* @param {Schema} schema
* @param {string} value
*/
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */
/*! safe-buffer. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */
